<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>python,day11,django - blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="khw" /><meta name="description" content="python django框架详解
" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.100.1 with theme even" />


<link rel="canonical" href="http://localhost:1313/post/pythonday11django/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.8c3cbcb0324c2bb4875ceccba4007cbad4b4ac8377f33af9953c3e7684534a50.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="python,day11,django" />
<meta property="og:description" content="python django框架详解" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/pythonday11django/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-07T11:06:25+08:00" />
<meta property="article:modified_time" content="2022-01-07T11:06:25+08:00" />

<meta itemprop="name" content="python,day11,django">
<meta itemprop="description" content="python django框架详解"><meta itemprop="datePublished" content="2022-01-07T11:06:25+08:00" />
<meta itemprop="dateModified" content="2022-01-07T11:06:25+08:00" />
<meta itemprop="wordCount" content="76615">
<meta itemprop="keywords" content="python,django," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="python,day11,django"/>
<meta name="twitter:description" content="python django框架详解"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">类别</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">类别</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">python,day11,django</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-07 </span>
        <div class="post-category">
            <a href="/categories/python/"> python </a>
            </div>
          <span class="more-meta"> 76615 words </span>
          <span class="more-meta"> 153 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#前戏纯手撸web框架">前戏：纯手撸web框架</a>
          <ul>
            <li><a href="#第一次推导">第一次推导</a></li>
            <li><a href="#第二次推导">第二次推导</a></li>
            <li><a href="#第三次推导">第三次推导</a></li>
            <li><a href="#第四次推导">第四次推导</a></li>
            <li><a href="#动静态网页">动静态网页</a></li>
            <li><a href="#python三大主流web框架">python三大主流web框架</a></li>
          </ul>
        </li>
        <li><a href="#第一篇django框架基础">第一篇：django框架基础</a>
          <ul>
            <li><a href="#1--前言">1  前言</a></li>
            <li><a href="#2-django必会命令">2 django必会命令</a></li>
            <li><a href="#3-主要文件介绍">3 主要文件介绍</a></li>
            <li><a href="#4-django三板斧">4 django三板斧</a></li>
            <li><a href="#5-静态文件配置">5 静态文件配置</a></li>
            <li><a href="#6-request对象方法初识">6 request对象方法初识</a></li>
            <li><a href="#7-pycharm连接数据库">7 pycharm连接数据库</a></li>
            <li><a href="#8-django连接数据库mysql">8 django连接数据库(mysql)</a></li>
            <li><a href="#9-django-orm">9 django ORM</a></li>
            <li><a href="#10-利用orm实现数据的增删改查操作">10 利用ORM实现数据的增删改查操作</a></li>
            <li><a href="#11-案例实现登录注册编辑用户">11 案例：实现登录，注册，编辑用户</a></li>
            <li><a href="#12-orm如何创建表关系">12 orm如何创建表关系</a></li>
            <li><a href="#13-django生命周期流程图">13 django生命周期流程图</a></li>
          </ul>
        </li>
        <li><a href="#第二篇django路由层">第二篇：django路由层</a>
          <ul>
            <li><a href="#1-urlspy">1 urls.py</a></li>
            <li><a href="#2-无名分组有名分组">2 无名分组，有名分组</a></li>
            <li><a href="#3-反向解析">3 反向解析</a></li>
            <li><a href="#4-无名反向解析案例">4 无名反向解析案例</a></li>
            <li><a href="#5-路由分发">5 路由分发</a></li>
            <li><a href="#6-命名空间了解">6 命名空间（了解）</a></li>
            <li><a href="#7-伪静态了解">7 伪静态（了解）</a></li>
            <li><a href="#8-django版本区别了解">8 django版本区别（了解）</a></li>
          </ul>
        </li>
        <li><a href="#第三篇django视图层">第三篇：django视图层</a>
          <ul>
            <li><a href="#1-三板斧">1 三板斧</a></li>
            <li><a href="#2-jsonresponse">2 jsonResponse</a></li>
            <li><a href="#3-form表单上传文件">3 form表单上传文件</a></li>
            <li><a href="#4-fbv与cbv">4 FBV与CBV</a></li>
            <li><a href="#5-cbv源码剖析">5 CBV源码剖析</a></li>
            <li><a href="#54-settings源码剖析">5.4 settings源码剖析</a></li>
          </ul>
        </li>
        <li><a href="#第四篇django模板层">第四篇：django模板层</a>
          <ul>
            <li><a href="#1-模板语法传值">1 模板语法传值</a></li>
            <li><a href="#2-模板语法之过滤器最多两个参数">2 模板语法之过滤器(最多两个参数)</a></li>
            <li><a href="#3-模板语法之标签">3 模板语法之标签</a></li>
            <li><a href="#4-自定义过滤器标签inclusion_tag">4 自定义过滤器、标签、inclusion_tag</a></li>
            <li><a href="#5-模板的继承">5 模板的继承</a></li>
            <li><a href="#6-模板的导入">6 模板的导入</a></li>
          </ul>
        </li>
        <li><a href="#第五篇django模型层">第五篇：django模型层</a>
          <ul>
            <li><a href="#1-sql测试环境">1 sql测试环境</a></li>
            <li><a href="#2-单表操作">2 单表操作</a></li>
            <li><a href="#3-测试脚本">3 测试脚本</a></li>
            <li><a href="#4-django终端打印sql语句">4 django终端打印sql语句</a></li>
            <li><a href="#5-必知必会13条">5 必知必会13条</a></li>
            <li><a href="#6-神奇的双下划线查询">6 神奇的双下划线查询</a></li>
            <li><a href="#7-外键字段的增删改">7 外键字段的增删改</a></li>
            <li><a href="#8-正反向概念">8 正反向概念</a></li>
            <li><a href="#9-多表查询">9 多表查询</a></li>
            <li><a href="#10-聚合查询聚合函数">10 聚合查询（聚合函数）</a></li>
            <li><a href="#11-分组查询">11 分组查询</a></li>
            <li><a href="#12-f与q查询">12 F与Q查询</a></li>
            <li><a href="#13-django事务">13 django事务</a></li>
            <li><a href="#14-orm中常用字段及参数">14 orm中常用字段及参数</a></li>
            <li><a href="#15-数据库查询优化面试常考">15 数据库查询优化(面试常考)</a></li>
            <li><a href="#16-choices参数">16 choices参数</a></li>
            <li><a href="#17-mtv与mvc模型">17 MTV与MVC模型</a></li>
            <li><a href="#18-多对多三种创建方式">18 多对多三种创建方式</a></li>
          </ul>
        </li>
        <li><a href="#第六篇ajax分页器cookie与sessionform中间件auth">第六篇：ajax，分页器，cookie与session，form，中间件，auth</a>
          <ul>
            <li><a href="#1ajax与django">1、Ajax与django</a></li>
            <li><a href="#2分页器">2、分页器</a></li>
            <li><a href="#3form组件">3、form组件</a></li>
            <li><a href="#4cookie与session原理">4、Cookie与session原理</a></li>
            <li><a href="#5django中间件">5、django中间件</a></li>
            <li><a href="#6补充知识点importlib">6、补充知识点importlib</a></li>
            <li><a href="#7auth模块">7、Auth模块</a></li>
          </ul>
        </li>
        <li><a href="#第七篇rest-framework">第七篇：Rest Framework</a>
          <ul>
            <li><a href="#1drf入门规范">1、drf入门规范</a></li>
            <li><a href="#2序列化器serializer">2、序列化器Serializer</a></li>
            <li><a href="#3请求和响应">3、请求和响应</a></li>
            <li><a href="#4视图">4、视图</a></li>
            <li><a href="#5路由">5、路由</a></li>
            <li><a href="#6认证">6、认证</a></li>
            <li><a href="#7权限">7、权限</a></li>
            <li><a href="#8限流throttling">8、限流Throttling</a></li>
            <li><a href="#9过滤">9、过滤</a></li>
            <li><a href="#10排序">10、排序</a></li>
            <li><a href="#11分页">11、分页</a></li>
            <li><a href="#12异常处理">12、异常处理</a></li>
            <li><a href="#13封装response对象">13、封装Response对象</a></li>
            <li><a href="#14自动生成接口文档">14、自动生成接口文档</a></li>
            <li><a href="#15jwt认证">15、JWT认证</a></li>
            <li><a href="#16django缓存">16、django缓存</a></li>
            <li><a href="#17-celery异步任务框架">17 Celery(异步任务框架)</a></li>
            <li><a href="#18综合应用">18、综合应用</a></li>
            <li><a href="#18drf总结">18、drf总结</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>python django框架详解</p>
<h2 id="前戏纯手撸web框架">前戏：纯手撸web框架</h2>
<h3 id="第一次推导">第一次推导</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 不足之处
</span></span><span class="line"><span class="cl">	1、代码重复
</span></span><span class="line"><span class="cl">	2、手动处理http格式的数据 并且只能拿到url后缀，其他数据获取繁琐(数据格式一样处理代码其实也大致一样 重复写)
</span></span><span class="line"><span class="cl">	3、并发问题
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 可以将web框架理解成服务端
</span></span><span class="line"><span class="cl">import socket
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">b&#39;GET /index HTTP/1.1\r\nHost: 127ec-F...
</span></span><span class="line"><span class="cl">b&#39;GET /favicon.ico HTTP/1.1\r\nHost: 127...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">如何做到后缀不同返回不同的内容
</span></span><span class="line"><span class="cl">1、fav的那行不看
</span></span><span class="line"><span class="cl">2、可以通过打印data得知/index 为我们输入的后缀
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">server = socket.socket()  # tcp 三次握手四次回收
</span></span><span class="line"><span class="cl">server.bind((&#39;127.0.0.1&#39;,8080))  # ip协议 以太网协议 arp协议..
</span></span><span class="line"><span class="cl">server.listen(5)   # 池的概念复习
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">while True:
</span></span><span class="line"><span class="cl">    conn, addr = server.accept()
</span></span><span class="line"><span class="cl">    data = conn.recv(1024)
</span></span><span class="line"><span class="cl">    # print(data)     # 二进制数据，需要解码
</span></span><span class="line"><span class="cl">    data = data.decode(&#39;utf-8&#39;)      # 字符串
</span></span><span class="line"><span class="cl">    # 获取字符串中特定的内容，正则，如果字符串有规律也可以考虑用切割
</span></span><span class="line"><span class="cl">    conn.send(b&#39;HTTP/1.1 200 OK\r\n\r\n&#39;)
</span></span><span class="line"><span class="cl">    current_path = data.split(&#39; &#39;)[1]   # 拿到列表，而我们后缀在d
</span></span><span class="line"><span class="cl">    print(current_path)     # 拿到后缀
</span></span><span class="line"><span class="cl">    if current_path == &#39;/index&#39;:
</span></span><span class="line"><span class="cl">        # conn.send(b&#39;index heiheihie&#39;)
</span></span><span class="line"><span class="cl">        with open(r&#39;myheml.html&#39;,&#39;rb&#39;) as f:
</span></span><span class="line"><span class="cl">            conn.send(f.read())
</span></span><span class="line"><span class="cl">    elif current_path == &#39;/login&#39;:
</span></span><span class="line"><span class="cl">        conn.send(b&#39;login&#39;)
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        conn.send(b&#39;400&#39;)
</span></span><span class="line"><span class="cl">    conn.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="第二次推导">第二次推导</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl"># 借助 wsgiref
</span></span><span class="line"><span class="cl">1、帮助封装了socket代码
</span></span><span class="line"><span class="cl">2、帮忙处理了http格式的数据(大字典)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">web服务网关接口
</span></span><span class="line"><span class="cl">1、请求来的时候帮助自动拆分http格式数据，并且封装成好处理的数据格式
</span></span><span class="line"><span class="cl">2、响应走的时候将数据打包成符合http格式
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">from wsgiref.simple_server import make_server
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def run(env, response):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    :param env: 请求相关的所有数据
</span></span><span class="line"><span class="cl">    :param response: 响应相关的所有数据
</span></span><span class="line"><span class="cl">    :return: 返回浏览器的数据
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    response(&#39;200 OK&#39;, [])  # 响应首行 响应头
</span></span><span class="line"><span class="cl">    # print(env) # 是一个大字典 wsgiref模块帮忙处理好http格式的数据
</span></span><span class="line"><span class="cl">    current_path = env.get(&#39;PATH_INFO&#39;)
</span></span><span class="line"><span class="cl">    if current_path == &#39;/index&#39;:
</span></span><span class="line"><span class="cl">        return [b&#39;index&#39;]
</span></span><span class="line"><span class="cl">    elif current_path == &#39;/login&#39;:
</span></span><span class="line"><span class="cl">        return [b&#39;login&#39;]
</span></span><span class="line"><span class="cl">    return [b&#39;404 error&#39;]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">if __name__ == &#39;__main__&#39;:
</span></span><span class="line"><span class="cl">    server = make_server(&#39;127.0.0.1&#39;, 8081, run)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    会实时监听上面的地址和端口，只要有客户端
</span></span><span class="line"><span class="cl">    来了都会交给run函数处理(加括号触发run函数)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    server.serve_forever() # 启动服务端
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="第三次推导">第三次推导</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 由于第二次推导添加功能太麻烦，所以经过优化后得到以下内容
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from wsgiref.simple_server import make_server
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 将env传入函数内，函数就拿到更多数据，可以做更多操作
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(env):
</span></span><span class="line"><span class="cl">    return &#39;index&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def login(env):
</span></span><span class="line"><span class="cl">    return &#39;login&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def error(env):
</span></span><span class="line"><span class="cl">    return &#39;error&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urls = [
</span></span><span class="line"><span class="cl">    (&#39;/index&#39;, index),
</span></span><span class="line"><span class="cl">    (&#39;/login&#39;, login)
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def run(env, response):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    :param env: 请求相关的所有数据
</span></span><span class="line"><span class="cl">    :param response: 响应相关的所有数据
</span></span><span class="line"><span class="cl">    :return: 返回浏览器的数据
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    response(&#39;200 OK&#39;, [])  # 响应首行 响应头
</span></span><span class="line"><span class="cl">    # print(env) # 是一个大字典 wsgiref模块帮忙处理好http格式的数据
</span></span><span class="line"><span class="cl">    current_path = env.get(&#39;PATH_INFO&#39;)
</span></span><span class="line"><span class="cl">    # 定义一个变量，存储匹配到函数名,一旦匹配到将url对应的函数名赋值给func
</span></span><span class="line"><span class="cl">    func = None
</span></span><span class="line"><span class="cl">    for url in urls:
</span></span><span class="line"><span class="cl">        if current_path == url[0]:
</span></span><span class="line"><span class="cl">            func = url[1]
</span></span><span class="line"><span class="cl">            break   # 匹配到一个之后，立刻结束for循环
</span></span><span class="line"><span class="cl">    # 判断func是否有值
</span></span><span class="line"><span class="cl">    if func:
</span></span><span class="line"><span class="cl">        res = func(env)
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        res = error(env)
</span></span><span class="line"><span class="cl">    return [res.encode(&#39;utf-8&#39;)]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">if __name__ == &#39;__main__&#39;:
</span></span><span class="line"><span class="cl">    server = make_server(&#39;127.0.0.1&#39;, 8081, run)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    会实时监听上面的地址和端口，只要有客户端
</span></span><span class="line"><span class="cl">    来了都会交给run函数处理(加括号触发run函数)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    server.serve_forever()  # 启动服务端
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="第四次推导">第四次推导</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 将第三次推导解耦合为三个文件，一个文件夹
</span></span><span class="line"><span class="cl"># 更具不同的功能拆分成不同的py文件
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">wsgiref		写启动程序
</span></span><span class="line"><span class="cl">urls.py		路由于视图函数对应关系
</span></span><span class="line"><span class="cl">views.py	视图函数（后端业务逻辑）
</span></span><span class="line"><span class="cl">templates文件夹	专门用来存储html文件
</span></span><span class="line"><span class="cl"># 按照功能不同拆分之后 后续添加功能只需要在urls.py书写对应关系，在views.py中写函数逻辑即可
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 第一个文件wsgiref
</span></span><span class="line"><span class="cl">from wsgiref.simple_server import make_server
</span></span><span class="line"><span class="cl">from url import urls
</span></span><span class="line"><span class="cl">from vleus import *
</span></span><span class="line"><span class="cl"># 将env传入函数内，函数就拿到更多数据，可以做更多操作
</span></span><span class="line"><span class="cl">def run(env, response):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    :param env: 请求相关的所有数据
</span></span><span class="line"><span class="cl">    :param response: 响应相关的所有数据
</span></span><span class="line"><span class="cl">    :return: 返回浏览器的数据
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    response(&#39;200 OK&#39;, [])  # 响应首行 响应头
</span></span><span class="line"><span class="cl">    # print(env) # 是一个大字典 wsgiref模块帮忙处理好http格式的数据
</span></span><span class="line"><span class="cl">    current_path = env.get(&#39;PATH_INFO&#39;)
</span></span><span class="line"><span class="cl">    # 定义一个变量，存储匹配到函数名,一旦匹配到将url对应的函数名赋值给func
</span></span><span class="line"><span class="cl">    func = None
</span></span><span class="line"><span class="cl">    for url in urls:
</span></span><span class="line"><span class="cl">        if current_path == url[0]:
</span></span><span class="line"><span class="cl">            func = url[1]
</span></span><span class="line"><span class="cl">            break   # 匹配到一个之后，立刻结束for循环
</span></span><span class="line"><span class="cl">    # 判断func是否有值
</span></span><span class="line"><span class="cl">    if func:
</span></span><span class="line"><span class="cl">        res = func(env)
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        res = error(env)
</span></span><span class="line"><span class="cl">    return [res.encode(&#39;utf-8&#39;)]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">if __name__ == &#39;__main__&#39;:
</span></span><span class="line"><span class="cl">    server = make_server(&#39;127.0.0.1&#39;, 8081, run)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    会实时监听上面的地址和端口，只要有客户端
</span></span><span class="line"><span class="cl">    来了都会交给run函数处理(加括号触发run函数)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    server.serve_forever()  # 启动服务端
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 第二个文件 urls.py
</span></span><span class="line"><span class="cl">from vleus import *
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># url于函数的对应关系
</span></span><span class="line"><span class="cl">urls = [
</span></span><span class="line"><span class="cl">    (&#39;/index&#39;, index),
</span></span><span class="line"><span class="cl">    (&#39;/login&#39;, login),
</span></span><span class="line"><span class="cl">    (&#39;/xxx&#39;,xxx)
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 第三个文件views.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(env):
</span></span><span class="line"><span class="cl">    return &#39;index&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def login(env):
</span></span><span class="line"><span class="cl">    return &#39;login&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def error(env):
</span></span><span class="line"><span class="cl">    return &#39;error&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def xxx(env):
</span></span><span class="line"><span class="cl">    with open(r&#39;templates/myhtml.html&#39;,&#39;r&#39;,encoding=&#39;utf-8&#39;) as f:
</span></span><span class="line"><span class="cl">        return f.read()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 第四个目录templates文件夹
</span></span><span class="line"><span class="cl">	myhtml.html
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="动静态网页">动静态网页</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">静态网页
</span></span><span class="line"><span class="cl">	页面上的数据是直接写死的，万年不变
</span></span><span class="line"><span class="cl">动态网页
</span></span><span class="line"><span class="cl">	数据是实时获取的
</span></span><span class="line"><span class="cl">    1、后端获取当前时间，展示到当前html页面上
</span></span><span class="line"><span class="cl">    2、将一个字典传递给html文件，并且可以在文件上方便快捷操作字典数据
</span></span><span class="line"><span class="cl">    3、利用wsgiref模块封装web框架，加上jinja2模板语法 结合前端后端数据库
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="时间案例">时间案例</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 让html页面显示时间
</span></span><span class="line"><span class="cl">import datetime
</span></span><span class="line"><span class="cl">def get_time(env):
</span></span><span class="line"><span class="cl">    current_time = datetime.datetime.now().strftime(&#39;%Y-%m-%d %X&#39;)
</span></span><span class="line"><span class="cl">    # 如何将后端获取到的数据传递给html文件
</span></span><span class="line"><span class="cl">    with open(&#39;templates/myhtml.html&#39;,&#39;rt&#39;,encoding=&#39;utf-8&#39;) as f:
</span></span><span class="line"><span class="cl">        data = f.read()
</span></span><span class="line"><span class="cl">        # data就是一堆字符串
</span></span><span class="line"><span class="cl">    data = data.replace(&#39;asdasdasda&#39;,current_time)
</span></span><span class="line"><span class="cl">    return data
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="jinja2模块案例">jinja2模块案例</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 将一个字典传递给html文件，并且可以在文件上方便快捷操作字典数据
</span></span><span class="line"><span class="cl"># 在后端html文件起作用
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pip3 install jinja2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 模板语法
</span></span><span class="line"><span class="cl">{{ user }}}
</span></span><span class="line"><span class="cl">{{ user.get(&#39;username&#39;)}}
</span></span><span class="line"><span class="cl">{{ user.get(&#39;age&#39;)}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from jinja2 import Template
</span></span><span class="line"><span class="cl">def get_dict(env):
</span></span><span class="line"><span class="cl">    user_dic = {&#39;username&#39;:&#39;jason&#39;,&#39;age&#39;:18}
</span></span><span class="line"><span class="cl">    with  open(r&#39;templates/myhtml.html&#39;,&#39;r&#39;,encoding=&#39;utf-8&#39;) as f:
</span></span><span class="line"><span class="cl">        data = f.read()
</span></span><span class="line"><span class="cl">    tmp = Template(data)
</span></span><span class="line"><span class="cl">    res = tmp.render(user = user_dic)
</span></span><span class="line"><span class="cl">    # 给get_dict，html传递了一个值，页面上通过变量名user能够拿到user_dict
</span></span><span class="line"><span class="cl">    return res
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="数据库案例融汇贯通">数据库案例(融汇贯通)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 利用wsgiref模块封装web框架，加上jinja2模板语法 结合前端后端数据库
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">html文件
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;div class=&#34;container&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;dic class=&#34;row&#34;&gt;
</span></span><span class="line"><span class="cl">        &lt;div class=&#34;col-md-8 col-md-offset-2&#34;&gt;
</span></span><span class="line"><span class="cl">            &lt;h1 class=&#34;text-center&#34;&gt;用户数据&lt;/h1&gt;
</span></span><span class="line"><span class="cl">            &lt;table class=&#34;table table-hover table-striped&#34;&gt;&lt;/table&gt;
</span></span><span class="line"><span class="cl">                &lt;thead&gt;
</span></span><span class="line"><span class="cl">                    &lt;tr&gt;
</span></span><span class="line"><span class="cl">                        &lt;th&gt;ID&lt;/th&gt;
</span></span><span class="line"><span class="cl">                        &lt;th&gt;username&lt;/th&gt;
</span></span><span class="line"><span class="cl">                        &lt;th&gt;password&lt;/th&gt;
</span></span><span class="line"><span class="cl">                        &lt;th&gt;hobby&lt;/th&gt;
</span></span><span class="line"><span class="cl">                    &lt;/tr&gt;
</span></span><span class="line"><span class="cl">                &lt;/thead&gt;
</span></span><span class="line"><span class="cl">                &lt;tbody&gt;
</span></span><span class="line"><span class="cl">                    {% for user_dic in user_list%}
</span></span><span class="line"><span class="cl">                        &lt;tr&gt;
</span></span><span class="line"><span class="cl">                            &lt;td&gt;{{user_dic.id}}&lt;/td&gt;
</span></span><span class="line"><span class="cl">                            &lt;td&gt;{{user_dic.username}}&lt;/td&gt;
</span></span><span class="line"><span class="cl">                            &lt;td&gt;{{user_dic.password}}&lt;/td&gt;
</span></span><span class="line"><span class="cl">                            &lt;td&gt;{{user_dic.hobby}}&lt;/td&gt;
</span></span><span class="line"><span class="cl">                        &lt;/tr&gt;
</span></span><span class="line"><span class="cl">                    {% endfor %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                &lt;/tbody&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &lt;/div&gt;
</span></span><span class="line"><span class="cl">    &lt;/dic&gt;
</span></span><span class="line"><span class="cl">&lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vleus文件
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">import pymysql
</span></span><span class="line"><span class="cl">def get_user(env):
</span></span><span class="line"><span class="cl">    # 去数据库中获取数据，传递给html页面，借助于模板语法，发送给浏览器
</span></span><span class="line"><span class="cl">    conn = pymysql.connect(
</span></span><span class="line"><span class="cl">        host = &#39;127.0.0.1&#39;,
</span></span><span class="line"><span class="cl">        port = 3306,
</span></span><span class="line"><span class="cl">        user = &#39;root&#39;,
</span></span><span class="line"><span class="cl">        password = &#39;admin123&#39;,
</span></span><span class="line"><span class="cl">        db = &#39;day59&#39;,
</span></span><span class="line"><span class="cl">        charset = &#39;utf8&#39;,
</span></span><span class="line"><span class="cl">        autocomit = True    # 自动提交
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">    cursor = conn.cursor(cursor = pymysql.cursors.DictCursor)
</span></span><span class="line"><span class="cl">    sql = &#39;select * from user&#39;
</span></span><span class="line"><span class="cl">    affect_rows = cursor.execute(sql)  # 影响的行数
</span></span><span class="line"><span class="cl">    data_list = cursor.fatchall()   # 字典套数组的模式
</span></span><span class="line"><span class="cl">    # 将获取到的数据传递给html文件
</span></span><span class="line"><span class="cl">    with open(r&#39;templates/myhtml.html&#39;,&#39;r&#39;,encoding=&#39;utf-8&#39;) as f:
</span></span><span class="line"><span class="cl">        data = f.read()
</span></span><span class="line"><span class="cl">    tmp = Template(data)
</span></span><span class="line"><span class="cl">    res = tmp.render(user_list = data_list)
</span></span><span class="line"><span class="cl">    # 给html文件传递一个值，可以通过变量user_list就能拿到data_list
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="python三大主流web框架">python三大主流web框架</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">django
</span></span><span class="line"><span class="cl">	特点：大而全 自带的功能特别多，类似航母
</span></span><span class="line"><span class="cl">	不足：有时候过于笨重
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">flask
</span></span><span class="line"><span class="cl">	特点：小而精 自带的功能特别少，类似游骑兵
</span></span><span class="line"><span class="cl">	第三方的模块特别多，而且越来越小django
</span></span><span class="line"><span class="cl">	不足：比较依赖于第三方的开发者
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">tornado
</span></span><span class="line"><span class="cl">	特点：异步非阻塞  支持高并发
</span></span><span class="line"><span class="cl">		牛逼到甚至可以开发游戏服务器
</span></span><span class="line"><span class="cl">	不足：暂时不会
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">一个框架大致分为三部分
</span></span><span class="line"><span class="cl">A:socket部分
</span></span><span class="line"><span class="cl">B:路由与视图函数对应关系
</span></span><span class="line"><span class="cl">C:模板语法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">django
</span></span><span class="line"><span class="cl">	A用的是别人的	wsgiref模块
</span></span><span class="line"><span class="cl">	B用自己的
</span></span><span class="line"><span class="cl">	C用自己的(没有jinja2好用，但是也方便)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">flask
</span></span><span class="line"><span class="cl">	A用的是别人的	 werkzeug(内部还是wsgiref模块)
</span></span><span class="line"><span class="cl">	B用自己的
</span></span><span class="line"><span class="cl">	C用别人的(jinja2)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">tornado
</span></span><span class="line"><span class="cl">	ABC都是自己写的
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="第一篇django框架基础">第一篇：django框架基础</h2>
<h3 id="1--前言">1  前言</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">注意事项：
</span></span><span class="line"><span class="cl">	正常启动django项目要求
</span></span><span class="line"><span class="cl">	1、计算机名称不能有中文
</span></span><span class="line"><span class="cl">	2、pycharm窗口只开一个项目
</span></span><span class="line"><span class="cl">	3、项目里面所有文件也是不要出现中文
</span></span><span class="line"><span class="cl">	4、python解释器尽量使用3.4到3.6之间的版本
</span></span><span class="line"><span class="cl">		如果项目报错，可以点击最后一个报错信息
</span></span><span class="line"><span class="cl">		去源码中，把逗号删掉
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">django版本问题
</span></span><span class="line"><span class="cl">	市面上有三个版本
</span></span><span class="line"><span class="cl">	1.x  2.x   3.x(直接忽略)
</span></span><span class="line"><span class="cl">	1.x 和 2.x 本身差距也不大，学习主要以1.11为例，会讲解2.x区别
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">django安装
</span></span><span class="line"><span class="cl">	pip3 install django == 1.11.11
</span></span><span class="line"><span class="cl">	验证是否成功
</span></span><span class="line"><span class="cl">	在终端输入django-admin看看有没有反应
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-django必会命令">2 django必会命令</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">linux创建django项目   （重点）
</span></span><span class="line"><span class="cl">命令行操作
</span></span><span class="line"><span class="cl">	1、创建django项目
</span></span><span class="line"><span class="cl">		可以先切换到对应的盘，然后再创建
</span></span><span class="line"><span class="cl">		django-admin startproject 项目名
</span></span><span class="line"><span class="cl">			项目名文件夹
</span></span><span class="line"><span class="cl">				manage.py
</span></span><span class="line"><span class="cl">				mysite文件夹
</span></span><span class="line"><span class="cl">					__init__.py
</span></span><span class="line"><span class="cl">					settings.py
</span></span><span class="line"><span class="cl">					urls.py
</span></span><span class="line"><span class="cl">					wsgi.py
</span></span><span class="line"><span class="cl">	2、启动django项目（先切换到mysite文件夹下）
</span></span><span class="line"><span class="cl">		&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">		一定要先切换到项目目录下
</span></span><span class="line"><span class="cl">		&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">		python3 manage.py runserver
</span></span><span class="line"><span class="cl">		htpp://127.0.0.1:8000
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	3、创建应用
</span></span><span class="line"><span class="cl">		python manage.py startapp app01
</span></span><span class="line"><span class="cl">		名字应该见名知意
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">注意事项：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 命令行和pycharm创建的区别
</span></span><span class="line"><span class="cl"># pycharm创建
</span></span><span class="line"><span class="cl">TEMPLATES = [
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        &#39;BACKEND&#39;: &#39;django.template.backends.django.DjangoTemplates&#39;,
</span></span><span class="line"><span class="cl">        &#39;DIRS&#39;: [BASE_DIR / &#39;templates&#39;] # 拼接templates路径
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># linux创建
</span></span><span class="line"><span class="cl">TEMPLATES = [
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        &#39;BACKEND&#39;: &#39;django.template.backends.django.DjangoTemplates&#39;,
</span></span><span class="line"><span class="cl">        &#39;DIRS&#39;: []
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">意味着在用命令行创建django项目的时候还需要去配置文件中配置路径
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 创建出来的应用第一步先去配置文件中注册
</span></span><span class="line"><span class="cl">INSTALLED_APPS = [
</span></span><span class="line"><span class="cl">    &#39;django.contrib.admin&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.auth&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.contenttypes&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.sessions&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.messages&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.staticfiles&#39;,
</span></span><span class="line"><span class="cl">    &#39;app1.apps.App1Config&#39;,
</span></span><span class="line"><span class="cl">]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-主要文件介绍">3 主要文件介绍</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-mysite项目文件夹
</span></span><span class="line"><span class="cl">	--mysite文件夹
</span></span><span class="line"><span class="cl">		---settings.py			配置文件
</span></span><span class="line"><span class="cl">		---urls.py				路由于视图函数对应的关系
</span></span><span class="line"><span class="cl">		---wsgi.py				wsgiref模块(不考虑)
</span></span><span class="line"><span class="cl">	--manage.py					django的入口文件
</span></span><span class="line"><span class="cl">	--db.sqlite3				django自带的sqlite3数据库(小型数据库，功能不多有bug)
</span></span><span class="line"><span class="cl">	--app01文件夹
</span></span><span class="line"><span class="cl">		---admin.py				django后台管理
</span></span><span class="line"><span class="cl">		---apps.py				注册使用
</span></span><span class="line"><span class="cl">		---migrations文件夹	  数据库迁移记录
</span></span><span class="line"><span class="cl">		---models.py			数据库相关的 模型类(orm)
</span></span><span class="line"><span class="cl">		---tests.py				测试文件
</span></span><span class="line"><span class="cl">		---views.py				视图函数(视图层)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-django三板斧">4 django三板斧</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">HttpRespose
</span></span><span class="line"><span class="cl">	返回字符串类型的数据
</span></span><span class="line"><span class="cl">	return HttpResponse(&#39;你好啊，我是django妹质&#39;)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">render
</span></span><span class="line"><span class="cl">	返回html文件的
</span></span><span class="line"><span class="cl">	return render(request,&#39;myfilst.html&#39;)
</span></span><span class="line"><span class="cl">	# 方式一：将user_dict传给html文件，html文件通过data取值
</span></span><span class="line"><span class="cl">	return render(request,&#39;myfilst.html&#39;,{&#39;data&#39;:user_dic,&#39;data&#39;,123})	
</span></span><span class="line"><span class="cl">	# 方式二：locals会将所在名称空间中所有名字传递给html页面
</span></span><span class="line"><span class="cl">	return render(request,&#39;myfilst.html&#39;,locals())
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">redirect
</span></span><span class="line"><span class="cl">	重定向
</span></span><span class="line"><span class="cl">	return redirect(&#39;http://47.96.177.8:82/&#39;)
</span></span><span class="line"><span class="cl">	return redirect(&#39;/home/&#39;)	# 还可以重定向到自己的目录
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">===============案例===============
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.shortcuts import render,HttpResponse,redirect
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    :param request: 请求相关的所有数据，比之前的env更加牛逼
</span></span><span class="line"><span class="cl">    :return:
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    # return HttpResponse(&#39;你好啊，我是django妹质&#39;)
</span></span><span class="line"><span class="cl">    # return render(request,&#39;myfilst.html&#39;)  # 自动去tempaltes文件夹下查找文件
</span></span><span class="line"><span class="cl">    # return redirect(&#39;http://47.96.177.8:82/&#39;)
</span></span><span class="line"><span class="cl">	return redirect(&#39;/home/&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-静态文件配置">5 静态文件配置</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">我们将html文件默认放在templates文件夹下
</span></span><span class="line"><span class="cl">我们将网站所使用的静态文件夹默认都放在static文件夹下
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">静态文件
</span></span><span class="line"><span class="cl">	前端已经写好了的 能够直接调用使用的文件
</span></span><span class="line"><span class="cl">		网站写好的js文件
</span></span><span class="line"><span class="cl">		网站写好的css文件
</span></span><span class="line"><span class="cl">		网站用到的图片文件
</span></span><span class="line"><span class="cl">		第三方前端框架
</span></span><span class="line"><span class="cl">		...
</span></span><span class="line"><span class="cl">		拿来直接可以使用
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># django不会自动创建static文件夹，需要手动创建
</span></span><span class="line"><span class="cl">一般情况下我们在static文件夹下还会进一步划分
</span></span><span class="line"><span class="cl">	-static
</span></span><span class="line"><span class="cl">		--js
</span></span><span class="line"><span class="cl">		--css
</span></span><span class="line"><span class="cl">		--img
</span></span><span class="line"><span class="cl">		其他第三方文件
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">在浏览器中输入url能够看到对应的资源
</span></span><span class="line"><span class="cl">是应为后端提前开设了该资源的接口
</span></span><span class="line"><span class="cl">如果访问不到资源，说明后端没有开设该资源的接口
</span></span><span class="line"><span class="cl">向html文件就会应为以上原因使用不了bootstrap
</span></span><span class="line"><span class="cl">file:///D:/pycharm/pythonProject/djangoProject/djangoProject/bootstrap-3.4.1-dist/css/bootstrap.min.css
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 静态文件配置
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    STATIC_URL = &#39;/static/&#39; # 类似与访问静态文件的令牌
</span></span><span class="line"><span class="cl">    # 访问页面的时候导入的bootstrap路径只有
</span></span><span class="line"><span class="cl">    # 令牌对了才能拿着后缀去下面列表中查找
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    STATICFILES_DIRS = [
</span></span><span class="line"><span class="cl">    os.path.join(BASE_DIR,&#39;static&#39;),
</span></span><span class="line"><span class="cl">    os.path.join(BASE_DIR,&#39;static1&#39;)
</span></span><span class="line"><span class="cl">    ]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 静态文件动态解析
</span></span><span class="line"><span class="cl">    {% load static %}
</span></span><span class="line"><span class="cl">    &lt;link href=&#34;{% static &#39;bootstrap-3.4.1-dist/css/bootstrap.min.css&#39; %}&#34; rel=&#34;stylesheet&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;{% static &#39;bootstrap-3.4.1-dist/js/bootstrap.min.js&#39; %}&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">	这样一来，无论STATIC_URL如何变都能动态获取令牌
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">***************************************
</span></span><span class="line"><span class="cl">当在写django项目的时候，可能出现后端代码修改了，但是前端页面没有变化的情况
</span></span><span class="line"><span class="cl">	1、在同一个端口开了好几个django项目
</span></span><span class="line"><span class="cl">		而你一直跑的是第一个django项目
</span></span><span class="line"><span class="cl">	2、浏览器缓存问题
</span></span><span class="line"><span class="cl">		settings
</span></span><span class="line"><span class="cl">			network	
</span></span><span class="line"><span class="cl">				disable cache勾上
</span></span><span class="line"><span class="cl">***************************************
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-request对象方法初识">6 request对象方法初识</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">request.method	# 返回请求方式，并且是全大写的字符串形式
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">request.POST	# 获取用户post请求提交的普通数据(不包含文件)
</span></span><span class="line"><span class="cl">	request.POST.get()	# 只获取列表最后一个元素，str类型
</span></span><span class="line"><span class="cl">	request.POST.getlist()	# 直接将列表取出
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">request.GET		# 获取用户提交的get请求数据(url后面的数据)
</span></span><span class="line"><span class="cl">	request.GET.get()	# 只获取列表最后一个元素
</span></span><span class="line"><span class="cl">	request.GET.getlist()	# 直接将列表取出
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">get请求携带的数据是有大小限制的，大概4kb左右
</span></span><span class="line"><span class="cl">post请求则没有限制
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># form表单默认是get请求数据
</span></span><span class="line"><span class="cl"># 不论是get请求还是post请求都会触发login函数体代码
</span></span><span class="line"><span class="cl">http://127.0.0.1:8000/login/?username=&amp;password=
</span></span><span class="line"><span class="cl">form表单action参数
</span></span><span class="line"><span class="cl">	1、不写 默认朝当前所在的url提交数据
</span></span><span class="line"><span class="cl">	2、全写，指名道姓
</span></span><span class="line"><span class="cl">	3、只写后缀/ab_render/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 在前期我们使用django提交post请求的时候，需要去配置文件中注释掉一行代码
</span></span><span class="line"><span class="cl">MIDDLEWARE = [
</span></span><span class="line"><span class="cl">    &#39;django.middleware.security.SecurityMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.common.CommonMiddleware&#39;,
</span></span><span class="line"><span class="cl">    # &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def login(request):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    get请求和post请求应该有不同的处理机制
</span></span><span class="line"><span class="cl">    :param request: 请求相关的数据对象，里面有很多的建议方法
</span></span><span class="line"><span class="cl">    :return:
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    # print(request.method)   # 返回请求方式，并且是全大写的字符串
</span></span><span class="line"><span class="cl">    # if request.method == &#39;GET&#39;:
</span></span><span class="line"><span class="cl">    #     print(&#39;来了老弟&#39;)
</span></span><span class="line"><span class="cl">    #     return render(request,&#39;login.html&#39;)
</span></span><span class="line"><span class="cl">    # elif request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">    #     return HttpResponse(&#39;收到了，宝贝&#39;)
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        # 获取用户数据
</span></span><span class="line"><span class="cl">        print(request.POST)  # 获取用户提交的post请求数(不包含文件)
</span></span><span class="line"><span class="cl">        # &lt; QueryDict: {&#39;username&#39;: [&#39;&#39;], &#39;password&#39;: [&#39;&#39;]} &gt;
</span></span><span class="line"><span class="cl">        # username = request.POST.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        # asd = request.POST.getlist(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        # print(username, type(username))
</span></span><span class="line"><span class="cl">        # print(asd, type(asd))
</span></span><span class="line"><span class="cl">        # # get只会获取列表最后一个元素
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        return HttpResponse(&#39;收到了，宝贝&#39;)
</span></span><span class="line"><span class="cl">    # 获取url后面携带的参数
</span></span><span class="line"><span class="cl">    print(request.GET)
</span></span><span class="line"><span class="cl">    print(request.GET.get(&#39;username&#39;))
</span></span><span class="line"><span class="cl">    print(request.GET.getlist(&#39;username&#39;))
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    return render(request, &#39;login.html&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># request对象方法
</span></span><span class="line"><span class="cl">request.method	# 返回请求方式，并且是全大写的字符串形式
</span></span><span class="line"><span class="cl">request.POST	# 获取用户post请求提交的普通数据(不包含文件)
</span></span><span class="line"><span class="cl">request.GET		
</span></span><span class="line"><span class="cl">request.FILES	# 获取文件
</span></span><span class="line"><span class="cl">request.body	# 原生浏览器发送过来的二进制数据
</span></span><span class="line"><span class="cl">request.path	# 能获取url参数
</span></span><span class="line"><span class="cl">request.get_full_path()		# 能获取完整的url及问号后面的参数
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">django中的request.POST只能取到Content-Type(请求头)为application/x-www-form-urlencoded(form表单默认格式)的数据，如果请求头为application/json(json格式)，multipart/form-data(文件)等格式无法取到，只有在request.body里面能取到原生的数据。当发送过来的是JSON数据是，request.POST取到的数据是空的，这时只有用request.body取，再反序列化才能使用。
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7-pycharm连接数据库">7 pycharm连接数据库</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 找到pycharm databases选项
</span></span><span class="line"><span class="cl"># 选择对应数据库，下载对应驱动
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="8-django连接数据库mysql">8 django连接数据库(mysql)</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 默认用的是sqkite3
</span></span><span class="line"><span class="cl">DATABASES = {
</span></span><span class="line"><span class="cl">    &#39;default&#39;: {
</span></span><span class="line"><span class="cl">        &#39;ENGINE&#39;: &#39;django.db.backends.sqlite3&#39;,
</span></span><span class="line"><span class="cl">        &#39;NAME&#39;: BASE_DIR / &#39;db.sqlite3&#39;,
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># django连接mysql
</span></span><span class="line"><span class="cl">	1、第一步配置文件中配置
</span></span><span class="line"><span class="cl">        DATABASES = {
</span></span><span class="line"><span class="cl">            &#39;default&#39;: {
</span></span><span class="line"><span class="cl">                &#39;ENGINE&#39;: &#39;django.db.backends.mysql&#39;,
</span></span><span class="line"><span class="cl">                &#39;NAME&#39;: &#39;bianji&#39;,
</span></span><span class="line"><span class="cl">                &#39;USER&#39;:&#39;root&#39;,
</span></span><span class="line"><span class="cl">                &#39;PASSWORD&#39;:&#39;Huawei12#$&#39;,
</span></span><span class="line"><span class="cl">                &#39;HOST&#39;:&#39;127.0.0.1&#39;,
</span></span><span class="line"><span class="cl">                &#39;PORT&#39;:3306,
</span></span><span class="line"><span class="cl">                &#39;CHARSET&#39;:&#39;utf8&#39;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">	2、代码声明 init文件指定
</span></span><span class="line"><span class="cl">        django默认用的是mysqldb模块连接mysql
</span></span><span class="line"><span class="cl">        但是该模块兼容性不好，需要手动改为pymysql连接
</span></span><span class="line"><span class="cl">        所以需要告诉django使用pymysql
</span></span><span class="line"><span class="cl">        # 在项目名下的init或者任意应用下的init文件中书写代码
</span></span><span class="line"><span class="cl">		import pymysql
</span></span><span class="line"><span class="cl">		pymysql.install_as_MySQLdb()
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="9-django-orm">9 django ORM</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">orm不会帮你创建库，只能创建表的层面
</span></span><span class="line"><span class="cl">需要提前创建号库
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ORM. 对象关系映射
</span></span><span class="line"><span class="cl">作用：能够让一个不会sql语句的小白也能够用python代码操作数据库
</span></span><span class="line"><span class="cl">不足：封装程度太高，有时候sql语句的效率低 需要自己写sql语句
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">类		映射		表
</span></span><span class="line"><span class="cl">对象				记录
</span></span><span class="line"><span class="cl">对象属性		记录某个字段对应的值
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 1、先去models.py书写一个类
</span></span><span class="line"><span class="cl">	# 这个类里面需要继承models.Model
</span></span><span class="line"><span class="cl">    class User(models.Model):
</span></span><span class="line"><span class="cl">    # id int primary_key auto_increment
</span></span><span class="line"><span class="cl">    id = models.AutoField(primary_key=True)
</span></span><span class="line"><span class="cl">    # username varchar(32)
</span></span><span class="line"><span class="cl">    username = models.CharField(max_length=32,verbose_name=&#39;对字段的解释&#39;)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    CharField必须要指定max_length参数，不写会报错
</span></span><span class="line"><span class="cl">    verbose_name：该参数是所有字段都有的，对字段的解释
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # password int
</span></span><span class="line"><span class="cl">    password = models.IntegerField(verbose_name=&#39;密码&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Author(models.Model):
</span></span><span class="line"><span class="cl">    # 由于一张表中必须要有一个主键字段，并且一般情况下都叫id字段
</span></span><span class="line"><span class="cl">    # 所以orm当你不自定义主键字段的时候，orm会自动创建一个名为id主键字段
</span></span><span class="line"><span class="cl">    # 也就意味着后续我们在创建模型表的时候如果主键字段名没有额外的叫法，那么主键字段可以省略不写
</span></span><span class="line"><span class="cl">    # username varchar(32)
</span></span><span class="line"><span class="cl">    username = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    # password int
</span></span><span class="line"><span class="cl">    password = models.IntegerField()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">****************数据库迁移命令*******************
</span></span><span class="line"><span class="cl"># 2、数据库迁移命令
</span></span><span class="line"><span class="cl">	python manage.py makemigrations  
</span></span><span class="line"><span class="cl">	# 将操作记录记录到mirgrations内，不会操作数据库
</span></span><span class="line"><span class="cl">	python manage.py migrate	
</span></span><span class="line"><span class="cl">	# 将操作真正的同步到数据库
</span></span><span class="line"><span class="cl">	# 只要修改了models.py中更数据库相关的代码，就必须重写执行上述的两条命令
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	# pycharm简单快捷输入
</span></span><span class="line"><span class="cl">		tools
</span></span><span class="line"><span class="cl">		run manage.py task
</span></span><span class="line"><span class="cl">			自动提示
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">ps:Python数据迁移，提示The datetime and django.utils.timezone modules are available, so you can do e.g. timezone.now
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">解决办法：执行python manage.py makemigrations后，输入1，输入2是exit退出。然后输入timezone.now
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="10-利用orm实现数据的增删改查操作">10 利用ORM实现数据的增删改查操作</h3>
<p><strong>字段的增删改</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 字段的添加
</span></span><span class="line"><span class="cl">	1、当表中已经有数据 可以在终端内直接给出默认值
</span></span><span class="line"><span class="cl">    2、该字段可以为空
</span></span><span class="line"><span class="cl">        info = models.CharField(max_length=32,verbose_name=&#39;个人简介&#39;,null=True)
</span></span><span class="line"><span class="cl">    3、直接给字段设置默认值
</span></span><span class="line"><span class="cl">        hobby = models.CharField(max_length=32,verbose_name=&#39;兴趣爱好&#39;,default=&#39;dbj
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"># 字段的修改
</span></span><span class="line"><span class="cl">    直接修改代码，然后执行数据库迁移的两条命令即可
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 字段的删除
</span></span><span class="line"><span class="cl">	直接注释对应的字段，然后执行数据库迁移的两条命令即可
</span></span><span class="line"><span class="cl">	执行完毕之后字段对应的数据也没有了
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">在操作models.py的时候一定要细心
</span></span><span class="line"><span class="cl">    千万不要注释一些字段
</span></span><span class="line"><span class="cl">    执行迁移命令之前，先检查以下自己写的代码
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">        
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>数据的增删改</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from  app1 import models
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 查
</span></span><span class="line"><span class="cl">    res = models.User.objects.filter(username=username)
</span></span><span class="line"><span class="cl">    # select * from user where username=&#39;jason&#39;;
</span></span><span class="line"><span class="cl">    # 返回值可以先看成列表套数据的对象格式
</span></span><span class="line"><span class="cl">    # 也支持索引取值，切片操作，但是不支持负数索引
</span></span><span class="line"><span class="cl">    # 他也不推荐使用索引方式取值，推荐使用.first()：
</span></span><span class="line"><span class="cl">	user_obj = models.User.objects.filter(username=username).first()
</span></span><span class="line"><span class="cl">	# filter括号内可以携带多个参数，参数与参数之间是and关系
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 增 
</span></span><span class="line"><span class="cl">    # 第一种增加，create方法
</span></span><span class="line"><span class="cl">        res = models.User.objects.create(username=username,password=password)
</span></span><span class="line"><span class="cl">        返回的是当前被创建对象本身
</span></span><span class="line"><span class="cl">        print(res,res.username,res.password)
</span></span><span class="line"><span class="cl">    # 第二种增加，save方法
</span></span><span class="line"><span class="cl">        user_obj = models.User(username=username,password=password)
</span></span><span class="line"><span class="cl">        先生成一个类对象，对象调用类方法
</span></span><span class="line"><span class="cl">        user_obj.save() # 保存数据
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 删
</span></span><span class="line"><span class="cl">	# 批量删除(通过修改条件可以实现删除对应数据)
</span></span><span class="line"><span class="cl">	models.user.objects.filter(id=delete_id).delete()
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 改
</span></span><span class="line"><span class="cl">	    # 修改数据方式1(批量更新)
</span></span><span class="line"><span class="cl">        # models.user.objects.filter(id=edit_id).update(username=username,password=password)
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        将filter查询出来的所有对象全部更新，批量操作，通过筛选主键可以实现某一条数据更新
</span></span><span class="line"><span class="cl">        只修改被修改的字段
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        # 修改数据方式2(单独更新)
</span></span><span class="line"><span class="cl">        edit_obj.username = username
</span></span><span class="line"><span class="cl">        edit_obj.password = password
</span></span><span class="line"><span class="cl">        edit_obj.save()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 编辑数据
</span></span><span class="line"><span class="cl">	1、先获取用户想要编辑的主键值
</span></span><span class="line"><span class="cl">		url?edit_id=1
</span></span><span class="line"><span class="cl">		url/1/
</span></span><span class="line"><span class="cl">	2、后端查询出对应的数据展示到前端
</span></span><span class="line"><span class="cl">		利用input标签的value属性
</span></span><span class="line"><span class="cl">	3、提交post请求修改数据
</span></span><span class="line"><span class="cl">		前期提交post请求需要去配置文件中注释一行
</span></span><span class="line"><span class="cl">		
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="11-案例实现登录注册编辑用户">11 案例：实现登录，注册，编辑用户</h3>
<h4 id="111-urlspy文件"><strong>11.1 urls.py文件</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">*****************urls.py文件*******************
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import path
</span></span><span class="line"><span class="cl">from app02 import views
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    # 登录功能
</span></span><span class="line"><span class="cl">    path(&#39;login/&#39;, views.login),
</span></span><span class="line"><span class="cl">    # 注册功能
</span></span><span class="line"><span class="cl">    path(&#39;register/&#39;, views.register),
</span></span><span class="line"><span class="cl">    # 展示功能
</span></span><span class="line"><span class="cl">    path(&#39;userlist/&#39;, views.user_list),
</span></span><span class="line"><span class="cl">    # 编辑功能
</span></span><span class="line"><span class="cl">    path(&#39;edit_user/&#39;, views.edit_user),
</span></span><span class="line"><span class="cl">    # 删除用户
</span></span><span class="line"><span class="cl">    path(&#39;delete_user/&#39;, views.delete_user),
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="112--viewspy文件">11.2  views.py文件</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">*****************views.py文件*******************
</span></span><span class="line"><span class="cl">from django.shortcuts import render, HttpResponse, redirect
</span></span><span class="line"><span class="cl">from app02 import models
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Create your views here.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 登录功能
</span></span><span class="line"><span class="cl">def login(request):
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        username = request.POST.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        password = request.POST.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        from app02 import models
</span></span><span class="line"><span class="cl">        user_obj = models.user.objects.filter(username=username).first()
</span></span><span class="line"><span class="cl">        if user_obj:
</span></span><span class="line"><span class="cl">            if password == user_obj.password:
</span></span><span class="line"><span class="cl">                return HttpResponse(&#39;登录成功&#39;)
</span></span><span class="line"><span class="cl">            else:
</span></span><span class="line"><span class="cl">                return HttpResponse(&#39;密码错误&#39;)
</span></span><span class="line"><span class="cl">        return HttpResponse(&#39;账号错误&#39;)
</span></span><span class="line"><span class="cl">    return render(request, &#39;login.html&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 注册功能
</span></span><span class="line"><span class="cl">def register(request):
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        username = request.POST.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        password = request.POST.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        from app02 import models
</span></span><span class="line"><span class="cl">        # 方式一
</span></span><span class="line"><span class="cl">        # res = models.user.objects.create(username=username,password=password)
</span></span><span class="line"><span class="cl">        # 方式二
</span></span><span class="line"><span class="cl">        user_obj = models.user(username=username, password=password)
</span></span><span class="line"><span class="cl">        user_obj.save()
</span></span><span class="line"><span class="cl">    return render(request, &#39;register.html&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 展示功能
</span></span><span class="line"><span class="cl">def user_list(request):
</span></span><span class="line"><span class="cl">    from app02 import models
</span></span><span class="line"><span class="cl">    # 查询表中的数据，方式一
</span></span><span class="line"><span class="cl">    # data = models.user.objects.filter()
</span></span><span class="line"><span class="cl">    # print(data)
</span></span><span class="line"><span class="cl">    user_queryset = models.user.objects.all()
</span></span><span class="line"><span class="cl">    print(user_queryset)
</span></span><span class="line"><span class="cl">    # 将函数内的变量都传给html文件
</span></span><span class="line"><span class="cl">    return render(request,&#39;userlist.html&#39;,locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 编辑功能
</span></span><span class="line"><span class="cl">def edit_user(request):
</span></span><span class="line"><span class="cl">    # 获取url问号后面的主键值
</span></span><span class="line"><span class="cl">    edit_id = request.GET.get(&#39;user_id&#39;)
</span></span><span class="line"><span class="cl">    # 后端查询出用户想要编辑的数据对象，展示到前端页面给用户查看和编辑
</span></span><span class="line"><span class="cl">    edit_obj = models.user.objects.filter(id=edit_id).first()
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        username = request.POST.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        password = request.POST.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        # 去数据库中修改对应的数据内容
</span></span><span class="line"><span class="cl">        # 修改数据方式1(批量更新)
</span></span><span class="line"><span class="cl">        # models.user.objects.filter(id=edit_id).update(username=username,password=password)
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        将filter查询出来的所有对象全部更新，批量操作，通过筛选主键可以实现某一条数据更新
</span></span><span class="line"><span class="cl">        只修改被修改的字段
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        # 修改数据方式2(单独更新)
</span></span><span class="line"><span class="cl">        edit_obj.username = username
</span></span><span class="line"><span class="cl">        edit_obj.password = password
</span></span><span class="line"><span class="cl">        edit_obj.save()
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        上述方法当字段特别多的时候效率会很低
</span></span><span class="line"><span class="cl">        从头到尾将所有字段更新一边，无论字段是否被修改
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        # 编辑完跳转到数据的展示页面
</span></span><span class="line"><span class="cl">        return redirect(&#39;/userlist/&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 将数据对象展示到页面上
</span></span><span class="line"><span class="cl">    return render(request,&#39;edit_user.html&#39;,locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 删除功能
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">和编辑功能类似
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">def delete_user(request):
</span></span><span class="line"><span class="cl">    # 获取用户想要删除的数据id主键值
</span></span><span class="line"><span class="cl">    delete_id = request.GET.get(&#39;user_id&#39;)
</span></span><span class="line"><span class="cl">    # 直接去数据库中找到对应的数据删除即可
</span></span><span class="line"><span class="cl">    models.user.objects.filter(id=delete_id).delete()
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        批量删除
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    # 跳转到展示页面
</span></span><span class="line"><span class="cl">    return redirect(&#39;/userlist/&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="113-modelspy文件"><strong>11.3 models.py文件</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">*****************models.py文件*******************
</span></span><span class="line"><span class="cl">from django.db import models
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Create your models here.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class user(models.Model):
</span></span><span class="line"><span class="cl">    username = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    password = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    def __str__(self):
</span></span><span class="line"><span class="cl">        return &#39;%s&#39;%self.username
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">*****************html文件*******************
</span></span><span class="line"><span class="cl">*****************edit_user.thml文件*******************
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html lang=&#34;en&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Title&lt;/title&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;https://cdn.bootcdn.net/ajax/libs/jquery/3.4.0/jquery.min.js&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">    {% load static %}
</span></span><span class="line"><span class="cl">    &lt;link href=&#34;{% static &#39;bootstrap-3.4.1-dist/css/bootstrap.min.css&#39; %}&#34; rel=&#34;stylesheet&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;{% static &#39;bootstrap-3.4.1-dist/js/bootstrap.min.js&#39; %}&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;h1 class=&#34;text-center&#34;&gt;编辑页面&lt;/h1&gt;
</span></span><span class="line"><span class="cl">&lt;div class=&#34;container&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;div class=&#34;row&#34;&gt;
</span></span><span class="line"><span class="cl">        &lt;div class=&#34;col-md-8 col-md-offset-2&#34;&gt;
</span></span><span class="line"><span class="cl">            &lt;form action=&#34;&#34; method=&#34;post&#34;&gt;
</span></span><span class="line"><span class="cl">                &lt;p&gt;username:&lt;input type=&#34;text&#34; name=&#34;username&#34; class=&#34;form-control&#34; value=&#34;{{ edit_obj.username}}&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">                &lt;p&gt;password:&lt;input type=&#34;text&#34; name=&#34;password&#34; class=&#34;form-control&#34; value=&#34;{{ edit_obj.password }}&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">                &lt;input type=&#34;submit&#34; class=&#34;btn-block btn btn-info&#34; value=&#34;编辑&#34;&gt;
</span></span><span class="line"><span class="cl">            &lt;/form&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &lt;/div&gt;
</span></span><span class="line"><span class="cl">    &lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="114-loginhtml文件"><strong>11.4 login.html文件</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">*****************login.html文件*******************
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html lang=&#34;en&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Title&lt;/title&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;https://cdn.bootcdn.net/ajax/libs/jquery/3.4.0/jquery.min.js&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">    {% load static %}
</span></span><span class="line"><span class="cl">    &lt;link href=&#34;{% static &#39;bootstrap-3.4.1-dist/css/bootstrap.min.css&#39; %}&#34; rel=&#34;stylesheet&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;{% static &#39;bootstrap-3.4.1-dist/js/bootstrap.min.js&#39; %}&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">&lt;h1 class=&#34;text-center&#34;&gt;登录&lt;/h1&gt;
</span></span><span class="line"><span class="cl">&lt;div class=&#34;container&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;div class=&#34;row&#34;&gt;
</span></span><span class="line"><span class="cl">        &lt;div class=&#34;col-md-8 col-md-offset-2&#34;&gt;
</span></span><span class="line"><span class="cl">            &lt;form action=&#34;&#34; method=&#34;post&#34;&gt;
</span></span><span class="line"><span class="cl">                &lt;p&gt;username:&lt;input type=&#34;text&#34; name=&#34;username&#34; class=&#34;form-control&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">                &lt;p&gt;password:&lt;input type=&#34;text&#34; name=&#34;password&#34; class=&#34;form-control&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">                &lt;input type=&#34;submit&#34; class=&#34;btn-block btn btn-danger&#34;&gt;
</span></span><span class="line"><span class="cl">            &lt;/form&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &lt;/div&gt;
</span></span><span class="line"><span class="cl">    &lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="115-registerhtml"><strong>11.5 register.html</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*****************register.html文件*******************
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html lang=&#34;en&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Title&lt;/title&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;https://cdn.bootcdn.net/ajax/libs/jquery/3.4.0/jquery.min.js&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">    {% load static %}
</span></span><span class="line"><span class="cl">    &lt;link href=&#34;{% static &#39;bootstrap-3.4.1-dist/css/bootstrap.min.css&#39; %}&#34; rel=&#34;stylesheet&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;{% static &#39;bootstrap-3.4.1-dist/js/bootstrap.min.js&#39; %}&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;h1 class=&#34;text-center&#34;&gt;注册&lt;/h1&gt;
</span></span><span class="line"><span class="cl">&lt;div class=&#34;container&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;div class=&#34;row&#34;&gt;
</span></span><span class="line"><span class="cl">        &lt;div class=&#34;col-md-8 col-md-offset-2&#34;&gt;
</span></span><span class="line"><span class="cl">            &lt;form action=&#34;&#34; method=&#34;post&#34;&gt;
</span></span><span class="line"><span class="cl">                &lt;p&gt;username:&lt;input type=&#34;text&#34; name=&#34;username&#34; class=&#34;form-control&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">                &lt;p&gt;password:&lt;input type=&#34;text&#34; name=&#34;password&#34; class=&#34;form-control&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">                &lt;input type=&#34;submit&#34; class=&#34;btn-block btn btn-danger&#34;&gt;
</span></span><span class="line"><span class="cl">            &lt;/form&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &lt;/div&gt;
</span></span><span class="line"><span class="cl">    &lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="116-userlisthtml文件"><strong>11.6 userlist.html文件</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*****************userlist.html文件*******************
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html lang=&#34;en&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Title&lt;/title&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;https://cdn.bootcdn.net/ajax/libs/jquery/3.4.0/jquery.min.js&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">    {% load static %}
</span></span><span class="line"><span class="cl">    &lt;link href=&#34;{% static &#39;bootstrap-3.4.1-dist/css/bootstrap.min.css&#39; %}&#34; rel=&#34;stylesheet&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;{% static &#39;bootstrap-3.4.1-dist/js/bootstrap.min.js&#39; %}&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;h1 class=&#34;text-center&#34;&gt;页面展示&lt;/h1&gt;
</span></span><span class="line"><span class="cl">&lt;div class=&#34;container&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;div class=&#34;row&#34;&gt;
</span></span><span class="line"><span class="cl">        &lt;div class=&#34;col-md-8 col-md-offset-2&#34;&gt;
</span></span><span class="line"><span class="cl">            &lt;table class=&#34;table table-striped table-hover&#34;&gt;
</span></span><span class="line"><span class="cl">                &lt;thead&gt;
</span></span><span class="line"><span class="cl">                    &lt;tr&gt;
</span></span><span class="line"><span class="cl">                        &lt;th&gt;ID&lt;/th&gt;
</span></span><span class="line"><span class="cl">                        &lt;th&gt;username&lt;/th&gt;
</span></span><span class="line"><span class="cl">                        &lt;th&gt;password&lt;/th&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    &lt;/tr&gt;
</span></span><span class="line"><span class="cl">                &lt;/thead&gt;
</span></span><span class="line"><span class="cl">                &lt;tbody&gt;
</span></span><span class="line"><span class="cl">                    {% for user_obj in user_queryset %}
</span></span><span class="line"><span class="cl">                    &lt;tr&gt;
</span></span><span class="line"><span class="cl">                        &lt;td&gt;{{ user_obj.id }}&lt;/td&gt;
</span></span><span class="line"><span class="cl">                        &lt;td&gt;{{ user_obj.username }}&lt;/td&gt;
</span></span><span class="line"><span class="cl">                        &lt;td&gt;{{ user_obj.password }}&lt;/td&gt;
</span></span><span class="line"><span class="cl">                        &lt;td&gt;
</span></span><span class="line"><span class="cl">                            &lt;a href=&#34;/edit_user/?user_id={{ user_obj.id }}&#34; class=&#34;btn btn-primary btn-xs&#34;&gt;编辑&lt;/a&gt;
</span></span><span class="line"><span class="cl">                            &lt;a href=&#34;/delete_user/?user_id={{ user_obj.id }}&#34; class=&#34;btn btn-danger btn-xs&#34;&gt;删除&lt;/a&gt;
</span></span><span class="line"><span class="cl">                        &lt;/td&gt;
</span></span><span class="line"><span class="cl">                    &lt;/tr&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    {% endfor %}
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                &lt;/tbody&gt;
</span></span><span class="line"><span class="cl">            &lt;/table&gt;
</span></span><span class="line"><span class="cl">        &lt;/div&gt;
</span></span><span class="line"><span class="cl">    &lt;/div&gt;
</span></span><span class="line"><span class="cl">&lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="12-orm如何创建表关系">12 orm如何创建表关系</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">表与表主键的关系
</span></span><span class="line"><span class="cl">	一对一		外键创在任意一方即可
</span></span><span class="line"><span class="cl">	一对多		外键创在多的一方
</span></span><span class="line"><span class="cl">	多对多		额外创一个表，另外两张表外键指向创的表
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">orm中如何定义三种关系
</span></span><span class="line"><span class="cl"># 一对多
</span></span><span class="line"><span class="cl">publish_wj = models.ForeignKey(&#39;Publish&#39;,on_delete=models.CASCADE)
</span></span><span class="line"><span class="cl"># 多对多
</span></span><span class="line"><span class="cl">authors_wj = models.ManyToManyField(&#39;Author&#39;)
</span></span><span class="line"><span class="cl"># 一对一
</span></span><span class="line"><span class="cl">author_detall = models.OneToOneField(&#39;Author&#39;, on_delete=models.CASCADE)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps:on_delete=models.CASCADE级联操作，但是多对多貌似不用加这个参数
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;	
</span></span><span class="line"><span class="cl">图书表		图书表和出版社多对一，和作者表多对多
</span></span><span class="line"><span class="cl">出版社
</span></span><span class="line"><span class="cl">作者表		作者表和作者详情表一对一
</span></span><span class="line"><span class="cl">作者详情表
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">*********************案例代码*************************
</span></span><span class="line"><span class="cl"># 图书表
</span></span><span class="line"><span class="cl">class Book(models.Model):
</span></span><span class="line"><span class="cl">    title = models.CharField(max_length=32,verbose_name=&#39;头&#39;)
</span></span><span class="line"><span class="cl">    price = models.DecimalField(max_digits=8, decimal_places=2)
</span></span><span class="line"><span class="cl">    # 总共八位，小数点后面占两位
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    图书和出版社是一对多，并且书是多的一方，所以外键字段放在书表里面
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    publish_wj = models.ForeignKey(&#39;Publish&#39;,on_delete=models.CASCADE)
</span></span><span class="line"><span class="cl">    # to_field参数可以不写，默认就是与出版社表的主键字段做外键关联
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    图书和作者是多对多的关系，ORM外键字段建在任意一方均可
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    authors_wj = models.ManyToManyField(&#39;Author&#39;)
</span></span><span class="line"><span class="cl">    # author是一个虚拟字段，主要是告诉orm，书籍表和作者表是多对多
</span></span><span class="line"><span class="cl">    # 让orm自动创建第三张关系表
</span></span><span class="line"><span class="cl">    # 这里貌似不用加on_delete=models.CASCADE 级联删除
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 出版社
</span></span><span class="line"><span class="cl">class Publish(models.Model):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    # 地址
</span></span><span class="line"><span class="cl">    addr = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 作者表
</span></span><span class="line"><span class="cl">class Author(models.Model):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    age = models.IntegerField()
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    作者与作者详情是一对一的府岸西，外键在任意一方都行
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    author_detall = models.OneToOneField(&#39;Author&#39;, on_delete=models.CASCADE)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 作者详情表
</span></span><span class="line"><span class="cl">class AuthorDetail(models.Model):
</span></span><span class="line"><span class="cl">    phone = models.BigIntegerField()    # 或者直接字符类型
</span></span><span class="line"><span class="cl">    addr = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="13-django生命周期流程图">13 django生命周期流程图</h3>
<p><img src="C:/Users/86186/AppData/Roaming/Typora/typora-user-images/image-20220221221545603.png" alt="image-20220221221545603"></p>
<h2 id="第二篇django路由层">第二篇：django路由层</h2>
<h3 id="1-urlspy">1 urls.py</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 路由匹配
</span></span><span class="line"><span class="cl">url(r&#39;test&#39;,views.text),
</span></span><span class="line"><span class="cl">url(r&#39;testadd&#39;,views.testadd)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">url方法第一个参数就是正则表达式
</span></span><span class="line"><span class="cl">	只要第一个参数正则表达式能够匹配到内容，那么就会停止往下匹配
</span></span><span class="line"><span class="cl">	直接指向当前匹配到的对应视图函数
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在浏览器输入url的时候会默认加斜杠
</span></span><span class="line"><span class="cl">	django内部做重定向
</span></span><span class="line"><span class="cl">		第一次匹配不行
</span></span><span class="line"><span class="cl">		会自动匹配第二次，这一次会加斜杠再来一次
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 取消自动加斜杠
</span></span><span class="line"><span class="cl">APPEND_SLASH = False/True	# 默认是自动加斜杠的
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(r&#39;^admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    # 首页
</span></span><span class="line"><span class="cl">    path(r&#39;^$&#39;, views.login),
</span></span><span class="line"><span class="cl">    # 路由匹配
</span></span><span class="line"><span class="cl">    path(r&#39;^test/$&#39;, views.register),
</span></span><span class="line"><span class="cl">    path(r&#39;^userlist/$&#39;, views.user_list),
</span></span><span class="line"><span class="cl">    # 尾页404
</span></span><span class="line"><span class="cl">    path(r&#39;&#39;, views.delete_user),
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">如果是test则输入testasdasd也能匹配到
</span></span><span class="line"><span class="cl">如果是test/则输入asdasdtest/也能匹配到
</span></span><span class="line"><span class="cl">如果是^test/则输入test/asdad也可以匹配到
</span></span><span class="line"><span class="cl">如果是^test/$这样才能精确匹配
</span></span><span class="line"><span class="cl">如果正则里啥都不写r&#39;&#39;，则表示全部匹配这种一般丢到最下面
</span></span><span class="line"><span class="cl">正则里是r&#39;^$&#39;，这种一般表示首页,直接记不要问为啥
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps：
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    ^	匹配字符串的开头
</span></span><span class="line"><span class="cl">    $	匹配字符串的末尾。
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-无名分组有名分组">2 无名分组，有名分组</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、无名分组
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    分组:就是将某一个正则加小括号括起来
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    path(r&#39;^test/(\d+)/&#39;, views.register)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def register(request,xx)
</span></span><span class="line"><span class="cl">        print(xx)
</span></span><span class="line"><span class="cl">        pass
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 无名分组就是将括号内正则表达式匹配到的内容当作位置参数传递给视图函数
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ps:
</span></span><span class="line"><span class="cl">    \d	匹配任意数字，等价于 [0-9]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、有名分组
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    可以给正则表达式起一个别名
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    path(r&#39;^test/(?p&lt;year&gt;\d+)/(?p&lt;year&gt;\d+)&#39;, views.register)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def register(request,year)
</span></span><span class="line"><span class="cl">        print(year)
</span></span><span class="line"><span class="cl">        pass
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 有名分组就是将括号内正则表达式匹配到的内容当作关键字参数传递给视图函数
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、有名无名不能混用，但是同一个分组可以使用n次
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 4、单个分组可以重复使用
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    path(r&#39;^test/(\d+)/(\d+)/&#39;, views.register)
</span></span><span class="line"><span class="cl">    def register(request,*args,**kwargs)
</span></span><span class="line"><span class="cl">        print(args)
</span></span><span class="line"><span class="cl">        print(kwargs)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    path(r&#39;^test/(?p&lt;year&gt;\d+)/(?p&lt;age&gt;\d+)/&#39;, views.register)
</span></span><span class="line"><span class="cl">    def register(request,*args,**kwargs)
</span></span><span class="line"><span class="cl">        print(args)
</span></span><span class="line"><span class="cl">        print(kwargs)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-反向解析">3 反向解析</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 通过一些方法得到一个结果，改结果可以直接访问对应的url触发视图函数
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 1、反向解析
</span></span><span class="line"><span class="cl">    # 第一步，先给路由与视图函数起一个别名
</span></span><span class="line"><span class="cl">    path(r&#39;^test/&#39;, views.register,name=&#39;ooo&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 第二步反向解析
</span></span><span class="line"><span class="cl">        后端方向解析:可以拿到数据的主键值
</span></span><span class="line"><span class="cl">            from django.shortcuts import  reverse
</span></span><span class="line"><span class="cl">            print(reverse(&#39;ooo&#39;))
</span></span><span class="line"><span class="cl">            后端拿到/test
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        前端反向解析：
</span></span><span class="line"><span class="cl">             &lt;a href=&#34;{% url &#39;ooo&#39; user_obj.id %}&#34;&gt;编辑&lt;/a&gt;
</span></span><span class="line"><span class="cl">             前端访问的是test，也就是ooo别名代表的/test/
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl"># 2、无名分组反向解析
</span></span><span class="line"><span class="cl">    url(r&#39;^index/(\d+)/&#39;,views.index,name=&#39;xxx&#39;)
</span></span><span class="line"><span class="cl">        # 前端
</span></span><span class="line"><span class="cl">            {% url &#39;xxx&#39; 123 %}
</span></span><span class="line"><span class="cl">            访问的是 index/123
</span></span><span class="line"><span class="cl">        # 后端
</span></span><span class="line"><span class="cl">            reverse(&#39;xxx&#39;,args=(1,))
</span></span><span class="line"><span class="cl">            拿到的是index/1
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl"># 3、有名分组反向解析
</span></span><span class="line"><span class="cl">    url(r&#39;^index/(?p&lt;year&gt;\d+)/&#39;,views.index,name=&#39;ooo&#39;)
</span></span><span class="line"><span class="cl">        # 前端
</span></span><span class="line"><span class="cl">        &lt;a href=&#34;{% url &#39;ooo&#39; year=123 %}&#34;&gt;111&lt;/a&gt; 了解
</span></span><span class="line"><span class="cl">        &lt;a href=&#34;{% url &#39;ooo&#39; 123 %}&#34;&gt;222&lt;/a&gt;
</span></span><span class="line"><span class="cl">        # 后端
</span></span><span class="line"><span class="cl">        reverse(&#39;ooo&#39;,kwargs=(&#39;year&#39;,123))	了解
</span></span><span class="line"><span class="cl">        reverse(&#39;ooo&#39;,args=(1,))
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"># 4、案例
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    这个参数写代码的时候应该放什么？
</span></span><span class="line"><span class="cl">        数字一般放的是数据的主键值 数据的编辑和删除url(r&#39;^index/(\d+)/&#39;,views.index,name=&#39;xxx&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def edit(request,edit_id):
</span></span><span class="line"><span class="cl">    	print(reverse(&#39;xxx&#39;))
</span></span><span class="line"><span class="cl">        pass
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {%for user_obj in user_queryset%}
</span></span><span class="line"><span class="cl">    &lt;a href=&#34;{% url &#39;xxx&#39; user_obj.id %}&#34;&gt;编辑&lt;/a&gt;
</span></span><span class="line"><span class="cl">    {%endfor%}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    案例：通过无名有名，反向解析，完成数据的增删改
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-无名反向解析案例">4 无名反向解析案例</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">通过无名反向解析，完成数据的编辑
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urls:
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import re_path
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    re_path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    re_path(r&#39;^bianji/&#39;, views.bj_user),
</span></span><span class="line"><span class="cl">    re_path(r&#39;del_user/(\d+)/&#39;, views.del_user, name=&#39;ooo&#39;),
</span></span><span class="line"><span class="cl">    re_path(r&#39;edit_user/(\d+)/&#39;, views.edit_user, name=&#39;eee&#39;),
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">========================================
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">views：
</span></span><span class="line"><span class="cl">from django.shortcuts import render, HttpResponse, redirect
</span></span><span class="line"><span class="cl">import app01.models
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl">from django.shortcuts import reverse
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Create your views here.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 编辑页面
</span></span><span class="line"><span class="cl">def bj_user(request, ):
</span></span><span class="line"><span class="cl">    user_queryset = models.User.objects.all()
</span></span><span class="line"><span class="cl">    # print(reverse(&#39;xxx&#39;, args=(1,)))
</span></span><span class="line"><span class="cl">    return render(request, &#39;bj_user.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 编辑数据
</span></span><span class="line"><span class="cl">def edit_user(request, edit_id):
</span></span><span class="line"><span class="cl">    edit_obj = models.User.objects.filter(id=edit_id).filter()
</span></span><span class="line"><span class="cl">    print(edit_obj)
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        name = request.POST.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        describe = request.POST.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        models.User.objects.filter(id=edit_id).update(name=name, describe=describe)
</span></span><span class="line"><span class="cl">        return redirect(&#39;/bianji/&#39;)
</span></span><span class="line"><span class="cl">    return render(request, &#39;edit_user.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 删除数据
</span></span><span class="line"><span class="cl">def del_user(request, edit_id):
</span></span><span class="line"><span class="cl">    models.User.objects.filter(id=edit_id).delete()
</span></span><span class="line"><span class="cl">    return redirect(&#39;/bianji/&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">=============================================
</span></span><span class="line"><span class="cl">edit_user.html
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html lang=&#34;en&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Title&lt;/title&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;https://cdn.bootcdn.net/ajax/libs/jquery/3.4.0/jquery.min.js&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">    &lt;link href=&#34;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css&#34; rel=&#34;stylesheet&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">&lt;h1 class=&#34;text-center&#34;&gt;编辑页面&lt;/h1&gt;
</span></span><span class="line"><span class="cl">&lt;div class=&#34;container&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;div class=&#34;row&#34;&gt;
</span></span><span class="line"><span class="cl">        &lt;div class=&#34;col-md-8 col-md-offset-2&#34;&gt;
</span></span><span class="line"><span class="cl">            &lt;form action=&#34;&#34; method=&#34;post&#34;&gt;
</span></span><span class="line"><span class="cl">                {% for foo in edit_obj %}
</span></span><span class="line"><span class="cl">                    &lt;p&gt;username:&lt;input type=&#34;text&#34; name=&#34;username&#34; class=&#34;form-control&#34; value=&#34;{{ foo.name }}&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">                    &lt;p&gt;password:&lt;input type=&#34;text&#34; name=&#34;password&#34; class=&#34;form-control&#34; value=&#34;{{ foo.describe }}&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">                    &lt;input type=&#34;submit&#34; class=&#34;btn-block btn btn-danger&#34;&gt;
</span></span><span class="line"><span class="cl">                {% endfor %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            &lt;/form&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &lt;/div&gt;
</span></span><span class="line"><span class="cl">    &lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/div&gt;
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">==============================================
</span></span><span class="line"><span class="cl">bj_user.html
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html lang=&#34;en&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Title&lt;/title&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;https://cdn.bootcdn.net/ajax/libs/jquery/3.4.0/jquery.min.js&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">    {% load static %}
</span></span><span class="line"><span class="cl">    &lt;link href=&#34;{% static &#39;bootstrap-3.4.1-dist/css/bootstrap.min.css&#39; %}&#34; rel=&#34;stylesheet&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;script src=&#34;{% static &#39;bootstrap-3.4.1-dist/js/bootstrap.min.js&#39; %}&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;h1 class=&#34;text-center&#34;&gt;展示页面&lt;/h1&gt;
</span></span><span class="line"><span class="cl">&lt;div class=&#34;container&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;div class=&#34;row&#34;&gt;
</span></span><span class="line"><span class="cl">        &lt;div class=&#34;col-md-8 col-md-offset-2&#34;&gt;
</span></span><span class="line"><span class="cl">            &lt;table class=&#34;table table-striped table-hover&#34;&gt;
</span></span><span class="line"><span class="cl">                &lt;thead&gt;
</span></span><span class="line"><span class="cl">                    &lt;tr&gt;
</span></span><span class="line"><span class="cl">                        &lt;th&gt;ID&lt;/th&gt;
</span></span><span class="line"><span class="cl">                        &lt;th&gt;username&lt;/th&gt;
</span></span><span class="line"><span class="cl">                        &lt;th&gt;describe&lt;/th&gt;
</span></span><span class="line"><span class="cl">                    &lt;/tr&gt;
</span></span><span class="line"><span class="cl">                &lt;/thead&gt;
</span></span><span class="line"><span class="cl">                &lt;tbody&gt;
</span></span><span class="line"><span class="cl">                    {% for user_obj in user_queryset %}
</span></span><span class="line"><span class="cl">                    &lt;tr&gt;
</span></span><span class="line"><span class="cl">                        &lt;td&gt;{{ user_obj.id }}&lt;/td&gt;
</span></span><span class="line"><span class="cl">                        &lt;td&gt;{{ user_obj.name }}&lt;/td&gt;
</span></span><span class="line"><span class="cl">                        &lt;td&gt;{{ user_obj.describe }}&lt;/td&gt;
</span></span><span class="line"><span class="cl">                        &lt;td&gt;
</span></span><span class="line"><span class="cl">{#                            &lt;a href=&#34;/edit_user/?user_id={{ user_obj.id }}&#34; class=&#34;btn btn-primary btn-xs&#34;&gt;编辑&lt;/a&gt;#}
</span></span><span class="line"><span class="cl">                            &lt;a href=&#34;{% url &#39;eee&#39; user_obj.id %}&#34; class=&#34;btn btn-primary btn-xs&#34;&gt;编辑&lt;/a&gt;
</span></span><span class="line"><span class="cl">                            &lt;a href=&#34;{% url &#39;ooo&#39; user_obj.id %}&#34; class=&#34;btn btn-danger btn-xs&#34;&gt;删除&lt;/a&gt;
</span></span><span class="line"><span class="cl">                        &lt;/td&gt;
</span></span><span class="line"><span class="cl">                    &lt;/tr&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    {% endfor %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                &lt;/tbody&gt;
</span></span><span class="line"><span class="cl">            &lt;/table&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &lt;/div&gt;
</span></span><span class="line"><span class="cl">    &lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/div&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-路由分发">5 路由分发</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">每一个应用都可以有自己的templates文件夹，urls.py  static文件夹
</span></span><span class="line"><span class="cl">正是基于上述的特点，django能够做到分组开发(每个人只写自己的app)
</span></span><span class="line"><span class="cl">二作为组长，只需要将手下书写的app全部cp到一个新的django项目中 然后配置文件里注册所有的app，在利用路由分发的特点将所有的app整合起来
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">当一个django项目中url特别多的时候，总路由urls.py代码非常冗余不好维护
</span></span><span class="line"><span class="cl">这个时候也可以利用路由分发来减轻总路由的压力
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">利用路由分发之后，总路由不在干路由与视图的直接对应关系
</span></span><span class="line"><span class="cl">而是做一个分发处理
</span></span><span class="line"><span class="cl">	识别当前url属于那个app的，然后进行转发
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 1、总路由
</span></span><span class="line"><span class="cl">from app01 import urls as app01_urls
</span></span><span class="line"><span class="cl">from app02 import urls as app02_urls
</span></span><span class="line"><span class="cl">urlpatterns = {
</span></span><span class="line"><span class="cl">	url(r&#39;^admin/&#39;,admin.site.urls),
</span></span><span class="line"><span class="cl">	# 路由分发
</span></span><span class="line"><span class="cl">	# 方法一：
</span></span><span class="line"><span class="cl">	url(r&#39;^app01/&#39;,include(app01_urls)),	# 只要url前缀是app01开头的全部交给app01处理
</span></span><span class="line"><span class="cl">	url(r&#39;^app02/&#39;,include(app02_urls)),
</span></span><span class="line"><span class="cl">	# 方法二(常用)：
</span></span><span class="line"><span class="cl">	url(r&#39;^app01/&#39;,include(app01.urls)),
</span></span><span class="line"><span class="cl">	url(r&#39;^app02/&#39;,include(app02.urls)),
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、子路由
</span></span><span class="line"><span class="cl">	# app01 urls.py
</span></span><span class="line"><span class="cl">	from django.conf.urls import url
</span></span><span class="line"><span class="cl">	from app01 import views
</span></span><span class="line"><span class="cl">	urlpatterns = {
</span></span><span class="line"><span class="cl">		url(r&#39;^reg/&#39;,views.reg)
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	# app02 urls.py
</span></span><span class="line"><span class="cl">	from django.conf.urls import url
</span></span><span class="line"><span class="cl">	from app02 import views
</span></span><span class="line"><span class="cl">	urlpatterns = {
</span></span><span class="line"><span class="cl">		url(r&#39;^reg/&#39;,views.reg)
</span></span><span class="line"><span class="cl">	}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-命名空间了解">6 命名空间（了解）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">当我们多人开发app的时候，大家设置的别名一样时，反向解析则不能自动识别
</span></span><span class="line"><span class="cl">这个时候可以用过命名空间来区分
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 名称空间
</span></span><span class="line"><span class="cl">	# 总路由
</span></span><span class="line"><span class="cl">	url(r&#39;^app01/&#39;,include(&#39;app01_urls&#39;,namespace=&#39;app01&#39;)),
</span></span><span class="line"><span class="cl">	url(r&#39;^app02/&#39;,include(&#39;app02_urls&#39;,namespace=&#39;app02&#39;))
</span></span><span class="line"><span class="cl">	# 解析的时候
</span></span><span class="line"><span class="cl">	# app01
</span></span><span class="line"><span class="cl">	urlpatterns = {
</span></span><span class="line"><span class="cl">		url(r&#39;^reg/&#39;,views.reg,name=&#39;reg&#39;)
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	# app02
</span></span><span class="line"><span class="cl">	urlpatterns = {
</span></span><span class="line"><span class="cl">		url(r&#39;^reg/&#39;,views.reg,name=&#39;reg&#39;)
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	# 后端解析
</span></span><span class="line"><span class="cl">	reverse(&#39;app01:reg&#39;)
</span></span><span class="line"><span class="cl">	reverse(&#39;app02:reg&#39;)
</span></span><span class="line"><span class="cl">	# 前端解析
</span></span><span class="line"><span class="cl">	{% url &#39;app01:reg&#39;%}
</span></span><span class="line"><span class="cl">	{% url &#39;app02:reg&#39;%}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7-伪静态了解">7 伪静态（了解）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">静态网页
</span></span><span class="line"><span class="cl">	数据是写死的，万年不变
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">伪静态
</span></span><span class="line"><span class="cl">	将一个动态网页伪装成静态网页
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl"># 实现，直接加个.html
</span></span><span class="line"><span class="cl">    urlpatterns = {
</span></span><span class="line"><span class="cl">        url(r&#39;^reg.html/&#39;,views.reg,name=&#39;reg&#39;)
</span></span><span class="line"><span class="cl">    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="8-django版本区别了解">8 django版本区别（了解）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1、django1.x路由层使用的是url方法
</span></span><span class="line"><span class="cl">	而在2或者3本本中路由层使用的是path方法
</span></span><span class="line"><span class="cl">	url()第一个参数支持正则
</span></span><span class="line"><span class="cl">	path()第一个参数不支持正则，写什么就匹配什么
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">2、虽然path不支持正则，但是它的内部支持五种转换器
</span></span><span class="line"><span class="cl">    str,匹配除了路径分隔符（/）之外的非空字符串，这是默认的形式
</span></span><span class="line"><span class="cl">    int,匹配正整数，包含0。
</span></span><span class="line"><span class="cl">    slug,匹配字母、数字以及横杠、下划线组成的字符串。
</span></span><span class="line"><span class="cl">    uuid,匹配格式化的uuid，如 075194d3-6885-417e-a8a8-6c931e272f00。
</span></span><span class="line"><span class="cl">    path,匹配任何非空字符串，包含了路径分隔符（/）（不能用？）
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">3、例子
</span></span><span class="line"><span class="cl">	path(&#39;articles/&lt;int:year&gt;/&lt;int:month&gt;/&lt;slug:other&gt;/&#39;, views.article_detail) 
</span></span><span class="line"><span class="cl">    # 针对路径http://127.0.0.1:8000/articles/2009/123/hello/，path会匹配出参数year=2009,month=123,other=&#39;hello&#39;传递给函数article_detai
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="第三篇django视图层">第三篇：django视图层</h2>
<h3 id="1-三板斧">1 三板斧</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">HttpRespose
</span></span><span class="line"><span class="cl">	返回字符串类型的数据
</span></span><span class="line"><span class="cl">	return HttpResponse(&#39;你好啊，我是django妹质&#39;)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">render
</span></span><span class="line"><span class="cl">	返回html文件的
</span></span><span class="line"><span class="cl">	return render(request,&#39;myfilst.html&#39;)
</span></span><span class="line"><span class="cl">	# 方式一：将user_dict传给html文件，html文件通过data取值
</span></span><span class="line"><span class="cl">	return render(request,&#39;myfilst.html&#39;,{&#39;data&#39;:user_dic,&#39;data&#39;,123})	
</span></span><span class="line"><span class="cl">	# 方式二：locals会将所在名称空间中所有名字传递给html页面
</span></span><span class="line"><span class="cl">	return render(request,&#39;myfilst.html&#39;,locals())
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">redirect
</span></span><span class="line"><span class="cl">	重定向
</span></span><span class="line"><span class="cl">	return redirect(&#39;http://47.96.177.8:82/&#39;)
</span></span><span class="line"><span class="cl">	return redirect(&#39;/home/&#39;)	# 还可以重定向到自己的目录
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">===============案例===============
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.shortcuts import render,HttpResponse,redirect
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    :param request: 请求相关的所有数据，比之前的env更加牛逼
</span></span><span class="line"><span class="cl">    :return:
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    # return HttpResponse(&#39;你好啊，我是django妹质&#39;)
</span></span><span class="line"><span class="cl">    # return render(request,&#39;myfilst.html&#39;)  # 自动去tempaltes文件夹下查找文件
</span></span><span class="line"><span class="cl">    # return redirect(&#39;http://47.96.177.8:82/&#39;)
</span></span><span class="line"><span class="cl">	return redirect(&#39;/home/&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-jsonresponse">2 jsonResponse</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">json格式的数据有什么用？
</span></span><span class="line"><span class="cl">	前后端交互需要使用json作为过渡，实现跨语言传输数据
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">import json
</span></span><span class="line"><span class="cl">from django.http import JsonResponse
</span></span><span class="line"><span class="cl">def ab_json(request):
</span></span><span class="line"><span class="cl">	user_dict = {&#39;username&#39;:&#39;khw阿斯顿&#39;}
</span></span><span class="line"><span class="cl">	1 = [1,2,3]
</span></span><span class="line"><span class="cl">	# 先转成json格式字符串
</span></span><span class="line"><span class="cl">	json_str = json.dumps(user_dict,ensure_ascii=False) # 表示不动冒号里的数据，也就是不将起转化为ASCII码
</span></span><span class="line"><span class="cl">	# 将该字符串返回
</span></span><span class="line"><span class="cl">	# return HttpResponse(json_str)
</span></span><span class="line"><span class="cl">	# return JsonResponse(l,safe=False)
</span></span><span class="line"><span class="cl">	# 默认只能序列化字典，序列化其他需要加safe参数
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-form表单上传文件">3 form表单上传文件</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">form表单上传文件夹类型的数据
</span></span><span class="line"><span class="cl">	1、method必须指定成posts
</span></span><span class="line"><span class="cl">	2、enctype必须换成formdata
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def ab_file(request):
</span></span><span class="line"><span class="cl">	if request.method == &#34;POST&#34;:
</span></span><span class="line"><span class="cl">        # print(request.POST) 只能获取普通的键值对数据，文件不行
</span></span><span class="line"><span class="cl">        print(request.FILES)	# 获取文件数据
</span></span><span class="line"><span class="cl">        file_obj = request.FILES.get(&#39;file&#39;) # 文件对象
</span></span><span class="line"><span class="cl">        print(file_obj.name)
</span></span><span class="line"><span class="cl">        with open(&#39;file&#39;,&#39;wb&#39;) as f:
</span></span><span class="line"><span class="cl">            for line in file_obj.chunks(): # 推荐加上chunks方法，其实不加也是一行一行读取数据
</span></span><span class="line"><span class="cl">            f.write(line)
</span></span><span class="line"><span class="cl">	return render(requet,&#39;form.html&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># request对象方法
</span></span><span class="line"><span class="cl">request.method	# 返回请求方式，并且是全大写的字符串形式
</span></span><span class="line"><span class="cl">request.POST	# 获取用户post请求提交的普通数据(不包含文件)
</span></span><span class="line"><span class="cl">request.GET		
</span></span><span class="line"><span class="cl">request.FILES	# 获取文件
</span></span><span class="line"><span class="cl">request.body	# 原生浏览器发送过来的二进制数据
</span></span><span class="line"><span class="cl">request.path	# 能获取url参数
</span></span><span class="line"><span class="cl">request.get_full_path()		# 能获取完整的url及问号后面的参数
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-fbv与cbv">4 FBV与CBV</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 视图函数既可以是函数也可以是类
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># FBV函数
</span></span><span class="line"><span class="cl">	def index(request):
</span></span><span class="line"><span class="cl">		return 	HttpResponse(&#39;index&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># CBV类
</span></span><span class="line"><span class="cl"># 能够更具请求方式不同自动匹配方法的执行
</span></span><span class="line"><span class="cl">from django.views import View
</span></span><span class="line"><span class="cl">	# CBV路由
</span></span><span class="line"><span class="cl">	url(r&#39;^login/&#39;,views.Mylogin.as_view())
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34; 只要是处理业务逻辑的视图函数，形参里面肯定要有request &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">	class Mylogin(view):
</span></span><span class="line"><span class="cl">		def get(self,request):
</span></span><span class="line"><span class="cl">			return render(request,&#39;form.html&#39;)
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		def post(self,request):
</span></span><span class="line"><span class="cl">			return 	HttpResponse(&#39;post方法&#39;)
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">					
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-cbv源码剖析">5 CBV源码剖析</h3>
<h4 id="51-第一步解析"><strong>5.1 第一步解析</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">re_path(r&#39;^login/&#39;, views.MyLogin.as_view())
</span></span><span class="line"><span class="cl"># 上述代码在启动django的时候会立即执行as_view方法
</span></span><span class="line"><span class="cl"># 通过源码得知该行等价于 re_path(r&#39;^login/&#39;, views.view)
</span></span><span class="line"><span class="cl"># CBV与FBV在路由匹配上本质是一样的，都是路由对应函数的内存地址
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">函数名/方法名 加括号执行优先级最高
</span></span><span class="line"><span class="cl">猜测
</span></span><span class="line"><span class="cl">    as_view
</span></span><span class="line"><span class="cl">        要么是被@staicmethod修饰的静态方法
</span></span><span class="line"><span class="cl">        要么是被@classmethod修饰的类方法  正确
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="52-第二步解析解析as_view方法"><strong>5.2 第二步解析：解析as_view方法</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">    def as_view(cls, **initkwargs):
</span></span><span class="line"><span class="cl">		&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">		cls 就是我们自己写的类 MyLogin
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        def view(request, *args, **kwargs):
</span></span><span class="line"><span class="cl">            self = cls(**initkwargs)		# cls我们自己写的类
</span></span><span class="line"><span class="cl">            # self = Mylogin(**initkwargs)	# 产生一个自己写的类的对象
</span></span><span class="line"><span class="cl">            return self.dispatch(request, *args, **kwargs)
</span></span><span class="line"><span class="cl">            &#34;&#34;&#34;
</span></span><span class="line"><span class="cl"> 			 ps：一定要知道self.dispatch这个对象属性的查找顺序
</span></span><span class="line"><span class="cl"> 			 先从对象自己找
</span></span><span class="line"><span class="cl"> 			 再去产生对象的类里面找
</span></span><span class="line"><span class="cl"> 			 之后再去父类里找
</span></span><span class="line"><span class="cl"> 			 总结：看源码只要看到self点了一个东西，一定要问自己当前这个self到底是谁
</span></span><span class="line"><span class="cl"> 			&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        return view
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="53-第三步解析解析dispatch源码"><strong>5.3 第三步解析：解析dispatch源码</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># CBV精髓
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def dispatch(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        # 获取当前请求的小写格式，然后对比当前请求方式是否合法
</span></span><span class="line"><span class="cl">        # get请求为例
</span></span><span class="line"><span class="cl">        # post请求
</span></span><span class="line"><span class="cl">        if request.method.lower() in self.http_method_names:
</span></span><span class="line"><span class="cl">            handler = getattr(self, request.method.lower(), self.http_method_not_allowed)
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        反射：通过字符串来操作对象属性或方法
</span></span><span class="line"><span class="cl">        handler = getattr(自己写的类产生的对象, &#39;get&#39;, 当找不到get属性或者方法会用到这个参数)
</span></span><span class="line"><span class="cl">        handler = 我们自己写的类里面的get方法
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            handler = self.http_method_not_allowed
</span></span><span class="line"><span class="cl">        return handler(request, *args, **kwargs)
</span></span><span class="line"><span class="cl">		&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">		自动调用get方法
</span></span><span class="line"><span class="cl">		&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="54-settings源码剖析">5.4 settings源码剖析</h3>
<h2 id="第四篇django模板层">第四篇：django模板层</h2>
<h3 id="1-模板语法传值">1 模板语法传值</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{}}：变量相关
</span></span><span class="line"><span class="cl">{%%}：逻辑相关
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    # 模板语法传递的后端python数据类型
</span></span><span class="line"><span class="cl">    n = 123
</span></span><span class="line"><span class="cl">    f = 11.11
</span></span><span class="line"><span class="cl">    s = &#39;字符串&#39;
</span></span><span class="line"><span class="cl">    b = True
</span></span><span class="line"><span class="cl">    l = [&#39;地&#39;, &#39;瓜&#39;]
</span></span><span class="line"><span class="cl">    t = (111, 222, 333)
</span></span><span class="line"><span class="cl">    d = {&#39;username&#39;: &#39;dig&#39;, &#39;age&#39;: 18, &#39;info&#39;: &#39;这个人有点意思&#39;,&#39;hobby&#39;:[111,222,{&#39;info&#39;:&#39;NB&#39;}]}
</span></span><span class="line"><span class="cl">    se = {&#39;撒旦&#39;, &#39;地方&#39;, &#39;速度&#39;}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def func():
</span></span><span class="line"><span class="cl">        print(&#39;我被执行了&#39;)
</span></span><span class="line"><span class="cl">        return &#39;我在等你&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    class MyLogin(object):
</span></span><span class="line"><span class="cl">        def get_self(self):
</span></span><span class="line"><span class="cl">            return &#39;self&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        @staticmethod
</span></span><span class="line"><span class="cl">        def get_func():
</span></span><span class="line"><span class="cl">            return &#39;func&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        @classmethod
</span></span><span class="line"><span class="cl">        def get_class(cls):
</span></span><span class="line"><span class="cl">            return &#39;cls&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # 对象被展示到html页面上就类似于执行了打印操作，也会触发__str__方法
</span></span><span class="line"><span class="cl">        def __str__(self):
</span></span><span class="line"><span class="cl">            return &#39;会不会玩&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    obj = MyLogin()
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 模板传值
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ n }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ f }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ s }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ b }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ l }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ d }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ t }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ se }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;传递函数名会自动加括号调用，但是模板语法不支持给函数传额外的参数：{{ func }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;传类名的时候也可以自动加括号调用(实例化){{ MyLogin }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;内部能够自动判断出当前的变量名是否可以加括号调用，如果可以就会自动执行，这个针对的是函数和类名&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ obj }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ obj.get_class }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ obj.get_func }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ obj.get_self }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 模板取值
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ d.username }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ l.0 }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ d.hobby.2.info }}&lt;/p&gt;
</span></span><span class="line"><span class="cl"># 通过点来取值
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-模板语法之过滤器最多两个参数">2 模板语法之过滤器(最多两个参数)</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    # 模板语法传递的后端python数据类型
</span></span><span class="line"><span class="cl">    n = 123
</span></span><span class="line"><span class="cl">    f = 11.11
</span></span><span class="line"><span class="cl">    s = &#39;字符串&#39;
</span></span><span class="line"><span class="cl">    b = True
</span></span><span class="line"><span class="cl">    l = [&#39;地&#39;, &#39;瓜&#39;,&#39;3&#39;,&#39;4&#39;]
</span></span><span class="line"><span class="cl">    t = (111, 222, 333)
</span></span><span class="line"><span class="cl">    d = {&#39;username&#39;: &#39;dig&#39;, &#39;age&#39;: 18, &#39;info&#39;: &#39;这个人有点意思&#39;,&#39;hobby&#39;:[111,222,{&#39;info&#39;:&#39;NB&#39;}]}
</span></span><span class="line"><span class="cl">    se = {&#39;撒旦&#39;, &#39;地方&#39;, &#39;速度&#39;}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def func():
</span></span><span class="line"><span class="cl">        print(&#39;我被执行了&#39;)
</span></span><span class="line"><span class="cl">        return &#39;我在等你&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    class MyLogin(object):
</span></span><span class="line"><span class="cl">        def get_self(self):
</span></span><span class="line"><span class="cl">            return &#39;self&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        @staticmethod
</span></span><span class="line"><span class="cl">        def get_func():
</span></span><span class="line"><span class="cl">            return &#39;func&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        @classmethod
</span></span><span class="line"><span class="cl">        def get_class(cls):
</span></span><span class="line"><span class="cl">            return &#39;cls&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # 对象被展示到html页面上就类似于执行了打印操作，也会触发__str__方法
</span></span><span class="line"><span class="cl">        def __str__(self):
</span></span><span class="line"><span class="cl">            return &#39;会不会玩&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    obj = MyLogin()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    file_size = 10240000
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    import datetime
</span></span><span class="line"><span class="cl">    current_time = datetime.datetime.now()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    info = &#39;# 商业转载请联系作者获得授权，非商业转载请注明出处。&#39;
</span></span><span class="line"><span class="cl">    egl = &#39;my name is khw age 18&#39;
</span></span><span class="line"><span class="cl">    msg = &#39;i love you and you?&#39;
</span></span><span class="line"><span class="cl">    hhh = &#39;&lt;h1&gt;地瓜&lt;h1&gt;&#39;
</span></span><span class="line"><span class="cl">    from django.utils.safestring import mark_safe
</span></span><span class="line"><span class="cl">    res = mark_safe(&#39;&lt;h1&gt;木可&lt;h1&gt;&#39;)
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;p&gt;默认长度：{{ s|length }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;默认值（第一个参数布尔值是true就展示第一个参数的值，否则展示默认值）：{{ b|default:&#34;啥也不是&#34; }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;文件大小:{{ file_size|filesizeformat }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;日期格式化:{{ current_time|date:&#39;Y-m-d H:i:s&#39; }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;切片操作(0到4步长为2)：{{ l|slice:&#39;0:4:2&#39; }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;切取字符（摘要,后面数字表示截取多少个字符，包含三个点）：{{ info|truncatechars:9 }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;切取单词（按照空格切，中文也是一样）：{{ egl|truncatewords:4 }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;移除特定的字符（该例将空格切除）：{{ msg|cut:&#39; &#39; }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;拼接操作:{{ l|join:&#34;$&#34; }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;拼接操作(加法):{{ n|add:10 }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;拼接操作(还能拼接字符串):{{ s|add:msg }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;转义：{{ hhh|safe }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 转义
</span></span><span class="line"><span class="cl"># 前端操作
</span></span><span class="line"><span class="cl">&lt;p&gt;转义：{{ hhh|safe }}&lt;/p&gt;
</span></span><span class="line"><span class="cl"># 后端操作
</span></span><span class="line"><span class="cl">from django.utils.safestring import mark_safe
</span></span><span class="line"><span class="cl">res = mark_safe(&#39;&lt;h1&gt;木可&lt;h1&gt;&#39;)
</span></span><span class="line"><span class="cl">return render(request, &#39;index.html&#39;, locals())
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-模板语法之标签">3 模板语法之标签</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># for循环
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {% for foo in l %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;{{ forloop }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">        &lt;p&gt;{{ foo }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">        {% empty %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;for循环可迭代对象是空，根本没法循环&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {&#39;parentloop&#39;: {}, &#39;counter0&#39;: 2, &#39;counter&#39;: 3, &#39;revcounter&#39;: 2, &#39;revcounter0&#39;: 1, &#39;first&#39;: False, &#39;last&#39;: False}
</span></span><span class="line"><span class="cl">    {&#39;parentloop&#39;: {}, &#39;counter0&#39;: 3, &#39;counter&#39;: 4, &#39;revcounter&#39;: 1, &#39;revcounter0&#39;: 0, &#39;first&#39;: False, &#39;last&#39;: True}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    first：表示该for循环是否为第一次
</span></span><span class="line"><span class="cl">    last：表示该for循环是否为最后一次
</span></span><span class="line"><span class="cl">    counter0：表示计数 2 表示从2开始
</span></span><span class="line"><span class="cl">    counter：表示数数，3表示从3开始
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># if判断
</span></span><span class="line"><span class="cl">    {% if b %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;贝比&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% elif s%}
</span></span><span class="line"><span class="cl">        &lt;p&gt;都来把&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% else %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;老贝比&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% endif %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># for与if混合使用
</span></span><span class="line"><span class="cl">    {% for foo in l %}
</span></span><span class="line"><span class="cl">        {% if forloop.first %}
</span></span><span class="line"><span class="cl">            &lt;p&gt;这是我的第一次&lt;/p&gt;
</span></span><span class="line"><span class="cl">        {% elif forloop.last %}
</span></span><span class="line"><span class="cl">            &lt;p&gt;这是最后一次&lt;/p&gt;
</span></span><span class="line"><span class="cl">        {% else %}
</span></span><span class="line"><span class="cl">            &lt;p&gt;老贝比&lt;/p&gt;
</span></span><span class="line"><span class="cl">        {% endif %}
</span></span><span class="line"><span class="cl">        {% empty %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;for循环可迭代对象是空，根本没法循环&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 处理字典的其他方法
</span></span><span class="line"><span class="cl">    {% for foo in d.keys %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;{{ foo }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {% for value in d.values %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;{{ value }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {% for item in d.items %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;{{ item }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># with起别名
</span></span><span class="line"><span class="cl">    {% with d.hobby.2.info as nb %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;{{ nb }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">        &lt;p&gt;在whit语法内可以通过as后面的别名使用到前面非常复杂的获取数据方式&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% endwith %}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-自定义过滤器标签inclusion_tag">4 自定义过滤器、标签、inclusion_tag</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">先三步走
</span></span><span class="line"><span class="cl">	1、在应用下面创建一个名字“必须”叫templatetages文件夹
</span></span><span class="line"><span class="cl">	2、在该文件夹内创建“任意”名称的py文件 eg：mytag.py
</span></span><span class="line"><span class="cl">	3、在该py文件内“必须”先写下面两句话
</span></span><span class="line"><span class="cl">		from django import template
</span></span><span class="line"><span class="cl">		register = template.Library()
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 1、自定义过滤器(参数最多两个)
</span></span><span class="line"><span class="cl">@register.filter(name=&#39;baby&#39;)
</span></span><span class="line"><span class="cl">def my_sum(v1, v2):
</span></span><span class="line"><span class="cl">    return v1 + v2
</span></span><span class="line"><span class="cl">自定义的使用(过滤器最多只能有两个参数)
</span></span><span class="line"><span class="cl">{% load mytag %}
</span></span><span class="line"><span class="cl">&lt;p&gt;{{ n|baby:666 }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、自定义标签(参数可以多个)
</span></span><span class="line"><span class="cl">@register.simple_tag(name=&#39;plus&#39;)
</span></span><span class="line"><span class="cl">def index(a,b,c,d):
</span></span><span class="line"><span class="cl">    return &#39;%s-%s-%s-%s&#39;%(a,b,c,d)
</span></span><span class="line"><span class="cl">标签多个参数彼此之间空格隔开
</span></span><span class="line"><span class="cl">{% load mytag %}
</span></span><span class="line"><span class="cl">&lt;p&gt;{% plus &#39;jason&#39; 123 123 123 %}&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、自定义inclusion_tag
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">内部原理
</span></span><span class="line"><span class="cl">	先定义一个方法
</span></span><span class="line"><span class="cl">	在一面上调用方法，并可以传值
</span></span><span class="line"><span class="cl">	该方法会生成一些数据然后传递给一个html页面
</span></span><span class="line"><span class="cl">	之后将渲染好的结果放到调用位置
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl"># 自定义inclusion_tag
</span></span><span class="line"><span class="cl">@register.inclusion_tag(&#39;left_menu.html&#39;)
</span></span><span class="line"><span class="cl">def left(n):
</span></span><span class="line"><span class="cl">    data = [&#39;第{}项&#39;.format(i) for i in range(n)]
</span></span><span class="line"><span class="cl">    # return {&#39;data&#39;:data}
</span></span><span class="line"><span class="cl">    return locals()  # 将data传递给left_menu.html
</span></span><span class="line"><span class="cl">使用：
</span></span><span class="line"><span class="cl">{% left 10 %}
</span></span><span class="line"><span class="cl"># 总结:当html页面某一个地方的页面需要传参数才能动态渲染出来，并且在多个页面上都需要使用该局部，那么就考虑该局部页面做成inclusion_tag形式
</span></span><span class="line"><span class="cl">（在讲bbs的时候使用到）
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-模板的继承">5 模板的继承</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">模板继承，选选好一个想要继承的模板页面
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 模板的继承
</span></span><span class="line"><span class="cl">    {% extends &#39;bj_user.html&#39; %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 继承之后子页面和模板页面长得一摸一样，需要在模板页面上提前划定可以被修改的区域
</span></span><span class="line"><span class="cl">    {% block content  %}
</span></span><span class="line"><span class="cl">    模板的内容
</span></span><span class="line"><span class="cl">    {% endblock %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 子页面就可以声明想要修改那块决定的区域
</span></span><span class="line"><span class="cl">    {% block content %}
</span></span><span class="line"><span class="cl">        子页面的内容
</span></span><span class="line"><span class="cl">    {% endblock %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 一般情况下模板页面上至少有三块可以修改的区域
</span></span><span class="line"><span class="cl">	1、css区域
</span></span><span class="line"><span class="cl">	2、html区域
</span></span><span class="line"><span class="cl">	3、js区域
</span></span><span class="line"><span class="cl">	# 这样操作后，每个页面就可以有自己独有的css，html，js代码
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">一般情况下，模板的页面上划定的区域越多，扩展性越高
</span></span><span class="line"><span class="cl">如果太多，还不如自己写
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-模板的导入">6 模板的导入</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">将页面的某一个局部当成一个模块的形式
</span></span><span class="line"><span class="cl">那个地方需要直接导入即可
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">&lt;p&gt;模板的导入&lt;/p&gt;
</span></span><span class="line"><span class="cl">{% include &#39;bj_user.html&#39; %}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="第五篇django模型层">第五篇：django模型层</h2>
<h3 id="1-sql测试环境">1 sql测试环境</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">class Book(models.Model):
</span></span><span class="line"><span class="cl">    title = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    price = models.DecimalField(max_digits=8, decimal_places=2)
</span></span><span class="line"><span class="cl">    publish_data = models.DateField(auto_now_add=True)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 书和出版社一对多
</span></span><span class="line"><span class="cl">    publish = models.ForeignKey(to=&#39;Publish&#39;, on_delete=models.CASCADE)
</span></span><span class="line"><span class="cl">    # 和作者多对多
</span></span><span class="line"><span class="cl">    author = models.ManyToManyField(to=&#39;Author&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Publish(models.Model):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    addr = models.CharField(max_length=64)
</span></span><span class="line"><span class="cl">    email = models.EmailField()  # 本质还是varchar(254),该字段是给校验性组件看的
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Author(models.Model):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    age = models.IntegerField()
</span></span><span class="line"><span class="cl">    # 作者和作者详情一对一
</span></span><span class="line"><span class="cl">    author_detail = models.OneToOneField(to=&#39;AuthorDetail&#39;,on_delete=models.CASCADE)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class AuthorDetail(models.Model):
</span></span><span class="line"><span class="cl">    phone = models.BigIntegerField()  # 电话号码用BigIntegerField或者CharField
</span></span><span class="line"><span class="cl">    addr = models.CharField(max_length=32)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-单表操作">2 单表操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># django自带的sqllite3数据库对日期格式不是很敏感 处理的时候容易出错
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 增
</span></span><span class="line"><span class="cl"># res = models.user.objects.create(name=&#39;digua&#39;, age=18, register_time=&#39;2021-11-28&#39;)
</span></span><span class="line"><span class="cl"># print(res)
</span></span><span class="line"><span class="cl"># import datetime
</span></span><span class="line"><span class="cl"># ctime = datetime.datetime.now()
</span></span><span class="line"><span class="cl"># user_obj = models.user(name=&#39;egon&#39;, age=84, register_time=ctime)
</span></span><span class="line"><span class="cl"># user_obj.save()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 删
</span></span><span class="line"><span class="cl"># res = models.user.objects.filter(pk=2).delete()
</span></span><span class="line"><span class="cl"># print(res)
</span></span><span class="line"><span class="cl"># user_obj = models.user.objects.filter(pk=1).first()
</span></span><span class="line"><span class="cl"># user_obj.delete()
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">pk会自动查找到当前表的主键字段，指代的就是当前表的主键
</span></span><span class="line"><span class="cl">用了pk之后就不需要知道当前表的字段到底叫什么
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 修改
</span></span><span class="line"><span class="cl"># models.user.objects.filter(pk=4).update(name=&#39;hongweidsb&#39;)
</span></span><span class="line"><span class="cl"># user_obj = models.user.objects.get(pk=4)
</span></span><span class="line"><span class="cl"># user_obj.name = &#39;egonPPP&#39;
</span></span><span class="line"><span class="cl"># user_obj.save()
</span></span><span class="line"><span class="cl"># print(user_obj)
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">get方法直接返回的就是当前数据对象
</span></span><span class="line"><span class="cl">该方法不推荐
</span></span><span class="line"><span class="cl">一旦数据不存在，该方法会直接报错而filter则不会，所以还是用filter
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-测试脚本">3 测试脚本</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">当你只是想测试django中某一个py文件内容，那么你可以不用书写前后端交互模式，可以直接写一个测试脚本
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.test import TestCase
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Create your tests here.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">import os
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">if __name__ == &#39;__main__&#39;:
</span></span><span class="line"><span class="cl">    os.environ.setdefault(&#39;DJANGO_SETTINGS_MODULE&#39;, &#39;djangoProject.settings&#39;)
</span></span><span class="line"><span class="cl">    import django
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    django.setup()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">models.User.objects.all()
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-django终端打印sql语句">4 django终端打印sql语句</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 方式1
</span></span><span class="line"><span class="cl">res3 = models.user.objects.values_list(&#39;name&#39;)
</span></span><span class="line"><span class="cl">print(res3)
</span></span><span class="line"><span class="cl">print(res3.query)
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl"># 查看内部sql语句的方式，queryset对象才能狗点query查看内部sql语句
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 方式2：所有sql语句都能查看
</span></span><span class="line"><span class="cl">取配置文件中配置以下即可
</span></span><span class="line"><span class="cl">LOGGING = {
</span></span><span class="line"><span class="cl">    &#39;version&#39;: 1,
</span></span><span class="line"><span class="cl">    &#39;disable_existing_loggers&#39;: False,
</span></span><span class="line"><span class="cl">    &#39;handlers&#39;: {
</span></span><span class="line"><span class="cl">        &#39;console&#39;:{
</span></span><span class="line"><span class="cl">            &#39;level&#39;:&#39;DEBUG&#39;,
</span></span><span class="line"><span class="cl">            &#39;class&#39;:&#39;logging.StreamHandler&#39;,
</span></span><span class="line"><span class="cl">        },
</span></span><span class="line"><span class="cl">    },
</span></span><span class="line"><span class="cl">    &#39;loggers&#39;: {
</span></span><span class="line"><span class="cl">        &#39;django.db.backends&#39;: {
</span></span><span class="line"><span class="cl">            &#39;handlers&#39;: [&#39;console&#39;],
</span></span><span class="line"><span class="cl">            &#39;propagate&#39;: True,
</span></span><span class="line"><span class="cl">            &#39;level&#39;:&#39;DEBUG&#39;,
</span></span><span class="line"><span class="cl">        },
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-必知必会13条">5 必知必会13条</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">必知必会n多条
</span></span><span class="line"><span class="cl"># 1、all()       查询所有数据
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、filter()    带有过滤条件
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">pk会自动查找到当前表的主键字段，指代的就是当前表的主键
</span></span><span class="line"><span class="cl">用了pk之后就不需要知道当前表的字段到底叫什么
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、get()       直接拿数据对象，但不存在会报错
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 4、first()     拿queryset里面的第一个元素
</span></span><span class="line"><span class="cl">    res = models.user.objects.all().first()
</span></span><span class="line"><span class="cl">    print(res)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 5、last()    拿queryset对象里最后一个元素
</span></span><span class="line"><span class="cl">    res1 = models.user.objects.all().last()
</span></span><span class="line"><span class="cl">    print(res1)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 6、values()  筛选取值
</span></span><span class="line"><span class="cl">    res2 = models.user.objects.values(&#39;name&#39;)
</span></span><span class="line"><span class="cl">    print(res2)
</span></span><span class="line"><span class="cl">    # 返回结果是queryset对象
</span></span><span class="line"><span class="cl">    # 里面是列表套字典
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 7、values_list()     筛选取值
</span></span><span class="line"><span class="cl">    res3 = models.user.objects.values_list(&#39;name&#39;)
</span></span><span class="line"><span class="cl">    print(res3)
</span></span><span class="line"><span class="cl">    # 列表套元组
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 8、distinct()      去重
</span></span><span class="line"><span class="cl">    res = models.user.objects.all().distinct()
</span></span><span class="line"><span class="cl">    print(res)
</span></span><span class="line"><span class="cl">    需要将主键筛选走才能去重
</span></span><span class="line"><span class="cl">    res = models.user.objects.values(&#39;name&#39;, &#39;age&#39;).distinct()
</span></span><span class="line"><span class="cl">    print(res)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 9、order_by()        排序
</span></span><span class="line"><span class="cl">    res = models.user.objects.order_by(&#39;age&#39;)   # 默认升序
</span></span><span class="line"><span class="cl">    res = models.user.objects.order_by(&#39;-age&#39;)   # 降序
</span></span><span class="line"><span class="cl">    print(res)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 10、reverse()        反转，反转的前提是数据已经排序
</span></span><span class="line"><span class="cl">    res = models.user.objects.order_by(&#39;age&#39;)
</span></span><span class="line"><span class="cl">    res1 = models.user.objects.order_by(&#39;age&#39;).reverse()
</span></span><span class="line"><span class="cl">    print(res1)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 11、count()          统计当前数据的个数
</span></span><span class="line"><span class="cl">    res = models.user.objects.count()
</span></span><span class="line"><span class="cl">    print(res)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 12、exclude()        排除在外
</span></span><span class="line"><span class="cl">    res = models.user.objects.exclude(name=&#39;json&#39;)
</span></span><span class="line"><span class="cl">    print(res)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 13、exists()         判断某个东西是否存在
</span></span><span class="line"><span class="cl">    res = models.user.objects.filter(pk=9).exists()
</span></span><span class="line"><span class="cl">    print(res)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-神奇的双下划线查询">6 神奇的双下划线查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl"># 神奇的双下划线查询
</span></span><span class="line"><span class="cl">        1、 年龄大于35岁的数据
</span></span><span class="line"><span class="cl">            res = models.user.objects.filter(age__gt=35)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">        2、 年龄小于35
</span></span><span class="line"><span class="cl">            res = models.user.objects.filter(age__lt=35)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">        3、 大于等于，小于等于
</span></span><span class="line"><span class="cl">            res = models.user.objects.filter(age__gte=32)
</span></span><span class="line"><span class="cl">            res = models.user.objects.filter(age__lte=32)
</span></span><span class="line"><span class="cl">        4、 年龄是18 或者32 或者40
</span></span><span class="line"><span class="cl">            res = models.user.objects.filter(age__in=[18,32,40])
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">        5、 年龄在18到40岁之间的
</span></span><span class="line"><span class="cl">            res = models.user.objects.filter(age__range=[18,40])
</span></span><span class="line"><span class="cl">            首尾都会取
</span></span><span class="line"><span class="cl">        6、 模糊查询，查询出名字含有n的数据 模糊查询，不忽略大小写
</span></span><span class="line"><span class="cl">            res = models.user.objects.filter(name__contains=&#39;n&#39;)
</span></span><span class="line"><span class="cl">        7、 忽略大小写
</span></span><span class="line"><span class="cl">            res = models.user.objects.filter(name__icontains=&#39;D&#39;)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">        8、以什么开头,什么结尾的
</span></span><span class="line"><span class="cl">            models.user.objects.filter(name__startswith=&#39;j&#39;)
</span></span><span class="line"><span class="cl">            models.user.objects.filter(name__endswith=&#39;j&#39;)
</span></span><span class="line"><span class="cl">        9、查询出 注册时间是2021年6月的数据,22年的数据
</span></span><span class="line"><span class="cl">            res = models.user.objects.filter(register_time__month=&#39;6&#39;)
</span></span><span class="line"><span class="cl">            res = models.user.objects.filter(register_time__year=&#39;2021&#39;)
</span></span><span class="line"><span class="cl">            ...
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7-外键字段的增删改">7 外键字段的增删改</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">一对多的外键增删改查
</span></span><span class="line"><span class="cl">        1、增
</span></span><span class="line"><span class="cl">            1）直接写实际字段id
</span></span><span class="line"><span class="cl">                models.Book.objects.create(title=&#39;三国演绎&#39;, price=123.23, publish_id=1)
</span></span><span class="line"><span class="cl">            2）虚拟字段，给数据对象
</span></span><span class="line"><span class="cl">                publish_obj = models.Publish.objects.filter(pk=2).first()
</span></span><span class="line"><span class="cl">                models.Book.objects.create(title=&#39;剑来&#39;, price=231.23, publish=publish_obj)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        2、删
</span></span><span class="line"><span class="cl">            级联删除
</span></span><span class="line"><span class="cl">            models.Publish.objects.filter(pk=1).delete()
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">        3、修改
</span></span><span class="line"><span class="cl">            1)直接写id
</span></span><span class="line"><span class="cl">            models.Book.objects.filter(pk=1).update(publish_id=2)
</span></span><span class="line"><span class="cl">            2）传对象
</span></span><span class="line"><span class="cl">            obj = models.Publish.objects.filter(pk=1).first()
</span></span><span class="line"><span class="cl">            models.Book.objects.filter(pk=1).update(publish=obj)
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">多对多外键增删改查（就是第三张关系表的增删改）
</span></span><span class="line"><span class="cl">        1、如何给书籍绑定作者？(增加)
</span></span><span class="line"><span class="cl">            1)放id
</span></span><span class="line"><span class="cl">                # 先拿到一个书籍对象，里有个authors外键属性，点了authors之后就已经到了第三方关系表了
</span></span><span class="line"><span class="cl">                book_obj = models.Book.objects.filter(pk=1).first()
</span></span><span class="line"><span class="cl">                book_obj.author.add(1,2)      # 给书籍id为1的书籍绑定一个主键为1和2的作者
</span></span><span class="line"><span class="cl">            2）放对象
</span></span><span class="line"><span class="cl">                book_obj = models.Book.objects.filter(pk=1).first()
</span></span><span class="line"><span class="cl">                author_obj = models.Author.objects.filter(pk=3).first()
</span></span><span class="line"><span class="cl">                book_obj.author.add(author_obj)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        2、删除作者字段
</span></span><span class="line"><span class="cl">            1）放id
</span></span><span class="line"><span class="cl">                book_obj = models.Book.objects.filter(pk=1).first()
</span></span><span class="line"><span class="cl">                book_obj.author.remove(3,2,1)  
</span></span><span class="line"><span class="cl">                # 删除书主键为1，作者主键为3,2,1的这三条数据
</span></span><span class="line"><span class="cl">            2）放对象
</span></span><span class="line"><span class="cl">                book_obj = models.Book.objects.filter(pk=5).first()
</span></span><span class="line"><span class="cl">                author_obj = models.Author.objects.filter(pk=3).first()
</span></span><span class="line"><span class="cl">                book_obj.author.remove(author_obj)     
</span></span><span class="line"><span class="cl">                # 删除主键为5的书的，作者主键为3的这条数据
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        3、修改字段  set
</span></span><span class="line"><span class="cl">            1）放id
</span></span><span class="line"><span class="cl">                book_obj = models.Book.objects.filter(pk=2).first()
</span></span><span class="line"><span class="cl">                book_obj.author.set([1,2])  # 括号内必须给一个可迭代对象
</span></span><span class="line"><span class="cl">                # 将书id为2的数据删除，然后创建将书id为2的作者id改为1和2的两条数据
</span></span><span class="line"><span class="cl">                book_obj.author.set([3])
</span></span><span class="line"><span class="cl">                # 将书id为2的数据删除，然后创建书为2作者id为3的数据
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            2）放对象
</span></span><span class="line"><span class="cl">                book_obj = models.Book.objects.filter(pk=6).first()
</span></span><span class="line"><span class="cl">                author_obj = models.Author.objects.filter(pk=3).first()
</span></span><span class="line"><span class="cl">                book_obj.author.set([author_obj])
</span></span><span class="line"><span class="cl">                # 将书id为6的这条数据中的作者id改为3
</span></span><span class="line"><span class="cl">        3、清空数据
</span></span><span class="line"><span class="cl">            比如有本书下架了，我想将书籍和作者的绑定关系给清空
</span></span><span class="line"><span class="cl">            book_obj = models.Book.objects.filter(pk=6).first()
</span></span><span class="line"><span class="cl">            book_obj.author.clear()
</span></span><span class="line"><span class="cl">            # 将主键为6的这本书和作者的所有关系清空掉,括号内不加参数
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="8-正反向概念">8 正反向概念</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">一对一和多对多的正反向判断：
</span></span><span class="line"><span class="cl">正向
</span></span><span class="line"><span class="cl">    看外键字段在哪一方
</span></span><span class="line"><span class="cl">    书查出版社则外键在书手上，这就是正向
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">反向
</span></span><span class="line"><span class="cl">    出版社查书，外键在书上，则这种为反向
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">正向查询按字段
</span></span><span class="line"><span class="cl">反向查询按表名小写
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="9-多表查询">9 多表查询</h3>
<ul>
<li>
<h5 id="子查询基于对象的跨表查询">子查询（基于对象的跨表查询）</h5>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">子查询就是分步查询
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">基于对象的跨表查询
</span></span><span class="line"><span class="cl">        1、查询书籍主键为1的出版社  正向按字段
</span></span><span class="line"><span class="cl">            book_obj = models.Book.objects.filter(pk=1).first()
</span></span><span class="line"><span class="cl">            # 书查出版社  正向
</span></span><span class="line"><span class="cl">            res = book_obj.publish
</span></span><span class="line"><span class="cl">            # 书籍主键为1的书对应的出版对应东方出版社
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            print(res.name)
</span></span><span class="line"><span class="cl">            print(res.addr)
</span></span><span class="line"><span class="cl">        2、查询书籍主键为1的作者   书查作者外键在书，为正向，按字段
</span></span><span class="line"><span class="cl">            book_obj = models.Book.objects.filter(pk=2).first()
</span></span><span class="line"><span class="cl">            res = book_obj.author       # app01.Author.None
</span></span><span class="line"><span class="cl">            res = book_obj.author.all()
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            ps:如果结果为app01.Author.None，则需要.all()
</span></span><span class="line"><span class="cl">        3、查询作者hongwei的电话号码  作者查作者详情，正向
</span></span><span class="line"><span class="cl">            author_obj = models.Author.objects.filter(name=&#39;hongwei&#39;).first()
</span></span><span class="line"><span class="cl">            res = author_obj.author_detail  (当结果为一个对象的时候不需要.all)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            print(res.phone)
</span></span><span class="line"><span class="cl">            print(res.addr)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        ps：正向什么需要加.all
</span></span><span class="line"><span class="cl">            当结果可能有多个的时候有.all
</span></span><span class="line"><span class="cl">            如果只有一个则不需要.all
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        4、查询出版社是东方出版社出版的书      出版社查书，反向，表名小写
</span></span><span class="line"><span class="cl">            publish_obj = models.Publish.objects.filter(name=&#39;东方出版社&#39;).first()
</span></span><span class="line"><span class="cl">            res = publish_obj.book_set.all()
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        5、查询作者是hongwei写过的书      作者查书，反向，表名小写
</span></span><span class="line"><span class="cl">            author_obj = models.Author.objects.filter(name=&#39;hongwei&#39;).first()
</span></span><span class="line"><span class="cl">            res = author_obj.book_set.all()
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        6、查询手机号为110的作者姓名    作者详情查作者，反向，表名小写
</span></span><span class="line"><span class="cl">            author_detail_obj = models.AuthorDetail.objects.filter(phone=110).first()
</span></span><span class="line"><span class="cl">            res = author_detail_obj.author
</span></span><span class="line"><span class="cl">            print(res.name)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        ps:反向什么时候需要加_set.all()
</span></span><span class="line"><span class="cl">            反向查询的时候
</span></span><span class="line"><span class="cl">                当你的查询结果可以有多个的时候，就必须加_set.all()
</span></span><span class="line"><span class="cl">                当你的结果只有一个的时候，不需要加_set.all()
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<h5 id="联表查询基于双下划线的跨表查询">联表查询（基于双下划线的跨表查询）</h5>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">基于双下划线的跨表查询
</span></span><span class="line"><span class="cl">        1、查询hongwei的手机号和姓名
</span></span><span class="line"><span class="cl">            res = models.Author.objects.filter(name=&#39;hongwei&#39;).values(&#39;author_detail__phone&#39;, &#39;name)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            反向，不允许点author
</span></span><span class="line"><span class="cl">            # 拿作者是hongwei的作者详情
</span></span><span class="line"><span class="cl">            res = models.AuthorDetail.objects.filter(author__name=&#39;hongwei&#39;).values(&#39;phone&#39;,&#39;author__name&#39;)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        2、查询书籍主键为1的出版社名称和书的名称   
</span></span><span class="line"><span class="cl">            res = models.Book.objects.filter(pk=1).values(&#39;title&#39;, &#39;publish__name&#39;)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            反向：
</span></span><span class="line"><span class="cl">            res = models.Publish.objects.filter(book__id=1).values(&#39;name&#39;,&#39;book__title&#39;)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">        3、查询书籍主键为1的作者姓名
</span></span><span class="line"><span class="cl">            res = models.Book.objects.filter(pk=2).values(&#39;title&#39;,&#39;author__name&#39;)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            反向：
</span></span><span class="line"><span class="cl">            res = models.Author.objects.filter(book__id=1).values(&#39;name&#39;, &#39;book__title&#39;)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        4、查询书籍主键是1的作者的手机号
</span></span><span class="line"><span class="cl">            res = models.Author.objects.filter(book__id=2).values(&#39;name&#39;,&#39;author_detail__phone&#39;)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            res = models.Book.objects.filter(pk=2).values(&#39;author__author_detail__phone&#39;)
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">只要掌握了正反向概念以及双下划线
</span></span><span class="line"><span class="cl">就能无限跨表
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="10-聚合查询聚合函数">10 聚合查询（聚合函数）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">聚合查询(聚合函数的使用)   aggregate
</span></span><span class="line"><span class="cl">    聚合查询通常情况下都是配合分组一起使用的
</span></span><span class="line"><span class="cl">    导入对应模块  
</span></span><span class="line"><span class="cl">        from django.db.models import Max, Min, Sum, Count, Avg
</span></span><span class="line"><span class="cl">        只要是和数据库相关的模块基本都在django.db.models里面
</span></span><span class="line"><span class="cl">        如果上述没有应该在django.db里面
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    # 1、统计所有书的平均价格
</span></span><span class="line"><span class="cl">        res = models.Book.objects.aggregate(Avg(&#39;price&#39;))
</span></span><span class="line"><span class="cl">        print(res)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 2、使用多个
</span></span><span class="line"><span class="cl">        res = models.Book.objects.aggregate(Max(&#39;price&#39;),Min(&#39;price&#39;))
</span></span><span class="line"><span class="cl">        print(res)
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="11-分组查询">11 分组查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">分组查询 （annotate）
</span></span><span class="line"><span class="cl">    Mysql分组查询特点
</span></span><span class="line"><span class="cl">        分组之后默认只能获取到分组的依据，组内其他字段都无法直接获取
</span></span><span class="line"><span class="cl">            严格模式
</span></span><span class="line"><span class="cl">    # 1、统计每一本书的作者个数
</span></span><span class="line"><span class="cl">        # models后面点什么就是按什么分组，这一句就是按照什么分组
</span></span><span class="line"><span class="cl">            # res = models.Book.objects.annotate()    
</span></span><span class="line"><span class="cl">        # 分组为Book，然后起别名author_num=Count(&#39;author__id&#39;)，然后查询title，author_num
</span></span><span class="line"><span class="cl">            res = models.Book.objects.annotate(author_num=Count(&#39;author__id&#39;)).values(&#39;title&#39;,&#39;author_num&#39;) # 书查作者正向查询按字段
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">    # 2、统计每个出版社卖的最便宜的书的价格
</span></span><span class="line"><span class="cl">        res = models.Publish.objects.annotate(min_price=Min(&#39;book__price&#39;)).values(&#39;name&#39;,&#39;min_price&#39;)
</span></span><span class="line"><span class="cl">        print(res)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    # 3、统计不止一个作者的图书
</span></span><span class="line"><span class="cl">        # 1、先按照图书分组 求每一本书对应的作者个数
</span></span><span class="line"><span class="cl">        # 2、然后过滤出不止一个作者的图书
</span></span><span class="line"><span class="cl">        res = models.Book.objects.annotate(author_num=Count(&#39;author&#39;)).filter(author_num__gt=1).values(&#39;title&#39;,&#39;author_num&#39;)
</span></span><span class="line"><span class="cl">        print(res)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    # 4、查询每个作者出的书的总价格
</span></span><span class="line"><span class="cl">        res = models.Author.objects.annotate(sum_price=Sum(&#39;book__price&#39;)).values(&#39;name&#39;,&#39;sum_price&#39;)
</span></span><span class="line"><span class="cl">        print(res)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    ps:只要orm语句得出的结果还是一个queryset对象，那么他就可以无限制的点quertset对象封装的方法    
</span></span><span class="line"><span class="cl">        按照指定的字段分组
</span></span><span class="line"><span class="cl">        res = models.Book.objects.values(&#39;price&#39;).annotate()
</span></span><span class="line"><span class="cl">        va;ies在annotate后面默认按values分组，反之则按book分组
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="12-f与q查询">12 F与Q查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">F与Q查询
</span></span><span class="line"><span class="cl">    from django.db.models import F,Q
</span></span><span class="line"><span class="cl">    F能够帮助你直接获取到表中某个字段对应的数据
</span></span><span class="line"><span class="cl">    F查询
</span></span><span class="line"><span class="cl">        1、查询卖出数大于库存数的数据
</span></span><span class="line"><span class="cl">            f查询
</span></span><span class="line"><span class="cl">            res = models.Book.objects.filter(maichu__gt=F(&#39;kucun&#39;))
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        2、将所有书籍的价格提升50块
</span></span><span class="line"><span class="cl">            # res = models.Book.objects.update(price=原来的价格+50)
</span></span><span class="line"><span class="cl">            res = models.Book.objects.update(price=F(&#39;price&#39;)+50)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        3、将所有书的名称后面加上爆款两个字
</span></span><span class="line"><span class="cl">            models.Book.objects.update(title=Concat(F(&#39;title&#39;),Value(&#39;爆款&#39;)))
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        ps:在操作字符类型的数据时，F不能直接做到字符串的拼接如果要做凭借则需要导入：
</span></span><span class="line"><span class="cl">            from django.db.models.functions import Concat
</span></span><span class="line"><span class="cl">            from django.db.models import Value
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">    Q查询     加上q查询旧可以在条件之间添加其他运算符例如or and not
</span></span><span class="line"><span class="cl">        1、查询卖出数大于100或者价格小于600的书籍            
</span></span><span class="line"><span class="cl">            # filter内部默认是and的关系，所以要用到q查询
</span></span><span class="line"><span class="cl">            res = models.Book.objects.filter(maichu__gt=100, price__lt=600) # 为空
</span></span><span class="line"><span class="cl">            res = models.Book.objects.filter(Q(maichu__gt=100) or Q(price__lt=600))
</span></span><span class="line"><span class="cl">            print(res)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    Q的高阶用法  能够将查询条件的左边变成字符串的形式
</span></span><span class="line"><span class="cl">        q = Q()
</span></span><span class="line"><span class="cl">        q.connector = &#39;or&#39;  # 修改filter默认的and为or
</span></span><span class="line"><span class="cl">        q.children.append((&#39;maichu__gt&#39;, 100))
</span></span><span class="line"><span class="cl">        q.children.append((&#39;price__gt&#39;, 100))
</span></span><span class="line"><span class="cl">        res = models.Book.objects.filter(q) # filter括号内也支持直接放q对象，默认还是and关系
</span></span><span class="line"><span class="cl">        print(res)
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="13-django事务">13 django事务</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">事务的四个特性
</span></span><span class="line"><span class="cl">	原子性
</span></span><span class="line"><span class="cl">		不可分割的最小单位
</span></span><span class="line"><span class="cl">	一致性
</span></span><span class="line"><span class="cl">		跟原子性是相辅相成
</span></span><span class="line"><span class="cl">	隔离性
</span></span><span class="line"><span class="cl">		事务之间互不干扰
</span></span><span class="line"><span class="cl">	持久性
</span></span><span class="line"><span class="cl">		事务一旦确认永久生效
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">事务的回滚
</span></span><span class="line"><span class="cl">	rollback
</span></span><span class="line"><span class="cl">事务的确认
</span></span><span class="line"><span class="cl">	commit
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">事务
</span></span><span class="line"><span class="cl">    导入模块
</span></span><span class="line"><span class="cl">    from django.db import transaction
</span></span><span class="line"><span class="cl">    开启事务
</span></span><span class="line"><span class="cl">    try:
</span></span><span class="line"><span class="cl">        with transaction.atomic():
</span></span><span class="line"><span class="cl">            # sql1
</span></span><span class="line"><span class="cl">            # sql2
</span></span><span class="line"><span class="cl">            # 在with代码块内书写的所有orm操作都属于同一个事务
</span></span><span class="line"><span class="cl">    except Exception as e:
</span></span><span class="line"><span class="cl">        print(e)
</span></span><span class="line"><span class="cl">    print(&#39;执行其他操作&#39;)
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="14-orm中常用字段及参数">14 orm中常用字段及参数</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">orm语句和对标的sql语句
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1、AutoField
</span></span><span class="line"><span class="cl">	primary_key=True	主键字段 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2、CharFiled	varchar
</span></span><span class="line"><span class="cl">	verbose_name：字段的注释
</span></span><span class="line"><span class="cl">	max_lenth：字符的长度
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">3、IntegerField	sql里的int
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4、BigIntegerField	 bigint
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5、DecimalField
</span></span><span class="line"><span class="cl">	max_digits=8
</span></span><span class="line"><span class="cl">	decimal_places=2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6、EmailFiled	varchar(254)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">7、DateField	data
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">8、DateTimeField	datetime
</span></span><span class="line"><span class="cl">	auto_now:每次修改数据的时候会自动更新当前时间
</span></span><span class="line"><span class="cl">	auto_now_add:只在创建数据的时候记录时间，后续不会修改了
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">9、BooleanField(Field)		布尔值类型
</span></span><span class="line"><span class="cl">	该字段传布尔值，数据库里面存0或1
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">10、TextField(Field)	文本类型
</span></span><span class="line"><span class="cl">	该字段可以用来存大段内容(文章，博客),没有字数限制
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">11、FileField(Field)
</span></span><span class="line"><span class="cl">	upload_to = &#34;/data&#34;
</span></span><span class="line"><span class="cl">	给该字段传一个文件对象，会自动将文件保存在/data目录下然后将文件路径保存到数据库中
</span></span><span class="line"><span class="cl">	/data/a.txt
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">更多字段参考博客
</span></span><span class="line"><span class="cl">https://www.cnblogs.com/Dominic-Ji/p/9203990.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># django自定义字段
</span></span><span class="line"><span class="cl">![img](https://images2018.cnblogs.com/blog/1342004/201806/1342004-20180620142424835-1741683926.png)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 外键字段及参数
</span></span><span class="line"><span class="cl">1、unique=True
</span></span><span class="line"><span class="cl">	ForeignKey(unique=True) === OneToOneField()
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">2、to_field
</span></span><span class="line"><span class="cl">	设置要关联的表的字段 默认不写关联的就是另一张的主键字段
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">3、on_delete
</span></span><span class="line"><span class="cl">	1.x默认级联更新和删除
</span></span><span class="line"><span class="cl">	&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">	django2.x版本以上 需要自己指定外键字段的级联更新和删除
</span></span><span class="line"><span class="cl">	&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="15-数据库查询优化面试常考">15 数据库查询优化(面试常考)</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">only与defer
</span></span><span class="line"><span class="cl">select_related与prefetch_related
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">orm语句的特点:
</span></span><span class="line"><span class="cl">    惰性查询
</span></span><span class="line"><span class="cl">    如果你仅仅知识书写了orm语句，在后面根本没有用到该语句所查询出来的参数
</span></span><span class="line"><span class="cl">    那么orm会自动识别，直接不执行
</span></span><span class="line"><span class="cl">    res = models.Book.objects.all()	# 不执行
</span></span><span class="line"><span class="cl">    print(res)  # 要用数据了才会走数据库
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">only 
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    获取书记表中所有书的名字
</span></span><span class="line"><span class="cl">    普通方法
</span></span><span class="line"><span class="cl">        res = models.Book.objects.values(&#39;title&#39;)
</span></span><span class="line"><span class="cl">        for d in res:
</span></span><span class="line"><span class="cl">            print(d.get(&#39;title&#39;))	# 每循环一次都要走一次数据库
</span></span><span class="line"><span class="cl">	only方法
</span></span><span class="line"><span class="cl">		将title封装在res对象中，后续每循环查询直接点就出来了，不用查数据库
</span></span><span class="line"><span class="cl">        # res = models.Book.objects.all()
</span></span><span class="line"><span class="cl">        res = models.Book.objects.only(&#39;title&#39;) # 拿到对象
</span></span><span class="line"><span class="cl">        for i in res:
</span></span><span class="line"><span class="cl">            print(i.title)  # 点only括号内的字段不会走数据库，在res的对象里面有
</span></span><span class="line"><span class="cl">            print(i.price)  # 点only括号内没有的字段会重新走数据库查询而all不需要走
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">defer
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    defer与only刚好相反
</span></span><span class="line"><span class="cl">        defer括号内放的字段不在查询出来的对象里面，查询该字段需要重新走数据库
</span></span><span class="line"><span class="cl">        而如果查询的是非括号内的字段则不需要走数据库
</span></span><span class="line"><span class="cl">        res = models.Book.objects.defer(&#39;title&#39;)
</span></span><span class="line"><span class="cl">        for i in res:
</span></span><span class="line"><span class="cl">            print(i.price)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">select_related与prefetch_related
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">select_related与prefetch_related 跟跨表操作有关
</span></span><span class="line"><span class="cl">    # 拿到每一本书对应的出版社名称
</span></span><span class="line"><span class="cl">        普通版
</span></span><span class="line"><span class="cl">            res = models.Book.objects.all() 
</span></span><span class="line"><span class="cl">            for i in res:
</span></span><span class="line"><span class="cl">                print(i.publish.name)   # 每循环一次就要走一次数据库查询
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">        select_related版
</span></span><span class="line"><span class="cl">        	内部其实是连表查询
</span></span><span class="line"><span class="cl">            select_related内部直接将book与publish连起来，然后一次性将大表里面的所有数据
</span></span><span class="line"><span class="cl">            全部封装给查询出来的对象
</span></span><span class="line"><span class="cl">            这个时候对象无论是点击book表的数据还是publish的数据就不需要走数据库查询了
</span></span><span class="line"><span class="cl">            res = models.Book.objects.select_related(&#39;publish&#39;) # inner join
</span></span><span class="line"><span class="cl">            for i in res:
</span></span><span class="line"><span class="cl">                print(i.publish.name)  # 不走数据库
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            ps：select_related括号内只能放外键字段 一对多，一对一
</span></span><span class="line"><span class="cl">            如果表特别大，则耗时长
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        prefetch_related版
</span></span><span class="line"><span class="cl">            该方法其实就是子查询
</span></span><span class="line"><span class="cl">            然后将子查询查询出来的所有结果也封装到对象中
</span></span><span class="line"><span class="cl">            给人的感觉好像也是一次性搞定的
</span></span><span class="line"><span class="cl">            res = models.Book.objects.prefetch_related(&#39;publish&#39;)   # 子查询
</span></span><span class="line"><span class="cl">            for i in res:
</span></span><span class="line"><span class="cl">                print(i.publish.name)
</span></span><span class="line"><span class="cl">            ps：如果表特别大，虽然查询次数多，但是效率反而高
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="16-choices参数">16 choices参数</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">用户表
</span></span><span class="line"><span class="cl">	性别
</span></span><span class="line"><span class="cl">	学历
</span></span><span class="line"><span class="cl">	工作经验
</span></span><span class="line"><span class="cl">	是否结婚
</span></span><span class="line"><span class="cl">	是否生子
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">针对某个可以列举多种可能性的字段，我们可以用choices
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class User(models.Model):
</span></span><span class="line"><span class="cl">    username = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    age = models.IntegerField()
</span></span><span class="line"><span class="cl">    # 性别
</span></span><span class="line"><span class="cl">    gender_choice = (
</span></span><span class="line"><span class="cl">        (1, &#39;男&#39;),
</span></span><span class="line"><span class="cl">        (2, &#39;女&#39;),
</span></span><span class="line"><span class="cl">        (3, &#39;其他&#39;),
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">    gender_choice = models.IntegerField(choices=gender_choice)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    该gender字段存的还是数字，但是如果存的数字在上面元组列举的范围之内
</span></span><span class="line"><span class="cl">    那么还是可以轻松获取到数字对应的内容
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 取
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl"># 插入数据
</span></span><span class="line"><span class="cl">models.User.objects.create(username=&#39;json&#39;,age=23,gender_choice=1)
</span></span><span class="line"><span class="cl">models.User.objects.create(username=&#39;asd&#39;,age=23,gender_choice=2)
</span></span><span class="line"><span class="cl">models.User.objects.create(username=&#39;fgdg&#39;,age=23,gender_choice=3)
</span></span><span class="line"><span class="cl">models.User.objects.create(username=&#39;fgh&#39;,age=23,gender_choice=4)
</span></span><span class="line"><span class="cl"># ps:存的时候没有列举出来的数字也能村(范围还是按照字段类型决定的)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">user_obj = models.User.objects.filter(pk=1).first()
</span></span><span class="line"><span class="cl">#只要是choices参数的字段，如果想要获取对应信息格式为 get_字段名_display()
</span></span><span class="line"><span class="cl">print(user_obj.get_gender_choice_display())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">user_obj = models.User.objects.filter(pk=4).first()
</span></span><span class="line"><span class="cl"># 如果没有对应关系，那么字段是什么则返回什么
</span></span><span class="line"><span class="cl">print(user_obj.get_gender_choice_display())
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="17-mtv与mvc模型">17 MTV与MVC模型</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># MTV：django号称是MTV模型
</span></span><span class="line"><span class="cl">M:models
</span></span><span class="line"><span class="cl">T:templates
</span></span><span class="line"><span class="cl">V:views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># MVC：其实django本质也是MVC
</span></span><span class="line"><span class="cl">M:models
</span></span><span class="line"><span class="cl">V:views
</span></span><span class="line"><span class="cl">C:controller(urls.py)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># VUE框架：MVVM模型 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="18-多对多三种创建方式">18 多对多三种创建方式</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、全自动：利用orm自动帮我们创建第三张关系表
</span></span><span class="line"><span class="cl">class book(models.Model):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    authors = models.ManyToManyField(to=&#39;Author&#39;)
</span></span><span class="line"><span class="cl">class Author(models.Model):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    优点：代码不需要你写，非常方便，还支持orm操作第三张表的方法
</span></span><span class="line"><span class="cl">    缺点：第三张表的扩展性差(没办法额外添加字段...)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">2、纯手动
</span></span><span class="line"><span class="cl">class book(models.Model):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">class Author(models.Model):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">class Book2Author(models.Model):
</span></span><span class="line"><span class="cl">    book_id = models.ForeignKey(to=&#39;book&#39;)
</span></span><span class="line"><span class="cl">    author_id = models.ForeignKey(to=&#39;Author&#39;)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    优点：第三张表可以随便扩展
</span></span><span class="line"><span class="cl">    缺点:需要写的代码多，不能使用orm提供的简单方法
</span></span><span class="line"><span class="cl">    不推荐使用该方式
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">3、半自动
</span></span><span class="line"><span class="cl">class book(models.Model):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    author = models.ManyToManyField(to=&#39;Author&#39;,
</span></span><span class="line"><span class="cl">                                    # 告诉orm不需要创建第三张表，
</span></span><span class="line"><span class="cl">                                    # 直接使用创好的表
</span></span><span class="line"><span class="cl">                                    through=&#39;Book2Author&#39;,
</span></span><span class="line"><span class="cl">                                    # 告诉orm这两张表之间的连接字段
</span></span><span class="line"><span class="cl">                                    # 元组内顺序，当前表是谁，就将表
</span></span><span class="line"><span class="cl">                                    # 的字段放在前面
</span></span><span class="line"><span class="cl">                                    through_fields=(&#39;book&#39;, &#39;author&#39;)
</span></span><span class="line"><span class="cl">                                    )
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Author(models.Model):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Book2Author(models.Model):
</span></span><span class="line"><span class="cl">    book_id = models.ForeignKey(to=&#39;book&#39;)
</span></span><span class="line"><span class="cl">    author_id = models.ForeignKey(to=&#39;Author&#39;)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">ps:through_fields字段内先后顺序：当前表是谁，就将表的字段放在前面
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">半自动:可以使用orm正反向查询，但是没法用add,set,remove,clear这四个方法
</span></span><span class="line"><span class="cl">一般使用半自动
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">                                    
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="第六篇ajax分页器cookie与sessionform中间件auth">第六篇：ajax，分页器，cookie与session，form，中间件，auth</h2>
<h3 id="1ajax与django">1、Ajax与django</h3>
<h4 id="11-介绍">1.1 介绍</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">异步提交
</span></span><span class="line"><span class="cl">局部刷新
</span></span><span class="line"><span class="cl">例子：github注册
</span></span><span class="line"><span class="cl">	动态获取用户名，实时的跟后端确认并实时的展示到前端(局部跟新)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">目前学的朝后端发送请求
</span></span><span class="line"><span class="cl">	1、浏览器地址栏直接输入url回车(get请求)
</span></span><span class="line"><span class="cl">	2、a标签href属性(get请求)
</span></span><span class="line"><span class="cl">	3、form表单(get请求/post请求)
</span></span><span class="line"><span class="cl">	4、ajax(get请求/post请求)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">AJAX不是新的编程语言，而是一种使用现有标准的新方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">AJAX最大优点是在不重新加载整个页面的情况下、可以与服务器交换数据并更新部分网页的内容
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Ajax我们只学jQuery封装之后的版本(不学原生的)
</span></span><span class="line"><span class="cl">所以我们在前端页面使用ajax的时候需要确保导入jQuery
</span></span><span class="line"><span class="cl">ps：并不只有jquery能够实现ajax，其他框架也可以。
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="12-举个例子">1.2 举个例子</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">页面上有桑格input框
</span></span><span class="line"><span class="cl">	在前俩个框中输入数字，点击按钮，朝后端发送ajax请求
</span></span><span class="line"><span class="cl">	后端计算出结果，再返回给前端，动态展示到第三个input框中
</span></span><span class="line"><span class="cl">	(整个过程页面不准刷新，也不能在前端计算)
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def ab_ajax(request):
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        #     print(request.POST)
</span></span><span class="line"><span class="cl">        #     i1 = request.POST.get(&#39;i1&#39;)
</span></span><span class="line"><span class="cl">        #     i2 = request.POST.get(&#39;i2&#39;)
</span></span><span class="line"><span class="cl">        #     # 先转成整型再相加
</span></span><span class="line"><span class="cl">        #     i3 = int(i1) + int(i2)
</span></span><span class="line"><span class="cl">        #     print(i3)
</span></span><span class="line"><span class="cl">        #     return HttpResponse(i3)
</span></span><span class="line"><span class="cl">        d = {&#39;code&#39;: 100, &#39;msg&#39;: 666}
</span></span><span class="line"><span class="cl">        # return HttpResponse(json.dumps(d))
</span></span><span class="line"><span class="cl">        return JsonResponse(d)
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;script&gt;
</span></span><span class="line"><span class="cl">    // 先给按钮绑定一个点击事件
</span></span><span class="line"><span class="cl">    $(&#39;#btn&#39;).click(function (){
</span></span><span class="line"><span class="cl">        // 朝后端发送ajax请求
</span></span><span class="line"><span class="cl">        $.ajax({
</span></span><span class="line"><span class="cl">            // 1、指定朝那个后端发送ajax请求
</span></span><span class="line"><span class="cl">            url:&#39;&#39;, // 不写就是朝当前地址提交
</span></span><span class="line"><span class="cl">            // 2、请求方式
</span></span><span class="line"><span class="cl">            type:&#39;post&#39;, // 不指定默认是get,都是小写
</span></span><span class="line"><span class="cl">            // 3、数据
</span></span><span class="line"><span class="cl">            data:{&#39;i1&#39;:$(&#39;#d1&#39;).val(),&#39;i2&#39;:$(&#39;#d2&#39;).val()},
</span></span><span class="line"><span class="cl">            // 4、回调函数:当后端返回结果的时候自动触发,args接收后端返回的结果
</span></span><span class="line"><span class="cl">            success:function (args){
</span></span><span class="line"><span class="cl">                {#alert(args) // 通过DOM操作动态渲染到第三个input里面#}
</span></span><span class="line"><span class="cl">                {#$(&#39;#d3&#39;).val(args)#}
</span></span><span class="line"><span class="cl">                console.log(typeof args)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        })
</span></span><span class="line"><span class="cl">    })
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">针对后端如果是用HttpResponse返回的数据，回调函数不会自动帮你反序列化
</span></span><span class="line"><span class="cl">如果后端用的是JsonResponse返回的数据，回调函数会自动的帮忙反序列化
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HttpResponse解决方式
</span></span><span class="line"><span class="cl">	1、自己在前端利用JSON.parse()
</span></span><span class="line"><span class="cl">	2、在ajax里面配置一个参数(后面在学)
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="13-前后端传输数据的编码格式">1.3 前后端传输数据的编码格式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 主要研究post请求数据的编码格式
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">争对get没啥研究的，get请求的数据就是放在url后面的
</span></span><span class="line"><span class="cl">url?username=json&amp;password=123
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 可以朝后端发送post请求的方式
</span></span><span class="line"><span class="cl">	&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">	1、from表单
</span></span><span class="line"><span class="cl">	2、ajax请求
</span></span><span class="line"><span class="cl">	&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">前后端传输数据的编码格式
</span></span><span class="line"><span class="cl">	urlencoded
</span></span><span class="line"><span class="cl">	formdata
</span></span><span class="line"><span class="cl">	json
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1、研究form表单
</span></span><span class="line"><span class="cl">	1、默认的数据编码格式是urlencoded
</span></span><span class="line"><span class="cl">	数据格式：username=jason&amp;password=123
</span></span><span class="line"><span class="cl">	django后端针对符合urlencoded编码格式的数据都会自动封装到request.POST中
</span></span><span class="line"><span class="cl">		username=jason&amp;password=123  &gt;&gt;&gt; request.POST
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	2、如果把编码格式改成formdata，那么争对普通的键值对还是解析到request.POST中，
</span></span><span class="line"><span class="cl">	而将文件解析到request.FILES中
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	3、form表单是没有办法发送json格式的数据的
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">2、研究ajax
</span></span><span class="line"><span class="cl">	1、默认的编码格式也是urlencoded
</span></span><span class="line"><span class="cl">	数据格式：username=jason&amp;password=123
</span></span><span class="line"><span class="cl">	django后端针对符合urlencoded编码格式的数据都会自动封装到request.POST中
</span></span><span class="line"><span class="cl">		username=jason&amp;password=123  &gt;&gt;&gt; request.POST
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="14-ajax发送json格式数据">1.4 ajax发送json格式数据</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">前后端传输数据的时候一定要确保编码格式和数据真正的格式是一致的
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#39;username&#39;:&#39;json&#39;,&#39;age&#39;:25} 在request.POST里面找不到，默认的编码格式是urlencoded
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">django针对json的数据不会左任何处理
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">request对象方法补充：
</span></span><span class="line"><span class="cl">    request.is_ajax()
</span></span><span class="line"><span class="cl">    判断当前请求是否是ajax请求，返回布尔值
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;script&gt;
</span></span><span class="line"><span class="cl">    $(&#39;#d1&#39;).click(function (){
</span></span><span class="line"><span class="cl">        $.ajax({
</span></span><span class="line"><span class="cl">            url:&#39;&#39;,
</span></span><span class="line"><span class="cl">            type:&#39;post&#39;,
</span></span><span class="line"><span class="cl">            data:JSON.stringify({&#39;username&#39;:&#39;json&#39;,&#39;age&#39;:25}),
</span></span><span class="line"><span class="cl">            dataType:&#34;JSON&#34;
</span></span><span class="line"><span class="cl">            contentType:&#39;application/json&#39;, // 指定编码格式
</span></span><span class="line"><span class="cl">            success:function (){
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        })
</span></span><span class="line"><span class="cl">    })
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/script&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        # if request.is_ajax():
</span></span><span class="line"><span class="cl">        # print(request.is_ajax())
</span></span><span class="line"><span class="cl">        # print(request.POST)
</span></span><span class="line"><span class="cl">        # print(request.FILES)
</span></span><span class="line"><span class="cl">        # print(request.body) # b&#39;{&#34;username&#34;:&#34;json&#34;,&#34;age&#34;:25}&#39;
</span></span><span class="line"><span class="cl">        # 争对json格式的数据需要自己手动处理
</span></span><span class="line"><span class="cl">        json_bytes = request.body
</span></span><span class="line"><span class="cl">        # 解码
</span></span><span class="line"><span class="cl">        json_str = json_bytes.decode(&#39;utf-8&#39;)
</span></span><span class="line"><span class="cl">        print(json_str)
</span></span><span class="line"><span class="cl">        # 反序列化,json.loads括号内如果传入一个二进制格式的数据，那么会自动解码再反序列化
</span></span><span class="line"><span class="cl">        # json_dict = json.loads(json_bytes)
</span></span><span class="line"><span class="cl">        json_dict = json.loads(json_str)
</span></span><span class="line"><span class="cl">        print(json_dict, type(json_dict))
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">ajax发送json格式数据需要注意点
</span></span><span class="line"><span class="cl">	1、contenType参数指定成:application/json
</span></span><span class="line"><span class="cl">	2、数据是真正的json格式数据
</span></span><span class="line"><span class="cl">	3、django后端不会帮忙处理json格式数据，需要自己取request.body获取并处理
</span></span><span class="line"><span class="cl">	4、dataType:&#34;JSON&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="15-ajax发送文件数据">1.5 ajax发送文件数据</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;script&gt;
</span></span><span class="line"><span class="cl">    // 点击按钮朝后端发送普通键值对和文件数据
</span></span><span class="line"><span class="cl">    $(&#39;#d4&#39;).on(&#39;click&#39;,function (){
</span></span><span class="line"><span class="cl">        // 1、需要先利用formdata内置对象
</span></span><span class="line"><span class="cl">        let formDateObj = new FormData();
</span></span><span class="line"><span class="cl">        // 2、添加普通的键值对
</span></span><span class="line"><span class="cl">        formDateObj.append(&#39;username&#39;,$(&#39;#d1&#39;).val());
</span></span><span class="line"><span class="cl">        formDateObj.append(&#39;password&#39;,$(&#39;#d2&#39;).val());
</span></span><span class="line"><span class="cl">        // 3、添加文件对象
</span></span><span class="line"><span class="cl">        formDateObj.append(&#39;myfile&#39;,$(&#39;#d3&#39;)[0].files[0])
</span></span><span class="line"><span class="cl">        // 4、将对象基于ajax发送给后端
</span></span><span class="line"><span class="cl">        $.ajax({
</span></span><span class="line"><span class="cl">            url:&#39;&#39;,
</span></span><span class="line"><span class="cl">            type:&#39;post&#39;,
</span></span><span class="line"><span class="cl">            data:formDateObj, // 直接将对象放在data后面即可
</span></span><span class="line"><span class="cl">        // ajax发送文件必须要指定的两个参数c
</span></span><span class="line"><span class="cl">            contentType:false, // 不需使用如何编码，django后端能自动识别formdata对象
</span></span><span class="line"><span class="cl">            processData:false, // 告诉浏览器不要对数据进行如何处理
</span></span><span class="line"><span class="cl">        // 回调函数
</span></span><span class="line"><span class="cl">            success:function (args){
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        })
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    })
</span></span><span class="line"><span class="cl">&lt;/script&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        print(request.POST)
</span></span><span class="line"><span class="cl">        print(request.FILES)
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">总结：
</span></span><span class="line"><span class="cl">	1、需要利用内置对象formdata
</span></span><span class="line"><span class="cl">	    // 2、添加普通的键值对
</span></span><span class="line"><span class="cl">        formDateObj.append(&#39;username&#39;,$(&#39;#d1&#39;).val());
</span></span><span class="line"><span class="cl">        formDateObj.append(&#39;password&#39;,$(&#39;#d2&#39;).val());
</span></span><span class="line"><span class="cl">        // 3、添加文件对象
</span></span><span class="line"><span class="cl">        formDateObj.append(&#39;myfile&#39;,$(&#39;#d3&#39;)[0].files[0])
</span></span><span class="line"><span class="cl">    2、需要指定两个关键参数
</span></span><span class="line"><span class="cl">    	    contentType:false, // 不需使用如何编码，django后端能自动识别formdata对象
</span></span><span class="line"><span class="cl">            processData:false, // 告诉浏览器不要对数据进行如何处理
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">	3、django后端能够识别formdata对象并且能够将内部普通键值自动解析并封装到request.POST中，文件数据自动解析并封装到request.FILES中
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="16-django自带的序列化组件drf铺垫">1.6 django自带的序列化组件(drf铺垫)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{% for user_query in user_queryset %}
</span></span><span class="line"><span class="cl">    &lt;p&gt;{{ user_query }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{% endfor %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class User(models.Model):
</span></span><span class="line"><span class="cl">    username = models.CharField(max_length=32,verbose_name=&#39;用户名&#39;)
</span></span><span class="line"><span class="cl">    age = models.IntegerField()
</span></span><span class="line"><span class="cl">    gender_choices=(
</span></span><span class="line"><span class="cl">        (1,&#39;male&#39;),
</span></span><span class="line"><span class="cl">        (2,&#39;female&#39;),
</span></span><span class="line"><span class="cl">        (3,&#39;others&#39;)
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">    gender = models.IntegerField(choices=gender_choices, verbose_name=&#39;性别&#39;)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.core import serializers
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    user_queryset = models.User.objects.all()
</span></span><span class="line"><span class="cl">    # [{},{},{},{}]
</span></span><span class="line"><span class="cl">    user_lsit = []
</span></span><span class="line"><span class="cl">    # for user_obj in user_queryset:
</span></span><span class="line"><span class="cl">    #     tmp = {
</span></span><span class="line"><span class="cl">    #         &#39;pk&#39;:user_obj.pk,
</span></span><span class="line"><span class="cl">    #         &#39;username&#39;:user_obj.username,
</span></span><span class="line"><span class="cl">    #         &#39;age&#39;:user_obj.age,
</span></span><span class="line"><span class="cl">    #         &#39;gender&#39;:user_obj.get_gender_display()
</span></span><span class="line"><span class="cl">    #     }
</span></span><span class="line"><span class="cl">    #     user_lsit.append(tmp)
</span></span><span class="line"><span class="cl">    #
</span></span><span class="line"><span class="cl">    # return JsonResponse(user_lsit, safe=False)
</span></span><span class="line"><span class="cl">    # return render(request, &#39;index.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 序列化
</span></span><span class="line"><span class="cl">    res = serializers.serialize(&#39;json&#39;, user_queryset)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;这一步会自动将数据变成json格式的字符串，并且内部非常全面&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    return HttpResponse(res)
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">[
</span></span><span class="line"><span class="cl">{&#34;pk&#34;:1, &#34;username&#34;:&#34;json&#34;, &#34;age&#34;:25, &#34;gender&#34;:&#34;male&#34;}
</span></span><span class="line"><span class="cl">{&#34;pk&#34;:2, &#34;username&#34;:&#34;json&#34;, &#34;age&#34;:25, &#34;gender&#34;:&#34;male&#34;}
</span></span><span class="line"><span class="cl">{&#34;pk&#34;:3, &#34;username&#34;:&#34;json&#34;, &#34;age&#34;:25, &#34;gender&#34;:&#34;male&#34;}
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">前后端分离的项目
</span></span><span class="line"><span class="cl">    作为后端开发，只需要写代码将数据处理好
</span></span><span class="line"><span class="cl">    能够序列化返回给前端即可
</span></span><span class="line"><span class="cl">        再写一个接口文档，告诉前端每个字段代表的意思即可
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">[
</span></span><span class="line"><span class="cl">{   &#34;model&#34;:&#34;app01.user&#34;,
</span></span><span class="line"><span class="cl">    &#34;pk&#34;:1,
</span></span><span class="line"><span class="cl">    &#34;fields&#34;:{&#34;username&#34;:&#34;json&#34;, &#34;age&#34;:25, &#34;gender&#34;:1}}
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">写接口就是利用序列化组件渲染数据然后写一个接口文档，然后交代一下就完事
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="17-ajax结合sweetalert实现二次确认">1.7 ajax结合sweetalert实现二次确认</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># sweetalert针对中文可能会出现展示不全的现象
</span></span><span class="line"><span class="cl">	自己找到对应的标签书写css修改样式即可
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"># 也可以不解和sweetalert及使用ajax和BOM操作也能完成二次确认
</span></span><span class="line"><span class="cl">	res = confirm()
</span></span><span class="line"><span class="cl">	if(res){
</span></span><span class="line"><span class="cl">		$.ajax({})
</span></span><span class="line"><span class="cl">	}else{
</span></span><span class="line"><span class="cl">		不发
</span></span><span class="line"><span class="cl">	}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="18-批量插入">1.8 批量插入</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    # # 先给Book插入一万条数据
</span></span><span class="line"><span class="cl">    # for i in range(1000):
</span></span><span class="line"><span class="cl">    #     models.Book.objects.create(title=&#34;第%s本书&#34;%i)
</span></span><span class="line"><span class="cl">    # # 再将所有的数据查询并展示到前端页面
</span></span><span class="line"><span class="cl">    # book_queryset = models.Book.objects.all()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 批量插入
</span></span><span class="line"><span class="cl">    # book_list = []
</span></span><span class="line"><span class="cl">    # for i in range(10000):
</span></span><span class="line"><span class="cl">    #     book_obj = models.Book(title=&#39;第%s本书&#39;%i)
</span></span><span class="line"><span class="cl">    #     book_list.append(book_list)
</span></span><span class="line"><span class="cl">    # models.Book.objects.bulk_create(book_list)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    当你想要插入数据的时候使用orm提供的bulk_create可以大量减少插入时间
</span></span><span class="line"><span class="cl">    :param request:
</span></span><span class="line"><span class="cl">    :return:
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;, locals())
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2分页器">2、分页器</h3>
<h4 id="21-分页器思路">2.1 分页器思路</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">总数据100 每页展示10  需要10
</span></span><span class="line"><span class="cl">总数居101 每页展示10 需要11
</span></span><span class="line"><span class="cl">总数居99	每页展示10 需要10
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    # 1、分页
</span></span><span class="line"><span class="cl">    book_list = models.Book.objects.all()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 2、想访问那一页
</span></span><span class="line"><span class="cl">    current_page = request.GET.get(&#39;page&#39;, 1)  # 护国获取不到当前页码，就展示第一页
</span></span><span class="line"><span class="cl">    # 数据类型转换
</span></span><span class="line"><span class="cl">    try:
</span></span><span class="line"><span class="cl">        current_page = int(current_page)
</span></span><span class="line"><span class="cl">    except Exception:
</span></span><span class="line"><span class="cl">        current_page = 1
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    # 3、每页展示多少条
</span></span><span class="line"><span class="cl">    per_page_num = 10
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    # 4、起始位置
</span></span><span class="line"><span class="cl">    start_page = (current_page - 1) * per_page_num
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    # 5、终止位置
</span></span><span class="line"><span class="cl">    end_page = current_page * per_page_num
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 6、计算出到底需要多少页，利用内置函数divmod
</span></span><span class="line"><span class="cl">    all_count = book_list.count()
</span></span><span class="line"><span class="cl">    page_count, more = divmod(all_count, per_page_num)
</span></span><span class="line"><span class="cl">    if more:
</span></span><span class="line"><span class="cl">        page_count += 1
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	# 7、前端模板语法没有range功能的，可以通过再后端写好传给前端
</span></span><span class="line"><span class="cl">	#	当前页减5，当前页加6，针对页码小于6的情况需要做处理泵再减
</span></span><span class="line"><span class="cl">    page_html = &#39;&#39;
</span></span><span class="line"><span class="cl">    xxx = current_page
</span></span><span class="line"><span class="cl">    if current_page &lt; 6:
</span></span><span class="line"><span class="cl">        current_page = 6
</span></span><span class="line"><span class="cl">    for i in range(current_page-5, current_page+6):
</span></span><span class="line"><span class="cl">        if xxx == i:
</span></span><span class="line"><span class="cl">            page_html += &#39;&lt;li class=&#34;active&#34;&gt;&lt;a href=&#34;?page=%s&#34;&gt;%s&lt;/a&gt;&lt;/li&gt;&#39;%(i, i)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            page_html +=  &#39;&lt;li&gt;&lt;a href=&#34;?page=%s&#34;&gt;%s&lt;/a&gt;&lt;/li&gt;&#39;%(i, i)
</span></span><span class="line"><span class="cl">    book_queryset = book_list[start_page:end_page]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">per_page_num = 10
</span></span><span class="line"><span class="cl">current_page    start_page      end_page
</span></span><span class="line"><span class="cl">    1               0               10
</span></span><span class="line"><span class="cl">    2               10              20
</span></span><span class="line"><span class="cl">    3               20              30
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">start_page = (current_page - 1) * per_page_num
</span></span><span class="line"><span class="cl">end_page = current_page * per_page_num
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">django中有自带分页器模块，但是书写起来很麻烦并且功能太简单，所以我们需要自己定义分页器
</span></span><span class="line"><span class="cl">我们基于上述思路以及封装好了我们自己定义的分页器后续需要使用直接拷贝即可
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="22-自定义分页器的拷贝使用">2.2 自定义分页器的拷贝使用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">当我们需要使用到非django内置的第三方功能或者组件代码的时候
</span></span><span class="line"><span class="cl">我们一般放在utils文件夹下面
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps:我们的分页器是基于bootstrap央视来的，所以要提前导入bootstrap	
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Pagination(object):
</span></span><span class="line"><span class="cl">    def __init__(self, current_page, all_count, per_page_num=2, pager_count=11):
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        封装分页相关数据
</span></span><span class="line"><span class="cl">        :param current_page: 当前页
</span></span><span class="line"><span class="cl">        :param all_count:    数据库中的数据总条数
</span></span><span class="line"><span class="cl">        :param per_page_num: 每页显示的数据条数
</span></span><span class="line"><span class="cl">        :param pager_count:  最多显示的页码个数
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        try:
</span></span><span class="line"><span class="cl">            current_page = int(current_page)
</span></span><span class="line"><span class="cl">        except Exception as e:
</span></span><span class="line"><span class="cl">            current_page = 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if current_page &lt; 1:
</span></span><span class="line"><span class="cl">            current_page = 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        self.current_page = current_page
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        self.all_count = all_count
</span></span><span class="line"><span class="cl">        self.per_page_num = per_page_num
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # 总页码
</span></span><span class="line"><span class="cl">        all_pager, tmp = divmod(all_count, per_page_num)
</span></span><span class="line"><span class="cl">        if tmp:
</span></span><span class="line"><span class="cl">            all_pager += 1
</span></span><span class="line"><span class="cl">        self.all_pager = all_pager
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        self.pager_count = pager_count
</span></span><span class="line"><span class="cl">        self.pager_count_half = int((pager_count - 1) / 2)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    @property
</span></span><span class="line"><span class="cl">    def start(self):
</span></span><span class="line"><span class="cl">        return (self.current_page - 1) * self.per_page_num
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    @property
</span></span><span class="line"><span class="cl">    def end(self):
</span></span><span class="line"><span class="cl">        return self.current_page * self.per_page_num
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def page_html(self):
</span></span><span class="line"><span class="cl">        # 如果总页码 &lt; 11个：
</span></span><span class="line"><span class="cl">        if self.all_pager &lt;= self.pager_count:
</span></span><span class="line"><span class="cl">            pager_start = 1
</span></span><span class="line"><span class="cl">            pager_end = self.all_pager + 1
</span></span><span class="line"><span class="cl">        # 总页码  &gt; 11
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            # 当前页如果&lt;=页面上最多显示11/2个页码
</span></span><span class="line"><span class="cl">            if self.current_page &lt;= self.pager_count_half:
</span></span><span class="line"><span class="cl">                pager_start = 1
</span></span><span class="line"><span class="cl">                pager_end = self.pager_count + 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            # 当前页大于5
</span></span><span class="line"><span class="cl">            else:
</span></span><span class="line"><span class="cl">                # 页码翻到最后
</span></span><span class="line"><span class="cl">                if (self.current_page + self.pager_count_half) &gt; self.all_pager:
</span></span><span class="line"><span class="cl">                    pager_end = self.all_pager + 1
</span></span><span class="line"><span class="cl">                    pager_start = self.all_pager - self.pager_count + 1
</span></span><span class="line"><span class="cl">                else:
</span></span><span class="line"><span class="cl">                    pager_start = self.current_page - self.pager_count_half
</span></span><span class="line"><span class="cl">                    pager_end = self.current_page + self.pager_count_half + 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        page_html_list = []
</span></span><span class="line"><span class="cl">        # 添加前面的nav和ul标签
</span></span><span class="line"><span class="cl">        page_html_list.append(&#39;&#39;&#39;
</span></span><span class="line"><span class="cl">                    &lt;nav aria-label=&#39;Page navigation&gt;&#39;
</span></span><span class="line"><span class="cl">                    &lt;ul class=&#39;pagination&#39;&gt;
</span></span><span class="line"><span class="cl">                &#39;&#39;&#39;)
</span></span><span class="line"><span class="cl">        first_page = &#39;&lt;li&gt;&lt;a href=&#34;?page=%s&#34;&gt;首页&lt;/a&gt;&lt;/li&gt;&#39; % (1)
</span></span><span class="line"><span class="cl">        page_html_list.append(first_page)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if self.current_page &lt;= 1:
</span></span><span class="line"><span class="cl">            prev_page = &#39;&lt;li class=&#34;disabled&#34;&gt;&lt;a href=&#34;#&#34;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#39;
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            prev_page = &#39;&lt;li&gt;&lt;a href=&#34;?page=%s&#34;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#39; % (self.current_page - 1,)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        page_html_list.append(prev_page)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        for i in range(pager_start, pager_end):
</span></span><span class="line"><span class="cl">            if i == self.current_page:
</span></span><span class="line"><span class="cl">                temp = &#39;&lt;li class=&#34;active&#34;&gt;&lt;a href=&#34;?page=%s&#34;&gt;%s&lt;/a&gt;&lt;/li&gt;&#39; % (i, i,)
</span></span><span class="line"><span class="cl">            else:
</span></span><span class="line"><span class="cl">                temp = &#39;&lt;li&gt;&lt;a href=&#34;?page=%s&#34;&gt;%s&lt;/a&gt;&lt;/li&gt;&#39; % (i, i,)
</span></span><span class="line"><span class="cl">            page_html_list.append(temp)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if self.current_page &gt;= self.all_pager:
</span></span><span class="line"><span class="cl">            next_page = &#39;&lt;li class=&#34;disabled&#34;&gt;&lt;a href=&#34;#&#34;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#39;
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            next_page = &#39;&lt;li&gt;&lt;a href=&#34;?page=%s&#34;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#39; % (self.current_page + 1,)
</span></span><span class="line"><span class="cl">        page_html_list.append(next_page)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        last_page = &#39;&lt;li&gt;&lt;a href=&#34;?page=%s&#34;&gt;尾页&lt;/a&gt;&lt;/li&gt;&#39; % (self.all_pager,)
</span></span><span class="line"><span class="cl">        page_html_list.append(last_page)
</span></span><span class="line"><span class="cl">        # 尾部添加标签
</span></span><span class="line"><span class="cl">        page_html_list.append(&#39;&#39;&#39;
</span></span><span class="line"><span class="cl">                                           &lt;/nav&gt;
</span></span><span class="line"><span class="cl">                                           &lt;/ul&gt;
</span></span><span class="line"><span class="cl">                                       &#39;&#39;&#39;)
</span></span><span class="line"><span class="cl">        return &#39;&#39;.join(page_html_list)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 后端
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    book_queryset = models.Book.objects.all()
</span></span><span class="line"><span class="cl">    current_page = request.GET.get(&#39;page&#39;,1)
</span></span><span class="line"><span class="cl">    all_count = book_queryset.count()
</span></span><span class="line"><span class="cl">    # 1、传值生产对象
</span></span><span class="line"><span class="cl">    page_obj = Pagination(current_page=current_page,all_count=all_count)
</span></span><span class="line"><span class="cl">    # 2、直接对总数居进行切片操作
</span></span><span class="line"><span class="cl">    page_queryset = book_queryset[page_obj.start:page_obj.end]
</span></span><span class="line"><span class="cl">    # 3、将page_queryset传递到页面 替换之前的book_queryset
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;, locals())
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 前端
</span></span><span class="line"><span class="cl">{% for page_query in page_queryset %}
</span></span><span class="line"><span class="cl">    &lt;p&gt;{{ page_query.title }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">    &lt;nav aria-label=&#34;Page navigation&#34;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;/nav&gt;
</span></span><span class="line"><span class="cl">{% endfor %}
</span></span><span class="line"><span class="cl">{#利用自定义分页器直接显示分页器样式#}
</span></span><span class="line"><span class="cl">{{ page_obj.page_html }}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3form组件">3、form组件</h3>
<h4 id="31-前戏">3.1 前戏</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">写一个注册功能
</span></span><span class="line"><span class="cl">	获取用户名和密码，利用form表单提交数据
</span></span><span class="line"><span class="cl">	在后端判断用户和密码是否符合一定条件
</span></span><span class="line"><span class="cl">		用户名中不能含有金瓶梅
</span></span><span class="line"><span class="cl">		密码不能少于三位
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	如果符合条件需要你将提示信息展示到前端页面
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;form action=&#34;&#34; method=&#34;post&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;p&gt;username:
</span></span><span class="line"><span class="cl">        &lt;input type=&#34;text&#34; class=&#34;form-control&#34; name=&#34;username&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">        &lt;span style=&#34;color: red&#34;&gt;{{ back_dic.username }}&lt;/span&gt;
</span></span><span class="line"><span class="cl">    &lt;p&gt;username:
</span></span><span class="line"><span class="cl">        &lt;input type=&#34;text&#34; class=&#34;form-control&#34; name=&#34;password&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">        &lt;span style=&#34;color: red&#34;&gt;{{ back_dic.password }}&lt;/span&gt;
</span></span><span class="line"><span class="cl">    &lt;input type=&#34;submit&#34; class=&#34;btn btn-info&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;/form&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    back_dic = {&#39;username&#39;: &#39;&#39;, &#39;password&#39;: &#39;&#39;}
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        username = request.POST.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        password = request.POST.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        if &#39;金瓶梅&#39; in username:
</span></span><span class="line"><span class="cl">            back_dic[&#39;username&#39;] = &#39;不符合社会主义核心价值观&#39;
</span></span><span class="line"><span class="cl">        if len(password) &lt; 3:
</span></span><span class="line"><span class="cl">            back_dic[&#39;password&#39;] = &#39;不能太短，不好&#39;
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        无论是post请求还是get请求
</span></span><span class="line"><span class="cl">        页面都能够获取到字典，只不过get请求来的时候，字典是空的
</span></span><span class="line"><span class="cl">        而post请求来了之后，字典有值
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1、手动书写前端获取用户数据的html代码	渲染html代码
</span></span><span class="line"><span class="cl">2、后端对用户数据进行校验		校验数据
</span></span><span class="line"><span class="cl">3、对不符合要求的数据进行前端提示	展示提示信息
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">form组件
</span></span><span class="line"><span class="cl">	能够完成的事情
</span></span><span class="line"><span class="cl">		1、渲染html代码
</span></span><span class="line"><span class="cl">		2、校验数据
</span></span><span class="line"><span class="cl">		3、展示提示信息
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="32-form组件基本使用">3.2 form组件基本使用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from django import forms
</span></span><span class="line"><span class="cl">class MyForm(forms.Form):
</span></span><span class="line"><span class="cl">    # username 字符串类型最小3位最大8位
</span></span><span class="line"><span class="cl">    username = forms.CharField(min_length=3,max_length=8)
</span></span><span class="line"><span class="cl">    password = forms.CharField(min_length=3,max_length=8)
</span></span><span class="line"><span class="cl">    # email字段必须符合邮箱格式
</span></span><span class="line"><span class="cl">    email = forms.EmailInput()
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="33-forms校验数据">3.3 forms校验数据</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">测试环境的准备，可以自己拷贝代码准备
</span></span><span class="line"><span class="cl">起始在pycharm里面以及帮你准备了一个测试环境
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl"># 1、将带校验的数据组织成字典的形式传入即可
</span></span><span class="line"><span class="cl">form_obj = views.MyForm({&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:&#39;133&#39;,&#39;email&#39;:&#39;12&#39;})
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、判断数据是否合法，只有全部合法才会返回True
</span></span><span class="line"><span class="cl">form_obj.is_valid()
</span></span><span class="line"><span class="cl">False
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、查看所有校验通过的数据
</span></span><span class="line"><span class="cl">form_obj.cleaned_data
</span></span><span class="line"><span class="cl">{&#39;username&#39;: &#39;jason&#39;,&#39;password&#39;:&#39;133&#39;}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 4、查看所有不符合校验规则以及不符合的原因
</span></span><span class="line"><span class="cl">form_obj.errors
</span></span><span class="line"><span class="cl">{&#39;email&#39;: [&#39;Enter a valid email address.&#39;]}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 5、校验数据之校验类中出现的字段，多传不影响，多传的字段直接忽略
</span></span><span class="line"><span class="cl">form_obj = views.MyForm({&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:&#39;133&#39;,&#39;email&#39;:&#39;12&#39;,&#39;qwe&#39;:&#39;123&#39;})
</span></span><span class="line"><span class="cl">form_obj.is_valid()
</span></span><span class="line"><span class="cl">True
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 6、校验数据 默认情况下，类里面所有的字段都必须传值
</span></span><span class="line"><span class="cl">form_obj = views.MyForm({&#39;username&#39;:&#39;asd&#39;,&#39;password&#39;:&#39;123&#39;})
</span></span><span class="line"><span class="cl">form_obj.is_valid()
</span></span><span class="line"><span class="cl">False
</span></span><span class="line"><span class="cl">form_obj.errors
</span></span><span class="line"><span class="cl">{&#39;email&#39;: [&#39;This field is required.&#39;]}
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">也就意味着校验数据的时候，默认情况下数据可以多传但不能少传
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="34-渲染标签">3.4 渲染标签</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">forms组件只会自动渲染获取用户输入的标签(input select radio checkbox)
</span></span><span class="line"><span class="cl">不会帮你渲染提交按钮
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyForm(forms.Form):
</span></span><span class="line"><span class="cl">    # username 字符串类型最小3位最大8位
</span></span><span class="line"><span class="cl">    username = forms.CharField(min_length=3, max_length=8, label=&#39;用户名&#39;)
</span></span><span class="line"><span class="cl">    password = forms.CharField(min_length=3, max_length=8, label=&#39;密码&#39;)
</span></span><span class="line"><span class="cl">    # email字段必须符合邮箱格式
</span></span><span class="line"><span class="cl">    email = forms.EmailField()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    # 1、先产生一个空对象
</span></span><span class="line"><span class="cl">    form_obj = MyForm()
</span></span><span class="line"><span class="cl">    # 2、直接将该空对象传递给html页面
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 前端利用空对象做操作
</span></span><span class="line"><span class="cl">&lt;form action=&#34;&#34; method=&#34;post&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;p&gt;第一种渲染方法:代码书写极少，封装程度高，不便于后续的
</span></span><span class="line"><span class="cl">        扩展，一边情况下旨在本地测试使用&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {{ form_obj.as_p }}
</span></span><span class="line"><span class="cl">    {{ form_obj.as_ul }}
</span></span><span class="line"><span class="cl">    {{ form_obj.as_table }}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;p&gt;第二种渲染方式:可扩展性很强，但是需要书写的代码太多&lt;/p&gt;
</span></span><span class="line"><span class="cl">    &lt;p&gt;{{ form_obj.username.label }}{{ form_obj.username }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">    &lt;p&gt;{{ form_obj.password.label }}{{ form_obj.password }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">    &lt;p&gt;{{ form_obj.email.label }}{{ form_obj.email }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;p&gt;第三种渲染方式(推荐使用):&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% for form in form_obj %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;{{ form.label }}: {{ form }}&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/form&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">label属性默认展示的是类中定义的字段首字母大写的形式
</span></span><span class="line"><span class="cl">也可以自己修改，直接给字段对象加label属性即可
</span></span><span class="line"><span class="cl">username = forms.CharField(min_length=3, max_length=8, label=&#39;用户名&#39;)
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="35-展示提示信息">3.5 展示提示信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">浏览器会自动校验数据，但前端校验不安全
</span></span><span class="line"><span class="cl">如何让浏览器不做校验 novalidate
</span></span><span class="line"><span class="cl">&lt;form action=&#34;&#34; method=&#34;post&#34; novalidate&gt;
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;form action=&#34;&#34; method=&#34;post&#34; novalidate&gt;
</span></span><span class="line"><span class="cl">    &lt;p&gt;第三种渲染方式(推荐使用):&lt;/p&gt;
</span></span><span class="line"><span class="cl">    {% for form in form_obj %}
</span></span><span class="line"><span class="cl">        &lt;p&gt;
</span></span><span class="line"><span class="cl">            {{ form.label }}: {{ form }}
</span></span><span class="line"><span class="cl">{#           form.errors,在后面加个.0浏览器则不会将其转化为ul套li的格式 #}
</span></span><span class="line"><span class="cl">            &lt;span style=&#34;color: red&#34;&gt;{{ form.errors.0 }}&lt;/span&gt;
</span></span><span class="line"><span class="cl">        &lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">    &lt;input type=&#34;submit&#34; class=&#34;btn btn-info&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;/form&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyForm(forms.Form):
</span></span><span class="line"><span class="cl">    # username 字符串类型最小3位最大8位
</span></span><span class="line"><span class="cl">    username = forms.CharField(min_length=3, max_length=8, label=&#39;用户名&#39;,
</span></span><span class="line"><span class="cl">                               error_messages={
</span></span><span class="line"><span class="cl">                                   &#39;min_length&#39;:&#39;用户名最小3位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;max_length&#39;:&#39;用户名最大8位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;required&#39;:&#39;密码不能为空&#39;
</span></span><span class="line"><span class="cl">                               }
</span></span><span class="line"><span class="cl">                               )
</span></span><span class="line"><span class="cl">    password = forms.CharField(min_length=3, max_length=8, label=&#39;密码&#39;,
</span></span><span class="line"><span class="cl">                               error_messages={
</span></span><span class="line"><span class="cl">                                   &#39;min_length&#39;: &#39;密码最小3位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;max_length&#39;: &#39;密码最大8位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;required&#39;: &#39;密码不能为空&#39;
</span></span><span class="line"><span class="cl">                               }
</span></span><span class="line"><span class="cl">                               )
</span></span><span class="line"><span class="cl">    # email字段必须符合邮箱格式
</span></span><span class="line"><span class="cl">    email = forms.EmailField(label=&#39;邮箱名&#39;,
</span></span><span class="line"><span class="cl">                             error_messages={
</span></span><span class="line"><span class="cl">                                   &#39;invalid&#39;:&#39;邮箱格式不正确&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;required&#39;:&#39;邮箱不能为空&#39;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                               }
</span></span><span class="line"><span class="cl">                             )
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    # 1、先产生一个空对象
</span></span><span class="line"><span class="cl">    form_obj = MyForm()
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        # 获取用户数据并校验
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        1、数据获取繁琐
</span></span><span class="line"><span class="cl">        2、校验数据需要构造成字典格式传入才行
</span></span><span class="line"><span class="cl">        ps：但是request.POST可以看出就是一个字典
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        # 3、校验数据
</span></span><span class="line"><span class="cl">        form_obj = MyForm(request.POST)
</span></span><span class="line"><span class="cl">        # 4、判断数据是否合法
</span></span><span class="line"><span class="cl">        if form_obj.is_valid():
</span></span><span class="line"><span class="cl">            # 5、如果合法，操作数据库存储数
</span></span><span class="line"><span class="cl">            return HttpResponse(&#39;OK&#39;)
</span></span><span class="line"><span class="cl">        # 5、不合法 有错误
</span></span><span class="line"><span class="cl">    # 2、直接将该空对象传递给html页面
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1、必备条件 get请求和post传给html页面对象变量名必须一样
</span></span><span class="line"><span class="cl">2、forms组件当你数据不合法时，会保存你上次的数据，让你基于之前的结果进行修改，更加人性化
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 针对错误提示信息还可以自己定制
</span></span><span class="line"><span class="cl">    # username 字符串类型最小3位最大8位
</span></span><span class="line"><span class="cl">    username = forms.CharField(min_length=3, max_length=8, label=&#39;用户名&#39;,
</span></span><span class="line"><span class="cl">                               error_messages={
</span></span><span class="line"><span class="cl">                                   &#39;min_length&#39;:&#39;用户名最小3位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;max_length&#39;:&#39;用户名最大8位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;required&#39;:&#39;密码不能为空&#39;
</span></span><span class="line"><span class="cl">                               }
</span></span><span class="line"><span class="cl">                               )
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="36-钩子函数hook">3.6 钩子函数(HOOK)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">在特定的节点自动触发完成相应操作
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">钩子函数在forms组件中就类似于第二道关卡，能够让我们自定义校验规则
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在forms组件中有两类狗子
</span></span><span class="line"><span class="cl">	1、局部钩子
</span></span><span class="line"><span class="cl">		当需要给单个字段增加校验规则的时候使用
</span></span><span class="line"><span class="cl">	2、全局钩子
</span></span><span class="line"><span class="cl">		当需要给多个字段增加校验规则的时候使用
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 实际案例
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 1、校验用户名中不能含有666 只校验username字段 局部钩子
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、检验密码和确认密码是否一致 password confirm两个字段 全局钩子
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django import forms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyForm(forms.Form):
</span></span><span class="line"><span class="cl">    # username 字符串类型最小3位最大8位
</span></span><span class="line"><span class="cl">    username = forms.CharField(min_length=3, max_length=8, label=&#39;用户名&#39;,
</span></span><span class="line"><span class="cl">                               error_messages={
</span></span><span class="line"><span class="cl">                                   &#39;min_length&#39;:&#39;用户名最小3位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;max_length&#39;:&#39;用户名最大8位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;required&#39;:&#39;密码不能为空&#39;
</span></span><span class="line"><span class="cl">                               }
</span></span><span class="line"><span class="cl">                               )
</span></span><span class="line"><span class="cl">    password = forms.CharField(min_length=3, max_length=8, label=&#39;密码&#39;,
</span></span><span class="line"><span class="cl">                               error_messages={
</span></span><span class="line"><span class="cl">                                   &#39;min_length&#39;: &#39;密码最小3位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;max_length&#39;: &#39;密码最大8位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;required&#39;: &#39;密码不能为空&#39;
</span></span><span class="line"><span class="cl">                               }
</span></span><span class="line"><span class="cl">                               )
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    confirm_password = forms.CharField(min_length=3, max_length=8, label=&#39;密码&#39;,
</span></span><span class="line"><span class="cl">                               error_messages={
</span></span><span class="line"><span class="cl">                                   &#39;min_length&#39;: &#39;密码最小3位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;max_length&#39;: &#39;密码最大8位&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;required&#39;: &#39;密码不能为空&#39;
</span></span><span class="line"><span class="cl">                               }
</span></span><span class="line"><span class="cl">                               )
</span></span><span class="line"><span class="cl">    # email字段必须符合邮箱格式
</span></span><span class="line"><span class="cl">    email = forms.EmailField(label=&#39;邮箱名&#39;,
</span></span><span class="line"><span class="cl">                             error_messages={
</span></span><span class="line"><span class="cl">                                   &#39;invalid&#39;:&#39;邮箱格式不正确&#39;,
</span></span><span class="line"><span class="cl">                                   &#39;required&#39;:&#39;邮箱不能为空&#39;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                               }
</span></span><span class="line"><span class="cl">                             )
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 钩子函数 在类里面书写方法即可
</span></span><span class="line"><span class="cl">    # 局部钩子
</span></span><span class="line"><span class="cl">    def clean_username(self):
</span></span><span class="line"><span class="cl">        # 获取到用户名
</span></span><span class="line"><span class="cl">        username = self.cleaned_data.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        if &#39;666&#39; in username:
</span></span><span class="line"><span class="cl">            # 提示前端展示错误信息
</span></span><span class="line"><span class="cl">            self.add_error(&#39;username&#39;, &#39;光喊666是不行滴&#39;)
</span></span><span class="line"><span class="cl">        # 将钩子函数勾取出来的数据在放回去
</span></span><span class="line"><span class="cl">        return username
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 全局钩子
</span></span><span class="line"><span class="cl">    def clean(self):
</span></span><span class="line"><span class="cl">        password = self.cleaned_data.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        confirm_password = self.cleaned_data.get(&#39;confirm_password&#39;)
</span></span><span class="line"><span class="cl">        if not confirm_password == password:
</span></span><span class="line"><span class="cl">            self.add_error(&#39;confirm_password&#39;, &#39;两次密码不一致&#39;)
</span></span><span class="line"><span class="cl">        # 将钩子函数勾出来的数据再放回去
</span></span><span class="line"><span class="cl">        return self.cleaned_data
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="37-form组件其他参数补充知识点">3.7 form组件其他参数补充知识点</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">leabel		字段名
</span></span><span class="line"><span class="cl">error_messages		自定义报错信息
</span></span><span class="line"><span class="cl">initia		默认值类似input框里面的value
</span></span><span class="line"><span class="cl">required		控制字段是否必填
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1、字段没有样式， 加样式方法如下
</span></span><span class="line"><span class="cl"># 多个书写值直接空格隔开即可
</span></span><span class="line"><span class="cl">    username = forms.CharField(min_length=3, max_length=8, label=&#39;用户名&#39;,
</span></span><span class="line"><span class="cl">                               error_messages={
</span></span><span class="line"><span class="cl">                                   &#39;min_length&#39;:&#39;用户名最小3位&#39;
</span></span><span class="line"><span class="cl">                               },
</span></span><span class="line"><span class="cl">                               widget=forms.widgets.PasswordInput(attrs={&#39;class&#39;:&#39;form-control c1 c2&#39;})
</span></span><span class="line"><span class="cl">                               )
</span></span><span class="line"><span class="cl">2、针对不同类型的input如何修改
</span></span><span class="line"><span class="cl">	text
</span></span><span class="line"><span class="cl">	password
</span></span><span class="line"><span class="cl">	date
</span></span><span class="line"><span class="cl">	radio
</span></span><span class="line"><span class="cl">	checkbox
</span></span><span class="line"><span class="cl">	phone
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    phone = forms.CharField(
</span></span><span class="line"><span class="cl">            validators=[RegexValidator(r&#39;^[0-9]+$&#39;, &#39;请输入数字&#39;),
</span></span><span class="line"><span class="cl">                        RegexValidator(r&#39;^159[0-9]+$&#39;, &#39;数字必须以159开头&#39;)],
</span></span><span class="line"><span class="cl">        )
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">剩下其他参数直接看博客即可
</span></span><span class="line"><span class="cl">https://www.cnblogs.com/Dominic-Ji/p/9240365.html
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="38-其他类型渲染">3.8 其他类型渲染</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">radioSelect
</span></span><span class="line"><span class="cl">单radio值为字符串
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class LoginForm(forms.Form):
</span></span><span class="line"><span class="cl">    username = forms.CharField(
</span></span><span class="line"><span class="cl">        min_length=8,
</span></span><span class="line"><span class="cl">        label=&#34;用户名&#34;,
</span></span><span class="line"><span class="cl">        initial=&#34;张三&#34;,
</span></span><span class="line"><span class="cl">        error_messages={
</span></span><span class="line"><span class="cl">            &#34;required&#34;: &#34;不能为空&#34;,
</span></span><span class="line"><span class="cl">            &#34;invalid&#34;: &#34;格式错误&#34;,
</span></span><span class="line"><span class="cl">            &#34;min_length&#34;: &#34;用户名最短8位&#34;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">    pwd = forms.CharField(min_length=6, label=&#34;密码&#34;)
</span></span><span class="line"><span class="cl">    gender = forms.fields.ChoiceField(
</span></span><span class="line"><span class="cl">        choices=((1, &#34;男&#34;), (2, &#34;女&#34;), (3, &#34;保密&#34;)),
</span></span><span class="line"><span class="cl">        label=&#34;性别&#34;,
</span></span><span class="line"><span class="cl">        initial=3,
</span></span><span class="line"><span class="cl">        widget=forms.widgets.RadioSelect()
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">单选Select
</span></span><span class="line"><span class="cl">class LoginForm(forms.Form):
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    hobby = forms.ChoiceField(
</span></span><span class="line"><span class="cl">        choices=((1, &#34;篮球&#34;), (2, &#34;足球&#34;), (3, &#34;双色球&#34;), ),
</span></span><span class="line"><span class="cl">        label=&#34;爱好&#34;,
</span></span><span class="line"><span class="cl">        initial=3,
</span></span><span class="line"><span class="cl">        widget=forms.widgets.Select()
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">多选Select
</span></span><span class="line"><span class="cl">class LoginForm(forms.Form):
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    hobby = forms.MultipleChoiceField(
</span></span><span class="line"><span class="cl">        choices=((1, &#34;篮球&#34;), (2, &#34;足球&#34;), (3, &#34;双色球&#34;), ),
</span></span><span class="line"><span class="cl">        label=&#34;爱好&#34;,
</span></span><span class="line"><span class="cl">        initial=[1, 3],
</span></span><span class="line"><span class="cl">        widget=forms.widgets.SelectMultiple()
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">单选checkbox
</span></span><span class="line"><span class="cl">class LoginForm(forms.Form):
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    keep = forms.ChoiceField(
</span></span><span class="line"><span class="cl">        label=&#34;是否记住密码&#34;,
</span></span><span class="line"><span class="cl">        initial=&#34;checked&#34;,
</span></span><span class="line"><span class="cl">        widget=forms.widgets.CheckboxInput()
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">多选checkbox
</span></span><span class="line"><span class="cl">class LoginForm(forms.Form):
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    hobby = forms.MultipleChoiceField(
</span></span><span class="line"><span class="cl">        choices=((1, &#34;篮球&#34;), (2, &#34;足球&#34;), (3, &#34;双色球&#34;),),
</span></span><span class="line"><span class="cl">        label=&#34;爱好&#34;,
</span></span><span class="line"><span class="cl">        initial=[1, 3],
</span></span><span class="line"><span class="cl">        widget=forms.widgets.CheckboxSelectMultiple()
</span></span><span class="line"><span class="cl">    )
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="39-form组件源码">3.9 form组件源码</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">切入点：
</span></span><span class="line"><span class="cl">	form_obj.is_valid()
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def is_valid(self):
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;Return True if the form has no errors, or False otherwise.&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        return self.is_bound and not self.errors
</span></span><span class="line"><span class="cl">        # 如果is_valid要返回True的话，那么self.is_bound要为True self.errors为Flase
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">self.is_bound = data is not None or files is not None # 只要传值了肯定为True
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">@property
</span></span><span class="line"><span class="cl">    def errors(self):
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;Return an ErrorDict for the data provided for the form.&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        if self._errors is None:
</span></span><span class="line"><span class="cl">            self.full_clean()
</span></span><span class="line"><span class="cl">        return self._errors
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def full_clean(self):	# form组件都来源于该方法
</span></span><span class="line"><span class="cl">        self._clean_fields()	# 校验字段 + 局部钩子
</span></span><span class="line"><span class="cl">        self._clean_form()		# 全局钩子
</span></span><span class="line"><span class="cl">        self._post_clean()
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4cookie与session原理">4、Cookie与session原理</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">发展史
</span></span><span class="line"><span class="cl">	1、网站都没有保存用户功能的需求，所有用户访问返回的结果都死一样的
</span></span><span class="line"><span class="cl">		eg:新闻、博客、文章...
</span></span><span class="line"><span class="cl">	2、出现了一些需要保护用户信息的网站
</span></span><span class="line"><span class="cl">		eg:淘宝、支付宝、京东..
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	以登录功能为例：如果不保存用户登录状态，也就意味着用户每次访问网站都需要重复的输入用户名和密码
</span></span><span class="line"><span class="cl">	当用户第一次登录成功之后，将用户的用户名和密码返回给用户浏览器，让用户浏览器保存在本地，之后访问的时候浏览器自动将保存在浏览器上的用户名和密码都发送给服务端，服务端获取之后自动验证
</span></span><span class="line"><span class="cl">	早期这种方式具有非常大的安全隐患
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	优化:
</span></span><span class="line"><span class="cl">		当用户登录成功之后，服务端产生一个随机字符串(在服务端保存数据，用kv键值对的形式)，交由客户端浏览器保存
</span></span><span class="line"><span class="cl">		随机字符串1:用户1相关信息
</span></span><span class="line"><span class="cl">		随机字符串2:用户2相关信息
</span></span><span class="line"><span class="cl">		随机字符串2:用户2相关信息
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		之后访问服务端的时候，都带着随机字符串，服务端取数据库中比对是否有对应的随机字符串，从而获取到对应的用户信息
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">但是如果截获到了该随机字符串，那么你就可以冒充当前用户，其实还有有安全隐患的
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cookie
</span></span><span class="line"><span class="cl">	服务端保存在客户端浏览器上的信息都称之为cookie
</span></span><span class="line"><span class="cl">	它的表现形式一般都是k:v键值对(可以有多个)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">session
</span></span><span class="line"><span class="cl">	数据保存在服务端的并且它的表现形式一般也是k:v键值对(可以有多个)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">token
</span></span><span class="line"><span class="cl">	seesion虽然数据是保存在服务端的，但是禁不止数据量大
</span></span><span class="line"><span class="cl">	服务端不再保存数据
</span></span><span class="line"><span class="cl">		登录成功之后，将一段信息进行加密处理(加密算法公司开发知道)
</span></span><span class="line"><span class="cl">		将加密之后的结果凭借在信息后面，整体返回给浏览器保存
</span></span><span class="line"><span class="cl">		浏览器下次访问的时候带着该信息 服务端自动切去前面一段信息再次使用自己的加密算法更浏览器尾部的密文进行对比
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">总结：
</span></span><span class="line"><span class="cl">	1、cookie就是保存在客户端浏览器上的信息
</span></span><span class="line"><span class="cl">	2、session就是保存在服务端上的信息
</span></span><span class="line"><span class="cl">	3、session是基于cookie工作的
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="41-cookie操作">4.1 Cookie操作</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 虽然cookie是服务端告诉客户端浏览器要保存内容
</span></span><span class="line"><span class="cl"># 但是客户端浏览器可以选择拒绝保存，如果禁止了，那么只要是需要记录用户状态的网站的登录功能都无法使用
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 视图函数的返回值
</span></span><span class="line"><span class="cl">return HttpResponse()
</span></span><span class="line"><span class="cl">return render()
</span></span><span class="line"><span class="cl">return redirect()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">obj1 = HttpResponse()
</span></span><span class="line"><span class="cl"># 操作cookie
</span></span><span class="line"><span class="cl">return obj1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">obj2 = render()
</span></span><span class="line"><span class="cl"># 操作cookie
</span></span><span class="line"><span class="cl">return obj2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">obj3 = redirect()
</span></span><span class="line"><span class="cl"># 操作cookie
</span></span><span class="line"><span class="cl">return obj3
</span></span><span class="line"><span class="cl"># 如果想要操作cookie，你就不得不利用obj对象
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">设置cookie
</span></span><span class="line"><span class="cl">	obj.set_cookie(key,value)
</span></span><span class="line"><span class="cl">获取cookie
</span></span><span class="line"><span class="cl">	reqiest.COOKIES.get(key)
</span></span><span class="line"><span class="cl">在设置cookie的时候可以添加一个超时时间
</span></span><span class="line"><span class="cl"> obj.set_cookie(&#39;username&#39;, &#39;hw666&#39;, max_age=3,expires=3)
</span></span><span class="line"><span class="cl"> expires适用于ie浏览器
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 检验用户是否登录的装饰器
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">用户如果在没有登录的情况下想访问一个需要登录的页面
</span></span><span class="line"><span class="cl">那么先跳转到登录页面 当用户输入正确的用户名和密码之后
</span></span><span class="line"><span class="cl">应该跳转到用户之前想要访问的页面
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">def login_auth(func):
</span></span><span class="line"><span class="cl">    def inner(request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        # print(request.path_info)
</span></span><span class="line"><span class="cl">        # print(request.get_full_path())  # 获取到用户上一次像访问的url
</span></span><span class="line"><span class="cl">        target_url = request.get_full_path()
</span></span><span class="line"><span class="cl">        if request.COOKIES.get(&#39;username&#39;):
</span></span><span class="line"><span class="cl">            return func(request, *args, **kwargs)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            return redirect(&#39;/index/?next=%s&#39;%target_url)
</span></span><span class="line"><span class="cl">    return inner
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 登录页面
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        username = request.POST.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        password = request.POST.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        if username == &#39;jason&#39; and password == &#39;123&#39;:
</span></span><span class="line"><span class="cl">            # 获取用户上一次想要访问的url
</span></span><span class="line"><span class="cl">            target_url = request.GET.get(&#39;next&#39;)
</span></span><span class="line"><span class="cl">            if target_url:
</span></span><span class="line"><span class="cl">                obj = redirect(target_url)
</span></span><span class="line"><span class="cl">            else:
</span></span><span class="line"><span class="cl">                # 保存用户登录状态
</span></span><span class="line"><span class="cl">                obj = redirect(&#39;/home&#39;)
</span></span><span class="line"><span class="cl">                # 让浏览器记录cookie数据
</span></span><span class="line"><span class="cl">            obj.set_cookie(&#39;username&#39;, &#39;hw666&#39;, max_age=3,expires=3)
</span></span><span class="line"><span class="cl">            &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">            浏览器不单单会帮你存
</span></span><span class="line"><span class="cl">            而且后面每次访问你的时候还会带着它过来
</span></span><span class="line"><span class="cl">            &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">            # 跳转到一个需要用户登录之后才能看到的页面
</span></span><span class="line"><span class="cl">            return obj
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@login_auth
</span></span><span class="line"><span class="cl">def home(request):
</span></span><span class="line"><span class="cl">    # 获取cookie信息，判断你有没有
</span></span><span class="line"><span class="cl">    if request.COOKIES.get(&#39;username&#39;) == &#39;hw666&#39;:
</span></span><span class="line"><span class="cl">        return HttpResponse(&#34;我是home页面，只有登录的用户才能进来&#34;)
</span></span><span class="line"><span class="cl">    # 没有登录应该跳转登录页面
</span></span><span class="line"><span class="cl">    return redirect(&#39;/index/&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@login_auth
</span></span><span class="line"><span class="cl">def video(request):
</span></span><span class="line"><span class="cl">    # 获取cookie信息，判断你有没有
</span></span><span class="line"><span class="cl">    if request.COOKIES.get(&#39;username&#39;) == &#39;hw666&#39;:
</span></span><span class="line"><span class="cl">        return HttpResponse(&#34;我是video页面，只有登录的用户才能进来&#34;)
</span></span><span class="line"><span class="cl">    # 没有登录应该跳转登录页面
</span></span><span class="line"><span class="cl">    return redirect(&#39;/index/&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#注销功能
</span></span><span class="line"><span class="cl">@login_auth
</span></span><span class="line"><span class="cl">def logout(request):
</span></span><span class="line"><span class="cl">    obj = redirect(&#39;/index/&#39;)
</span></span><span class="line"><span class="cl">    obj.delete_cookie(&#39;username&#39;)
</span></span><span class="line"><span class="cl">    return obj
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="42-session操作">4.2 session操作</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">session数据是保存在服务端的，给客户端返回的是一个随机字符串
</span></span><span class="line"><span class="cl">	sessionid:随机字符串
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">1、在默认情况下操作session的时候需要django默认的一张django_session表
</span></span><span class="line"><span class="cl">	数据库迁移命令
</span></span><span class="line"><span class="cl">		django会自己创建很多表 django_session就是其中的一张
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">2、django默认session过期时间是14天
</span></span><span class="line"><span class="cl">	但你也可以人为的修改它
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3、设置session
</span></span><span class="line"><span class="cl">request.session[&#39;key&#39;] = value
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4、获取session
</span></span><span class="line"><span class="cl">request.session.get(&#39;key&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5、设置过期时间
</span></span><span class="line"><span class="cl">request.session.set_expiry()
</span></span><span class="line"><span class="cl">    括号内可以放四种类型的参数
</span></span><span class="line"><span class="cl">    1、整数		多少秒
</span></span><span class="line"><span class="cl">    2、日期对象		到指定日期就失效
</span></span><span class="line"><span class="cl">    3、0			一旦当前浏览器窗口关闭立刻失效
</span></span><span class="line"><span class="cl">    4、不写		失效时间取决于django内部的默认失效使劲按
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6、清除session
</span></span><span class="line"><span class="cl">	request.session.delete()	# 只删除服务端的，客户端的不删
</span></span><span class="line"><span class="cl">	request.session.flush()		# 浏览器和服务端都清空
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">7、session是保存在服务端的，但是session的保存位置可以有多种选择
</span></span><span class="line"><span class="cl">	1、mysql
</span></span><span class="line"><span class="cl">	2、文件
</span></span><span class="line"><span class="cl">	3、redis
</span></span><span class="line"><span class="cl">	4、memcache
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">	具体参考博客https://www.cnblogs.com/Dominic-Ji/p/10718365.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">8、django_session表中的数据条数是取决于浏览器的
</span></span><span class="line"><span class="cl">	同一个计算机上同一个浏览器只会有一条数据生效
</span></span><span class="line"><span class="cl">	(当session过期的时候可能会出现多条数据对应一个浏览器，但是该情况不会持续很久，内部会自动识别清理)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def set_session(request):
</span></span><span class="line"><span class="cl">    request.session[&#39;hobby&#39;] = &#39;girl&#39;
</span></span><span class="line"><span class="cl">    # request.session[&#39;hobby1&#39;] = &#39;girl1&#39;
</span></span><span class="line"><span class="cl">    # request.session[&#39;hobby2&#39;] = &#39;girl2&#39;
</span></span><span class="line"><span class="cl">    request.session.set_expiry(3)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    内部发生了那些事
</span></span><span class="line"><span class="cl">        1、django内部会自动帮你生成一个随机字符串
</span></span><span class="line"><span class="cl">        2、django内部自动将随机字符串和对应的数据存储到django_session表中
</span></span><span class="line"><span class="cl">            2.1、现在内存中产生操作数据的缓存
</span></span><span class="line"><span class="cl">            2.2、在响应经过django中间件的时候才真正的操作数据
</span></span><span class="line"><span class="cl">        3、将产生的随机字符串返回给客户端浏览器保存
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    return HttpResponse(&#39;嘿嘿嘿&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def get_session(request):
</span></span><span class="line"><span class="cl">    if request.session.get(&#39;hobby&#39;):
</span></span><span class="line"><span class="cl">        print(request.session)
</span></span><span class="line"><span class="cl">        print(request.session.get(&#39;hobby&#39;))
</span></span><span class="line"><span class="cl">        # print(request.session.get(&#39;hobby1&#39;))
</span></span><span class="line"><span class="cl">        # print(request.session.get(&#39;hobby2&#39;))
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        return HttpResponse(&#39;大爷，关门了明天再来吧&#39;)
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    内部发生了那些事
</span></span><span class="line"><span class="cl">        1、自从浏览器请求中获取sessionid对应的随机字符串
</span></span><span class="line"><span class="cl">        2、拿着该随机字符串去django_session表中查找对应的数据
</span></span><span class="line"><span class="cl">        3、如果比对上了，则将对应的数据取出并封装到request.session中
</span></span><span class="line"><span class="cl">            如果比对不上，则request.session.get()返回的是None
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    return HttpResponse(&#34;哈哈哈&#34;)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 利用session实现登录认证
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="43-视图函数cbv如何添加装饰器">4.3 视图函数(CBV)如何添加装饰器</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">在CBV中django不建议你直接给类的方法加装饰器
</span></span><span class="line"><span class="cl">无论该装饰器能正常工作都不建议直接加
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.views import View
</span></span><span class="line"><span class="cl">from django.utils.decorators import method_decorator
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># @method_decorator(login_auth,name=&#39;get&#39;)    # 方式2(可以添加多个，针对不同的方法添加不同的装饰器)
</span></span><span class="line"><span class="cl"># @method_decorator(login_auth,name=&#39;post&#39;)
</span></span><span class="line"><span class="cl">class Mylogin(View):
</span></span><span class="line"><span class="cl">    @method_decorator(login_auth)   # 方式3:他会直接作用与当前类里面的所有方法
</span></span><span class="line"><span class="cl">    def dispatch(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        pass
</span></span><span class="line"><span class="cl">    # @method_decorator(login_auth)   # 方式1
</span></span><span class="line"><span class="cl">    def get(self,request):
</span></span><span class="line"><span class="cl">        return HttpResponse(&#34;get请求&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def post(self,request):
</span></span><span class="line"><span class="cl">        return HttpResponse(&#39;post请求&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5django中间件">5、django中间件</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">django中间件是django的门户
</span></span><span class="line"><span class="cl">1、请求来的时候需要先经过中间件才能达到真正的django后端
</span></span><span class="line"><span class="cl">2、响应走的时候最后也需要经过中间件才能发送出去
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">django中间件能够做的事情
</span></span><span class="line"><span class="cl">	只要涉及到项目全局的功能，就要用到中间件
</span></span><span class="line"><span class="cl">	1、全局身份校验
</span></span><span class="line"><span class="cl">	2、全局访问频率校验
</span></span><span class="line"><span class="cl">	3、全局权限校验
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">django自带的七个中间件
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">django除了自带七个之外，还支持用户自定义中间件，并且暴露给用户五个可以自定义的方法
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">django请求生命周期流程图
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">研究django中间件代码规律
</span></span><span class="line"><span class="cl">MIDDLEWARE = [
</span></span><span class="line"><span class="cl">    &#39;django.middleware.security.SecurityMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.common.CommonMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class SessionMiddleware(MiddlewareMixin):
</span></span><span class="line"><span class="cl">    def process_request(self, request):
</span></span><span class="line"><span class="cl">        session_key = request.COOKIES.get(settings.SESSION_COOKIE_NAME)
</span></span><span class="line"><span class="cl">        request.session = self.SessionStore(session_key)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    def process_response(self, request, response):
</span></span><span class="line"><span class="cl">        return response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class CsrfViewMiddleware(MiddlewareMixin):
</span></span><span class="line"><span class="cl">    def process_request(self, request):
</span></span><span class="line"><span class="cl">        try:
</span></span><span class="line"><span class="cl">            csrf_token = self._get_token(request)
</span></span><span class="line"><span class="cl">        except InvalidTokenFormat:
</span></span><span class="line"><span class="cl">            _add_new_csrf_cookie(request)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            if csrf_token is not None:
</span></span><span class="line"><span class="cl">                # Use same token next time.
</span></span><span class="line"><span class="cl">                request.META[&#39;CSRF_COOKIE&#39;] = csrf_token
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">    def process_view(self, request, callback, callback_args, callback_kwargs):
</span></span><span class="line"><span class="cl">        return self._accept(request)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def process_response(self, request, response):
</span></span><span class="line"><span class="cl">        return response
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">class AuthenticationMiddleware(MiddlewareMixin):
</span></span><span class="line"><span class="cl">    def process_request(self, request):
</span></span><span class="line"><span class="cl">        request.user = SimpleLazyObject(lambda: get_user(request))
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">django支持程序员自定义中间件，并且暴露给程序员五个可以自定义的方法
</span></span><span class="line"><span class="cl">	1、必须掌握
</span></span><span class="line"><span class="cl">		process_request
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		process_response
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	2、了解即可
</span></span><span class="line"><span class="cl">		process_view
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		process_template_response
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		process_exeption
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="51-如何自定义中间件">5.1 如何自定义中间件</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1、在项目名或者应用下创建一个任意名称的文件夹
</span></span><span class="line"><span class="cl">2、在该文件夹内创建一个任意名称的py文件
</span></span><span class="line"><span class="cl">3、在该py文件内书写类(这个类必须继承MiddlewareMixin)
</span></span><span class="line"><span class="cl">	然后在这个类里面就可以定义五个方法了
</span></span><span class="line"><span class="cl">	(这五个方法并不是全部都要书写，用几个写几个)
</span></span><span class="line"><span class="cl">4、需要将类的路径以字符串的形式注册到配置文件中才能生效
</span></span><span class="line"><span class="cl">MIDDLEWARE = [
</span></span><span class="line"><span class="cl">    &#39;django.middleware.security.SecurityMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.common.CommonMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;自己写的中间件路径&#39;,
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">9 10 14 22 42‘’2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">	1、必须掌握
</span></span><span class="line"><span class="cl">		process_request 	请求来的时候经过该方法
</span></span><span class="line"><span class="cl">			1、请求来的时候需要进过每一个中间件里面的process_request方法
</span></span><span class="line"><span class="cl">				执行的顺序是按照配置文件中的中间件从上往下依次执行
</span></span><span class="line"><span class="cl">				
</span></span><span class="line"><span class="cl">			2、如果中间件里面没有定义方法，那么直接跳过执行下一个中间件
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			3、如果该方法返回了HttpResponse对象，那么请求将不在继续往后执行，
</span></span><span class="line"><span class="cl">				而是直接原路返回(检验失败不允许访问...)
</span></span><span class="line"><span class="cl">			4、proces_request方法就是用来做全局相关的所有限制功能
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		process_response	返回请求的时候经过该方法
</span></span><span class="line"><span class="cl">			1、响应走的时候需要进过每一个中间件里面process_response方法
</span></span><span class="line"><span class="cl">			该方法有两个额外的参数request，response
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			2、该方法必须返回一个HttpResponse对象
</span></span><span class="line"><span class="cl">				1.默认返回的就是形参response
</span></span><span class="line"><span class="cl">				2.你也可以返回自己定义的
</span></span><span class="line"><span class="cl">				
</span></span><span class="line"><span class="cl">			3、顺序是按照配置文件中注册了的中间件从下往上依次进过
</span></span><span class="line"><span class="cl">				如果没有定义的话直接跳过执行下一个
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		研究如果在第一个process_request方法就已经返回了HttpResponse对象，那么响应走的时候是经过所有的中间件里面的process_response还是有其他情况？？？
</span></span><span class="line"><span class="cl">		是其他情况
</span></span><span class="line"><span class="cl">			会直接走同级别的process_response原路返回
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		flask框架也有一个中间件，但是它的规律
</span></span><span class="line"><span class="cl">			只要返回了数据就必须经过所有中间件里面的process_response方法
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	2、了解即可
</span></span><span class="line"><span class="cl">		process_view
</span></span><span class="line"><span class="cl">			路由匹配成功之后执行视图函数之前，会自动执行中间件里面的该方法
</span></span><span class="line"><span class="cl">			顺序是按照配置文件中注册的中间件从上往下的顺序依次执行
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		process_template_response
</span></span><span class="line"><span class="cl">			返回的HttpResponse对象render书写的时候才会触发
</span></span><span class="line"><span class="cl">			顺序是按照配置文件中注册了中间件从下往上依次经过
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		process_exeption
</span></span><span class="line"><span class="cl">			当视图函数中出现异常的情况下触发
</span></span><span class="line"><span class="cl">			顺序是按照配置文件中注册了中间件从下往上依次经过
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyMiddleware1(MiddlewareMixin):
</span></span><span class="line"><span class="cl">    def process_request(self, request):
</span></span><span class="line"><span class="cl">        print(&#39;我是第一个自定义中间件里面的process_request方法&#39;)
</span></span><span class="line"><span class="cl">        return HttpResponse(&#39;自定义返回&#39;)
</span></span><span class="line"><span class="cl">    def process_response(self,request,response):
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        :param request:
</span></span><span class="line"><span class="cl">        :param response: 就是django后端返回给浏览器的内容
</span></span><span class="line"><span class="cl">        :return:
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        print(&#39;我是第一个自定义中间件里面的process_response方法&#39;)
</span></span><span class="line"><span class="cl">        return response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyMiddleware2(MiddlewareMixin):
</span></span><span class="line"><span class="cl">    def process_request(self, request):
</span></span><span class="line"><span class="cl">        print(&#39;我是第二个自定义中间件里面的process_request方法&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def process_response(self, request, response):
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        :param request:
</span></span><span class="line"><span class="cl">        :param response:
</span></span><span class="line"><span class="cl">        :return:
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        print(&#39;我是第二个自定义中间件里面的process_response方法&#39;)
</span></span><span class="line"><span class="cl">        return response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">我是第一个自定义中间件里面的process_request方法
</span></span><span class="line"><span class="cl">我是第二个自定义中间件里面的process_request方法
</span></span><span class="line"><span class="cl">我是视图函数index
</span></span><span class="line"><span class="cl">我是第二个自定义中间件里面的process_response方法
</span></span><span class="line"><span class="cl">我是第一个自定义中间件里面的process_response方法
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="52-csrf跨站请求伪造">5.2 csrf跨站请求伪造</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">钓鱼网站
</span></span><span class="line"><span class="cl">	我搭建一个更正规网站一摸一样的界面(银行)
</span></span><span class="line"><span class="cl">	用户不小心进入到了我们的网站，用户给某个人打钱
</span></span><span class="line"><span class="cl">	打钱的操作实实是提交给了银行的系统，用户的前页确确实实减少了
</span></span><span class="line"><span class="cl">	但是唯一不同的是打钱的账户不是用户想要打的账户，而是一个莫名奇妙的账户
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">内部本质
</span></span><span class="line"><span class="cl">	在钓鱼网站页面针对对方的账户，只给用户提供一个没有name属性的普通input框
</span></span><span class="line"><span class="cl">	然后我们在内部隐藏一个已经写好name和value的input框
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">如何规避上述问题
</span></span><span class="line"><span class="cl">	csrf跨站请求伪造校验
</span></span><span class="line"><span class="cl">		网站在给用户返回一个具有提交数据功能页面的时候会给这个页面加一个唯一表示
</span></span><span class="line"><span class="cl">		当这个页面朝后端发送post请求的时候，我的后端会先校验唯一标识，如果唯一标识不对则直接拒绝(403 forbbiden)如果成功则正常执行
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="53-如何符合校验">5.3 如何符合校验</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># form表单如何符合校验
</span></span><span class="line"><span class="cl">&lt;form action=&#34;&#34; method=&#34;post&#34; &gt;
</span></span><span class="line"><span class="cl">    {% csrf_token %}
</span></span><span class="line"><span class="cl">    &lt;p&gt;username:&lt;input type=&#34;text&#34; name=&#34;username&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">    &lt;p&gt;target_user:&lt;input type=&#34;password&#34; name=&#34;target_user&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">    &lt;p&gt;money&lt;input type=&#34;text&#34; name=&#34;money&#34;&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">    &lt;input type=&#34;submit&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;/form&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># ajax如何符合校验
</span></span><span class="line"><span class="cl">&lt;button id=&#34;d1&#34;&gt;ajax请求&lt;/button&gt;
</span></span><span class="line"><span class="cl">{#第三种方式#}
</span></span><span class="line"><span class="cl">&lt;script src=&#34;{% static &#39;js/mysetup.js&#39; %}&#34;&gt;&lt;/script&gt;
</span></span><span class="line"><span class="cl">&lt;script&gt;
</span></span><span class="line"><span class="cl">    $(&#39;#d1&#39;).click(function (){
</span></span><span class="line"><span class="cl">        $.ajax({
</span></span><span class="line"><span class="cl">            url:&#39;&#39;,
</span></span><span class="line"><span class="cl">            type:&#39;post&#39;,
</span></span><span class="line"><span class="cl">            // 第一种 利用标签查找获取页面上的随机字符串
</span></span><span class="line"><span class="cl">            {#data:{&#34;username&#34;:&#34;kehongwei&#34;,&#39;csrfmiddlewaretoke&#39;:$(&#39;[name=csrfmiddlewaretoke]&#39;).val()},#}
</span></span><span class="line"><span class="cl">            // 第二种 利用模板语法提供的快捷书写
</span></span><span class="line"><span class="cl">            {#data:{&#34;username&#34;:&#34;kehongwei&#34;,&#39;csrfmiddlewaretoken&#39;:&#39;{{ csrf_token }}&#39;},#}
</span></span><span class="line"><span class="cl">            // 第三种方法 通用方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            success:function (){
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        })
</span></span><span class="line"><span class="cl">    })
</span></span><span class="line"><span class="cl">&lt;/script&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>第三种方式源代码</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 拷贝到static里面的js文件夹里的任意js文件
</span></span><span class="line"><span class="cl">function getCookie(name) {
</span></span><span class="line"><span class="cl">    var cookieValue = null;
</span></span><span class="line"><span class="cl">    if (document.cookie &amp;&amp; document.cookie !== &#39;&#39;) {
</span></span><span class="line"><span class="cl">        var cookies = document.cookie.split(&#39;;&#39;);
</span></span><span class="line"><span class="cl">        for (var i = 0; i &lt; cookies.length; i++) {
</span></span><span class="line"><span class="cl">            var cookie = jQuery.trim(cookies[i]);
</span></span><span class="line"><span class="cl">            // Does this cookie string begin with the name we want?
</span></span><span class="line"><span class="cl">            if (cookie.substring(0, name.length + 1) === (name + &#39;=&#39;)) {
</span></span><span class="line"><span class="cl">                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
</span></span><span class="line"><span class="cl">                break;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    return cookieValue;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">var csrftoken = getCookie(&#39;csrftoken&#39;);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">function csrfSafeMethod(method) {
</span></span><span class="line"><span class="cl">  // these HTTP methods do not require CSRF protection
</span></span><span class="line"><span class="cl">  return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$.ajaxSetup({
</span></span><span class="line"><span class="cl">  beforeSend: function (xhr, settings) {
</span></span><span class="line"><span class="cl">    if (!csrfSafeMethod(settings.type) &amp;&amp; !this.crossDomain) {
</span></span><span class="line"><span class="cl">      xhr.setRequestHeader(&#34;X-CSRFToken&#34;, csrftoken);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">});
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="54-csrf相关装饰器">5.4 csrf相关装饰器</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1、网站整体都不校验csrf，就单单几个视图函数都要校验
</span></span><span class="line"><span class="cl">2、网站整体都校验csrf，就单单几个视图函数不校验
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">=================================================
</span></span><span class="line"><span class="cl">from django.views.decorators.csrf import csrf_protect,csrf_exempt
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">csrf_protect    需要校验
</span></span><span class="line"><span class="cl">csrf_exempt     忽视校验
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">@csrf_exempt    # 不校验
</span></span><span class="line"><span class="cl"># @csrf_protect # 校验
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    if request.method == &#34;POST&#34;:
</span></span><span class="line"><span class="cl">        username = request.POST.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        target_user = request.POST.get(&#39;target_user&#39;)
</span></span><span class="line"><span class="cl">        money = request.POST.get(&#39;money&#39;)
</span></span><span class="line"><span class="cl">        print(&#39;%s给%s转了%s元&#39; % (username, target_user, money))
</span></span><span class="line"><span class="cl">    return render(request, &#39;index.html&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">============================================
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.utils.decorators import method_decorator
</span></span><span class="line"><span class="cl">from django.views import View
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">csrf_protect 需要校验
</span></span><span class="line"><span class="cl">    针对csrf_protect符合我们之前所学的装饰器的三种玩法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">csrf_exempt 忽视校验
</span></span><span class="line"><span class="cl">    针对csrf_exempt只能给dispatch方法加才有效
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># @method_decorator(csrf_protect,name=&#39;post&#39;)     # 针对csrf_protect 第二种方式可以
</span></span><span class="line"><span class="cl"># @method_decorator(csrf_exempt,name=&#39;post&#39;)  # 针对csrf_exempt 第三种方式不行
</span></span><span class="line"><span class="cl"># @method_decorator(csrf_exempt,name=&#39;dispatch&#39;)  # 针对csrf_exempt 等价于第二种方式
</span></span><span class="line"><span class="cl">class MyCsrfToken(View):
</span></span><span class="line"><span class="cl">    # @method_decorator(csrf_protect)  # 针对csrf_protect 第三种方式可以
</span></span><span class="line"><span class="cl">    # @method_decorator(csrf_exempt)  # 针对csrf_exempt 第三种方式行
</span></span><span class="line"><span class="cl">    def dispatch(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        super(MyCsrfToken,self).dispatch(request,*args,**kwargs)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def get(self, request):
</span></span><span class="line"><span class="cl">        return HttpResponse(&#39;get&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # @method_decorator(csrf_protect) # 针对csrf_protect 第一种方式可以
</span></span><span class="line"><span class="cl">    @method_decorator(csrf_exempt)  # 针对csrf_exempt 第一种方式不行
</span></span><span class="line"><span class="cl">    def post(self, request):
</span></span><span class="line"><span class="cl">        return HttpResponse(&#39;post&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6补充知识点importlib">6、补充知识点importlib</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">import  importlib
</span></span><span class="line"><span class="cl">res = &#39;myfile.b&#39;
</span></span><span class="line"><span class="cl">func = importlib.import_module(res) # from myfile import b
</span></span><span class="line"><span class="cl"># 该方法最小只能到py文件名
</span></span><span class="line"><span class="cl">print(func)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 功能的插拔式设计
</span></span><span class="line"><span class="cl">	1、配置文件注册功能
</span></span><span class="line"><span class="cl">	2、importlib模块
</span></span><span class="line"><span class="cl">	3、字符串切割split
</span></span><span class="line"><span class="cl">	4、反射
</span></span><span class="line"><span class="cl">	5、面向对象及鸭子类型
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="61-重要思想">6.1 重要思想</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># notify文件夹中__init__文件：
</span></span><span class="line"><span class="cl">import settings
</span></span><span class="line"><span class="cl">import importlib
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from app01.notify import email
</span></span><span class="line"><span class="cl">def send_all(content):
</span></span><span class="line"><span class="cl">    for path_str in settings.NOTIFY_LIST:   # &#39;notify.email.Email&#39;
</span></span><span class="line"><span class="cl">        module_path,class_name = path_str.rsplit(&#39;.&#39;, maxsplit=1)
</span></span><span class="line"><span class="cl">        # module_path = &#39;notify.email&#39;  class_name = &#39;Email&#39;
</span></span><span class="line"><span class="cl">        # 1、利用字符串导入模块
</span></span><span class="line"><span class="cl">        module = importlib.import_module(module_path)   # from notify import email
</span></span><span class="line"><span class="cl">        # 2、利用反射获取类名
</span></span><span class="line"><span class="cl">        cls = getattr(module,class_name) # Email，QQ，Wechat
</span></span><span class="line"><span class="cl">        # 3、生成类的对象
</span></span><span class="line"><span class="cl">        obj = cls()
</span></span><span class="line"><span class="cl">        # 4、利用鸭子类型直接调用send方法
</span></span><span class="line"><span class="cl">        obj.send(content)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"># notify文件夹中QQ.py文件：
</span></span><span class="line"><span class="cl">class QQ(object):
</span></span><span class="line"><span class="cl">    def __init__(self):
</span></span><span class="line"><span class="cl">        pass    # 发送微QQ需要做的前期准备工作
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def send(self, content):
</span></span><span class="line"><span class="cl">        print(&#39;QQ通知%s&#39;%content)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"># settings文件
</span></span><span class="line"><span class="cl">NOTIFY_LIST = [
</span></span><span class="line"><span class="cl">    &#39;app01.notify.email.Email&#39;,
</span></span><span class="line"><span class="cl">    &#39;app01.notify.qq.QQ&#39;,
</span></span><span class="line"><span class="cl">    &#39;app01.notify.wechat.Wechat&#39;,
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># start文件
</span></span><span class="line"><span class="cl">from app01 import  notify
</span></span><span class="line"><span class="cl">notify.send_all(&#39;bug解决&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7auth模块">7、Auth模块</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">其实我们在创建好一个django项目之后直接执行数据库迁移命令会自动生成很多表
</span></span><span class="line"><span class="cl">	django_session
</span></span><span class="line"><span class="cl">	auth_user
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">django在启动之后就可以访问admin路由，需要输入用户名和密码，数据参考的就是auth_user表，并且还必须是管理员用户才能进入
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">创建超级用户(管理员)
</span></span><span class="line"><span class="cl">	python3 manage.py createsuperuser
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">依赖于auth_user表完成用户相关的所有功能
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="71-方法总结">7.1 方法总结</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、 比对用户名和密码是否正确
</span></span><span class="line"><span class="cl">user_obj = auth.authenticate(request, username=username, password=password)
</span></span><span class="line"><span class="cl">print(user_obj)  # 用户对象  jason
</span></span><span class="line"><span class="cl">print(user_obj.username)     # jason
</span></span><span class="line"><span class="cl">print(user_obj.password)     # 密文密码
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、保存用户状态
</span></span><span class="line"><span class="cl">auth.login(request, user_obj)   # 相当于request.session[key] = user_obj
</span></span><span class="line"><span class="cl"># 只要执行了该方法，你就可以再任何地方通过request.user获取到当前用户登录的对象
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、判断当前用户是否登录
</span></span><span class="line"><span class="cl">print(request.user.is_authenticated)  # 返回布尔值
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 4、获取当前登录用户
</span></span><span class="line"><span class="cl">request.user
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 5、校验用户是否登录装饰器
</span></span><span class="line"><span class="cl">from django.contrib.auth.decorators import login_required
</span></span><span class="line"><span class="cl"># 局部配置
</span></span><span class="line"><span class="cl">@login_required(login_url=&#39;/login/&#39;)    # 局部配置:用户没有登录跳转到loginuser后面指定的网址
</span></span><span class="line"><span class="cl"># 全局配置
</span></span><span class="line"><span class="cl">@login_required  
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1、如果局部和全局都有 该听谁的？
</span></span><span class="line"><span class="cl">    局部&gt;全局
</span></span><span class="line"><span class="cl">2、局部和全局那个好呢？
</span></span><span class="line"><span class="cl">    全局的好处在于无须写重复代码，但跳转的页面很单一
</span></span><span class="line"><span class="cl">    局部好处在于不同函数可以跳转不同页面
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 6、比对原密码
</span></span><span class="line"><span class="cl"># 校验老密码对不对，返回布尔值
</span></span><span class="line"><span class="cl">is_rigth = request.user.check_password(old_password)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 7、修改密码
</span></span><span class="line"><span class="cl">request.user.set_password(new_password)
</span></span><span class="line"><span class="cl">request.user.save()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 8、注销
</span></span><span class="line"><span class="cl">auth.logout(request)    # 类似request.session.flush()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 9、注册
</span></span><span class="line"><span class="cl"># 操作auth_user表写入数据
</span></span><span class="line"><span class="cl"># User.objects.create(username=username, password=password) # 写入数据不能用create，密码没加密处理
</span></span><span class="line"><span class="cl"># 创建普通用户
</span></span><span class="line"><span class="cl"># User.objects.create_user(password=password, username=username)
</span></span><span class="line"><span class="cl"># 创建超级用户(了解)
</span></span><span class="line"><span class="cl">User.objects.create_superuser(username=username,email=&#39;123qq.com&#39;, password=password)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="72-auth实现登录注册功能案例">7.2 auth实现登录注册功能案例</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    # 登录功能
</span></span><span class="line"><span class="cl">    re_path(r&#39;^login/&#39;, views.login),
</span></span><span class="line"><span class="cl">    # 校验用户是否登录
</span></span><span class="line"><span class="cl">    re_path(r&#39;^home/&#39;, views.home),
</span></span><span class="line"><span class="cl">    re_path(r&#39;^index/&#39;, views.index),
</span></span><span class="line"><span class="cl">    # 修改密码
</span></span><span class="line"><span class="cl">    re_path(r&#39;^set_password/&#39;, views.set_password),
</span></span><span class="line"><span class="cl">    # 注销功能
</span></span><span class="line"><span class="cl">    re_path(r&#39;^logout/&#39;, views.logout),
</span></span><span class="line"><span class="cl">    # 注册功能
</span></span><span class="line"><span class="cl">    re_path(r&#39;^register/&#39;, views.register),
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.shortcuts import render, redirect, HttpResponse
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.contrib import auth
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">使用auth模块要用就用全套
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def login(request):
</span></span><span class="line"><span class="cl">    if request.method == &#34;POST&#34;:
</span></span><span class="line"><span class="cl">        username = request.POST.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        password = request.POST.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        去用户表中校验数据
</span></span><span class="line"><span class="cl">        1、表如何获取
</span></span><span class="line"><span class="cl">        2、密码如何对比
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        user_obj = auth.authenticate(request, username=username, password=password)
</span></span><span class="line"><span class="cl">        print(user_obj)  # 用户对象  jason
</span></span><span class="line"><span class="cl">        print(user_obj.username)     # jason
</span></span><span class="line"><span class="cl">        print(user_obj.password)     # 密文密码
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        1、 自动查找auth_user表
</span></span><span class="line"><span class="cl">        2、 自动给密码加密再比对
</span></span><span class="line"><span class="cl">        该方法的注意事项
</span></span><span class="line"><span class="cl">            括号内必须同时传入用户名和密码
</span></span><span class="line"><span class="cl">            不能只传用户名(一步就帮你筛选出用户对象)
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        if user_obj:
</span></span><span class="line"><span class="cl">            # 保存用户状态
</span></span><span class="line"><span class="cl">            auth.login(request, user_obj)   # 相当于request.session[key] = user_obj
</span></span><span class="line"><span class="cl">            # 只要执行了该方法，你就可以再任何地方通过request.user获取到当前用户登录的对象
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    return render(request, &#39;login.html&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.contrib.auth.decorators import login_required
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;局部的优先级大于全局的优先级&#34;&#34;&#34;
</span></span><span class="line"><span class="cl"># @login_required(login_url=&#39;/login/&#39;)    # 局部配置:用户没有登录跳转到loginuser后面指定的网址
</span></span><span class="line"><span class="cl">@login_required  # 全局配置
</span></span><span class="line"><span class="cl">def home(request):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;用户登录之后才能看home&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    print(request.user) # 用户对象
</span></span><span class="line"><span class="cl">    # 判断用户是否登录
</span></span><span class="line"><span class="cl">    print(request.user.is_authenticated)  # 返回布尔值
</span></span><span class="line"><span class="cl">    # 自动去django_session里面查找对应的用户对象给你封装到request.user中
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    return HttpResponse(&#39;OK&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1、如果局部和全局都有 该听谁的？
</span></span><span class="line"><span class="cl">    局部&gt;全局
</span></span><span class="line"><span class="cl">2、局部和全局那个好呢？
</span></span><span class="line"><span class="cl">    全局的好处在于无须写重复代码，但跳转的页面很单一
</span></span><span class="line"><span class="cl">    局部好处在于不同函数可以跳转不同页面
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@login_required(login_url=&#39;/login/&#39;)
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">    return HttpResponse(&#39;index&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@login_required()
</span></span><span class="line"><span class="cl">def set_password(request):
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        old_password = request.POST.get(&#39;old_password&#39;)
</span></span><span class="line"><span class="cl">        new_password = request.POST.get(&#39;new_password&#39;)
</span></span><span class="line"><span class="cl">        confirm_password = request.POST.get(&#39;confirm_password&#39;)
</span></span><span class="line"><span class="cl">        # 先校验两次密码一致
</span></span><span class="line"><span class="cl">        if new_password == confirm_password:
</span></span><span class="line"><span class="cl">            # 校验老密码对不对
</span></span><span class="line"><span class="cl">            is_rigth = request.user.check_password(old_password)   # 自动加密比对密码，返回布尔值
</span></span><span class="line"><span class="cl">            if is_rigth:
</span></span><span class="line"><span class="cl">                # 修改密码
</span></span><span class="line"><span class="cl">                request.user.set_password(new_password)
</span></span><span class="line"><span class="cl">                request.user.save()
</span></span><span class="line"><span class="cl">        return redirect(&#39;/login&#39;)
</span></span><span class="line"><span class="cl">    return render(request,&#39;set_password.html&#39;, locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@login_required
</span></span><span class="line"><span class="cl">def logout(request):
</span></span><span class="line"><span class="cl">    auth.logout(request)    # 类似request.session.flush()
</span></span><span class="line"><span class="cl">    return redirect(&#39;/login/&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.contrib.auth.models import User
</span></span><span class="line"><span class="cl">def register(request):
</span></span><span class="line"><span class="cl">    if request.method == &#39;POST&#39;:
</span></span><span class="line"><span class="cl">        username = request.POST.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        password = request.POST.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        # 操作auth_user表写入数据
</span></span><span class="line"><span class="cl">        # User.objects.create(username=username, password=password) # 写入数据不能用create
</span></span><span class="line"><span class="cl">        # 创建普通用户
</span></span><span class="line"><span class="cl">        # User.objects.create_user(password=password, username=username)
</span></span><span class="line"><span class="cl">        # 创建超级用户(了解)
</span></span><span class="line"><span class="cl">        User.objects.create_superuser(username=username,email=&#39;123qq.com&#39;, password=password)
</span></span><span class="line"><span class="cl">    return render(request, &#39;register.html&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="73如何扩展auth_user表">7.3如何扩展auth_user表</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 第一种:一对一关系  不推荐
</span></span><span class="line"><span class="cl"># class UserDetail(models.Model):
</span></span><span class="line"><span class="cl">#     phone = models.BigIntegerField()
</span></span><span class="line"><span class="cl">#     user = models.OneToOneField(to=&#39;User&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.contrib.auth.models import User, AbstractUser
</span></span><span class="line"><span class="cl"># 第二种:利用面向对象的继承
</span></span><span class="line"><span class="cl">class UserInfo(AbstractUser):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    如果执行了AbstractUser
</span></span><span class="line"><span class="cl">    那么在执行数据库迁移命令的时候auth_user表就不会再创建出来了
</span></span><span class="line"><span class="cl">    而UserInfo表中会出现auth_user所有字段外加上自己扩展的字段
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    这么做的好处在于你可以直接点击你自己的表，更加快速的完成操作及扩展
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    前提:
</span></span><span class="line"><span class="cl">        1、再继承之前没有执行过数据库迁移命令(auth_user没有呗创建)
</span></span><span class="line"><span class="cl">            如果当前库已经创建了auth_user就自己换一个库
</span></span><span class="line"><span class="cl">        2、继承的类里面不要覆盖AbstractUser里面的字段名
</span></span><span class="line"><span class="cl">            表里面有的字段都不能东，只能扩展额外的字段
</span></span><span class="line"><span class="cl">        3、需要再配置文件中告诉django你要用UserInfo替代auth_user
</span></span><span class="line"><span class="cl">            AUTH_USER_MODEL = &#39;app01.UserInfo&#39;
</span></span><span class="line"><span class="cl">                                ps:&#39;应用名.表名&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    phone = models.BigIntegerField()
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">如果你自己写表替代了auth_user那么
</span></span><span class="line"><span class="cl">auth模块的功能还是照常使用，参考的表也由原来的auth_user变成了userinfo
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="第七篇rest-framework">第七篇：Rest Framework</h2>
<p>restful规范，drf入门，视图，序列化，响应，权限，认证，频率，过滤，分页</p>
<h3 id="1drf入门规范">1、drf入门规范</h3>
<h4 id="11-web应用模式">1.1 web应用模式</h4>
<p><strong>前后端不分离</strong></p>
<p><img src="C:/Users/86186/AppData/Roaming/Typora/typora-user-images/image-20220120111205944.png" alt="image-20220120111205944"></p>
<p><strong>前后端分离</strong></p>
<p><img src="C:/Users/86186/AppData/Roaming/Typora/typora-user-images/image-20220120111229493.png" alt="image-20220120111229493"></p>
<h4 id="12-restful规范">1.2 Restful规范</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">RESTful是定义一种web api接口的设计风格，尤其适用于前后端分离的应用模式中
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">事实上，我们科一使用任何一个框架都可以实现符合restful规范的API接口
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 10条规范
</span></span><span class="line"><span class="cl">4.1 数据的安全保障
</span></span><span class="line"><span class="cl">	url链接一般都采用https协议进行传输
</span></span><span class="line"><span class="cl">	注：采用https协议，可以提高数据交互过程中的安全性
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.2 接口特征表现
</span></span><span class="line"><span class="cl">    用api关键字标识接口url：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    https://api.baidu.com
</span></span><span class="line"><span class="cl">    https://www.baidu.com/api
</span></span><span class="line"><span class="cl">	注：看到api字眼，就代表该请求url链接是完成前后台数据交互的
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.3 多数据版本共存
</span></span><span class="line"><span class="cl">    在url链接中标识数据版本
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    https://api.baidu.com/v1
</span></span><span class="line"><span class="cl">    https://api.baidu.com/v2
</span></span><span class="line"><span class="cl">    注：url链接中的v1、v2就是不同数据版本的体现（只有在一种数据资源有多版本情况下）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.4 数据即是资源，均使用名词（可复数）
</span></span><span class="line"><span class="cl">	接口一般都是完成前后台数据的交互，交互的数据我们称之为资源
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    https://api.baidu.com/users
</span></span><span class="line"><span class="cl">    https://api.baidu.com/books
</span></span><span class="line"><span class="cl">    https://api.baidu.com/book
</span></span><span class="line"><span class="cl">    注：一般提倡用资源的复数形式，在url链接中奖励不要出现操作资源的动词，错误示范：https://api.baidu.com/delete-user
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    特殊的接口可以出现动词，因为这些接口一般没有一个明确的资源，或是动词就是接口的核心含义
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    https://api.baidu.com/place/search
</span></span><span class="line"><span class="cl">    https://api.baidu.com/login
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">4.5 资源操作由请求方式决定（method）
</span></span><span class="line"><span class="cl">    操作资源一般都会涉及到增删改查，我们提供请求方式来标识增删改查动作
</span></span><span class="line"><span class="cl">    https://api.baidu.com/books - get请求：获取所有书
</span></span><span class="line"><span class="cl">    https://api.baidu.com/books/1 - get请求：获取主键为1的书
</span></span><span class="line"><span class="cl">    https://api.baidu.com/books - post请求：新增一本书书
</span></span><span class="line"><span class="cl">    https://api.baidu.com/books/1 - put请求：整体修改主键为1的书
</span></span><span class="line"><span class="cl">    https://api.baidu.com/books/1 - patch请求：局部修改主键为1的书
</span></span><span class="line"><span class="cl">    https://api.baidu.com/books/1 - delete请求：删除主键为1的书
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">4.6 过滤，通过在url上传参的形式传递搜索条件
</span></span><span class="line"><span class="cl">    https://api.example.com/v1/zoos?limit=10：指定返回记录的数量
</span></span><span class="line"><span class="cl">    https://api.example.com/v1/zoos?offset=10：指定返回记录的开始位置
</span></span><span class="line"><span class="cl">    https://api.example.com/v1/zoos?page=2&amp;per_page=100：指定第几页，以及每页的记录数
</span></span><span class="line"><span class="cl">    https://api.example.com/v1/zoos?sortby=name&amp;order=asc：指定返回结果按照哪个属性排序，以及排序顺序
</span></span><span class="line"><span class="cl">    https://api.example.com/v1/zoos?animal_type_id=1：指定筛选条件
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.7 响应状态码
</span></span><span class="line"><span class="cl">    4.7.1 正常响应
</span></span><span class="line"><span class="cl">        响应状态码2xx
</span></span><span class="line"><span class="cl">        200：常规请求
</span></span><span class="line"><span class="cl">        201：创建成功
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    4.7.2 重定向响应
</span></span><span class="line"><span class="cl">        响应状态码3xx
</span></span><span class="line"><span class="cl">        301：永久重定向
</span></span><span class="line"><span class="cl">        302：暂时重定向
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    4.7.3 客户端异常
</span></span><span class="line"><span class="cl">        响应状态码4xx
</span></span><span class="line"><span class="cl">        403：请求无权限
</span></span><span class="line"><span class="cl">        404：请求路径不存在
</span></span><span class="line"><span class="cl">        405：请求方法不存在
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    4.7.4 服务器异常
</span></span><span class="line"><span class="cl">        响应状态码5xx
</span></span><span class="line"><span class="cl">        500：服务器异常
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="13-drf安装使用">1.3 drf安装使用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 安装：pip install dgangorestframework
</span></span><span class="line"><span class="cl"># 使用
</span></span><span class="line"><span class="cl">	1、在setting.py 的app中注册
</span></span><span class="line"><span class="cl">		INSTALLED_APPS = [
</span></span><span class="line"><span class="cl">            &#39;rest_framework&#39;,
</span></span><span class="line"><span class="cl">        ]
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    2、在models.py中写表模型
</span></span><span class="line"><span class="cl">            class Book(models.Model):
</span></span><span class="line"><span class="cl">                nid = models.AutoField(primary_key=True)
</span></span><span class="line"><span class="cl">                name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">                price = models.DecimalField(max_digits=5, decimal_places=2)
</span></span><span class="line"><span class="cl">                author = models.CharField(max_len)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    3、新建一个序列化类
</span></span><span class="line"><span class="cl">        from rest_framework.serializers import ModelSerializer
</span></span><span class="line"><span class="cl">        from app01.models import Book
</span></span><span class="line"><span class="cl">        class BookModelSerializer(ModelSerializer):
</span></span><span class="line"><span class="cl">            class Meta:
</span></span><span class="line"><span class="cl">            model = Book
</span></span><span class="line"><span class="cl">            fields = &#34;__all__&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    4、在视图中写视图类
</span></span><span class="line"><span class="cl">        from rest_framework.viewsets import ModelViewSet
</span></span><span class="line"><span class="cl">        from .models import Book
</span></span><span class="line"><span class="cl">        from .ser import BookModelSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        class BookViewSet(ModelViewSet):
</span></span><span class="line"><span class="cl">            queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">            serializer_class = BookModelSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    5、写路由关系
</span></span><span class="line"><span class="cl">        from django.contrib import admin
</span></span><span class="line"><span class="cl">        from django.urls import path,re_path
</span></span><span class="line"><span class="cl">        from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        from rest_framework.routers import DefaultRouter
</span></span><span class="line"><span class="cl">        router = DefaultRouter() # 可以处理视图的路由器
</span></span><span class="line"><span class="cl">        router.register(&#39;book&#39;, views.BookViewSet)  # 向路由中注册视图集
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        urlpatterns = [
</span></span><span class="line"><span class="cl">            path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">            re_path(r&#39;^book/&#39;, views.BookViewSet),
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        ]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # 列表相加
</span></span><span class="line"><span class="cl">        urlpatterns += router.urls
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    6、 启动，在postman中测试即可
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="14-apiview源码分析">1.4 APIView源码分析</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework.views import APIView
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    re_path(r&#39;^booksapiview/&#39;, views.BookAPIView.as_view()),
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># APIView的as_view方法
</span></span><span class="line"><span class="cl">    def as_view(cls, **initkwargs):
</span></span><span class="line"><span class="cl">        view = super().as_view(**initkwargs)  # 调用父类view的as_view(**initkwargs)
</span></span><span class="line"><span class="cl">        view.cls = cls
</span></span><span class="line"><span class="cl">        view.initkwargs = initkwargs
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        # 以后所有请求都没有csrf认证了，只要继承了APIView就没有csrf认证
</span></span><span class="line"><span class="cl">        return csrf_exempt(view)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 请求来了--》路由匹配上--》view(request)--》调用了self.dispatch(),会执行apiview的dispath方法
</span></span><span class="line"><span class="cl"># APIView的dispath方法
</span></span><span class="line"><span class="cl">    def dispatch(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        `.dispatch()` is pretty much the same as Django&#39;s regular dispatch,
</span></span><span class="line"><span class="cl">        but with extra hooks for startup, finalize, and exception handling.
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        self.args = args
</span></span><span class="line"><span class="cl">        self.kwargs = kwargs
</span></span><span class="line"><span class="cl">        request = self.initialize_request(request, *args, **kwargs)
</span></span><span class="line"><span class="cl">        self.request = request
</span></span><span class="line"><span class="cl">        self.headers = self.default_response_headers  # deprecate?
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        try:
</span></span><span class="line"><span class="cl">        	# 三大认证模块
</span></span><span class="line"><span class="cl">            self.initial(request, *args, **kwargs)	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            # Get the appropriate handler method
</span></span><span class="line"><span class="cl">            if request.method.lower() in self.http_method_names:
</span></span><span class="line"><span class="cl">                handler = getattr(self, request.method.lower(),
</span></span><span class="line"><span class="cl">                                  self.http_method_not_allowed)
</span></span><span class="line"><span class="cl">            else:
</span></span><span class="line"><span class="cl">                handler = self.http_method_not_allowed
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			# 响应模块
</span></span><span class="line"><span class="cl">            response = handler(request, *args, **kwargs)
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			# 异常模块
</span></span><span class="line"><span class="cl">        except Exception as exc:
</span></span><span class="line"><span class="cl">            response = self.handle_exception(exc)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        self.response = self.finalize_response(request, response, *args, **kwargs)
</span></span><span class="line"><span class="cl">        return self.response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># APIview的initial方法
</span></span><span class="line"><span class="cl">    def initial(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">    	# 认证组件：校验用户-游客、合法用户、非法用户
</span></span><span class="line"><span class="cl">    	# 游客：代表验证通过，直接进入下一步校验(权限校验)
</span></span><span class="line"><span class="cl">    	# 合法用户：代表校验通过，将用户存储在request.user中，再进入下一步校验(权限校验)
</span></span><span class="line"><span class="cl">    	# 非法用户：代表校验失败，抛出异常，返回403权限异常结果
</span></span><span class="line"><span class="cl">        self.perform_authentication(request)
</span></span><span class="line"><span class="cl">        # 权限组件：校验用户权限 -必须登录、所有用户、登录读写游客只读、自定义用户角色
</span></span><span class="line"><span class="cl">        # 认证通过：可以进入下一步校验(频率校验)
</span></span><span class="line"><span class="cl">        # 认证失败：抛出异常。返回403权限异常结果
</span></span><span class="line"><span class="cl">        self.check_permissions(request)
</span></span><span class="line"><span class="cl">        # 频率组件：限制视图接口被访问频率次数-限制的条件(ip,id,唯一键)
</span></span><span class="line"><span class="cl">        # 频率周期时间(s,m,h)，频率次数(3/s)
</span></span><span class="line"><span class="cl">        # 没有达到限次：正常访问接口
</span></span><span class="line"><span class="cl">        # 达到限次：限制时间内不能访问，限制时间达到后，可以重写访问
</span></span><span class="line"><span class="cl">        self.check_throttles(request)
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from rest_framework.request import Request
</span></span><span class="line"><span class="cl"># 只继承了APIview，视图类中的request对象都被替换成了新的request
</span></span><span class="line"><span class="cl"># 老的request在新的request_request里面
</span></span><span class="line"><span class="cl"># 以后使用request对象，就像使用之前的request一摸一样(因为重写了__getattr__方法)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def __getattr__(self, attr):
</span></span><span class="line"><span class="cl">        try:
</span></span><span class="line"><span class="cl">            return getattr(self._request, attr)	# 通过反射，取原生的request对象，取出属性或方法
</span></span><span class="line"><span class="cl">        except AttributeError:
</span></span><span class="line"><span class="cl">            return self.__getattribute__(attr)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># request.data 感觉是个数据属性，其实是个方法@property
</span></span><span class="line"><span class="cl">	他是一个字典，post请求不管使用什么编码，传过来的数据都在request.data
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># get请求传来的数据，从哪取？
</span></span><span class="line"><span class="cl">	request.GET
</span></span><span class="line"><span class="cl">	@property
</span></span><span class="line"><span class="cl">	def query_params(self):
</span></span><span class="line"><span class="cl">		return self._request.GET
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	# 视图类中
</span></span><span class="line"><span class="cl">	print(request.query_params) # get请求，地址中的参数
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	# 原来
</span></span><span class="line"><span class="cl">	print(request.GET)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2序列化器serializer">2、序列化器Serializer</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">序列化组件介绍：
</span></span><span class="line"><span class="cl">1、序列化，序列化器会把模型对象转成字典，经过response以后变成json字符串
</span></span><span class="line"><span class="cl">2、反序列化，把客户端发过来的数据，经过request以后变成字典，序列化器可以把字典转为模型
</span></span><span class="line"><span class="cl">3、反序列化，完成数据校验功能
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="21-查询数据">2.1 查询数据</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、在setting.py 的app中注册
</span></span><span class="line"><span class="cl">    INSTALLED_APPS = [
</span></span><span class="line"><span class="cl">    	&#39;rest_framework&#39;,
</span></span><span class="line"><span class="cl">    ]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2、写一个序列化的类，继承Serializer
</span></span><span class="line"><span class="cl">    from rest_framework import serializers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 需要继承Serializer
</span></span><span class="line"><span class="cl">    class BookSerializer(serializers.Serializer):
</span></span><span class="line"><span class="cl">        nid = serializers.CharField()
</span></span><span class="line"><span class="cl">        name = serializers.CharField()
</span></span><span class="line"><span class="cl">        price = serializers.CharField()
</span></span><span class="line"><span class="cl">        author = serializers.CharField()
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">3、写路由
</span></span><span class="line"><span class="cl">    urlpatterns = [
</span></span><span class="line"><span class="cl">        path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">        re_path(&#39;books/(?P&lt;pk&gt;\d+)&#39;, views.BookViewSet.as_view()),
</span></span><span class="line"><span class="cl">    ]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">4、在视图中使用，将实例化得到序列化的对象，然后传入
</span></span><span class="line"><span class="cl">    序列化的对象.data是一个字典，返回该字典
</span></span><span class="line"><span class="cl">    from rest_framework.views import APIView
</span></span><span class="line"><span class="cl">    from app01.models import Book
</span></span><span class="line"><span class="cl">    from app01.ser import BookSerializer    # 导入序列化器
</span></span><span class="line"><span class="cl">    from rest_framework.response import Response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    class BookViewSet(APIView):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        def get(self,request,pk):
</span></span><span class="line"><span class="cl">            print(pk)
</span></span><span class="line"><span class="cl">            book = Book.objects.filter(pk=pk).first()
</span></span><span class="line"><span class="cl">            # 用一个类一定要实例化
</span></span><span class="line"><span class="cl">            # 要序列化谁，就将谁传进来
</span></span><span class="line"><span class="cl">            book_ser = BookSerializer(book) # 调用类的__init__方法
</span></span><span class="line"><span class="cl">            # 直接序列化对象.data就是序列化后的字典
</span></span><span class="line"><span class="cl">            # return Response(book_ser.data)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            from django.http import JsonResponse
</span></span><span class="line"><span class="cl">            return JsonResponse(book_ser.data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps：返回字典的时候，如果不适用rest_framework提供的Response，就得使用JsonResponse
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="22-序列化类的字段类型">2.2 序列化类的字段类型</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">不需要多记，只需要记住几个即可
</span></span><span class="line"><span class="cl">CharField，IntegerField，DateField
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>字段</th>
<th>字段构造方式</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>BooleanField</strong></td>
<td>BooleanField()</td>
</tr>
<tr>
<td><strong>NullBooleanField</strong></td>
<td>NullBooleanField()</td>
</tr>
<tr>
<td><strong>CharField</strong></td>
<td>CharField(max_length=None, min_length=None, allow_blank=False, trim_whitespace=True)</td>
</tr>
<tr>
<td><strong>EmailField</strong></td>
<td>EmailField(max_length=None, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td><strong>RegexField</strong></td>
<td>RegexField(regex, max_length=None, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td><strong>SlugField</strong></td>
<td>SlugField(max<em>length=50, min_length=None, allow_blank=False) 正则字段，验证正则模式 [a-zA-Z0-9</em>-]+</td>
</tr>
<tr>
<td><strong>URLField</strong></td>
<td>URLField(max_length=200, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td><strong>UUIDField</strong></td>
<td>UUIDField(format=‘hex_verbose’) format: 1) &lsquo;hex_verbose&rsquo; 如&quot;5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot; 2） &lsquo;hex&rsquo; 如 &ldquo;5ce0e9a55ffa654bcee01238041fb31a&rdquo; 3）</td>
</tr>
<tr>
<td><strong>IPAddressField</strong></td>
<td>IPAddressField(protocol=‘both’, unpack_ipv4=False, **options)</td>
</tr>
<tr>
<td><strong>IntegerField</strong></td>
<td>IntegerField(max_value=None, min_value=None)</td>
</tr>
<tr>
<td><strong>FloatField</strong></td>
<td>FloatField(max_value=None, min_value=None)</td>
</tr>
<tr>
<td><strong>DecimalField</strong></td>
<td>DecimalField(max_digits, decimal_places, coerce_to_string=None, max_value=None, min_value=None) max_digits: 最多位数 decimal_palces: 小数点位置</td>
</tr>
<tr>
<td><strong>DateTimeField</strong></td>
<td>DateTimeField(format=api_settings.DATETIME_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td><strong>DateField</strong></td>
<td>DateField(format=api_settings.DATE_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td><strong>TimeField</strong></td>
<td>TimeField(format=api_settings.TIME_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td><strong>DurationField</strong></td>
<td>DurationField()</td>
</tr>
<tr>
<td><strong>ChoiceField</strong></td>
<td>ChoiceField(choices) choices与Django的用法相同</td>
</tr>
<tr>
<td><strong>MultipleChoiceField</strong></td>
<td>MultipleChoiceField(choices)</td>
</tr>
<tr>
<td><strong>FileField</strong></td>
<td>FileField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td><strong>ImageField</strong></td>
<td>ImageField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td><strong>ListField</strong></td>
<td>ListField(child=, min_length=None, max_length=None)</td>
</tr>
<tr>
<td><strong>DictField</strong></td>
<td>DictField(child=)</td>
</tr>
</tbody>
</table>
<p><strong>选项参数</strong></p>
<table>
<thead>
<tr>
<th><strong>参数名称</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>max_length</strong></td>
<td>最大长度</td>
</tr>
<tr>
<td><strong>min_lenght</strong></td>
<td>最小长度</td>
</tr>
<tr>
<td><strong>allow_blank</strong></td>
<td>是否允许为空</td>
</tr>
<tr>
<td><strong>trim_whitespace</strong></td>
<td>是否截断空白字符</td>
</tr>
<tr>
<td><strong>max_value</strong></td>
<td>最小值</td>
</tr>
<tr>
<td><strong>min_value</strong></td>
<td>最大值</td>
</tr>
</tbody>
</table>
<p><strong>通用参数</strong></p>
<table>
<thead>
<tr>
<th><strong>参数名称</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>read_only</strong></td>
<td>表明该字段仅用于序列化输出，默认False</td>
</tr>
<tr>
<td><strong>write_only</strong></td>
<td>表明该字段仅用于反序列化输入，默认False</td>
</tr>
<tr>
<td><strong>required</strong></td>
<td>表明该字段在反序列化时必须输入，默认True</td>
</tr>
<tr>
<td><strong>default</strong></td>
<td>反序列化时使用的默认值</td>
</tr>
<tr>
<td><strong>allow_null</strong></td>
<td>表明该字段是否允许传入None，默认False</td>
</tr>
<tr>
<td><strong>validators</strong></td>
<td>该字段使用的验证器</td>
</tr>
<tr>
<td><strong>error_messages</strong></td>
<td>包含错误编号与错误信息的字典</td>
</tr>
<tr>
<td><strong>label</strong></td>
<td>用于HTML展示API页面时，显示的字段名称</td>
</tr>
<tr>
<td><strong>help_text</strong></td>
<td>用于HTML展示API页面时，显示的字段帮助提示信息</td>
</tr>
</tbody>
</table>
<h4 id="23-修改数据">2.3 修改数据</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、在setting.py 的app中注册
</span></span><span class="line"><span class="cl">    INSTALLED_APPS = [
</span></span><span class="line"><span class="cl">    	&#39;rest_framework&#39;,
</span></span><span class="line"><span class="cl">    ]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2、写一个序列化的类，继承Serializer
</span></span><span class="line"><span class="cl">    from rest_framework import serializers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 需要继承Serializer
</span></span><span class="line"><span class="cl">    class BookSerializer(serializers.Serializer):
</span></span><span class="line"><span class="cl">        nid = serializers.CharField()
</span></span><span class="line"><span class="cl">        name = serializers.CharField()
</span></span><span class="line"><span class="cl">        price = serializers.CharField()
</span></span><span class="line"><span class="cl">        author = serializers.CharField(max_length=2)
</span></span><span class="line"><span class="cl">      	def update(self, instance, validated_data):
</span></span><span class="line"><span class="cl">            # instance是book这个对象
</span></span><span class="line"><span class="cl">            # validated_data是校验后的数据
</span></span><span class="line"><span class="cl">            instance.name = validated_data.get(&#39;name&#39;)
</span></span><span class="line"><span class="cl">            instance.price = validated_data.get(&#39;price&#39;)
</span></span><span class="line"><span class="cl">            instance.author = validated_data.get(&#39;author&#39;)
</span></span><span class="line"><span class="cl">            instance.save() # book.save(),django的orm提供的
</span></span><span class="line"><span class="cl">            return instance
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3、写路由
</span></span><span class="line"><span class="cl">    urlpatterns = [
</span></span><span class="line"><span class="cl">        path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">        re_path(&#39;books/(?P&lt;pk&gt;\d+)&#39;, views.BookViewSet.as_view()),
</span></span><span class="line"><span class="cl">    ]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">4、在视图中使用，将实例化得到序列化的对象，然后传入
</span></span><span class="line"><span class="cl">    序列化的对象.data是一个字典，返回该字典
</span></span><span class="line"><span class="cl">    from rest_framework.views import APIView
</span></span><span class="line"><span class="cl">    from app01.models import Book
</span></span><span class="line"><span class="cl">    from app01.ser import BookSerializer    # 导入序列化器
</span></span><span class="line"><span class="cl">    from rest_framework.response import Response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    class BookViewSet(APIView):
</span></span><span class="line"><span class="cl">        def get(self,request,pk):
</span></span><span class="line"><span class="cl">            print(pk)
</span></span><span class="line"><span class="cl">            book = Book.objects.filter(pk=pk).first()
</span></span><span class="line"><span class="cl">            # 用一个类一定要实例化
</span></span><span class="line"><span class="cl">            # 要序列化谁，就将谁传进来
</span></span><span class="line"><span class="cl">            book_ser = BookSerializer(book) # 调用类的__init__方法
</span></span><span class="line"><span class="cl">            # 直接序列化对象.data就是序列化后的字典
</span></span><span class="line"><span class="cl">            # return Response(book_ser.data)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            from django.http import JsonResponse
</span></span><span class="line"><span class="cl">            return JsonResponse(book_ser.data)
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        def put(self,request,pk):
</span></span><span class="line"><span class="cl">            # 定义一个报错字典
</span></span><span class="line"><span class="cl">            response_msg = {&#39;status&#39;:100,&#39;msg&#39;:&#39;成功&#39;}
</span></span><span class="line"><span class="cl">            # 找到这个对象
</span></span><span class="line"><span class="cl">            book = Book.objects.filter(pk=pk).first()
</span></span><span class="line"><span class="cl">            # 得到一个序列化类的对象
</span></span><span class="line"><span class="cl">            # 第一个参数传需要修改的对象，第二个传已修改的数据
</span></span><span class="line"><span class="cl">            # book_ser = BookSerializer(book,request.data)
</span></span><span class="line"><span class="cl">            book_ser = BookSerializer(instance=book,data=request.data)	# 推荐使用
</span></span><span class="line"><span class="cl">            if book_ser.is_valid(): # 返回True表示验证通过
</span></span><span class="line"><span class="cl">                book_ser.save() # 直接调用报错   需要自己写updata方法
</span></span><span class="line"><span class="cl">                response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">            else:
</span></span><span class="line"><span class="cl">                response_msg[&#39;status&#39;] = 101
</span></span><span class="line"><span class="cl">                response_msg[&#39;msg&#39;] = &#39;数据校验失败&#39;
</span></span><span class="line"><span class="cl">                response_msg[&#39;data&#39;] = book_ser.errors
</span></span><span class="line"><span class="cl">            # 返回已经修改后的数据
</span></span><span class="line"><span class="cl">            return Response(response_msg)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5、如果序列化类里的校验函数不够，可以写钩子函数
</span></span><span class="line"><span class="cl"># 需要继承Serializer
</span></span><span class="line"><span class="cl">class BookSerializer(serializers.Serializer):
</span></span><span class="line"><span class="cl">    nid = serializers.CharField()
</span></span><span class="line"><span class="cl">    name = serializers.CharField()
</span></span><span class="line"><span class="cl">    price = serializers.CharField()
</span></span><span class="line"><span class="cl">    author = serializers.CharField(max_length=2)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 局部钩子
</span></span><span class="line"><span class="cl">    def validate_price(self, data):
</span></span><span class="line"><span class="cl">        # validate杠字段名，需要接收参数data
</span></span><span class="line"><span class="cl">        # 如果价格小于10，则校验不通过
</span></span><span class="line"><span class="cl">        # print(type(data))  # &lt;class &#39;str&#39;&gt;
</span></span><span class="line"><span class="cl">        # print(data) # 价格 price
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if float(data)&gt;10:
</span></span><span class="line"><span class="cl">            return data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            # 校验失败抛异常
</span></span><span class="line"><span class="cl">            from rest_framework.exceptions import ValidationError
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;价格太低，抬高价格&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 全局钩子
</span></span><span class="line"><span class="cl">    def validate(self, validate_data):
</span></span><span class="line"><span class="cl">        print(validate_data)
</span></span><span class="line"><span class="cl">        author = validate_data.get(&#39;author&#39;)
</span></span><span class="line"><span class="cl">        name = validate_data.get(&#39;name&#39;)
</span></span><span class="line"><span class="cl">        if author == name:
</span></span><span class="line"><span class="cl">            from rest_framework.exceptions import ValidationError
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;作者名和书名不能一致&#39;)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            return validate_data
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def update(self, instance, validated_data):
</span></span><span class="line"><span class="cl">        # instance是book这个对象
</span></span><span class="line"><span class="cl">        # validated_data是校验后的数据
</span></span><span class="line"><span class="cl">        instance.name = validated_data.get(&#39;name&#39;)
</span></span><span class="line"><span class="cl">        instance.price = validated_data.get(&#39;price&#39;)
</span></span><span class="line"><span class="cl">        instance.author = validated_data.get(&#39;author&#39;)
</span></span><span class="line"><span class="cl">        instance.save()  # book.save(),django的orm提供的
</span></span><span class="line"><span class="cl">        return instance
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps:保存数据的时候需要在序列化类里面重写updata方法
</span></span><span class="line"><span class="cl">	BookSerializer()的第一个参数是instance，第二个参数是data
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">校验数据的三种方式:
</span></span><span class="line"><span class="cl">	1、直接在校验字段里面写
</span></span><span class="line"><span class="cl">		author = serializers.CharField(max_length=2)
</span></span><span class="line"><span class="cl">	2、写钩子函数，全局和局部
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	3、通过在校验字段里面写函数的内存地址
</span></span><span class="line"><span class="cl">        def check_author(data):
</span></span><span class="line"><span class="cl">            if data.startswith(&#39;sb&#39;):
</span></span><span class="line"><span class="cl">                raise ValidationError(&#39;作者名字不能以sb开头&#39;)
</span></span><span class="line"><span class="cl">            else：
</span></span><span class="line"><span class="cl">                return data
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        class BookSerializer(serializers.Serializer):
</span></span><span class="line"><span class="cl">            # validators=[] 列表里面写函数名
</span></span><span class="line"><span class="cl">            author = serializers.CharField(validators=[check_author])
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="24-read_only和write_only">2.4 read_only和write_only</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">read_only： 表明该字段仅用于序列化输出，默认False，如果设置为true，postman中看得到该字段，修改时不需要传
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">write_only： 表明该字段仅用于反序列化输入，默认False，如果设置为true，postman中看不到该字段，修改时必须传 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">以下了解即可
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">| **required**       | 表明该字段在反序列化时必须输入，默认True      |
</span></span><span class="line"><span class="cl">| ------------------ | --------------------------------------------- |
</span></span><span class="line"><span class="cl">| **default**        | 反序列化时使用的默认值                        |
</span></span><span class="line"><span class="cl">| **allow_null**     | 表明该字段是否允许传入None，默认False         |
</span></span><span class="line"><span class="cl">| **validators**     | 该字段使用的验证器                            |
</span></span><span class="line"><span class="cl">| **error_messages** | 包含错误编号与错误信息的字典                  |
</span></span><span class="line"><span class="cl">| **label**          | 用于HTML展示API页面时，显示的字段名称         |
</span></span><span class="line"><span class="cl">| **help_text**      | 用于HTML展示API页面时，显示的字段帮助提示信息 |
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="25-查询所有数据">2.5 查询所有数据</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、写路由
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?P&lt;pk&gt;\d+)&#39;, views.BookViewSet.as_view()),
</span></span><span class="line"><span class="cl">    # 为什么还要再新写一个新的函数，应为原来的里面已经有get函数了，所以要写新的类
</span></span><span class="line"><span class="cl">    re_path(&#39;books/&#39;, views.BooksViewSet.as_view()),
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2、写视图函数
</span></span><span class="line"><span class="cl">class BooksViewSet(APIView):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def get(self,request):
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        books = Book.objects.all()
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(books,many=True) # 序列化多条要加many=True,序列化一条则不用
</span></span><span class="line"><span class="cl">        response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="26-新增数据">2.6 新增数据</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、写路由
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?P&lt;pk&gt;\d+)&#39;, views.BookViewSet.as_view()),
</span></span><span class="line"><span class="cl">    # 为什么还要再新写一个新的函数，应为原来的里面已经有get函数了，所以要写新的类
</span></span><span class="line"><span class="cl">    re_path(&#39;books/&#39;, views.BooksViewSet.as_view()),
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2、写视图函数
</span></span><span class="line"><span class="cl">class BooksViewSet(APIView):
</span></span><span class="line"><span class="cl">    # 查询所有
</span></span><span class="line"><span class="cl">    def get(self,request):
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        books = Book.objects.all()
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(books,many=True) # 序列化多条要加many=True,序列化一条则不用
</span></span><span class="line"><span class="cl">        response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 新增
</span></span><span class="line"><span class="cl">    def post(self,request):
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        # 修改才偶instance，新增没有instance,只有data
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(data=request.data)
</span></span><span class="line"><span class="cl">        # book_ser = BookSerializer(request.data) # 报错，第一个参数是instance
</span></span><span class="line"><span class="cl">        # 校验字段
</span></span><span class="line"><span class="cl">        if book_ser.is_valid():
</span></span><span class="line"><span class="cl">            book_ser.save()     # 需要重写create方法
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            response_msg[&#39;status&#39;] = 102
</span></span><span class="line"><span class="cl">            response_msg[&#39;msg&#39;] = &#39;数据校验失败&#39;
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.errors
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">3、写序列化类
</span></span><span class="line"><span class="cl">from rest_framework import serializers
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 需要继承Serializer
</span></span><span class="line"><span class="cl">class BookSerializer(serializers.Serializer):
</span></span><span class="line"><span class="cl">    nid = serializers.CharField(read_only=True)
</span></span><span class="line"><span class="cl">    name = serializers.CharField(write_only=False)
</span></span><span class="line"><span class="cl">    price = serializers.CharField()
</span></span><span class="line"><span class="cl">    author = serializers.CharField(max_length=2)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 局部钩子
</span></span><span class="line"><span class="cl">    def validate_price(self, data):
</span></span><span class="line"><span class="cl">        # validate杠字段名，需要接收参数data
</span></span><span class="line"><span class="cl">        # 如果价格小于10，则校验不通过
</span></span><span class="line"><span class="cl">        # print(type(data))  # &lt;class &#39;str&#39;&gt;
</span></span><span class="line"><span class="cl">        # print(data) # 价格 price
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if float(data)&gt;10:
</span></span><span class="line"><span class="cl">            return data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            # 校验失败抛异常
</span></span><span class="line"><span class="cl">            from rest_framework.exceptions import ValidationError
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;价格太低，抬高价格&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 全局钩子
</span></span><span class="line"><span class="cl">    def validate(self, validate_data):
</span></span><span class="line"><span class="cl">        print(validate_data)
</span></span><span class="line"><span class="cl">        author = validate_data.get(&#39;author&#39;)
</span></span><span class="line"><span class="cl">        name = validate_data.get(&#39;name&#39;)
</span></span><span class="line"><span class="cl">        if author == name:
</span></span><span class="line"><span class="cl">            from rest_framework.exceptions import ValidationError
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;作者名和书名不能一致&#39;)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            return validate_data
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def update(self, instance, validated_data):
</span></span><span class="line"><span class="cl">        # instance是book这个对象
</span></span><span class="line"><span class="cl">        # validated_data是校验后的数据
</span></span><span class="line"><span class="cl">        instance.name = validated_data.get(&#39;name&#39;)
</span></span><span class="line"><span class="cl">        instance.price = validated_data.get(&#39;price&#39;)
</span></span><span class="line"><span class="cl">        instance.author = validated_data.get(&#39;author&#39;)
</span></span><span class="line"><span class="cl">        instance.save()  # book.save(),django的orm提供的
</span></span><span class="line"><span class="cl">        return instance
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def create(self, validated_data):
</span></span><span class="line"><span class="cl">        instance=Book.objects.create(**validated_data)
</span></span><span class="line"><span class="cl">        # Book.objects.create(name=validated_data.get(&#39;name&#39;))
</span></span><span class="line"><span class="cl">        return instance
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">ps：序列化中需要重写create方法
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="27-删除数据">2.7 删除数据</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">class BookViewSet(APIView):
</span></span><span class="line"><span class="cl">    def delete(self,request,pk):
</span></span><span class="line"><span class="cl">        res = Book.objects.filter(pk=pk).delete()
</span></span><span class="line"><span class="cl">        return Response({&#39;status&#39;: 100, &#39;msg&#39;: &#39;删除成功&#39;})
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="28-五个接口的源码">2.8 五个接口的源码</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、注册
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2、写路由urls
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import path,re_path
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?P&lt;pk&gt;\d+)&#39;, views.BookViewSet.as_view()),
</span></span><span class="line"><span class="cl">    # 为什么还要再新写一个新的函数，应为原来的里面已经有get函数了，所以要写新的类
</span></span><span class="line"><span class="cl">    re_path(&#39;books/&#39;, views.BooksViewSet.as_view()),
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3、视图函数views
</span></span><span class="line"><span class="cl">from django.shortcuts import render, redirect, HttpResponse
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework.views import APIView
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer    # 导入序列化器
</span></span><span class="line"><span class="cl">from rest_framework.response import Response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookViewSet(APIView):
</span></span><span class="line"><span class="cl">	# 查看单个
</span></span><span class="line"><span class="cl">    def get(self,request,pk):
</span></span><span class="line"><span class="cl">        book = Book.objects.filter(pk=pk).first()
</span></span><span class="line"><span class="cl">        # 用一个类一定要实例化
</span></span><span class="line"><span class="cl">        # 要序列化谁，就将谁传进来
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(book) # 调用类的__init__方法
</span></span><span class="line"><span class="cl">        # 直接序列化对象.data就是序列化后的字典
</span></span><span class="line"><span class="cl">        return Response(book_ser.data)
</span></span><span class="line"><span class="cl">        # from django.http import JsonResponse
</span></span><span class="line"><span class="cl">        # return JsonResponse(book_ser.data)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	# 修改
</span></span><span class="line"><span class="cl">    def put(self,request,pk):
</span></span><span class="line"><span class="cl">        # 定义一个报错字典
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;:100,&#39;msg&#39;:&#39;成功&#39;}
</span></span><span class="line"><span class="cl">        # 找到这个对象
</span></span><span class="line"><span class="cl">        book = Book.objects.filter(pk=pk).first()
</span></span><span class="line"><span class="cl">        # 得到一个序列化类的对象
</span></span><span class="line"><span class="cl">        # 第一个参数传需要修改的对象，第二个传已修改的数据
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(book,request.data)
</span></span><span class="line"><span class="cl">        if book_ser.is_valid(): # 返回True表示验证通过
</span></span><span class="line"><span class="cl">            book_ser.save() # 直接调用报错   需要自己写updata方法
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            response_msg[&#39;status&#39;] = 101
</span></span><span class="line"><span class="cl">            response_msg[&#39;msg&#39;] = &#39;数据校验失败&#39;
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.errors
</span></span><span class="line"><span class="cl">        # 返回已经修改后的数据
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	# 删除
</span></span><span class="line"><span class="cl">    def delete(self,request,pk):
</span></span><span class="line"><span class="cl">        res = Book.objects.filter(pk=pk).delete()
</span></span><span class="line"><span class="cl">        return Response({&#39;status&#39;: 100, &#39;msg&#39;: &#39;删除成功&#39;})
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BooksViewSet(APIView):
</span></span><span class="line"><span class="cl">    # 查询所有
</span></span><span class="line"><span class="cl">    def get(self,request):
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        books = Book.objects.all()
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(books,many=True) # 序列化多条要加many=True,序列化一条则不用
</span></span><span class="line"><span class="cl">        response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 新增
</span></span><span class="line"><span class="cl">    def post(self,request):
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        # 修改才偶instance，新增没有instance,只有data
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(data=request.data)
</span></span><span class="line"><span class="cl">        # book_ser = BookSerializer(request.data) # 报错，第一个参数是instance
</span></span><span class="line"><span class="cl">        # 校验字段
</span></span><span class="line"><span class="cl">        if book_ser.is_valid():
</span></span><span class="line"><span class="cl">            book_ser.save()     # 需要重写create方法
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            response_msg[&#39;status&#39;] = 102
</span></span><span class="line"><span class="cl">            response_msg[&#39;msg&#39;] = &#39;数据校验失败&#39;
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.errors
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4、写序列化校验类
</span></span><span class="line"><span class="cl">from rest_framework import serializers
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 需要继承Serializer
</span></span><span class="line"><span class="cl">class BookSerializer(serializers.Serializer):
</span></span><span class="line"><span class="cl">    nid = serializers.CharField(read_only=True)
</span></span><span class="line"><span class="cl">    name = serializers.CharField(write_only=False)
</span></span><span class="line"><span class="cl">    price = serializers.CharField()
</span></span><span class="line"><span class="cl">    author = serializers.CharField(max_length=2)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 局部钩子
</span></span><span class="line"><span class="cl">    def validate_price(self, data):
</span></span><span class="line"><span class="cl">        # validate杠字段名，需要接收参数data
</span></span><span class="line"><span class="cl">        # 如果价格小于10，则校验不通过
</span></span><span class="line"><span class="cl">        # print(type(data))  # &lt;class &#39;str&#39;&gt;
</span></span><span class="line"><span class="cl">        # print(data) # 价格 price
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if float(data)&gt;10:
</span></span><span class="line"><span class="cl">            return data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            # 校验失败抛异常
</span></span><span class="line"><span class="cl">            from rest_framework.exceptions import ValidationError
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;价格太低，抬高价格&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 全局钩子
</span></span><span class="line"><span class="cl">    def validate(self, validate_data):
</span></span><span class="line"><span class="cl">        print(validate_data)
</span></span><span class="line"><span class="cl">        author = validate_data.get(&#39;author&#39;)
</span></span><span class="line"><span class="cl">        name = validate_data.get(&#39;name&#39;)
</span></span><span class="line"><span class="cl">        if author == name:
</span></span><span class="line"><span class="cl">            from rest_framework.exceptions import ValidationError
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;作者名和书名不能一致&#39;)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            return validate_data
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def update(self, instance, validated_data):
</span></span><span class="line"><span class="cl">        # instance是book这个对象
</span></span><span class="line"><span class="cl">        # validated_data是校验后的数据
</span></span><span class="line"><span class="cl">        instance.name = validated_data.get(&#39;name&#39;)
</span></span><span class="line"><span class="cl">        instance.price = validated_data.get(&#39;price&#39;)
</span></span><span class="line"><span class="cl">        instance.author = validated_data.get(&#39;author&#39;)
</span></span><span class="line"><span class="cl">        instance.save()  # book.save(),django的orm提供的
</span></span><span class="line"><span class="cl">        return instance
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def create(self, validated_data):
</span></span><span class="line"><span class="cl">        instance=Book.objects.create(**validated_data)
</span></span><span class="line"><span class="cl">        # Book.objects.create(name=validated_data.get(&#39;name&#39;))
</span></span><span class="line"><span class="cl">        return instance
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="29-自己封装response_msg字典">2.9 自己封装response_msg字典</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">test.py:
</span></span><span class="line"><span class="cl">class MyResponse():
</span></span><span class="line"><span class="cl">    def __init__(self):
</span></span><span class="line"><span class="cl">        self.status=100
</span></span><span class="line"><span class="cl">        self.msg = &#39;成功&#39;
</span></span><span class="line"><span class="cl">    @property
</span></span><span class="line"><span class="cl">    def get_dict(self):
</span></span><span class="line"><span class="cl">        return self.__dict__
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">if __name__ == &#39;__main__&#39;:
</span></span><span class="line"><span class="cl">    res=MyResponse()
</span></span><span class="line"><span class="cl">    res.data = {&#39;name&#39;:&#39;lasda&#39;}
</span></span><span class="line"><span class="cl">    print(res.get_dict)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">from app01.tests import MyResponse
</span></span><span class="line"><span class="cl">例1：
</span></span><span class="line"><span class="cl">    没使用自己封装的字典前：
</span></span><span class="line"><span class="cl">    def delete(self,request,pk):
</span></span><span class="line"><span class="cl">        res = Book.objects.filter(pk=pk).delete()
</span></span><span class="line"><span class="cl">        return Response({&#39;status&#39;: 100, &#39;msg&#39;: &#39;删除成功&#39;})    
</span></span><span class="line"><span class="cl">    使用后：
</span></span><span class="line"><span class="cl">    def delete(self,request,pk):
</span></span><span class="line"><span class="cl">        response = MyResponse()
</span></span><span class="line"><span class="cl">        res = Book.objects.filter(pk=pk).delete()
</span></span><span class="line"><span class="cl">        return Response(response)    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">例2：
</span></span><span class="line"><span class="cl">	使用前：
</span></span><span class="line"><span class="cl">    def get(self,request):
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        books = Book.objects.all()
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(books,many=True) # 序列化多条要加many=True,序列化一条则不用
</span></span><span class="line"><span class="cl">        response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	使用后：
</span></span><span class="line"><span class="cl">    # 查询所有
</span></span><span class="line"><span class="cl">    def get(self,request):
</span></span><span class="line"><span class="cl">        response = MyResponse()
</span></span><span class="line"><span class="cl">        books = Book.objects.all()
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(books,many=True) # 序列化多条要加many=True,序列化一条则不用
</span></span><span class="line"><span class="cl">        response[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        return Response(response.get_dict)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="210-模型类序列化器">2.10 模型类序列化器</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">序列化类的写法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookModelSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        model=Book  # 对应上models.py中的模型
</span></span><span class="line"><span class="cl">        # fields = &#39;__all__&#39;
</span></span><span class="line"><span class="cl">        # fields=(&#39;name&#39;,&#39;price&#39;) # 只序列化指定字段
</span></span><span class="line"><span class="cl">        exclude=(&#39;name&#39;,)   # 排除name字段，和fields不能同时写
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">		extra_kwargs = {
</span></span><span class="line"><span class="cl">            &#39;name&#39;: {&#39;write_only&#39;: True},
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">视图函数使用：
</span></span><span class="line"><span class="cl">from app01.ser import BookModelSerializer
</span></span><span class="line"><span class="cl">class BookViewSet(APIView):
</span></span><span class="line"><span class="cl">    def get(self,request,pk):
</span></span><span class="line"><span class="cl">        book = Book.objects.filter(pk=pk).first()
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(book) 
</span></span><span class="line"><span class="cl">        return Response(book_ser.data)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="211-extra_kwargs添加额外参数">2.11 extra_kwargs添加额外参数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> extra_kwargs = {
</span></span><span class="line"><span class="cl">            &#39;id&#39;: {&#39;read_only&#39;: True,&#39;其他参数&#39;:&#39;&#39;},
</span></span><span class="line"><span class="cl">            &#39;name&#39;: {&#39;write_only&#39;: True},
</span></span><span class="line"><span class="cl">        }
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="212-serializer高级用法">2.12 Serializer高级用法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># source的用法
</span></span><span class="line"><span class="cl">	1、可以修改字段的名字	
</span></span><span class="line"><span class="cl">		xxx = serializers.CharField(source=&#39;title&#39;)
</span></span><span class="line"><span class="cl">	2、可以.跨表
</span></span><span class="line"><span class="cl">		publish = serializers.CharField(source=&#39;publish.email&#39;)
</span></span><span class="line"><span class="cl">	3、可以执行对应的方法
</span></span><span class="line"><span class="cl">		pub_data=serializers.CharField(source=&#39;test&#39;)
</span></span><span class="line"><span class="cl">		test是Book表模型中的方法
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"># SeruakuzerMethodField()的使用
</span></span><span class="line"><span class="cl">	1、他需要有个配套的方法，方法名叫get_字段名，返回值就是显示的东西
</span></span><span class="line"><span class="cl">	authors=serializers.SerializerMethodField()
</span></span><span class="line"><span class="cl">	def get_author(self,instance):
</span></span><span class="line"><span class="cl">		# self是book对象
</span></span><span class="line"><span class="cl">		authors = instance.authors.all()  取出所有作者
</span></span><span class="line"><span class="cl">		ll = []
</span></span><span class="line"><span class="cl">		for author in authors:
</span></span><span class="line"><span class="cl">			ll.append({&#39;name&#39;:author.name,&#39;age&#39;:author.age})
</span></span><span class="line"><span class="cl">		return ll
</span></span><span class="line"><span class="cl">		
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3请求和响应">3、请求和响应</h3>
<h4 id="31-请求">3.1 请求</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 请求对象
</span></span><span class="line"><span class="cl"># from rest_framework.request import Request
</span></span><span class="line"><span class="cl">	def __init__(self, request, parsers=None, authenticators=None)
</span></span><span class="line"><span class="cl">			# 二次封装request，将原生request作为drf request对象的 _request属性
</span></span><span class="line"><span class="cl">			self._request = request		
</span></span><span class="line"><span class="cl">		def __getattor__(self,item):
</span></span><span class="line"><span class="cl">			return getattr(self._request, item)
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl"># 请求对象.data：前端以三种编码方式传入数据，都可以取出来,包含了对POST、PUT、PATCH请求方式解析后的数据
</span></span><span class="line"><span class="cl"># 请求对象.query_params 与django标准的request.GET相同，知识更换了更正确的名称而已
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="32-响-应">3.2 响 应</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># from rest_framework.response import Response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def __init__(self, data=None, status=None,
</span></span><span class="line"><span class="cl">				template_name=None,headers=None,
</span></span><span class="line"><span class="cl">				exception=False, content_type=None):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># REST framework提供了一个响应类Response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 1、构造方式：
</span></span><span class="line"><span class="cl">Response(data, status=None, template_name=None, headers=None, content_type=None)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、参数说明：
</span></span><span class="line"><span class="cl">    data: 为响应准备的序列化处理后的数据；
</span></span><span class="line"><span class="cl">    status: 返回的状态码，默认200；
</span></span><span class="line"><span class="cl">    	from rest_framework import status 在这个路径下，它把所有使用到的状态码定义成了常量
</span></span><span class="line"><span class="cl">    template_name: 渲染的模板名称(自定义模板，不需要了解)
</span></span><span class="line"><span class="cl">    headers: 用于存放响应头信息的字典；
</span></span><span class="line"><span class="cl">    content_type: 响应的编码格式，application/json 和text/html
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 3、常用属性：
</span></span><span class="line"><span class="cl">1）.data
</span></span><span class="line"><span class="cl">传给response对象的序列化后，但尚未render处理的数据
</span></span><span class="line"><span class="cl">2）.status_code
</span></span><span class="line"><span class="cl">状态码的数字
</span></span><span class="line"><span class="cl">3）.content
</span></span><span class="line"><span class="cl">经过render处理后的响应数据
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 4、案例
</span></span><span class="line"><span class="cl">class TestView(APIView):
</span></span><span class="line"><span class="cl">	def get(self,request):
</span></span><span class="line"><span class="cl">		print(request)
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		return Response({&#39;name&#39;:&#39;sad&#39;},status=111,header={&#39;token&#39;:&#39;xxx&#39;})
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 5、浏览器响应成浏览器的格式。postman响应成json格式，通过配置实现(默认配置)
</span></span><span class="line"><span class="cl"># 不管postman还是浏览器，都返回json格式数据
</span></span><span class="line"><span class="cl"># ps：drf有默认的配置文件--&gt;先从项目的setting中找，找不到，采用默认的
</span></span><span class="line"><span class="cl"># def的配置信息，先从自己的类中找--&gt;项目的setting中找--&gt;默认的找
</span></span><span class="line"><span class="cl">	1、局部使用：对某个视图类有效
</span></span><span class="line"><span class="cl">		在视图类中加入如下
</span></span><span class="line"><span class="cl">		REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">            &#39;DEFAULT_RENDERER_CLASSES&#39;: (  # 默认响应渲染类
</span></span><span class="line"><span class="cl">                &#39;rest_framework.renderers.JSONRenderer&#39;,  # json渲染器
</span></span><span class="line"><span class="cl">                # &#39;rest_framework.renderers.BrowsableAPIRenderer&#39;,  # 浏览API渲染器
</span></span><span class="line"><span class="cl">            )
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	2、全局使用：全局的视图类，所有请求都有效
</span></span><span class="line"><span class="cl">		在setting.py中加入如下
</span></span><span class="line"><span class="cl">		REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">            &#39;DEFAULT_RENDERER_CLASSES&#39;: (  # 默认响应渲染类
</span></span><span class="line"><span class="cl">                &#39;rest_framework.renderers.JSONRenderer&#39;,  # json渲染器
</span></span><span class="line"><span class="cl">                # &#39;rest_framework.renderers.BrowsableAPIRenderer&#39;,  # 浏览API渲染器
</span></span><span class="line"><span class="cl">            )
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4视图">4、视图</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">视图基类有APIView，GenericAPIView
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">视图家族
</span></span><span class="line"><span class="cl">	APIView--》继承自view
</span></span><span class="line"><span class="cl">	GenicAPIview--》APIView，做了一些扩展：
</span></span><span class="line"><span class="cl">		queryset = None
</span></span><span class="line"><span class="cl">		serializer_class = None
</span></span><span class="line"><span class="cl">		get_queryset()	经常用
</span></span><span class="line"><span class="cl">		get_serializer()	经常用
</span></span><span class="line"><span class="cl">		get_serializer_class()	内部来用，外部会重写
</span></span><span class="line"><span class="cl">		get_object() 经常用，用来获取一条数据(pk传过来的)
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	5个视图扩展类(继承了object)，每个里面写了一个方法(ListModelMixin: list方法)
</span></span><span class="line"><span class="cl">		ListModelMixin
</span></span><span class="line"><span class="cl">		CreateModelMixin
</span></span><span class="line"><span class="cl">		RetrieveModelMixin
</span></span><span class="line"><span class="cl">		UpdateModelMixin
</span></span><span class="line"><span class="cl">		DestroyModelMixin
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	GenericAPIview的视图子类，9个，继承了GenicAPIview+一个或者两个或者三个视图扩展类
</span></span><span class="line"><span class="cl">        CreateAPIView,
</span></span><span class="line"><span class="cl">        ListAPIView,
</span></span><span class="line"><span class="cl">        UpdateAPIView,
</span></span><span class="line"><span class="cl">        RetrieveAPIView,
</span></span><span class="line"><span class="cl">        DestroyAPIView,
</span></span><span class="line"><span class="cl">        ListCreateAPIView,
</span></span><span class="line"><span class="cl">        RetrieveUpdateAPIView,
</span></span><span class="line"><span class="cl">        RetrieveUpdateDestroyAPIView,
</span></span><span class="line"><span class="cl">        RetrieveDestroyAPIView,
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	视图集：ModelviewSet，ReadOnlyModelViewSet：继承了上面一堆(5个视图扩展GenicAPIview)+自己写了一个ViewSetMixin(as_view方法)，只要继承他，路由就可以写成(&#39;get&#39;:&#39;自己定义的方法&#39;)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    ViewSetMixin：重写了as_view 
</span></span><span class="line"><span class="cl">    ViewSet：     继承ViewSetMixin和APIView
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    GenericViewSet：继承
</span></span><span class="line"><span class="cl">        ViewSetMixin, 
</span></span><span class="line"><span class="cl">        generics.GenericAPIView
</span></span><span class="line"><span class="cl">    ModelViewSet：继承：
</span></span><span class="line"><span class="cl">        mixins.CreateModelMixin,
</span></span><span class="line"><span class="cl">        mixins.RetrieveModelMixin,
</span></span><span class="line"><span class="cl">        mixins.UpdateModelMixin,
</span></span><span class="line"><span class="cl">        mixins.DestroyModelMixin,
</span></span><span class="line"><span class="cl">        mixins.ListModelMixin,
</span></span><span class="line"><span class="cl">        GenericViewSet
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    ReadOnlyModelViewSet：继承
</span></span><span class="line"><span class="cl">        mixins.RetrieveModelMixin,
</span></span><span class="line"><span class="cl">        mixins.ListModelMixin,
</span></span><span class="line"><span class="cl">        GenericViewSet
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">作业：继承ModelViewSet，重写list，只获取前十条
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="41-基于apiview的五个接口">4.1 基于APIView的五个接口</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、注册
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2、写路由urls
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import path,re_path
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?P&lt;pk&gt;\d+)&#39;, views.BookViewSet.as_view()),
</span></span><span class="line"><span class="cl">    # 为什么还要再新写一个新的函数，应为原来的里面已经有get函数了，所以要写新的类
</span></span><span class="line"><span class="cl">    re_path(&#39;books/&#39;, views.BooksViewSet.as_view()),
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3、视图函数views
</span></span><span class="line"><span class="cl">from django.shortcuts import render, redirect, HttpResponse
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework.views import APIView
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer    # 导入序列化器
</span></span><span class="line"><span class="cl">from rest_framework.response import Response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookViewSet(APIView):
</span></span><span class="line"><span class="cl">	# 查看单个
</span></span><span class="line"><span class="cl">    def get(self,request,pk):
</span></span><span class="line"><span class="cl">        book = Book.objects.filter(pk=pk).first()
</span></span><span class="line"><span class="cl">        # 用一个类一定要实例化
</span></span><span class="line"><span class="cl">        # 要序列化谁，就将谁传进来
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(book) # 调用类的__init__方法
</span></span><span class="line"><span class="cl">        # 直接序列化对象.data就是序列化后的字典
</span></span><span class="line"><span class="cl">        return Response(book_ser.data)
</span></span><span class="line"><span class="cl">        # from django.http import JsonResponse
</span></span><span class="line"><span class="cl">        # return JsonResponse(book_ser.data)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	# 修改
</span></span><span class="line"><span class="cl">    def put(self,request,pk):
</span></span><span class="line"><span class="cl">        # 定义一个报错字典
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;:100,&#39;msg&#39;:&#39;成功&#39;}
</span></span><span class="line"><span class="cl">        # 找到这个对象
</span></span><span class="line"><span class="cl">        book = Book.objects.filter(pk=pk).first()
</span></span><span class="line"><span class="cl">        # 得到一个序列化类的对象
</span></span><span class="line"><span class="cl">        # 第一个参数传需要修改的对象，第二个传已修改的数据
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(book,request.data)
</span></span><span class="line"><span class="cl">        if book_ser.is_valid(): # 返回True表示验证通过
</span></span><span class="line"><span class="cl">            book_ser.save() # 直接调用报错   需要自己写updata方法
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            response_msg[&#39;status&#39;] = 101
</span></span><span class="line"><span class="cl">            response_msg[&#39;msg&#39;] = &#39;数据校验失败&#39;
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.errors
</span></span><span class="line"><span class="cl">        # 返回已经修改后的数据
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	# 删除
</span></span><span class="line"><span class="cl">    def delete(self,request,pk):
</span></span><span class="line"><span class="cl">        res = Book.objects.filter(pk=pk).delete()
</span></span><span class="line"><span class="cl">        return Response({&#39;status&#39;: 100, &#39;msg&#39;: &#39;删除成功&#39;})
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BooksViewSet(APIView):
</span></span><span class="line"><span class="cl">    # 查询所有
</span></span><span class="line"><span class="cl">    def get(self,request):
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        books = Book.objects.all()
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(books,many=True) # 序列化多条要加many=True,序列化一条则不用
</span></span><span class="line"><span class="cl">        response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 新增
</span></span><span class="line"><span class="cl">    def post(self,request):
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        # 修改才偶instance，新增没有instance,只有data
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(data=request.data)
</span></span><span class="line"><span class="cl">        # book_ser = BookSerializer(request.data) # 报错，第一个参数是instance
</span></span><span class="line"><span class="cl">        # 校验字段
</span></span><span class="line"><span class="cl">        if book_ser.is_valid():
</span></span><span class="line"><span class="cl">            book_ser.save()     # 需要重写create方法
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            response_msg[&#39;status&#39;] = 102
</span></span><span class="line"><span class="cl">            response_msg[&#39;msg&#39;] = &#39;数据校验失败&#39;
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.errors
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4、写序列化校验类
</span></span><span class="line"><span class="cl">from rest_framework import serializers
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 需要继承Serializer
</span></span><span class="line"><span class="cl">class BookSerializer(serializers.Serializer):
</span></span><span class="line"><span class="cl">    nid = serializers.CharField(read_only=True)
</span></span><span class="line"><span class="cl">    name = serializers.CharField(write_only=False)
</span></span><span class="line"><span class="cl">    price = serializers.CharField()
</span></span><span class="line"><span class="cl">    author = serializers.CharField(max_length=2)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 局部钩子
</span></span><span class="line"><span class="cl">    def validate_price(self, data):
</span></span><span class="line"><span class="cl">        # validate杠字段名，需要接收参数data
</span></span><span class="line"><span class="cl">        # 如果价格小于10，则校验不通过
</span></span><span class="line"><span class="cl">        # print(type(data))  # &lt;class &#39;str&#39;&gt;
</span></span><span class="line"><span class="cl">        # print(data) # 价格 price
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if float(data)&gt;10:
</span></span><span class="line"><span class="cl">            return data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            # 校验失败抛异常
</span></span><span class="line"><span class="cl">            from rest_framework.exceptions import ValidationError
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;价格太低，抬高价格&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 全局钩子
</span></span><span class="line"><span class="cl">    def validate(self, validate_data):
</span></span><span class="line"><span class="cl">        print(validate_data)
</span></span><span class="line"><span class="cl">        author = validate_data.get(&#39;author&#39;)
</span></span><span class="line"><span class="cl">        name = validate_data.get(&#39;name&#39;)
</span></span><span class="line"><span class="cl">        if author == name:
</span></span><span class="line"><span class="cl">            from rest_framework.exceptions import ValidationError
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;作者名和书名不能一致&#39;)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            return validate_data
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def update(self, instance, validated_data):
</span></span><span class="line"><span class="cl">        # instance是book这个对象
</span></span><span class="line"><span class="cl">        # validated_data是校验后的数据
</span></span><span class="line"><span class="cl">        instance.name = validated_data.get(&#39;name&#39;)
</span></span><span class="line"><span class="cl">        instance.price = validated_data.get(&#39;price&#39;)
</span></span><span class="line"><span class="cl">        instance.author = validated_data.get(&#39;author&#39;)
</span></span><span class="line"><span class="cl">        instance.save()  # book.save(),django的orm提供的
</span></span><span class="line"><span class="cl">        return instance
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def create(self, validated_data):
</span></span><span class="line"><span class="cl">        instance=Book.objects.create(**validated_data)
</span></span><span class="line"><span class="cl">        # Book.objects.create(name=validated_data.get(&#39;name&#39;))
</span></span><span class="line"><span class="cl">        return instance
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="42-基于genericapiview的五个接口">4.2 基于GenericAPIView的五个接口</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、ser.py序列化类：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework import serializers
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        model=Book
</span></span><span class="line"><span class="cl">        fields=&#39;__all__&#39;
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"># 2、views.py视图函数
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.shortcuts import render, redirect, HttpResponse
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework.views import APIView
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer  # 导入序列化器
</span></span><span class="line"><span class="cl">from rest_framework.response import Response
</span></span><span class="line"><span class="cl">from rest_framework.generics import GenericAPIView
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 基于GenericAPIView写的五个接口
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookViewSet(GenericAPIView):
</span></span><span class="line"><span class="cl">    queryset = Book.objects
</span></span><span class="line"><span class="cl">    # queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 查看单个
</span></span><span class="line"><span class="cl">    def get(self, request, pk):
</span></span><span class="line"><span class="cl">        book = self.get_object()
</span></span><span class="line"><span class="cl">        book_ser = self.get_serializer(book)
</span></span><span class="line"><span class="cl">        return Response(book_ser.data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 修改
</span></span><span class="line"><span class="cl">    def put(self, request, pk):
</span></span><span class="line"><span class="cl">        # 定义一个报错字典
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        # 找到这个对象
</span></span><span class="line"><span class="cl">        book = self.get_object()
</span></span><span class="line"><span class="cl">        # 得到一个序列化类的对象
</span></span><span class="line"><span class="cl">        # 第一个参数传需要修改的对象，第二个传已修改的数据
</span></span><span class="line"><span class="cl">        book_ser = self.get_serializer(book, request.data)
</span></span><span class="line"><span class="cl">        if book_ser.is_valid():  # 返回True表示验证通过
</span></span><span class="line"><span class="cl">            book_ser.save()  # 直接调用报错   需要自己写updata方法
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            response_msg[&#39;status&#39;] = 101
</span></span><span class="line"><span class="cl">            response_msg[&#39;msg&#39;] = &#39;数据校验失败&#39;
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.errors
</span></span><span class="line"><span class="cl">        # 返回已经修改后的数据
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 删除
</span></span><span class="line"><span class="cl">    def delete(self, request, pk):
</span></span><span class="line"><span class="cl">        res = self.get_object().delete()
</span></span><span class="line"><span class="cl">        return Response({&#39;status&#39;: 100, &#39;msg&#39;: &#39;删除成功&#39;})
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BooksViewSet(GenericAPIView):
</span></span><span class="line"><span class="cl">    queryset = Book.objects
</span></span><span class="line"><span class="cl">    # queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 查询所有
</span></span><span class="line"><span class="cl">    def get(self, request):
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        books = self.get_queryset()
</span></span><span class="line"><span class="cl">        book_ser = self.get_serializer(books, many=True)  # 序列化多条要加many=True,序列化一条则不用
</span></span><span class="line"><span class="cl">        response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 新增
</span></span><span class="line"><span class="cl">    def post(self, request):
</span></span><span class="line"><span class="cl">        response_msg = {&#39;status&#39;: 100, &#39;msg&#39;: &#39;成功&#39;}
</span></span><span class="line"><span class="cl">        # 修改才偶instance，新增没有instance,只有data
</span></span><span class="line"><span class="cl">        book_ser = self.get_serializer(data=request.data)
</span></span><span class="line"><span class="cl">        # book_ser = BookSerializer(request.data) # 报错，第一个参数是instance
</span></span><span class="line"><span class="cl">        # 校验字段
</span></span><span class="line"><span class="cl">        if book_ser.is_valid():
</span></span><span class="line"><span class="cl">            book_ser.save()  # 需要重写create方法
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.data
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            response_msg[&#39;status&#39;] = 102
</span></span><span class="line"><span class="cl">            response_msg[&#39;msg&#39;] = &#39;数据校验失败&#39;
</span></span><span class="line"><span class="cl">            response_msg[&#39;data&#39;] = book_ser.errors
</span></span><span class="line"><span class="cl">        return Response(response_msg)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"># 3、url.py路由
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import path,re_path
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?P&lt;pk&gt;\d+)&#39;, views.BookViewSet.as_view()),
</span></span><span class="line"><span class="cl">    # 为什么还要再新写一个新的函数，应为原来的里面已经有get函数了，所以要写新的类
</span></span><span class="line"><span class="cl">    re_path(&#39;books/&#39;, views.BooksViewSet.as_view()),
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="41--5个视图扩展类">4.1  5个视图扩展类</h4>
<h5 id="411-listmodelmixin">4.1.1 ListModelMixin</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">列表视图扩展类，提供list(request, *args, **kwargs)方法快速实现列表视图，返回200状态码。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">该Mixin的list方法会对数据进行过滤和分页。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">**源代码**
</span></span><span class="line"><span class="cl">class ListModelMixin(object):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    List a queryset.
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    def list(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        # 过滤
</span></span><span class="line"><span class="cl">        queryset = self.filter_queryset(self.get_queryset())
</span></span><span class="line"><span class="cl">        # 分页
</span></span><span class="line"><span class="cl">        page = self.paginate_queryset(queryset)
</span></span><span class="line"><span class="cl">        if page is not None:
</span></span><span class="line"><span class="cl">            serializer = self.get_serializer(page, many=True)
</span></span><span class="line"><span class="cl">            return self.get_paginated_response(serializer.data)
</span></span><span class="line"><span class="cl">        # 序列化
</span></span><span class="line"><span class="cl">        serializer = self.get_serializer(queryset, many=True)
</span></span><span class="line"><span class="cl">        return Response(serializer.data)
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>举例</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from rest_framework.mixins import ListModelMixin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookListView(ListModelMixin, GenericAPIView):
</span></span><span class="line"><span class="cl">    queryset = BookInfo.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookInfoSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def get(self, request):
</span></span><span class="line"><span class="cl">        return self.list(request)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="412-createmodelmixin">4.1.2 CreateModelMixin</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">创建视图扩展类，提供create(request, *args, **kwargs)方法快速实现创建资源的视图，成功返回201状态码。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">如果序列化器对前端发送的数据验证失败，返回400错误。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">源代码：
</span></span><span class="line"><span class="cl">class CreateModelMixin(object):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    Create a model instance.
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    def create(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        # 获取序列化器
</span></span><span class="line"><span class="cl">        serializer = self.get_serializer(data=request.data)
</span></span><span class="line"><span class="cl">        # 验证
</span></span><span class="line"><span class="cl">        serializer.is_valid(raise_exception=True)
</span></span><span class="line"><span class="cl">        # 保存
</span></span><span class="line"><span class="cl">        self.perform_create(serializer)
</span></span><span class="line"><span class="cl">        headers = self.get_success_headers(serializer.data)
</span></span><span class="line"><span class="cl">        return Response(serializer.data, status=status.HTTP_201_CREATED, headers=headers)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def perform_create(self, serializer):
</span></span><span class="line"><span class="cl">        serializer.save()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def get_success_headers(self, data):
</span></span><span class="line"><span class="cl">        try:
</span></span><span class="line"><span class="cl">            return {&#39;Location&#39;: str(data[api_settings.URL_FIELD_NAME])}
</span></span><span class="line"><span class="cl">        except (TypeError, KeyError):
</span></span><span class="line"><span class="cl">            return {}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="413-retrievemodelmixin">4.1.3 RetrieveModelMixin</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">详情视图扩展类，提供retrieve(request, *args, **kwargs)方法，可以快速实现返回一个存在的数据对象。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">如果存在，返回200， 否则返回404。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">源代码：
</span></span><span class="line"><span class="cl">class RetrieveModelMixin(object):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    Retrieve a model instance.
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    def retrieve(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        # 获取对象，会检查对象的权限
</span></span><span class="line"><span class="cl">        instance = self.get_object()
</span></span><span class="line"><span class="cl">        # 序列化
</span></span><span class="line"><span class="cl">        serializer = self.get_serializer(instance)
</span></span><span class="line"><span class="cl">        return Response(serializer.data)
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>举例</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">class BookDetailView(RetrieveModelMixin, GenericAPIView):
</span></span><span class="line"><span class="cl">    queryset = BookInfo.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookInfoSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def get(self, request, pk):
</span></span><span class="line"><span class="cl">        return self.retrieve(request)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="414-updatemodelmixin">4.1.4 UpdateModelMixin</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">更新视图扩展类，提供update(request, *args, **kwargs)方法，可以快速实现更新一个存在的数据对象。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">同时也提供partial_update(request, *args, **kwargs)方法，可以实现局部更新。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">成功返回200，序列化器校验数据失败时，返回400错误。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">源代码：
</span></span><span class="line"><span class="cl">class UpdateModelMixin(object):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    Update a model instance.
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    def update(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        partial = kwargs.pop(&#39;partial&#39;, False)
</span></span><span class="line"><span class="cl">        instance = self.get_object()
</span></span><span class="line"><span class="cl">        serializer = self.get_serializer(instance, data=request.data, partial=partial)
</span></span><span class="line"><span class="cl">        serializer.is_valid(raise_exception=True)
</span></span><span class="line"><span class="cl">        self.perform_update(serializer)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if getattr(instance, &#39;_prefetched_objects_cache&#39;, None):
</span></span><span class="line"><span class="cl">            # If &#39;prefetch_related&#39; has been applied to a queryset, we need to
</span></span><span class="line"><span class="cl">            # forcibly invalidate the prefetch cache on the instance.
</span></span><span class="line"><span class="cl">            instance._prefetched_objects_cache = {}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        return Response(serializer.data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def perform_update(self, serializer):
</span></span><span class="line"><span class="cl">        serializer.save()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def partial_update(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        kwargs[&#39;partial&#39;] = True
</span></span><span class="line"><span class="cl">        return self.update(request, *args, **kwargs)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="415-destroymodelmixin">4.1.5 DestroyModelMixin</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">删除视图扩展类，提供`destroy(request, *args, **kwargs)`方法，可以快速实现删除一个存在的数据对象。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">成功返回204，不存在返回404。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">源代码：
</span></span><span class="line"><span class="cl">class DestroyModelMixin(object):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    Destroy a model instance.
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    def destroy(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        instance = self.get_object()
</span></span><span class="line"><span class="cl">        self.perform_destroy(instance)
</span></span><span class="line"><span class="cl">        return Response(status=status.HTTP_204_NO_CONTENT)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def perform_destroy(self, instance):
</span></span><span class="line"><span class="cl">        instance.delete()
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="416-使用genericapiview和视图扩展类实现api接口">4.1.6 使用GenericAPIView和视图扩展类，实现api接口</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer  # 导入序列化器
</span></span><span class="line"><span class="cl">from rest_framework.generics import GenericAPIView
</span></span><span class="line"><span class="cl">from rest_framework.mixins import ListModelMixin, CreateModelMixin, UpdateModelMixin, DestroyModelMixin, RetrieveModelMixin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 基于GenericAPIView写的五个接口
</span></span><span class="line"><span class="cl">class BookViewSet(GenericAPIView, RetrieveModelMixin, DestroyModelMixin, UpdateModelMixin):
</span></span><span class="line"><span class="cl">    queryset = Book.objects
</span></span><span class="line"><span class="cl">    # queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 查看单个
</span></span><span class="line"><span class="cl">    def get(self, request, pk):
</span></span><span class="line"><span class="cl">        return self.retrieve(request,pk)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 修改
</span></span><span class="line"><span class="cl">    def put(self, request, pk):
</span></span><span class="line"><span class="cl">        return self.update(request, pk)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 删除
</span></span><span class="line"><span class="cl">    def delete(self, request, pk):
</span></span><span class="line"><span class="cl">        return self.destroy(request, pk)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BooksViewSet(GenericAPIView, ListModelMixin, CreateModelMixin):
</span></span><span class="line"><span class="cl">    queryset = Book.objects
</span></span><span class="line"><span class="cl">    # queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 查询所有
</span></span><span class="line"><span class="cl">    def get(self, request):
</span></span><span class="line"><span class="cl">        return self.list(request)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 新增
</span></span><span class="line"><span class="cl">    def post(self, request):
</span></span><span class="line"><span class="cl">        return self.create(request)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="43-genericapiview的视图子类">4.3 GenericAPIView的视图子类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1）CreateAPIView
</span></span><span class="line"><span class="cl">提供 post 方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">继承自： GenericAPIView、CreateModelMixin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2）ListAPIView
</span></span><span class="line"><span class="cl">提供 get 方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">继承自：GenericAPIView、ListModelMixin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3）RetrieveAPIView
</span></span><span class="line"><span class="cl">提供 get 方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">继承自: GenericAPIView、RetrieveModelMixin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4）DestoryAPIView
</span></span><span class="line"><span class="cl">提供 delete 方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">继承自：GenericAPIView、DestoryModelMixin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5）UpdateAPIView
</span></span><span class="line"><span class="cl">提供 put 和 patch 方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">继承自：GenericAPIView、UpdateModelMixin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6）RetrieveUpdateAPIView
</span></span><span class="line"><span class="cl">提供 get、put、patch方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">继承自： GenericAPIView、RetrieveModelMixin、UpdateModelMixin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">7）RetrieveUpdateDestoryAPIView
</span></span><span class="line"><span class="cl">提供 get、put、patch、delete方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin、DestoryModelMixin
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="431-使用子类实现五个接口">4.3.1 使用子类实现五个接口</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># ser.py
</span></span><span class="line"><span class="cl">from rest_framework import serializers
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        model=Book
</span></span><span class="line"><span class="cl">        fields=&#39;__all__&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># views.py
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer  # 导入序列化器
</span></span><span class="line"><span class="cl">from rest_framework.generics import CreateAPIView,ListAPIView,UpdateAPIView,RetrieveAPIView,DestroyAPIView
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 更新，查询一个，删除
</span></span><span class="line"><span class="cl">class BookViewSet(UpdateAPIView, RetrieveAPIView, DestroyAPIView):
</span></span><span class="line"><span class="cl">    queryset = Book.objects
</span></span><span class="line"><span class="cl">    # queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 获取所有，新增一个
</span></span><span class="line"><span class="cl">class BooksViewSet(ListAPIView, CreateAPIView):
</span></span><span class="line"><span class="cl">    queryset = Book.objects
</span></span><span class="line"><span class="cl">    # queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># urls.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import path,re_path
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?P&lt;pk&gt;\d+)&#39;, views.BookViewSet.as_view()),
</span></span><span class="line"><span class="cl">    # 为什么还要再新写一个新的函数，应为原来的里面已经有get函数了，所以要写新的类
</span></span><span class="line"><span class="cl">    re_path(&#39;books/&#39;, views.BooksViewSet.as_view()),
</span></span><span class="line"><span class="cl">]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="44-常用视图集父类">4.4 常用视图集父类</h4>
<h5 id="441-基于modelviewset实现五个接口">4.4.1 基于ModelViewSet实现五个接口</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、urls.py路由
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import path,re_path
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps：视图哪里的有名分组名字必须为pk，如果想要换成别的则在对应的视图类中加上lookup_url_kwarg=&#39;想要换的名称&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?P&lt;pk&gt;\d+)&#39;, views.BooksViewSet.as_view(actions={&#39;get&#39;:&#39;retrieve&#39;, &#39;put&#39;:&#39;update&#39;, &#39;delete&#39;:&#39;destroy&#39;})),
</span></span><span class="line"><span class="cl">    # 为什么还要再新写一个新的函数，应为原来的里面已经有get函数了，所以要写新的类
</span></span><span class="line"><span class="cl">    re_path(&#39;books/&#39;, views.BooksViewSet.as_view(actions={&#39;get&#39;:&#39;list&#39;, &#39;post&#39;:&#39;create&#39;})),
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、views.py 视图函数
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer  # 导入序列化器
</span></span><span class="line"><span class="cl">from rest_framework.viewsets import ModelViewSet
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 5个接口都有，但是路由有点问题
</span></span><span class="line"><span class="cl">class BooksViewSet(ModelViewSet):
</span></span><span class="line"><span class="cl">    queryset = Book.objects
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 3、序列化类ser.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework import serializers
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        model=Book
</span></span><span class="line"><span class="cl">        fields=&#39;__all__&#39;
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="442-源码分析viewsetmixin">4.4.2 源码分析ViewSetMixin</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 重写了as_view
</span></span><span class="line"><span class="cl"># 核心代码(所以路由中只要配置了对应关系,比如(&#39;get&#39;:&#39;list&#39;)),当get请求来，就会执行list方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">for method, action in actions.items():
</span></span><span class="line"><span class="cl">	# method:get
</span></span><span class="line"><span class="cl">	# action:list
</span></span><span class="line"><span class="cl">	handler = getattr(self, action)
</span></span><span class="line"><span class="cl">	# 执行完上一句，handler就变成了list的内存地址
</span></span><span class="line"><span class="cl">	setattr(self, method, handler)
</span></span><span class="line"><span class="cl">	# 执行完上一句，对象.get=list
</span></span><span class="line"><span class="cl">	# for循环完毕 对象.get:对应list，对象.post：对应create
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="443-继承viewsetmixin的视图类">4.4.3 继承ViewSetMixin的视图类</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、urls.py路由
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import path,re_path
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    re_path(&#39;books/&#39;, views.BooksViewSet.as_view(actions={&#39;get&#39;:&#39;get_all_book&#39;})),
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、views.py视图函数
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer  # 导入序列化器
</span></span><span class="line"><span class="cl">from rest_framework.viewsets import ViewSetMixin
</span></span><span class="line"><span class="cl">from rest_framework.views import APIView
</span></span><span class="line"><span class="cl">from rest_framework.response import Response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># PS:一定要放在APIView前面
</span></span><span class="line"><span class="cl"># 该方法的精妙之处在于类里面的函数名可以随意取，只需要在路由里面配置好actions参数
</span></span><span class="line"><span class="cl"># re_path(&#39;books/&#39;, views.BooksViewSet.as_view(actions={&#39;get&#39;:&#39;get_all_book&#39;})),
</span></span><span class="line"><span class="cl">class BooksViewSet(ViewSetMixin,APIView):
</span></span><span class="line"><span class="cl">    def get_all_book(self,request):
</span></span><span class="line"><span class="cl">        book_list = Book.objects.all()
</span></span><span class="line"><span class="cl">        book_ser = BookSerializer(book_list, many=True)
</span></span><span class="line"><span class="cl">        return Response(book_ser.data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、序列化类
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework import serializers
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        model=Book
</span></span><span class="line"><span class="cl">        fields=&#39;__all__&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5路由">5、路由</h3>
<h4 id="51-路由">5.1 路由</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、在urls.py中配置
</span></span><span class="line"><span class="cl">	path(&#39;books/&#39;, views.BookView.as_view())
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?&lt;pk&gt;\d+)&#39;, views.BookDetailView.as_view() ),
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"># 2、一旦视图类继承了ViewSetMixin，路由
</span></span><span class="line"><span class="cl">    path(&#39;books/&#39;, views.BookView.as_view(actions={&#39;get&#39;:&#39;list&#39;,&#39;post&#39;:&#39;create&#39;})),
</span></span><span class="line"><span class="cl">    # 当路径匹配，优势get请求，则会执行对应actions里面对应的函数
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?&lt;pk&gt;\d+)&#39;, views.BooksViewSet.as_view(actions={&#39;get&#39;:&#39;retrieve&#39;})),
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、继承自视图类，ModelViewSet的路由写法
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?P&lt;pk&gt;\d+)&#39;, views.BooksViewSet.as_view(actions={&#39;get&#39;:&#39;retrieve&#39;, &#39;put&#39;:&#39;update&#39;, &#39;delete&#39;:&#39;destroy&#39;})),
</span></span><span class="line"><span class="cl">    # 为什么还要再新写一个新的函数，应为原来的里面已经有get函数了，所以要写新的类
</span></span><span class="line"><span class="cl">    re_path(&#39;books/&#39;, views.BooksViewSet.as_view(actions={&#39;get&#39;:&#39;list&#39;, &#39;post&#39;:&#39;create&#39;})),
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 4、继承视图类ModelViewSet的自动添加路由
</span></span><span class="line"><span class="cl">-urls.py
</span></span><span class="line"><span class="cl">    from django.contrib import admin
</span></span><span class="line"><span class="cl">    from django.urls import path,re_path
</span></span><span class="line"><span class="cl">    from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 第一步：导入routers模块
</span></span><span class="line"><span class="cl">    from rest_framework import routers
</span></span><span class="line"><span class="cl">    # 第二步：有两个类，实例化得到对象
</span></span><span class="line"><span class="cl">    # route = routers.DefaultRouter() 生成更多其他的路由
</span></span><span class="line"><span class="cl">    router = routers.SimpleRouter()
</span></span><span class="line"><span class="cl">    # 第三步：注册
</span></span><span class="line"><span class="cl">    # router.register(&#39;前缀&#39;,&#39;继承自ModelViewSet视图类&#39;)
</span></span><span class="line"><span class="cl">    router.register(&#39;books&#39;,views.BooksViewSet)
</span></span><span class="line"><span class="cl">    # 第四步，自动生成路由,然后将生成的路由和urlpatterns相结合
</span></span><span class="line"><span class="cl">    print(router.urls)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    urlpatterns = [
</span></span><span class="line"><span class="cl">        path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    ]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    urlpatterns += router.urls
</span></span><span class="line"><span class="cl">    print(urlpatterns)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">-views.py
</span></span><span class="line"><span class="cl">    from app01.models import Book
</span></span><span class="line"><span class="cl">    from app01.ser import BookSerializer  # 导入序列化器
</span></span><span class="line"><span class="cl">    from rest_framework.viewsets import ModelViewSet
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 5个接口都有，但是路由有点问题
</span></span><span class="line"><span class="cl">    class BooksViewSet(ModelViewSet):
</span></span><span class="line"><span class="cl">        queryset = Book.objects
</span></span><span class="line"><span class="cl">        serializer_class = BookSerializer
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="52-action的使用">5.2 action的使用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># action干什么用？ 为了给继承自ModelViewSet的视图类中的函数也添加路由
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">使用：
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer  # 导入序列化器
</span></span><span class="line"><span class="cl">from rest_framework.viewsets import ModelViewSet
</span></span><span class="line"><span class="cl">from rest_framework.response import Response
</span></span><span class="line"><span class="cl">from rest_framework.decorators import action  # 装饰器
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 5个接口都有，但是路由有点问题
</span></span><span class="line"><span class="cl">class BooksViewSet(ModelViewSet):
</span></span><span class="line"><span class="cl">    queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # methods第一个参数，传一个列表，列表中放请求方式
</span></span><span class="line"><span class="cl">    # books/get_1/$ [name=&#39;book-get-1&#39;] 当向这个地址发送get请求会执行下面函数
</span></span><span class="line"><span class="cl">    # detail布尔类型，如果是True，生成^books/(?P&lt;pk&gt;[^/.]+)/get_1/$ [name=&#39;book-get-1&#39;]
</span></span><span class="line"><span class="cl">    # detail为True会生成一个带有pk的地址，然后函数中还要加上pk
</span></span><span class="line"><span class="cl">    # ps:可以在里面加post或者get，然后在函数中判断请求类型进行进一步处理
</span></span><span class="line"><span class="cl">    @action(methods=[&#39;GET&#39;], detail=True)
</span></span><span class="line"><span class="cl">    def get_1(self, request,pk):
</span></span><span class="line"><span class="cl">        book = self.get_queryset()[:2]  # 从0开始获取一条
</span></span><span class="line"><span class="cl">        ser = self.get_serializer(book, many=True)  # 虽然只是一条，但还是个列表，苏哦一many=True
</span></span><span class="line"><span class="cl">        return Response(ser.data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps：action是一个装饰器，methods存放请求方式，detail决定是否带pk
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6认证">6、认证</h3>
<h4 id="61-认证组件的使用">6.1 认证组件的使用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">认证组件可以判断用户是否登录
</span></span><span class="line"><span class="cl">认证的实现：
</span></span><span class="line"><span class="cl">	1、写一个类，继承BaseAuthentication，重写authenticate，
</span></span><span class="line"><span class="cl">		认证的逻辑卸载里面，认证通过，返回两个值，一个值最终给了Request对象的user，第二个是token
</span></span><span class="line"><span class="cl">		认证失败，抛异常：APIException或者AuthenticationFailed
</span></span><span class="line"><span class="cl">	2、全局使用局部使用
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="611-myauthenticationpy">6.1.1 MyAuthentication.py</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from rest_framework.authentication import BaseAuthentication
</span></span><span class="line"><span class="cl">from rest_framework.exceptions import AuthenticationFailed
</span></span><span class="line"><span class="cl">from app01.models import UserToken
</span></span><span class="line"><span class="cl">class MyAuthentication(BaseAuthentication):
</span></span><span class="line"><span class="cl">    def authenticate(self, request):
</span></span><span class="line"><span class="cl">        # 认证逻辑，如果认证通过，返回两个值
</span></span><span class="line"><span class="cl">        # 如果认证失败，抛出AuthenticationFailed异常
</span></span><span class="line"><span class="cl">        token=request.GET.get(&#39;token&#39;)
</span></span><span class="line"><span class="cl">        if token:
</span></span><span class="line"><span class="cl">            user_token=UserToken.objects.filter(token=token).first()
</span></span><span class="line"><span class="cl">            if user_token:
</span></span><span class="line"><span class="cl">                # 认证通过
</span></span><span class="line"><span class="cl">                return user_token.user, token
</span></span><span class="line"><span class="cl">            else:
</span></span><span class="line"><span class="cl">                raise AuthenticationFailed(&#39;认证失败&#39;)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            raise AuthenticationFailed(&#39;请求地址中需要带有token&#39;)
</span></span><span class="line"><span class="cl">            
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="612-全局使用">6.1.2 全局使用</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 可以有多个认证，从左往右依次执行
</span></span><span class="line"><span class="cl"># 在setting.py中配置
</span></span><span class="line"><span class="cl">REST_FRAMEWORK={
</span></span><span class="line"><span class="cl">	&#34;DEFAULT_AUTHENTICATION_CLASSES&#34;:[&#34;app01.app_auth.MyAuthentication&#34;,]
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="613-局部使用">6.1.3 局部使用</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 在视图类中写
</span></span><span class="line"><span class="cl">authentication_classes = [MyAuthentication]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 局部禁用
</span></span><span class="line"><span class="cl">authentication_classes = []
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="62-认证源码分析">6.2 认证源码分析</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1 APIVIew----》dispatch方法---》self.initial(request，*ar gs，**kwar gs)----&gt;有认证，权限，频率
</span></span><span class="line"><span class="cl"># 2 只读认证源码:self.perform_authentication(request)
</span></span><span class="line"><span class="cl"># 3 self.perform_authentication(request)就一句话:request.user，需要去drf的Request对象中找user属性(方法)
</span></span><span class="line"><span class="cl"># 4 Request类中的user方法，刚开始来，没有_user ,走 self._authenticate()
</span></span><span class="line"><span class="cl"># 5 核心，就是Request类的_authenticate(se1f):
</span></span><span class="line"><span class="cl">    def _authenticate(self):
</span></span><span class="line"><span class="cl">        #遍历拿到一个个认证器,进行认证
</span></span><span class="line"><span class="cl">        # self.authenticators配置的一堆认证类产生的认证类对象组成的list
</span></span><span class="line"><span class="cl">        # self.authenticators你在视图类中配置的一个个的认证类: authentication_classes=[认证类1，
</span></span><span class="line"><span class="cl">        认证类2]，对象的列表
</span></span><span class="line"><span class="cl">        for authenticator in self.authenticators :
</span></span><span class="line"><span class="cl">        	try:
</span></span><span class="line"><span class="cl">                #认证器(对象)调用认证方法authenticate(认证类对象self，request请求对象)
</span></span><span class="line"><span class="cl">                #返回值:登陆的用户与认证的信息组成的tuple
</span></span><span class="line"><span class="cl">                #该方法被try包裹,代表该方法会抛异常，抛异常就代表认证失败
</span></span><span class="line"><span class="cl">                user_auth_tuple = authenticator.authenticate(sef)
</span></span><span class="line"><span class="cl">            except exceptions.APIException:
</span></span><span class="line"><span class="cl">                self._not_authenticated()
</span></span><span class="line"><span class="cl">                raise
</span></span><span class="line"><span class="cl">                #返回值的处理
</span></span><span class="line"><span class="cl">            if user_auth_tuple is not None :
</span></span><span class="line"><span class="cl">            	se1f._authenticator = authenticator
</span></span><span class="line"><span class="cl">        		#如何有返回值，就将登陆用户与登陆认证分别保存到request.user、request.auth
</span></span><span class="line"><span class="cl">        		self.user , se1f.auth = user_auth_tuple
</span></span><span class="line"><span class="cl">        		return
</span></span><span class="line"><span class="cl">        # 如果返回值user _auth_tuple为空，代表认证通过，但是没有登陆用户与登陆认证信息，代表游客				self._not_authenticated()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="63-使用认证组件实现用户登录">6.3 使用认证组件实现用户登录</h4>
<h5 id="631-urlpy">6.3.1 url.py</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import path,re_path
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 第一步：导入routers模块
</span></span><span class="line"><span class="cl">from rest_framework import routers
</span></span><span class="line"><span class="cl"># 第二步：有两个类，实例化得到对象
</span></span><span class="line"><span class="cl"># route = routers.DefaultRouter() 生成更多其他的路由
</span></span><span class="line"><span class="cl">router = routers.SimpleRouter()
</span></span><span class="line"><span class="cl"># 第三步：注册
</span></span><span class="line"><span class="cl"># router.register(&#39;前缀&#39;,&#39;继承自ModelViewSet视图类&#39;)
</span></span><span class="line"><span class="cl">router.register(&#39;books&#39;,views.BooksViewSet)
</span></span><span class="line"><span class="cl"># 第四步，自动生成路由,然后将生成的路由和urlpatterns相结合
</span></span><span class="line"><span class="cl"># print(router.urls)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    re_path(&#39;login/&#39;, views.LoginView.as_view()),
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns += router.urls
</span></span><span class="line"><span class="cl"># print(urlpatterns)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="632-viewspy">6.3.2 views.py</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer  # 导入序列化器
</span></span><span class="line"><span class="cl">from rest_framework.viewsets import ModelViewSet
</span></span><span class="line"><span class="cl">from rest_framework.response import Response
</span></span><span class="line"><span class="cl">from rest_framework.decorators import action  # 装饰器
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from app01.app_auth import MyAuthentication
</span></span><span class="line"><span class="cl">class BooksViewSet(ModelViewSet):
</span></span><span class="line"><span class="cl">    authentication_classes = [MyAuthentication]
</span></span><span class="line"><span class="cl">    queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # methods第一个参数，传一个列表，列表中放请求方式
</span></span><span class="line"><span class="cl">    # books/get_1/$ [name=&#39;book-get-1&#39;] 当向这个地址发送get请求会执行下面函数
</span></span><span class="line"><span class="cl">    # detail布尔类型，如果是True，生成^books/(?P&lt;pk&gt;[^/.]+)/get_1/$ [name=&#39;book-get-1&#39;]
</span></span><span class="line"><span class="cl">    # detail为True会生成一个带有pk的地址，然后函数中还要加上pk
</span></span><span class="line"><span class="cl">    # ps:可以在里面加post或者get，然后在函数中判断请求类型进行进一步处理
</span></span><span class="line"><span class="cl">    @action(methods=[&#39;GET&#39;], detail=True)
</span></span><span class="line"><span class="cl">    def get_1(self, request,pk):
</span></span><span class="line"><span class="cl">        book = self.get_queryset()[:2]  # 从0开始获取一条
</span></span><span class="line"><span class="cl">        ser = self.get_serializer(book, many=True)  # 虽然只是一条，但还是个列表，苏哦一many=True
</span></span><span class="line"><span class="cl">        return Response(ser.data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework.views import APIView
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl">from rest_framework.response import Response
</span></span><span class="line"><span class="cl">import uuid
</span></span><span class="line"><span class="cl">class LoginView(APIView):
</span></span><span class="line"><span class="cl">    def post(self,request):
</span></span><span class="line"><span class="cl">        username = request.data.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">        password = request.data.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        user = models.User.objects.filter(username=username,password=password).first()
</span></span><span class="line"><span class="cl">        if user:
</span></span><span class="line"><span class="cl">            # 登录成功,生成一个随机字符串
</span></span><span class="line"><span class="cl">            token = uuid.uuid4() # uuid4生成随机字符串
</span></span><span class="line"><span class="cl">            # 存到UserToken表中
</span></span><span class="line"><span class="cl">            # models.UserToken.objects.create(token=token,user=user) # 缺陷，每次登录都会记录一条数据
</span></span><span class="line"><span class="cl">            # 如果有记录则更新token
</span></span><span class="line"><span class="cl">            models.UserToken.objects.update_or_create(defaults={&#39;token&#39;:token},user=user)
</span></span><span class="line"><span class="cl">            # update_or_create会根据token去查user，有则更新，无则创建
</span></span><span class="line"><span class="cl">            return Response({&#39;status&#39;:100,&#39;msg&#39;:&#39;登录成功&#39;,&#39;token&#39;:token})
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            return Response({&#39;status&#39;:101,&#39;msg&#39;:&#39;用户名或密码错误&#39;})
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="633-modelspy">6.3.3 models.py</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from django.db import models
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Book(models.Model):
</span></span><span class="line"><span class="cl">    # nid = models.AutoField(primary_key=True)
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    price = models.DecimalField(max_digits=5, decimal_places=2)
</span></span><span class="line"><span class="cl">    # author = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    publish = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class User(models.Model):
</span></span><span class="line"><span class="cl">    username = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    password = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    user_type = models.IntegerField(choices=((1,&#39;超级用户&#39;),(2,&#39;普通用户&#39;),(3,&#39;二笔用户&#39;)))
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class UserToken(models.Model):
</span></span><span class="line"><span class="cl">    # 如果用户拿着token来，我们就通过token查询对应的用户，如果存在则登录成功
</span></span><span class="line"><span class="cl">    token = models.CharField(max_length=64)
</span></span><span class="line"><span class="cl">    user = models.OneToOneField(to=User,on_delete=models.CASCADE)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="634-app_authpy">6.3.4 app_auth.py</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from rest_framework.authentication import BaseAuthentication
</span></span><span class="line"><span class="cl">from rest_framework.exceptions import AuthenticationFailed
</span></span><span class="line"><span class="cl">from app01.models import UserToken
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyAuthentication(BaseAuthentication):
</span></span><span class="line"><span class="cl">    def authenticate(self, request):
</span></span><span class="line"><span class="cl">        # 认证逻辑，如果认证通过，返回两个值
</span></span><span class="line"><span class="cl">        # 如果认证失败，抛出AuthenticationFailed异常
</span></span><span class="line"><span class="cl">        token=request.GET.get(&#39;token&#39;)
</span></span><span class="line"><span class="cl">        if token:
</span></span><span class="line"><span class="cl">            user_token=UserToken.objects.filter(token=token).first()
</span></span><span class="line"><span class="cl">            if user_token:
</span></span><span class="line"><span class="cl">                # 认证通过
</span></span><span class="line"><span class="cl">                return user_token.user, token
</span></span><span class="line"><span class="cl">            else:
</span></span><span class="line"><span class="cl">                raise AuthenticationFailed(&#39;认证失败&#39;)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            raise AuthenticationFailed(&#39;请求地址中需要带有token&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7权限">7、权限</h3>
<h4 id="71-权限使用">7.1 权限使用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-app_auth.py:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 写一个类，继承BasePermission
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework.permissions import BasePermission
</span></span><span class="line"><span class="cl">class UserPermission(BasePermission):
</span></span><span class="line"><span class="cl">    def has_permission(self, request, view):
</span></span><span class="line"><span class="cl">        # 不是超级用户，不能访问
</span></span><span class="line"><span class="cl">        # 由于认证已经过了，request内就有user(当前登录用户)对象了
</span></span><span class="line"><span class="cl">        user = request.user     # 当前登录用户
</span></span><span class="line"><span class="cl">        # print(user.get_user_type_display())
</span></span><span class="line"><span class="cl">        # 如果该字段用了choice，可以通过上面的查看数字对应的中文
</span></span><span class="line"><span class="cl">        if user.user_type == 1:
</span></span><span class="line"><span class="cl">            return True
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            return False
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">局部使用：          
</span></span><span class="line"><span class="cl">-views.py:
</span></span><span class="line"><span class="cl">from app01 import app_auth
</span></span><span class="line"><span class="cl">class TestView(APIView):
</span></span><span class="line"><span class="cl">    authentication_classes = [app_auth.MyAuthentication]
</span></span><span class="line"><span class="cl">    permission_classes = [app_auth.UserPermission]
</span></span><span class="line"><span class="cl">    def get(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        return Response(&#39;只有超级管理员才能访问&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class TestView2(APIView):
</span></span><span class="line"><span class="cl">    authentication_classes = [app_auth.MyAuthentication]
</span></span><span class="line"><span class="cl">    def get(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        return Response(&#39;所有登录用户都可以访问&#39;)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">全局使用：
</span></span><span class="line"><span class="cl">-settings.py:
</span></span><span class="line"><span class="cl">REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">    &#34;DEFAULT_AUTHENTICATION_CLASSES&#34;: [&#34;app01.app_auth.MyAuthentication&#34;, ],
</span></span><span class="line"><span class="cl">    &#34;DEFAULT_PERMISSION_CLASSES&#34;:[&#34;app01.app_auth.UserPermission&#34;,],
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps:权限要配合认证一起使用，在全局使用的时候，局部可以禁用
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="72-内置权限">7.2 内置权限</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 演示以下内置权限的使用: IsAdminUser
</span></span><span class="line"><span class="cl"># 1、创建超级管理员 python manage.py createsuperus
</span></span><span class="line"><span class="cl"># 2、写一个测试视图类
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework.authentication import SessionAuthentication
</span></span><span class="line"><span class="cl">from rest_framework.permissions import IsAdminUser
</span></span><span class="line"><span class="cl">class TestView3(APIView):
</span></span><span class="line"><span class="cl">    # 这两个地方都得用系统自带的权限和认证
</span></span><span class="line"><span class="cl">    authentication_classes = [SessionAuthentication]
</span></span><span class="line"><span class="cl">    permission_classes = [IsAdminUser]
</span></span><span class="line"><span class="cl">    def get(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        return Response(&#39;内置超级管理员可以看&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、超级用户登录到admin就有权限访问
</span></span><span class="line"><span class="cl">ps ：如果创建一个普通用户，发现也有权限，可以取数据库里将用户is_staff置0
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="73-rabcdjango内置auth体系">7.3 RABC(django内置auth体系)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># RABC:基于角色的访问控制，公司内部系统偏多
</span></span><span class="line"><span class="cl"># django的auth内置了一淘基于RBAC的权限系统
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># django中
</span></span><span class="line"><span class="cl">	# 后台权限控制(公司内部系统，crm，erp，协同平台)
</span></span><span class="line"><span class="cl">        user表
</span></span><span class="line"><span class="cl">        permssion表
</span></span><span class="line"><span class="cl">        group表
</span></span><span class="line"><span class="cl">        user_groups表是user和group的中间表
</span></span><span class="line"><span class="cl">        group_permissions表是group和permssion的中间表
</span></span><span class="line"><span class="cl">        user_user_permissions表是user和permssion中间表
</span></span><span class="line"><span class="cl">	# 前台(主站),需要用三大认证
</span></span><span class="line"><span class="cl">		认证
</span></span><span class="line"><span class="cl">		权限
</span></span><span class="line"><span class="cl">		限流
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 我们可以基于django的这六张表来做对应的功能
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="8限流throttling">8、限流Throttling</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">可以对接口访问的频次进行限制，以减轻服务器压力。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">一般用于付费购买次数,投票等场景使用.
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="80-自定义频率类">8.0 自定义频率类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 自定义的逻辑
</span></span><span class="line"><span class="cl">#（1）取出访问者ip
</span></span><span class="line"><span class="cl">#（2）判断当前ip不在访问字典里，添加进去，并且直接返回True,表示第一次访问，在字典里，继续往下走
</span></span><span class="line"><span class="cl">#（3）循环判断当前ip的列表，有值，并且当前时间减去列表的最后一个时间大于60s，把这种数据pop掉，这样列表中只有60s以内的访问时间，
</span></span><span class="line"><span class="cl">#（4）判断，当列表小于3，说明一分钟以内访问不足三次，把当前时间插入到列表第一个位置，返回True，顺利通过
</span></span><span class="line"><span class="cl">#（5）当大于等于3，说明一分钟内访问超过三次，返回False验证失败
</span></span><span class="line"><span class="cl">class MyThrottles():
</span></span><span class="line"><span class="cl">    VISIT_RECORD = {}
</span></span><span class="line"><span class="cl">    def __init__(self):
</span></span><span class="line"><span class="cl">        self.history=None
</span></span><span class="line"><span class="cl">    def allow_request(self,request, view):
</span></span><span class="line"><span class="cl">        #（1）取出访问者ip
</span></span><span class="line"><span class="cl">        # print(request.META)
</span></span><span class="line"><span class="cl">        ip=request.META.get(&#39;REMOTE_ADDR&#39;)
</span></span><span class="line"><span class="cl">        import time
</span></span><span class="line"><span class="cl">        ctime=time.time()
</span></span><span class="line"><span class="cl">        # （2）判断当前ip不在访问字典里，添加进去，并且直接返回True,表示第一次访问
</span></span><span class="line"><span class="cl">        if ip not in self.VISIT_RECORD:
</span></span><span class="line"><span class="cl">            self.VISIT_RECORD[ip]=[ctime,]
</span></span><span class="line"><span class="cl">            return True
</span></span><span class="line"><span class="cl">        self.history=self.VISIT_RECORD.get(ip)
</span></span><span class="line"><span class="cl">        # （3）循环判断当前ip的列表，有值，并且当前时间减去列表的最后一个时间大于60s，把这种数据pop掉，这样列表中只有60s以内的访问时间，
</span></span><span class="line"><span class="cl">        while self.history and ctime-self.history[-1]&gt;60:
</span></span><span class="line"><span class="cl">            self.history.pop()
</span></span><span class="line"><span class="cl">        # （4）判断，当列表小于3，说明一分钟以内访问不足三次，把当前时间插入到列表第一个位置，返回True，顺利通过
</span></span><span class="line"><span class="cl">        # （5）当大于等于3，说明一分钟内访问超过三次，返回False验证失败
</span></span><span class="line"><span class="cl">        if len(self.history)&lt;3:
</span></span><span class="line"><span class="cl">            self.history.insert(0,ctime)
</span></span><span class="line"><span class="cl">            return True
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            return False
</span></span><span class="line"><span class="cl">    def wait(self):
</span></span><span class="line"><span class="cl">        import time
</span></span><span class="line"><span class="cl">        ctime=time.time()
</span></span><span class="line"><span class="cl">        return 60-(ctime-self.history[-1])
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">全局使用
</span></span><span class="line"><span class="cl">REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">    &#39;DEFAULT_THROTTLE_CLASSES&#39;:[&#39;app01.utils.MyThrottles&#39;,],
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">局部使用
</span></span><span class="line"><span class="cl">#在视图类里使用
</span></span><span class="line"><span class="cl">throttle_classes = [MyThrottles,]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="81-内置频率限制">8.1 内置频率限制</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 可以结合使用，如下，未登录用户每分钟五次，登录用户每分钟10次   
</span></span><span class="line"><span class="cl">   &#39;DEFAULT_THROTTLE_CLASSES&#39;: [
</span></span><span class="line"><span class="cl">        &#39;rest_framework.throttling.UserRateThrottle&#39;,
</span></span><span class="line"><span class="cl">        &#39;rest_framework.throttling.AnonRateThrottle&#39;,
</span></span><span class="line"><span class="cl">    ],
</span></span><span class="line"><span class="cl">    &#39;DEFAULT_THROTTLE_RATES&#39;: {
</span></span><span class="line"><span class="cl">        &#39;user&#39;: &#39;10/m&#39;,
</span></span><span class="line"><span class="cl">        &#39;anon&#39;: &#39;5/m&#39;,
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="82-限制未登录用户">8.2 限制未登录用户</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;DEFAULT_THROTTLE_CLASSES&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;rest_framework.throttling.AnonRateThrottle&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;DEFAULT_THROTTLE_RATES&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;anon&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;5/m&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1"># 使用 `second`, `minute`, `hour` 或`day`来指明周期。
</span></span></span><span class="line"><span class="cl"><span class="c1"># 可以全局使用，局部使用
</span></span></span><span class="line"><span class="cl"><span class="c1"># 局部使用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1"># views.py:
</span></span></span><span class="line"><span class="cl"><span class="c1"># 全局限制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">class</span><span class="w"> </span><span class="nf">TestView3</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">authentication_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">permission_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nf">Response</span><span class="p">(</span><span class="s1">&#39;未登录用户访问频率&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1"># 局部限制	需要将settings里面的&#39;rest_framework.throttling.AnonRateThrottle&#39; 注释
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">from</span><span class="w"> </span><span class="n">rest_framework</span><span class="p">.</span><span class="n">throttling</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">AnonRateThrottle</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">class</span><span class="w"> </span><span class="nf">TestView4</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">authentication_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">permission_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">throttle_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">AnonRateThrottle</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nf">Response</span><span class="p">(</span><span class="s1">&#39;未登录用户访问频率&#39;</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="83-限制登陆用户">8.3 限制登陆用户</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">    &#39;DEFAULT_THROTTLE_CLASSES&#39;: [
</span></span><span class="line"><span class="cl">        &#39;rest_framework.throttling.UserRateThrottle&#39;
</span></span><span class="line"><span class="cl">    ],
</span></span><span class="line"><span class="cl">    &#39;DEFAULT_THROTTLE_RATES&#39;: {
</span></span><span class="line"><span class="cl">        &#39;user&#39;: &#39;5/m&#39;,
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 可以全局使用，局部使用
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># views.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework.authentication import SessionAuthentication
</span></span><span class="line"><span class="cl">from rest_framework.permissions import IsAdminUser
</span></span><span class="line"><span class="cl">class TestView5(APIView):
</span></span><span class="line"><span class="cl">    # 这两个地方都得用系统自带的权限和认证
</span></span><span class="line"><span class="cl">    authentication_classes = [SessionAuthentication]
</span></span><span class="line"><span class="cl">    permission_classes = [IsAdminUser]
</span></span><span class="line"><span class="cl">    def get(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        return Response(&#39;登录频率限制&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="84-根据ip限制用户">8.4 根据ip限制用户</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#写一个类，继承自SimpleRateThrottle，重写get_cache_key方法（根据ip限制）
</span></span><span class="line"><span class="cl">from rest_framework.throttling import SimpleRateThrottle
</span></span><span class="line"><span class="cl">class VisitThrottle(SimpleRateThrottle):
</span></span><span class="line"><span class="cl">    scope = &#39;luffy&#39;
</span></span><span class="line"><span class="cl">    def get_cache_key(self, request, view):
</span></span><span class="line"><span class="cl">        return self.get_ident(request)
</span></span><span class="line"><span class="cl">#在setting里配置：（一分钟访问三次）
</span></span><span class="line"><span class="cl">REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">    &#39;DEFAULT_THROTTLE_RATES&#39;:{
</span></span><span class="line"><span class="cl">        &#39;luffy&#39;:&#39;3/m&#39;  # key要跟类中的scop对应
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps：get_cache_key返回什么就根据什么来限制
</span></span><span class="line"><span class="cl"># 可以全局使用，局部使用
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">全局使用
</span></span><span class="line"><span class="cl">REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">    &#39;DEFAULT_THROTTLE_CLASSES&#39;:[&#39;app01.utils.MyThrottles&#39;,],
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">局部使用
</span></span><span class="line"><span class="cl">#在视图类里使用
</span></span><span class="line"><span class="cl">throttle_classes = [MyThrottles,]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="9过滤">9、过滤</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、安装：pip install django-filter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、注册 
</span></span><span class="line"><span class="cl">INSTALLED_APPS = [
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    &#39;django_filters&#39;,  # 需要注册应用，
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、写配置文件
</span></span><span class="line"><span class="cl"># 全局配或者局部配置
</span></span><span class="line"><span class="cl">REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    &#39;DEFAULT_FILTER_BACKENDS&#39;: (&#39;django_filters.rest_framework.DjangoFilterBackend&#39;,)
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、写视图函数views.py
</span></span><span class="line"><span class="cl"># 全局
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer 
</span></span><span class="line"><span class="cl">from rest_framework.generics import ListAPIView
</span></span><span class="line"><span class="cl">class BooksViewSet2(ListAPIView):
</span></span><span class="line"><span class="cl">    queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">    filter_fields = (&#39;name&#39;, ) 	# 配置可以按照那个字段过滤
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 局部
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer 
</span></span><span class="line"><span class="cl">from rest_framework.generics import ListAPIView
</span></span><span class="line"><span class="cl">from django_filters.rest_framework import DjangoFilterBackend
</span></span><span class="line"><span class="cl">class BooksViewSet2(ListAPIView):
</span></span><span class="line"><span class="cl">    queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">    filter_backends = (DjangoFilterBackend,)  
</span></span><span class="line"><span class="cl">    filter_fields = (&#39;name&#39;, ) 	# 配置可以按照那个字段过滤
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl"># 4、使用过滤属性访问
</span></span><span class="line"><span class="cl">http://127.0.0.1:8000/book2/?name=金瓶梅
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="10排序">10、排序</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 局部使用和全局使用
</span></span><span class="line"><span class="cl"># 排序
</span></span><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer
</span></span><span class="line"><span class="cl">from rest_framework.generics import ListAPIView
</span></span><span class="line"><span class="cl">from django_filters.rest_framework import DjangoFilterBackend
</span></span><span class="line"><span class="cl">from rest_framework.filters import OrderingFilter
</span></span><span class="line"><span class="cl">class BooksViewSet3(ListAPIView):
</span></span><span class="line"><span class="cl">    queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">    filter_backends = (OrderingFilter,)
</span></span><span class="line"><span class="cl">    ordering_fields = (&#39;id&#39;, &#39;price&#39;)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># 127.0.0.1:8000/books/?ordering=-id
</span></span><span class="line"><span class="cl"># -id 表示针对id字段进行倒序排序
</span></span><span class="line"><span class="cl"># id  表示针对id字段进行升序排序
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>如果需要在过滤以后再次进行排序，则需要两者结合!</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from app01.models import Book
</span></span><span class="line"><span class="cl">from app01.ser import BookSerializer
</span></span><span class="line"><span class="cl">from rest_framework.generics import ListAPIView
</span></span><span class="line"><span class="cl">from django_filters.rest_framework import DjangoFilterBackend
</span></span><span class="line"><span class="cl">from rest_framework.filters import OrderingFilter
</span></span><span class="line"><span class="cl">class BooksViewSet3(ListAPIView):
</span></span><span class="line"><span class="cl">    queryset = Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookSerializer
</span></span><span class="line"><span class="cl">    filter_fields = (&#39;publish&#39;,)
</span></span><span class="line"><span class="cl">    # 因为局部配置会覆盖全局配置,所以需要重新把过滤组件核心类再次声明,
</span></span><span class="line"><span class="cl">    # 否则过滤功能会失效
</span></span><span class="line"><span class="cl">    filter_backends = [OrderingFilter, DjangoFilterBackend]
</span></span><span class="line"><span class="cl">    ordering_fields = (&#39;id&#39;, &#39;price&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="11分页">11、分页</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、配置文件配置
</span></span><span class="line"><span class="cl">REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">    &#39;DEFAULT_PAGINATION_CLASS&#39;:  &#39;rest_framework.pagination.PageNumberPagination&#39;,
</span></span><span class="line"><span class="cl">    &#39;PAGE_SIZE&#39;: 100  # 每页数目
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、视图配置
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 内置有三种分页
</span></span><span class="line"><span class="cl">from rest_framework.pagination import PageNumberPagination,LimitOffsetPagination,CursorPagination
</span></span><span class="line"><span class="cl">class MyLimitOffsetPagination(LimitOffsetPagination):
</span></span><span class="line"><span class="cl">    default_limit = 3       # 每页条数
</span></span><span class="line"><span class="cl">    limit_query_param = &#39;limit&#39;     # 往后拿几条
</span></span><span class="line"><span class="cl">    offset_query_param = &#39;offset&#39;   # 标杆
</span></span><span class="line"><span class="cl">    max_limit = 5   # 每页最大几条数据
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    如果标杆为二，则表示插在第二条数据上，然后可以基于第二条数据再往后设置想要
</span></span><span class="line"><span class="cl">    拿的数据条数
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyCursorPagination(CursorPagination):
</span></span><span class="line"><span class="cl">    cursor_query_param = &#39;cursor&#39;   # 每一页查询的key
</span></span><span class="line"><span class="cl">    page_size = 2   # 每一页显示的条数
</span></span><span class="line"><span class="cl">    ordering = &#39;-price&#39;   # 排序字段
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    这种方式就是速度快，只有上一页和下一页
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyPageNumberPagination(PageNumberPagination):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    PageNumberPagination
</span></span><span class="line"><span class="cl">        PAGE_SIZE: 每页显示的条数
</span></span><span class="line"><span class="cl">        page_query_param: 每页数目的关键词
</span></span><span class="line"><span class="cl">        max_page_size: 限制一页最多多少数据
</span></span><span class="line"><span class="cl">        page_size_query_param: 表示每一页查看多少条数据，在浏览器上可以加参数查看
</span></span><span class="line"><span class="cl">        http://127.0.0.1:8000/api/books2/?aaa=1&amp;size=3
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    page_size = 1
</span></span><span class="line"><span class="cl">    page_query_param = &#39;aaa&#39;
</span></span><span class="line"><span class="cl">    page_size_query_param = &#39;size&#39;
</span></span><span class="line"><span class="cl">    max_page_size = 3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 使用ListAPIView分页
</span></span><span class="line"><span class="cl">from rest_framework.generics import ListAPIView
</span></span><span class="line"><span class="cl">class BookView(ListAPIView):
</span></span><span class="line"><span class="cl">    queryset = models.Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookModelSerializer
</span></span><span class="line"><span class="cl">    # 配置分页
</span></span><span class="line"><span class="cl">    pagination_class = MyCursorPagination
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 使用APIView分页
</span></span><span class="line"><span class="cl">class BookView2(APIView):
</span></span><span class="line"><span class="cl">    def get(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        book_list = models.Book.objects.all()
</span></span><span class="line"><span class="cl">        # 实例化得到一个分页器对象
</span></span><span class="line"><span class="cl">        page_cursor = MyPageNumberPagination()
</span></span><span class="line"><span class="cl">        book_list = page_cursor.paginate_queryset(book_list,request,view=self)
</span></span><span class="line"><span class="cl">        next_url = page_cursor.get_next_link()
</span></span><span class="line"><span class="cl">        pr_url = page_cursor.get_previous_link()
</span></span><span class="line"><span class="cl">        print(next_url)
</span></span><span class="line"><span class="cl">        print(pr_url)
</span></span><span class="line"><span class="cl">        book_ser = BookModelSerializer(book_list, many=True)
</span></span><span class="line"><span class="cl">        return Response(data=book_ser.data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps:如果在视图内关闭分页功能，只需在视图内设置
</span></span><span class="line"><span class="cl">pagination_class = None
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">page_size 每页数目
</span></span><span class="line"><span class="cl">page_query_param 前端发送的页数关键字名，默认为”page”
</span></span><span class="line"><span class="cl">page_size_query_param 前端发送的每页数目关键字名，默认为None
</span></span><span class="line"><span class="cl">max_page_size 前端最多能设置的每页数量
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="12异常处理">12、异常处理</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">REST framework提供了异常处理，我们可以自定义异常处理函数。
</span></span><span class="line"><span class="cl">可以用来统一接口的返回
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 1、自定义类
</span></span><span class="line"><span class="cl"># 自定义异常处理方法
</span></span><span class="line"><span class="cl">from rest_framework.views import exception_handler
</span></span><span class="line"><span class="cl">from rest_framework.response import Response
</span></span><span class="line"><span class="cl">from rest_framework import status
</span></span><span class="line"><span class="cl">def my_exception_handler(exc, context):
</span></span><span class="line"><span class="cl">    response = exception_handler(exc, context)
</span></span><span class="line"><span class="cl">    # 两种情况，一个是None，drf没有处理
</span></span><span class="line"><span class="cl">    # response对象，django处理，但是处理的不符合咱们的要求
</span></span><span class="line"><span class="cl">    print(type(exc))
</span></span><span class="line"><span class="cl">    if not response:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        return Response(data={&#39;status&#39;:999,&#39;msg&#39;:str(exc)},status=status.HTTP_400_BAD_REQUEST)
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        if isinstance(exc, AuthenticationFailed):
</span></span><span class="line"><span class="cl">            return Response(data={&#39;status&#39;: 777, &#39;msg&#39;: &#34;自定义未登录错误，&#34; + str(exc)}, status=status.HTTP_400_BAD_REQUEST)
</span></span><span class="line"><span class="cl">        # return response
</span></span><span class="line"><span class="cl">        return Response(data={&#39;status&#39;: 888, &#39;msg&#39;: response.data.get(&#39;detail&#39;)}, status=status.HTTP_400_BAD_REQUEST)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、全局配置
</span></span><span class="line"><span class="cl">REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">    &#39;EXCEPTION_HANDLER&#39;: &#39;app01.app_auth.my_exception_handler&#39;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">REST framework定义的异常：
</span></span><span class="line"><span class="cl">    APIException 所有异常的父类
</span></span><span class="line"><span class="cl">    ParseError 解析错误
</span></span><span class="line"><span class="cl">    AuthenticationFailed 认证失败
</span></span><span class="line"><span class="cl">    NotAuthenticated 尚未认证
</span></span><span class="line"><span class="cl">    PermissionDenied 权限决绝
</span></span><span class="line"><span class="cl">    NotFound 未找到
</span></span><span class="line"><span class="cl">    MethodNotAllowed 请求方式不支持
</span></span><span class="line"><span class="cl">    NotAcceptable 要获取的数据格式不支持
</span></span><span class="line"><span class="cl">    Throttled 超过限流次数
</span></span><span class="line"><span class="cl">    ValidationError 校验失败
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="13封装response对象">13、封装Response对象</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 自己封装Response对象
</span></span><span class="line"><span class="cl">from rest_framework.response import Response
</span></span><span class="line"><span class="cl">class APIResponse(Response):
</span></span><span class="line"><span class="cl">    def __init__(self,code=&#39;100&#39;,msg=&#39;成功&#39;,data=None,status=None,header=None, **kwargs):
</span></span><span class="line"><span class="cl">        dic = {&#39;code&#39;:code, &#39;msg&#39;:msg}
</span></span><span class="line"><span class="cl">        if data:
</span></span><span class="line"><span class="cl">            dic = {&#39;code&#39;:code, &#39;msg&#39;:msg,&#39;data&#39;:data}
</span></span><span class="line"><span class="cl">        dic.update(kwargs)
</span></span><span class="line"><span class="cl">        super().__init__(data=dic, status=status,headers=header)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        ps:
</span></span><span class="line"><span class="cl">       # 对象来调用对象的绑定方法，会自动传值
</span></span><span class="line"><span class="cl">        super().__init__(data=dic,status=status,headers=headers,content_type=content_type)
</span></span><span class="line"><span class="cl">        # 类来调用对象的绑定方法，这个方法就是一个普通函数，有几个参数就要传几个参数
</span></span><span class="line"><span class="cl">        # Response.__init__(data=dic,status=status,headers=headers,content_type=content_type)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 使用：
</span></span><span class="line"><span class="cl">from app01.app_auth import APIResponse
</span></span><span class="line"><span class="cl">class TestView7(APIView):
</span></span><span class="line"><span class="cl">    def get(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        return APIResponse(data={&#34;name&#34;:&#34;khw&#34;},token=&#39;dasdasdasd&#39;,sa=&#39;asddfdgsdg&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">return APIResponse(data={&#34;name&#34;:&#34;khw&#34;},token=&#39;dasdasdasd&#39;,sa=&#39;asddfdgsdg&#39;)
</span></span><span class="line"><span class="cl">return APIResponse(data={&#34;name&#34;:&#34;khw&#34;},token=&#39;dasdasdasd&#39;,sa=&#39;asddfdgsdg&#39;，asd=&#39;asdasd&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="14自动生成接口文档">14、自动生成接口文档</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 安装依赖
</span></span><span class="line"><span class="cl">pip install coreapi
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 设置接口文档访问路径
</span></span><span class="line"><span class="cl">from rest_framework.documentation import include_docs_urls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    path(&#39;docs/&#39;, include_docs_urls(title=&#39;站点页面标题&#39;))
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 文档描述说明的定义位置
</span></span><span class="line"><span class="cl">1） 单一方法的视图，可直接使用类视图的文档字符串，如
</span></span><span class="line"><span class="cl">class BookListView(generics.ListAPIView):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    返回所有图书信息.
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">2）包含多个方法的视图，在类视图的文档字符串中，分开方法定义，如
</span></span><span class="line"><span class="cl">class BookListCreateView(generics.ListCreateAPIView):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    get:
</span></span><span class="line"><span class="cl">    返回所有图书信息.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    post:
</span></span><span class="line"><span class="cl">    新建图书.
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">3）对于视图集ViewSet，仍在类视图的文档字符串中封开定义，但是应使用action名称区分，如
</span></span><span class="line"><span class="cl">class BookInfoViewSet(mixins.ListModelMixin, mixins.RetrieveModelMixin, GenericViewSet):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    list:
</span></span><span class="line"><span class="cl">    返回图书列表数据
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    retrieve:
</span></span><span class="line"><span class="cl">    返回图书详情数据
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    latest:
</span></span><span class="line"><span class="cl">    返回最新的图书数据
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    read:
</span></span><span class="line"><span class="cl">    修改图书的阅读量
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">浏览器访问 127.0.0.1:8000/docs/，即可看到自动生成的接口文档。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">如果遇到报错
</span></span><span class="line"><span class="cl">#AttributeError: &#39;AutoSchema&#39; object has no attribute &#39;get_link&#39;
</span></span><span class="line"><span class="cl">REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl"> &#39;DEFAULT_SCHEMA_CLASS&#39;: &#39;rest_framework.schemas.coreapi.AutoSchema&#39;,
</span></span><span class="line"><span class="cl">    # 新版drf schema_class默认用的是rest_framework.schemas.openapi.AutoSchema
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps:两点说明
</span></span><span class="line"><span class="cl">1） 视图集ViewSet中的retrieve名称，在接口文档网站中叫做read
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2）参数的Description需要在模型类或序列化器类的字段中以help_text选项定义，如：
</span></span><span class="line"><span class="cl">class Student(models.Model):
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    age = models.IntegerField(default=0, verbose_name=&#39;年龄&#39;, help_text=&#39;年龄&#39;)
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">或
</span></span><span class="line"><span class="cl">class StudentSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        model = Student
</span></span><span class="line"><span class="cl">        fields = &#34;__all__&#34;
</span></span><span class="line"><span class="cl">        extra_kwargs = {
</span></span><span class="line"><span class="cl">            &#39;age&#39;: {
</span></span><span class="line"><span class="cl">                &#39;required&#39;: True,
</span></span><span class="line"><span class="cl">                &#39;help_text&#39;: &#39;年龄&#39;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="15jwt认证">15、JWT认证</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1）jwt分三段式：头.体.签名 （head.payload.sgin）
</span></span><span class="line"><span class="cl">2）头和体是可逆加密，让服务器可以反解出user对象；签名是不可逆加密，保证整个token的安全性的
</span></span><span class="line"><span class="cl">3）头体签名三部分，都是采用json格式的字符串，进行加密，可逆加密一般采用base64算法，不可逆加密一般采用hash(md5)算法
</span></span><span class="line"><span class="cl">4）头中的内容是基本信息：公司信息、项目组信息、token采用的加密方式信息
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	&#34;company&#34;: &#34;公司信息&#34;,
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">5）体中的内容是关键信息：用户主键、用户名、签发时客户端信息(设备号、地址)、过期时间
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	&#34;user_id&#34;: 1,
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">6）签名中的内容时安全信息：头的加密结果 + 体的加密结果 + 服务器不对外公开的安全码 进行md5加密
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	&#34;head&#34;: &#34;头的加密字符串&#34;,
</span></span><span class="line"><span class="cl">	&#34;payload&#34;: &#34;体的加密字符串&#34;,
</span></span><span class="line"><span class="cl">	&#34;secret_key&#34;: &#34;安全码&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">签发：根据登录请求提交来的 账号 + 密码 + 设备信息 签发 token
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1）用基本信息存储json字典，采用base64算法加密得到 头字符串
</span></span><span class="line"><span class="cl">2）用关键信息存储json字典，采用base64算法加密得到 体字符串
</span></span><span class="line"><span class="cl">3）用头、体加密字符串再加安全码信息存储json字典，采用hash md5算法加密得到 签名字符串
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">账号密码就能根据User表得到user对象，形成的三段字符串用 . 拼接成token返回给前台
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">校验：根据客户端带token的请求 反解出 user 对象
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1）将token按 . 拆分为三段字符串，第一段 头加密字符串 一般不需要做任何处理
</span></span><span class="line"><span class="cl">2）第二段 体加密字符串，要反解出用户主键，通过主键从User表中就能得到登录用户，过期时间和设备信息都是安全信息，确保token没过期，且时同一设备来的
</span></span><span class="line"><span class="cl">3）再用 第一段 + 第二段 + 服务器安全码 不可逆md5加密，与第三段 签名字符串 进行碰撞校验，通过后才能代表第二段校验得到的user对象就是合法的登录用户
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">drf项目的jwt认证开发流程（重点）
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">1）用账号密码访问登录接口，登录接口逻辑中调用 签发token 算法，得到token，返回给客户端，客户端自己存到cookies中
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2）校验token的算法应该写在认证类中(在认证类中调用)，全局配置给认证组件，所有视图类请求，都会进行认证校验，所以请求带了token，就会反解出user对象，在视图类中用request.user就能访问登录的用户
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">注：登录接口需要做 认证 + 权限 两个局部禁用
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="151-drf-jwt安装和简单使用">15.1 drf-jwt安装和简单使用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">官网
</span></span><span class="line"><span class="cl">http://getblimp.github.io/django-rest-framework-jwt/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">安装：pip install djangorestframework-jwt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">使用:
</span></span><span class="line"><span class="cl">    # 1 创建超级用户
</span></span><span class="line"><span class="cl">    python3 manage.py createsuperuser
</span></span><span class="line"><span class="cl">    # 2 配置路由urls.py
</span></span><span class="line"><span class="cl">    from django.urls import path
</span></span><span class="line"><span class="cl">    from rest_framework_jwt.views import obtain_jwt_token
</span></span><span class="line"><span class="cl">    urlpatterns = [
</span></span><span class="line"><span class="cl">        path(&#39;login/&#39;, obtain_jwt_token),
</span></span><span class="line"><span class="cl">    ]
</span></span><span class="line"><span class="cl">    # 3 postman测试
</span></span><span class="line"><span class="cl">    向后端接口发送post请求，携带用户名密码，即可看到生成的token
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 4 setting.py中配置认证使用jwt提供的jsonwebtoken
</span></span><span class="line"><span class="cl">    # 5 postman发送访问请求（必须带jwt空格）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ps：使用jwt需要在app中注册
</span></span><span class="line"><span class="cl">    INSTALLED_APPS = [
</span></span><span class="line"><span class="cl">        &#39;rest_framework_jwt&#39;,
</span></span><span class="line"><span class="cl">    ]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># jwt配置
</span></span><span class="line"><span class="cl">import datetime
</span></span><span class="line"><span class="cl">JWT_AUTH = {
</span></span><span class="line"><span class="cl">    &#39;JWT_RESPONSE_PAYLOAD_HANDLER&#39;:&#39;app02.utils.my_jwt_response_payload_handler&#39;,   # 自定值返回格式
</span></span><span class="line"><span class="cl">    &#39;JWT_EXPIRATION_DELTA&#39;:datetime.timedelta(days=7)   # 配置过期时间手动配置
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="152-jwt控制用户登录访问">15.2 jwt控制用户登录访问</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## urls
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;login/&#39;, obtain_jwt_token),
</span></span><span class="line"><span class="cl">    path(&#39;order/&#39;, views.OrderAPIView.as_view()),
</span></span><span class="line"><span class="cl">    path(&#39;userinfo/&#39;, views.UserinfoAPIView.as_view()),
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## views
</span></span><span class="line"><span class="cl"># 可以通过JSONWebTokenAuthentication和权限类IsAuthenticated，来控制用户登陆后才能访问某些接口
</span></span><span class="line"><span class="cl"># 如果用户不登录就可以访问，只需要把权限类IsAuthenticated去掉就可以了
</span></span><span class="line"><span class="cl"># 使用jwt提供的认证类，局部使用
</span></span><span class="line"><span class="cl">from rest_framework_jwt.authentication import JSONWebTokenAuthentication
</span></span><span class="line"><span class="cl">from rest_framework.permissions import IsAuthenticated
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class OrderAPIView(APIView):
</span></span><span class="line"><span class="cl">    authentication_classes = [JSONWebTokenAuthentication,]
</span></span><span class="line"><span class="cl">    # 权限控制
</span></span><span class="line"><span class="cl">    permission_classes = [IsAuthenticated,]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def get(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        return Response(&#39;这是订单信息&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class UserinfoAPIView(APIView):
</span></span><span class="line"><span class="cl">    authentication_classes = [JSONWebTokenAuthentication, ]
</span></span><span class="line"><span class="cl">    # 权限控制
</span></span><span class="line"><span class="cl">    # permission_classes = [IsAuthenticated, ]
</span></span><span class="line"><span class="cl">    def get(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        return Response(&#39;这是游客信息&#39;)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"># 全局使用
</span></span><span class="line"><span class="cl">## setting.py
</span></span><span class="line"><span class="cl">REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">    # 认证模块
</span></span><span class="line"><span class="cl">    &#39;DEFAULT_AUTHENTICATION_CLASSES&#39;: (
</span></span><span class="line"><span class="cl">        &#39;users.app_auth.JSONWebTokenAuthentication&#39;,
</span></span><span class="line"><span class="cl">    ),
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="153-控制登录接口返回的数据格式">15.3 控制登录接口返回的数据格式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">方案一： 自己写登录接口
</span></span><span class="line"><span class="cl">方案二： 用内置，控制数据返回格式(以方案二为例)
</span></span><span class="line"><span class="cl">	-jwt配置信息中又这个配置
</span></span><span class="line"><span class="cl">	    &#39;JWT_RESPONSE_PAYLOAD_HANDLER&#39;:
</span></span><span class="line"><span class="cl">    	&#39;rest_framework_jwt.utils.jwt_response_payload_handler&#39;,
</span></span><span class="line"><span class="cl">    -重写jwt_response_payload_handler&#39;,配置成自己的
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## settings
</span></span><span class="line"><span class="cl">JWT_AUTH = {
</span></span><span class="line"><span class="cl">    &#39;JWT_RESPONSE_PAYLOAD_HANDLER&#39;:&#39;app02.utils.my_jwt_response_payload_handler&#39;,
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## utils
</span></span><span class="line"><span class="cl">from rest_framework_jwt.utils import jwt_response_payload_handler
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def my_jwt_response_payload_handler(token, user=None, request=None):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    return {
</span></span><span class="line"><span class="cl">        &#39;token&#39;: token,
</span></span><span class="line"><span class="cl">        &#39;msg&#39;:&#39;登录成功&#39;,
</span></span><span class="line"><span class="cl">        &#39;status&#39;:100,
</span></span><span class="line"><span class="cl">        &#39;username&#39;:user.username
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这样之后，使用jwt返回的数据格式就是自己定制的了
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="154-两种方式自定制jwt认证类">15.4 两种方式自定制jwt认证类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## urls
</span></span><span class="line"><span class="cl">from django.urls import path,include
</span></span><span class="line"><span class="cl">from rest_framework_jwt.views import obtain_jwt_token
</span></span><span class="line"><span class="cl">from app02 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;login/&#39;, obtain_jwt_token),
</span></span><span class="line"><span class="cl">    path(&#39;goods/&#39;, views.GoodsAPIView.as_view()),
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## utils
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 基于一下两种都可以
</span></span><span class="line"><span class="cl">from rest_framework.authentication import BaseAuthentication
</span></span><span class="line"><span class="cl">from rest_framework_jwt.authentication import BaseJSONWebTokenAuthentication
</span></span><span class="line"><span class="cl">from rest_framework.exceptions import AuthenticationFailed
</span></span><span class="line"><span class="cl">from rest_framework_jwt.authentication import jwt_decode_handler
</span></span><span class="line"><span class="cl">import jwt
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl">class MyjwtAuthentication(BaseAuthentication):
</span></span><span class="line"><span class="cl">    def authenticate(self, request):
</span></span><span class="line"><span class="cl">        jwt_value = request.META.get(&#39;HTTP_AUTHORIZATION&#39;)
</span></span><span class="line"><span class="cl">        if jwt_value:
</span></span><span class="line"><span class="cl">            try:
</span></span><span class="line"><span class="cl">                # jwt提供了通过三段token，取出payload的方法，并且又校验功能
</span></span><span class="line"><span class="cl">                payload = jwt_decode_handler(jwt_value)
</span></span><span class="line"><span class="cl">            except jwt.ExpiredSignature:
</span></span><span class="line"><span class="cl">                raise AuthenticationFailed(&#39;签名过期&#39;)
</span></span><span class="line"><span class="cl">            except jwt.InvalidTokenError:
</span></span><span class="line"><span class="cl">                raise AuthenticationFailed(&#39;非法用户&#39;)
</span></span><span class="line"><span class="cl">            except Exception as e:
</span></span><span class="line"><span class="cl">                # 所有异常都会走到这
</span></span><span class="line"><span class="cl">                raise AuthenticationFailed(str(e))
</span></span><span class="line"><span class="cl">            # 因为payload就是用户信息的字典
</span></span><span class="line"><span class="cl">            print(payload)
</span></span><span class="line"><span class="cl">            # 第一种，需要得到user对象，去数据库中查
</span></span><span class="line"><span class="cl">            # user = models.User.objects.get(pk=payload.get(&#39;user_id&#39;))
</span></span><span class="line"><span class="cl">            # 第二种，不查库
</span></span><span class="line"><span class="cl">            user = models.User(id=payload.get(&#39;user_id&#39;),username=payload.get(&#39;username&#39;))
</span></span><span class="line"><span class="cl">            return user,jwt_value
</span></span><span class="line"><span class="cl">        # 没有值，直接抛异常
</span></span><span class="line"><span class="cl">        raise AuthenticationFailed(&#39;您没有携带认证信息&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyjwtAuthentication2(BaseAuthentication):
</span></span><span class="line"><span class="cl">    def authenticate(self, request):
</span></span><span class="line"><span class="cl">        jwt_value = request.META.get(&#39;HTTP_AUTHORIZATION&#39;)
</span></span><span class="line"><span class="cl">        if jwt_value:
</span></span><span class="line"><span class="cl">            try:
</span></span><span class="line"><span class="cl">                # jwt提供了通过三段token，取出payload的方法，并且又校验功能
</span></span><span class="line"><span class="cl">                payload = jwt_decode_handler(jwt_value)
</span></span><span class="line"><span class="cl">            except jwt.ExpiredSignature:
</span></span><span class="line"><span class="cl">                raise AuthenticationFailed(&#39;签名过期&#39;)
</span></span><span class="line"><span class="cl">            except jwt.InvalidTokenError:
</span></span><span class="line"><span class="cl">                raise AuthenticationFailed(&#39;非法用户&#39;)
</span></span><span class="line"><span class="cl">            except Exception as e:
</span></span><span class="line"><span class="cl">                # 所有异常都会走到这
</span></span><span class="line"><span class="cl">                raise AuthenticationFailed(str(e))
</span></span><span class="line"><span class="cl">            user = self.authenticate_header(payload)
</span></span><span class="line"><span class="cl">            return user,jwt_value
</span></span><span class="line"><span class="cl">        # 没有值，直接抛异常
</span></span><span class="line"><span class="cl">        raise AuthenticationFailed(&#39;您没有携带认证信息&#39;)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">## views
</span></span><span class="line"><span class="cl">from app02.utils import MyjwtAuthentication
</span></span><span class="line"><span class="cl">from app02.utils import MyjwtAuthentication2
</span></span><span class="line"><span class="cl">class GoodsAPIView(APIView):
</span></span><span class="line"><span class="cl">    authentication_classes = [MyjwtAuthentication2, ]
</span></span><span class="line"><span class="cl">    def get(self, request, *args, **kwargs):
</span></span><span class="line"><span class="cl">        print(request.user)
</span></span><span class="line"><span class="cl">        return Response(&#39;商品信息&#39;)
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="155-手动签发token多方式登录">15.5 手动签发token(多方式登录)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 使用用户名，手机号，邮箱都可以登录
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## urls
</span></span><span class="line"><span class="cl">from django.urls import path
</span></span><span class="line"><span class="cl">from rest_framework_jwt.views import obtain_jwt_token
</span></span><span class="line"><span class="cl">from app02 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;login/&#39;, obtain_jwt_token),
</span></span><span class="line"><span class="cl">    path(&#39;login2/&#39;, views.Login2View.as_view({&#39;post&#39;:&#39;login&#39;})),
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## models
</span></span><span class="line"><span class="cl">from django.db import models
</span></span><span class="line"><span class="cl">from django.contrib.auth.models import AbstractUser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class User(AbstractUser):
</span></span><span class="line"><span class="cl">    mobile = models.CharField(max_length=32,unique=True)
</span></span><span class="line"><span class="cl">    # 需要配media文件夹，上传的文件就会放在media文件夹
</span></span><span class="line"><span class="cl">    icon = models.ImageField(upload_to=&#39;icon&#39;, default=&#39;icon/default.png&#39;)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">## settings
</span></span><span class="line"><span class="cl">import os
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MEDIA_URL = &#39;/media/&#39;
</span></span><span class="line"><span class="cl">MEDIA_ROOT= os.path.join(BASE_DIR,&#39;media&#39;)    # 真正的文件夹路径
</span></span><span class="line"><span class="cl">AUTH_USER_MODEL = &#39;app01.user&#39;  # app名.表名
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## ser
</span></span><span class="line"><span class="cl">from rest_framework import serializers
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl">import re
</span></span><span class="line"><span class="cl">from rest_framework.exceptions import ValidationError
</span></span><span class="line"><span class="cl">from rest_framework_jwt.utils import jwt_encode_handler,jwt_payload_handler
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class LoginModelSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    # username该字段是数据库中的唯一字段，因为来的请求是post，数据库会认为你存数据，然后校验不通过
</span></span><span class="line"><span class="cl">    username = serializers.CharField()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        model = models.User
</span></span><span class="line"><span class="cl">        fields = [&#39;username&#39;,&#39;password&#39;]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def validate(self,attrs):   # 全局钩子
</span></span><span class="line"><span class="cl">        # 在这写逻辑
</span></span><span class="line"><span class="cl">        username = attrs.get(&#39;username&#39;)    # 用户名有三种方式
</span></span><span class="line"><span class="cl">        password = attrs.get(&#39;password&#39;)
</span></span><span class="line"><span class="cl">        # 通过判断，username数据不同，查询字段不一样
</span></span><span class="line"><span class="cl">        # 正则匹配，如果是手机号
</span></span><span class="line"><span class="cl">        if re.match(&#39;^1[3-9][0-9]{9}$&#39;,username):    # 手机号
</span></span><span class="line"><span class="cl">            print(username)
</span></span><span class="line"><span class="cl">            user = models.User.objects.filter(mobile=username).first()
</span></span><span class="line"><span class="cl">        elif re.match(&#39;^.+@.+$&#39;,username):  # 邮箱
</span></span><span class="line"><span class="cl">            user = models.User.objects.filter(email=username).first()
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            user = models.User.objects.filter(username=username).first()
</span></span><span class="line"><span class="cl">        if user:    # 存在用户
</span></span><span class="line"><span class="cl">            # 校验密码，因为是密文，使用check_password
</span></span><span class="line"><span class="cl">            if user.check_password(password):
</span></span><span class="line"><span class="cl">                # 签发token
</span></span><span class="line"><span class="cl">                payload = jwt_payload_handler(user) # 把user传入得到payload
</span></span><span class="line"><span class="cl">                token = jwt_encode_handler(payload)   # 把payload传入得到token
</span></span><span class="line"><span class="cl">                # self.aa = token
</span></span><span class="line"><span class="cl">                self.context[&#39;token&#39;] = token
</span></span><span class="line"><span class="cl">                self.context[&#39;username&#39;] = user.username
</span></span><span class="line"><span class="cl">                return attrs
</span></span><span class="line"><span class="cl">            else:
</span></span><span class="line"><span class="cl">                raise ValidationError(&#39;密码错误&#39;)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;用户不存在&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## views
</span></span><span class="line"><span class="cl"># 手动签发token，完成多方式登录
</span></span><span class="line"><span class="cl">from rest_framework.views import APIView
</span></span><span class="line"><span class="cl">from rest_framework.viewsets import ViewSetMixin, ViewSet
</span></span><span class="line"><span class="cl">from app02 import ser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># class Login2View(ViewSetMixin,APIView):
</span></span><span class="line"><span class="cl">class Login2View(ViewSet):  # 跟上面的一样
</span></span><span class="line"><span class="cl">    # 这是登录接口
</span></span><span class="line"><span class="cl">    # def post(self): # 不写post了，直接写login
</span></span><span class="line"><span class="cl">    # pass
</span></span><span class="line"><span class="cl">    def login(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # 1、需要有个序列化类
</span></span><span class="line"><span class="cl">        login_ser = ser.LoginModelSerializer(data=request.data,context={&#39;request&#39;:request})
</span></span><span class="line"><span class="cl">        # 2、身材序列化类对象
</span></span><span class="line"><span class="cl">        # 3、调用序列化对象的is_valid
</span></span><span class="line"><span class="cl">        login_ser.is_valid(raise_exception=True)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        token = login_ser.context.get(&#39;token&#39;)
</span></span><span class="line"><span class="cl">        # username = login_ser.context.get(&#39;username&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # 4、return
</span></span><span class="line"><span class="cl">        return Response({&#39;status&#39;:100,&#39;msg&#39;:&#39;登陆成功&#39;,&#39;token&#39;:token,&#39;username&#39;:login_ser.context.get(&#39;username&#39;)})
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="16django缓存">16、django缓存</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 前后端混合缓存的使用
</span></span><span class="line"><span class="cl">	-缓存位置，通过配置文件来操作(以文件为例)
</span></span><span class="line"><span class="cl">	-缓存粒度：
</span></span><span class="line"><span class="cl">		全站缓存
</span></span><span class="line"><span class="cl">		单页面缓存
</span></span><span class="line"><span class="cl">		页面局部缓存
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 前后端分离缓存的使用
</span></span><span class="line"><span class="cl">	-如何使用
</span></span><span class="line"><span class="cl">        from django.core.cache import cache
</span></span><span class="line"><span class="cl">        cache.set(&#39;key&#39;,value可以是任意数据类型)
</span></span><span class="line"><span class="cl">        cache.get(&#39;key&#39;)
</span></span><span class="line"><span class="cl">	-应用场景：
</span></span><span class="line"><span class="cl">		通过多表联查序列化之后的数据直接缓存起来
</span></span><span class="line"><span class="cl">		第一次查询所有图书，后续直接先去缓存查，如果有
</span></span><span class="line"><span class="cl">		直接返回，如果没有再去连表查，返回之前再缓存
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	-前后端分离缓存存放对象案例
</span></span><span class="line"><span class="cl">        class Person:
</span></span><span class="line"><span class="cl">            def __init__(self,name,age):
</span></span><span class="line"><span class="cl">                self.name = name
</span></span><span class="line"><span class="cl">                self.age = age
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        from django.core.cache import cache
</span></span><span class="line"><span class="cl">        def test_check(request):
</span></span><span class="line"><span class="cl">            p = Person(&#39;khw&#39;,100)
</span></span><span class="line"><span class="cl">            cache.set(&#39;name&#39;,p)
</span></span><span class="line"><span class="cl">            print(type(p),p.name)
</span></span><span class="line"><span class="cl">            return render(request,&#39;index.html&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        def test_check2(request):
</span></span><span class="line"><span class="cl">            p = cache.get(&#39;name&#39;)
</span></span><span class="line"><span class="cl">            print(type(p),p.name)
</span></span><span class="line"><span class="cl">            return render(request,&#39;index.html&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="161-django中的6种缓存方式">16.1 Django中的6种缓存方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">开发调试缓存
</span></span><span class="line"><span class="cl">内存缓存
</span></span><span class="line"><span class="cl">文件缓存
</span></span><span class="line"><span class="cl">数据库缓存
</span></span><span class="line"><span class="cl">Memcache缓存(使用python-memcached模块)
</span></span><span class="line"><span class="cl">Memcache缓存(使用pylibmc模块)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">经常使用的有文件缓存和Mencache缓存
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="162-django6种缓存的配置">16.2 Django6种缓存的配置</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 开发调试(此模式为开发调试使用,实际上不执行任何操作)
</span></span><span class="line"><span class="cl">CACHES = {
</span></span><span class="line"><span class="cl"> &#39;default&#39;: {
</span></span><span class="line"><span class="cl">  &#39;BACKEND&#39;: &#39;django.core.cache.backends.dummy.DummyCache&#39;,  # 缓存后台使用的引擎
</span></span><span class="line"><span class="cl">  &#39;TIMEOUT&#39;: 300,            # 缓存超时时间（默认300秒，None表示永不过期，0表示立即过期）
</span></span><span class="line"><span class="cl">  &#39;OPTIONS&#39;:{
</span></span><span class="line"><span class="cl">   &#39;MAX_ENTRIES&#39;: 300,          # 最大缓存记录的数量（默认300）
</span></span><span class="line"><span class="cl">   &#39;CULL_FREQUENCY&#39;: 3,          # 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl"> }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## 内存缓存(将缓存内容保存至内存区域中)
</span></span><span class="line"><span class="cl">CACHES = {
</span></span><span class="line"><span class="cl"> &#39;default&#39;: {
</span></span><span class="line"><span class="cl">  &#39;BACKEND&#39;: &#39;django.core.cache.backends.locmem.LocMemCache&#39;,  # 指定缓存使用的引擎
</span></span><span class="line"><span class="cl">  &#39;LOCATION&#39;: &#39;unique-snowflake&#39;,         # 写在内存中的变量的唯一值 
</span></span><span class="line"><span class="cl">  &#39;TIMEOUT&#39;:300,             # 缓存超时时间(默认为300秒,None表示永不过期)
</span></span><span class="line"><span class="cl">  &#39;OPTIONS&#39;:{
</span></span><span class="line"><span class="cl">   &#39;MAX_ENTRIES&#39;: 300,           # 最大缓存记录的数量（默认300）
</span></span><span class="line"><span class="cl">   &#39;CULL_FREQUENCY&#39;: 3,          # 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）
</span></span><span class="line"><span class="cl">  }  
</span></span><span class="line"><span class="cl"> }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## 文件缓存(把缓存数据存储在文件中)
</span></span><span class="line"><span class="cl">CACHES = {
</span></span><span class="line"><span class="cl"> &#39;default&#39;: {
</span></span><span class="line"><span class="cl">  &#39;BACKEND&#39;: &#39;django.core.cache.backends.filebased.FileBasedCache&#39;, #指定缓存使用的引擎
</span></span><span class="line"><span class="cl">  &#39;LOCATION&#39;: &#39;/var/tmp/django_cache&#39;,        #指定缓存的路径
</span></span><span class="line"><span class="cl">  &#39;TIMEOUT&#39;:300,              #缓存超时时间(默认为300秒,None表示永不过期)
</span></span><span class="line"><span class="cl">  &#39;OPTIONS&#39;:{
</span></span><span class="line"><span class="cl">   &#39;MAX_ENTRIES&#39;: 300,            # 最大缓存记录的数量（默认300）
</span></span><span class="line"><span class="cl">   &#39;CULL_FREQUENCY&#39;: 3,           # 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl"> }   
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## 数据库缓存(把缓存数据存储在数据库中)
</span></span><span class="line"><span class="cl">CACHES = {
</span></span><span class="line"><span class="cl"> &#39;default&#39;: {
</span></span><span class="line"><span class="cl">  &#39;BACKEND&#39;: &#39;django.core.cache.backends.db.DatabaseCache&#39;,  # 指定缓存使用的引擎
</span></span><span class="line"><span class="cl">  &#39;LOCATION&#39;: &#39;cache_table&#39;,          # 数据库表    
</span></span><span class="line"><span class="cl">  &#39;OPTIONS&#39;:{
</span></span><span class="line"><span class="cl">   &#39;MAX_ENTRIES&#39;: 300,           # 最大缓存记录的数量（默认300）
</span></span><span class="line"><span class="cl">   &#39;CULL_FREQUENCY&#39;: 3,          # 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）
</span></span><span class="line"><span class="cl">  }  
</span></span><span class="line"><span class="cl"> }   
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">注意,创建缓存的数据库表使用的语句:
</span></span><span class="line"><span class="cl">python manage.py createcachetable
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## Memcache缓存(使用python-memcached模块连接memcache)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Memcached是Django原生支持的缓存系统.要使用Memcached,需要下载Memcached的支持库python-memcached或pylibmc.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CACHES = {
</span></span><span class="line"><span class="cl"> &#39;default&#39;: {
</span></span><span class="line"><span class="cl">  &#39;BACKEND&#39;: &#39;django.core.cache.backends.memcached.MemcachedCache&#39;, # 指定缓存使用的引擎
</span></span><span class="line"><span class="cl">  &#39;LOCATION&#39;: &#39;192.168.10.100:11211&#39;,         # 指定Memcache缓存服务器的IP地址和端口
</span></span><span class="line"><span class="cl">  &#39;OPTIONS&#39;:{
</span></span><span class="line"><span class="cl">   &#39;MAX_ENTRIES&#39;: 300,            # 最大缓存记录的数量（默认300）
</span></span><span class="line"><span class="cl">   &#39;CULL_FREQUENCY&#39;: 3,           # 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl"> }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">LOCATION也可以配置成如下:
</span></span><span class="line"><span class="cl">&#39;LOCATION&#39;: &#39;unix:/tmp/memcached.sock&#39;,   # 指定局域网内的主机名加socket套接字为Memcache缓存服务器
</span></span><span class="line"><span class="cl">&#39;LOCATION&#39;: [         # 指定一台或多台其他主机ip地址加端口为Memcache缓存服务器
</span></span><span class="line"><span class="cl"> &#39;192.168.10.100:11211&#39;,
</span></span><span class="line"><span class="cl"> &#39;192.168.10.101:11211&#39;,
</span></span><span class="line"><span class="cl"> &#39;192.168.10.102:11211&#39;,
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## Memcache缓存(使用pylibmc模块连接memcache)
</span></span><span class="line"><span class="cl">settings.py文件配置
</span></span><span class="line"><span class="cl"> CACHES = {
</span></span><span class="line"><span class="cl">  &#39;default&#39;: {
</span></span><span class="line"><span class="cl">   &#39;BACKEND&#39;: &#39;django.core.cache.backends.memcached.PyLibMCCache&#39;,  # 指定缓存使用的引擎
</span></span><span class="line"><span class="cl">   &#39;LOCATION&#39;:&#39;192.168.10.100:11211&#39;,         # 指定本机的11211端口为Memcache缓存服务器
</span></span><span class="line"><span class="cl">   &#39;OPTIONS&#39;:{
</span></span><span class="line"><span class="cl">    &#39;MAX_ENTRIES&#39;: 300,            # 最大缓存记录的数量（默认300）
</span></span><span class="line"><span class="cl">    &#39;CULL_FREQUENCY&#39;: 3,           # 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）
</span></span><span class="line"><span class="cl">   },  
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl"> }
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">LOCATION也可以配置成如下:
</span></span><span class="line"><span class="cl">&#39;LOCATION&#39;: &#39;/tmp/memcached.sock&#39;,  # 指定某个路径为缓存目录
</span></span><span class="line"><span class="cl">&#39;LOCATION&#39;: [       # 分布式缓存,在多台服务器上运行Memcached进程,程序会把多台服务器当作一个单独的缓存,而不会在每台服务器上复制缓存值
</span></span><span class="line"><span class="cl"> &#39;192.168.10.100:11211&#39;,
</span></span><span class="line"><span class="cl"> &#39;192.168.10.101:11211&#39;,
</span></span><span class="line"><span class="cl"> &#39;192.168.10.102:11211&#39;,
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl"> 
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="163-django中的缓存应用">16.3 Django中的缓存应用</h4>
<h5 id="1631-视图函数使用缓存">16.3.1 视图函数使用缓存</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.views.decorators.cache import cache_page
</span></span><span class="line"><span class="cl">import time
</span></span><span class="line"><span class="cl">from .models import *
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@cache_page(15)          #超时时间为15秒
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">　　t=time.time()      #获取当前时间
</span></span><span class="line"><span class="cl">　　bookList=Book.objects.all()
</span></span><span class="line"><span class="cl">　　return render(request,&#34;index.html&#34;,locals())
</span></span><span class="line"><span class="cl">　　
</span></span><span class="line"><span class="cl">　　
</span></span><span class="line"><span class="cl">## index.html
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html lang=&#34;en&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Title&lt;/title&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">&lt;h3&gt;当前时间:-----{{ t }}&lt;/h3&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;ul&gt;
</span></span><span class="line"><span class="cl">    {% for book in bookList %}
</span></span><span class="line"><span class="cl">       &lt;li&gt;{{ book.name }}---------&gt;{{ book.price }}$&lt;/li&gt;
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">&lt;/ul&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## setting.py
</span></span><span class="line"><span class="cl">CACHES = {
</span></span><span class="line"><span class="cl"> &#39;default&#39;: {
</span></span><span class="line"><span class="cl">  &#39;BACKEND&#39;: &#39;django.core.cache.backends.filebased.FileBasedCache&#39;, # 指定缓存使用的引擎
</span></span><span class="line"><span class="cl">  &#39;LOCATION&#39;: &#39;E:\django_cache&#39;,          # 指定缓存的路径
</span></span><span class="line"><span class="cl">  &#39;TIMEOUT&#39;: 300,              # 缓存超时时间(默认为300秒,None表示永不过期)
</span></span><span class="line"><span class="cl">  &#39;OPTIONS&#39;: {
</span></span><span class="line"><span class="cl">   &#39;MAX_ENTRIES&#39;: 300,            # 最大缓存记录的数量（默认300）
</span></span><span class="line"><span class="cl">   &#39;CULL_FREQUENCY&#39;: 3,           # 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl"> }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="1632-全站使用缓存">16.3.2 全站使用缓存</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">既然是全站缓存,当然要使用Django中的中间件.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">用户的请求通过中间件,经过一系列的认证等操作,如果请求的内容在缓存中存在,则使用FetchFromCacheMiddleware获取内容并返回给用户
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">当返回给用户之前,判断缓存中是否已经存在,如果不存在,则UpdateCacheMiddleware会将缓存保存至Django的缓存之中,以实现全站缓存
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">缓存整个站点，是最简单的缓存方法
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在 MIDDLEWARE_CLASSES 中加入 “update” 和 “fetch” 中间件
</span></span><span class="line"><span class="cl">MIDDLEWARE_CLASSES = (
</span></span><span class="line"><span class="cl">    ‘django.middleware.cache.UpdateCacheMiddleware’, #第一
</span></span><span class="line"><span class="cl">    &#39;django.middleware.common.CommonMiddleware&#39;,
</span></span><span class="line"><span class="cl">    ‘django.middleware.cache.FetchFromCacheMiddleware’, #最后
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl">“update” 必须配置在第一个
</span></span><span class="line"><span class="cl">“fetch” 必须配置在最后一个
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## settings.py
</span></span><span class="line"><span class="cl">MIDDLEWARE_CLASSES = (
</span></span><span class="line"><span class="cl">    &#39;django.middleware.cache.UpdateCacheMiddleware&#39;,   #响应HttpResponse中设置几个headers
</span></span><span class="line"><span class="cl">    &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.common.CommonMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.auth.middleware.SessionAuthenticationMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.security.SecurityMiddleware&#39;,
</span></span><span class="line"><span class="cl">    &#39;django.middleware.cache.FetchFromCacheMiddleware&#39;,   #用来缓存通过GET和HEAD方法获取的状态码为200的响应
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CACHE_MIDDLEWARE_SECONDS=10
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## views
</span></span><span class="line"><span class="cl">from django.views.decorators.cache import cache_page
</span></span><span class="line"><span class="cl">import time
</span></span><span class="line"><span class="cl">from .models import *
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     t=time.time()      #获取当前时间
</span></span><span class="line"><span class="cl">     bookList=Book.objects.all()
</span></span><span class="line"><span class="cl">     return render(request,&#34;index.html&#34;,locals())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def foo(request):
</span></span><span class="line"><span class="cl">    t=time.time()      #获取当前时间
</span></span><span class="line"><span class="cl">    return HttpResponse(&#34;HELLO:&#34;+str(t))
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">## index.html
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html lang=&#34;en&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Title&lt;/title&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">&lt;h3 style=&#34;color: green&#34;&gt;当前时间:-----{{ t }}&lt;/h3&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;ul&gt;
</span></span><span class="line"><span class="cl">    {% for book in bookList %}
</span></span><span class="line"><span class="cl">       &lt;li&gt;{{ book.name }}---------&gt;{{ book.price }}$&lt;/li&gt;
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">&lt;/ul&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="1633-局部视图缓存">16.3.3 局部视图缓存</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">例子,刷新页面时,整个网页有一部分实现缓存
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## views
</span></span><span class="line"><span class="cl">from django.views.decorators.cache import cache_page
</span></span><span class="line"><span class="cl">import time
</span></span><span class="line"><span class="cl">from .models import *
</span></span><span class="line"><span class="cl">def index(request):
</span></span><span class="line"><span class="cl">     t=time.time()      #获取当前时间
</span></span><span class="line"><span class="cl">     bookList=Book.objects.all()
</span></span><span class="line"><span class="cl">     return render(request,&#34;index.html&#34;,locals())
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">## index
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html lang=&#34;en&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Title&lt;/title&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl"> &lt;h3 style=&#34;color: green&#34;&gt;不缓存:-----{{ t }}&lt;/h3&gt;
</span></span><span class="line"><span class="cl">{% load cache %}
</span></span><span class="line"><span class="cl">{% cache 2 &#39;name&#39; %}		// 2表示缓存2秒，name是key是缓存的名字，随便起就行但是要唯一
</span></span><span class="line"><span class="cl"> &lt;h3&gt;缓存:-----:{{ t }}&lt;/h3&gt;
</span></span><span class="line"><span class="cl">{% endcache %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="17-celery异步任务框架">17 Celery(异步任务框架)</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#了解
</span></span><span class="line"><span class="cl">    Celery 官网：http://www.celeryproject.org/
</span></span><span class="line"><span class="cl">    Celery 官方文档英文版:http://docs.celeryproject.org/en/latest/index.html
</span></span><span class="line"><span class="cl">    Celery 官方文档中文版：http://docs.jinkan.org/docs/celery/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    介绍： Celery是一个简单、灵活、可靠处理大量消息的分布式系统，专注于实时处理的异步入任务队列，同时支持任务调度   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Celery is a project with minimal funding, so we don’t support Microsoft Windows. Please don’t open any issues related to that platform.
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="171-celery使用">17.1 Celery使用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#可以执行异步、延时、定时任务
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#安装 pip install celery
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="172-基本机构">17.2 基本机构</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#t_redis_pool\celery_1\celery_task.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    from celery import Celery
</span></span><span class="line"><span class="cl">    broker = &#39;redis://127.0.0.1:6379/1&#39;#brokey任务队列
</span></span><span class="line"><span class="cl">    backend = &#39;redis://127.0.0.1:6379/2&#39;#结构存储，执行完的结果存在这
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    app = Celery(__name__,broker=broker,backend=backend)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    #添加任务，使用装饰器@app.task
</span></span><span class="line"><span class="cl">    @app.task
</span></span><span class="line"><span class="cl">    def add(x,y):
</span></span><span class="line"><span class="cl">        print(x,y)
</span></span><span class="line"><span class="cl">        return x*y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#t_redis_pool\celery_1\celery_add.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    from celery_task import add
</span></span><span class="line"><span class="cl">    ret = add.delay(3,8)#向add函数添加一个任务
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#t_redis_pool\celery_1\result1.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    from celery_task import app
</span></span><span class="line"><span class="cl">    from celery.result import AsyncResult
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    id = &#39;3e397fd7-e0c1-4c5c-999c-2655a96793bb&#39;
</span></span><span class="line"><span class="cl">    if __name__ == &#39;__main__&#39;:
</span></span><span class="line"><span class="cl">        a = AsyncResult(id=id, app=app)
</span></span><span class="line"><span class="cl">        if a.successful():
</span></span><span class="line"><span class="cl">            result = a.get()
</span></span><span class="line"><span class="cl">            print(result)
</span></span><span class="line"><span class="cl">        elif a.failed():
</span></span><span class="line"><span class="cl">            print(&#39;任务失败&#39;)
</span></span><span class="line"><span class="cl">        elif a.status == &#39;PENDING&#39;:
</span></span><span class="line"><span class="cl">            print(&#39;任务等待中被执行&#39;)
</span></span><span class="line"><span class="cl">        elif a.status == &#39;RETRY&#39;:
</span></span><span class="line"><span class="cl">            print(&#39;任务异常后正在重试&#39;)
</span></span><span class="line"><span class="cl">        elif a.status == &#39;STARTED&#39;:
</span></span><span class="line"><span class="cl">            print(&#39;任务已经开始被执行&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="173-包结构">17.3 包结构</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#新建一个包celery_task，包里面必须有个celery.py
</span></span><span class="line"><span class="cl">#celery_task\celery.py
</span></span><span class="line"><span class="cl">    from celery import Celery
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    broker = &#39;redis://127.0.0.1:6379/1&#39;#broker任务队列
</span></span><span class="line"><span class="cl">    backend = &#39;redis://127.0.0.1:6379/2&#39;#结构存储，执行完的结果在这
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    app = Celery(__name__,broker=broker,backend=backend,include=[&#39;celery_task.task1&#39;,&#39;celery_task.task2&#39;])
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#celery_task\task1.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    from .celery import app
</span></span><span class="line"><span class="cl">    @app.task
</span></span><span class="line"><span class="cl">    def mutile(x,y):
</span></span><span class="line"><span class="cl">        print(x,y)
</span></span><span class="line"><span class="cl">        return x*y
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">#celery_task\task2.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    from .celery import app
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    @app.task
</span></span><span class="line"><span class="cl">    def add(x, y):
</span></span><span class="line"><span class="cl">        print(x, y)
</span></span><span class="line"><span class="cl">        return x + y
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">#celery_task\test.py提交任务
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    from celery_task.task1 import mutile
</span></span><span class="line"><span class="cl">    from celery_task.task2 import add
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ret = add.delay(6,9)
</span></span><span class="line"><span class="cl">    print(ret)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    ret = mutile(9,8)#上面的ret不用注释，可以提交多个
</span></span><span class="line"><span class="cl">    print(ret)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    #提交延时任务
</span></span><span class="line"><span class="cl">    from datetime import datetime, timedelta
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    #需要utc时间
</span></span><span class="line"><span class="cl">    eta = datetime.utcnow() + timedelta(seconds=10)
</span></span><span class="line"><span class="cl">    ret = add.apply_async(args=(240,50),eta=eta)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    print(ret)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">#查看任务结果
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	from celery_task import app
</span></span><span class="line"><span class="cl">    from celery.result import AsyncResult
</span></span><span class="line"><span class="cl">    id = &#39;3e397fd7-e0c1-4c5c-999c-2655a96793bb&#39;
</span></span><span class="line"><span class="cl">    if __name__ == &#39;__main__&#39;:
</span></span><span class="line"><span class="cl">        async = AsyncResult(id=id, app=app)
</span></span><span class="line"><span class="cl">        if async.successful():
</span></span><span class="line"><span class="cl">            result = async.get()
</span></span><span class="line"><span class="cl">            print(result)
</span></span><span class="line"><span class="cl">        elif async.failed():
</span></span><span class="line"><span class="cl">            print(&#39;任务失败&#39;)
</span></span><span class="line"><span class="cl">        elif async.status == &#39;PENDING&#39;:
</span></span><span class="line"><span class="cl">            print(&#39;任务等待中被执行&#39;)
</span></span><span class="line"><span class="cl">        elif async.status == &#39;RETRY&#39;:
</span></span><span class="line"><span class="cl">            print(&#39;任务异常后正在重试&#39;)
</span></span><span class="line"><span class="cl">        elif async.status == &#39;STARTED&#39;:
</span></span><span class="line"><span class="cl">            print(&#39;任务已经开始被执行&#39;)    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">#执行定时任务
</span></span><span class="line"><span class="cl">#celery_task\celery.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    from celery import Celery
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    broker = &#39;redis://127.0.0.1:6379/1&#39;  # broker任务队列
</span></span><span class="line"><span class="cl">    backend = &#39;redis://127.0.0.1:6379/2&#39;  # 结构存储，执行完的结果存在这
</span></span><span class="line"><span class="cl">    app = Celery(__name__, broker=broker, backend=backend, include=[&#39;celery_task.task1&#39;, &#39;celery_task.task2&#39;])
</span></span><span class="line"><span class="cl">    # 执行定时任务
</span></span><span class="line"><span class="cl">    # 时区
</span></span><span class="line"><span class="cl">    app.conf.timezone = &#39;Asia/Shanghai&#39;
</span></span><span class="line"><span class="cl">    # 是否使用UTC
</span></span><span class="line"><span class="cl">    app.conf.enable_utc = False
</span></span><span class="line"><span class="cl">    # 任务的定时配置
</span></span><span class="line"><span class="cl">    from datetime import timedelta
</span></span><span class="line"><span class="cl">    from celery.schedules import crontab
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    app.conf.beat_schedule = {
</span></span><span class="line"><span class="cl">        &#39;add-task&#39;: {
</span></span><span class="line"><span class="cl">            &#39;task&#39;: &#39;celery_task.task1.add&#39;,
</span></span><span class="line"><span class="cl">            # &#39;schedule&#39;: timedelta(seconds=3),
</span></span><span class="line"><span class="cl">            &#39;schedule&#39;: crontab(hour=8, day_of_week=1),  # 每周一早八点
</span></span><span class="line"><span class="cl">            &#39;args&#39;: (300, 150),
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">#pycharm终端执行
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	#启动worker，等待任务
</span></span><span class="line"><span class="cl">	-celery worker -A celery_task -l info -P eventlet
</span></span><span class="line"><span class="cl">    #启动beat，提交任务，如果报错删除产生的文件
</span></span><span class="line"><span class="cl">	-celery beat -A celery_task -l info
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="18综合应用">18、综合应用</h3>
<h4 id="181-应用一">18.1 应用一</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">实现单条修改，批量修改，批量删除，分页，根据ip限制用户频率
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## urls
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import path,re_path
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;books/&#39;, views.BookAPIView.as_view()),
</span></span><span class="line"><span class="cl">    path(&#39;books2/&#39;, views.BookView.as_view()),  # 继承了ListApiView
</span></span><span class="line"><span class="cl">    re_path(&#39;books/(?P&lt;PK&gt;\d+)&#39;, views.BookAPIView.as_view()),
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## views
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.shortcuts import render
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Create your views here.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from rest_framework.views import APIView
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl">from app01.ser import BookModelSerializer
</span></span><span class="line"><span class="cl">from rest_framework.response import Response
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookAPIView(APIView):
</span></span><span class="line"><span class="cl">    def get(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        # 查询单个和查询所有合在一起,查出所有没删除的书
</span></span><span class="line"><span class="cl">        # 查所有
</span></span><span class="line"><span class="cl">        book_list = models.Book.objects.all().filter(is_delete=False)
</span></span><span class="line"><span class="cl">        book_list_ser = BookModelSerializer(book_list,many=True)
</span></span><span class="line"><span class="cl">        return Response(data=book_list_ser.data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def post(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        # 具备增单挑，和增多条的功能
</span></span><span class="line"><span class="cl">        if isinstance(request.data,dict):
</span></span><span class="line"><span class="cl">            book_ser = BookModelSerializer(data=request.data)
</span></span><span class="line"><span class="cl">            book_ser.is_valid(raise_exception=True)
</span></span><span class="line"><span class="cl">            book_ser.save()
</span></span><span class="line"><span class="cl">            return Response(data=book_ser.data)
</span></span><span class="line"><span class="cl">        elif isinstance(request.data,list):
</span></span><span class="line"><span class="cl">            # 现在book_ser是ListSerializer
</span></span><span class="line"><span class="cl">            book_ser = BookModelSerializer(data=request.data,many=True)  # 增多条
</span></span><span class="line"><span class="cl">            book_ser.is_valid(raise_exception=True)
</span></span><span class="line"><span class="cl">            book_ser.save()
</span></span><span class="line"><span class="cl">            return Response(data=book_ser.data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def put(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        # 改一个，改多个
</span></span><span class="line"><span class="cl">        # 改一个
</span></span><span class="line"><span class="cl">        if kwargs.get(&#39;pk&#39;,None):
</span></span><span class="line"><span class="cl">            book=models.Book.objects.filter(pk=kwargs.get(&#39;pk&#39;)).first()
</span></span><span class="line"><span class="cl">            # partial=True可以部分修改
</span></span><span class="line"><span class="cl">            book_ser = BookModelSerializer(instance=book,data=request.data,partial=True)  # 增多条
</span></span><span class="line"><span class="cl">            print(type(book_ser))
</span></span><span class="line"><span class="cl">            book_ser.is_valid(raise_exception=True)
</span></span><span class="line"><span class="cl">            book_ser.save()
</span></span><span class="line"><span class="cl">            return Response(data=book_ser.data)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            # 改多个 ，前端传来多个数据格式 [{id:1,name:xx},{id:1,name:xx},{id:1,name:xx}]
</span></span><span class="line"><span class="cl">            # 需要处理传入的数据 对象列表[book1,book2]   修改的数据列表 [{name:xx},{name:xx},{name:xx}]
</span></span><span class="line"><span class="cl">            book_list = []
</span></span><span class="line"><span class="cl">            modify_data=[]
</span></span><span class="line"><span class="cl">            for item in request.data:
</span></span><span class="line"><span class="cl">                pk = item.pop(&#39;pk&#39;)
</span></span><span class="line"><span class="cl">                book = models.Book.objects.get(pk=pk)
</span></span><span class="line"><span class="cl">                book_list.append(book)
</span></span><span class="line"><span class="cl">                modify_data.append(item)
</span></span><span class="line"><span class="cl">            # 第一种方案，for循环一个一个修改
</span></span><span class="line"><span class="cl">            # 第二种方案，重写ListSerializer的uptada方法
</span></span><span class="line"><span class="cl">            # ps：当many=True的时候book_ser的类型是ListSerializer
</span></span><span class="line"><span class="cl">            # book_ser = BookModelSerializer(instance=对象列表,data=修改的数据列表,many=True)
</span></span><span class="line"><span class="cl">            book_ser = BookModelSerializer(instance=book_list,data=modify_data,many=True)
</span></span><span class="line"><span class="cl">            book_ser.is_valid(raise_exception=True)
</span></span><span class="line"><span class="cl">            book_ser.save()  # 这里其实调用的是ListSerializer的updata方法
</span></span><span class="line"><span class="cl">            return Response(book_ser.data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def delete(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        # 单个删除和批量删除
</span></span><span class="line"><span class="cl">        pk = kwargs.get(&#39;pk&#39;)
</span></span><span class="line"><span class="cl">        pks = []
</span></span><span class="line"><span class="cl">        if pk:
</span></span><span class="line"><span class="cl">            # 单挑删除
</span></span><span class="line"><span class="cl">            pks.append(pk)
</span></span><span class="line"><span class="cl">        # 不管单条删除还是多条删除，都用多条删除
</span></span><span class="line"><span class="cl">        # 多条删除
</span></span><span class="line"><span class="cl">        # {&#39;pks&#39;:[1,2,3]}
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            pks = request.data.get(&#39;pks&#39;)
</span></span><span class="line"><span class="cl">        # 把is_delete设置为true
</span></span><span class="line"><span class="cl">        # ret返回受影响的行数
</span></span><span class="line"><span class="cl">        ret = models.Book.objects.filter(pk__in=pks,is_delete=False).update(is_delete=True)
</span></span><span class="line"><span class="cl">        if ret:
</span></span><span class="line"><span class="cl">            return Response(data={&#39;msg&#39;:&#39;删除成功&#39;})
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            return Response(data={&#39;msg&#39;:&#39;没有删除数据&#39;})
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 内置有三种分页
</span></span><span class="line"><span class="cl">from rest_framework.pagination import PageNumberPagination,LimitOffsetPagination,CursorPagination
</span></span><span class="line"><span class="cl">class MyLimitOffsetPagination(LimitOffsetPagination):
</span></span><span class="line"><span class="cl">    default_limit = 3       # 每页条数
</span></span><span class="line"><span class="cl">    limit_query_param = &#39;limit&#39;     # 往后拿几条
</span></span><span class="line"><span class="cl">    offset_query_param = &#39;offset&#39;   # 标杆
</span></span><span class="line"><span class="cl">    max_limit = 5   # 每页最大几条数据
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    如果标杆为二，则表示插在第二条数据上，然后可以基于第二条数据再往后设置想要
</span></span><span class="line"><span class="cl">    拿的数据条数
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyCursorPagination(CursorPagination):
</span></span><span class="line"><span class="cl">    cursor_query_param = &#39;cursor&#39;   # 每一页查询的key
</span></span><span class="line"><span class="cl">    page_size = 2   # 每一页显示的条数
</span></span><span class="line"><span class="cl">    ordering = &#39;-price&#39;   # 排序字段
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    这种方式就是速度快，只有上一页和下一页
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class MyPageNumberPagination(PageNumberPagination):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    PageNumberPagination
</span></span><span class="line"><span class="cl">        PAGE_SIZE: 每页显示的条数
</span></span><span class="line"><span class="cl">        page_query_param: 每页数目的关键词
</span></span><span class="line"><span class="cl">        max_page_size: 限制一页最多多少数据
</span></span><span class="line"><span class="cl">        page_size_query_param: 表示每一页查看多少条数据，在浏览器上可以加参数查看
</span></span><span class="line"><span class="cl">        http://127.0.0.1:8000/api/books2/?aaa=1&amp;size=3
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    page_size = 1
</span></span><span class="line"><span class="cl">    page_query_param = &#39;aaa&#39;
</span></span><span class="line"><span class="cl">    page_size_query_param = &#39;size&#39;
</span></span><span class="line"><span class="cl">    max_page_size = 3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 使用ListAPIView分页
</span></span><span class="line"><span class="cl">from rest_framework.generics import ListAPIView
</span></span><span class="line"><span class="cl">class BookView(ListAPIView):
</span></span><span class="line"><span class="cl">    queryset = models.Book.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = BookModelSerializer
</span></span><span class="line"><span class="cl">    # 配置分页
</span></span><span class="line"><span class="cl">    pagination_class = MyCursorPagination
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 使用APIView分页
</span></span><span class="line"><span class="cl">class BookView2(APIView):
</span></span><span class="line"><span class="cl">    def get(self,request,*args,**kwargs):
</span></span><span class="line"><span class="cl">        book_list = models.Book.objects.all()
</span></span><span class="line"><span class="cl">        # 实例化得到一个分页器对象
</span></span><span class="line"><span class="cl">        page_cursor = MyPageNumberPagination()
</span></span><span class="line"><span class="cl">        book_list = page_cursor.paginate_queryset(book_list,request,view=self)
</span></span><span class="line"><span class="cl">        next_url = page_cursor.get_next_link()
</span></span><span class="line"><span class="cl">        pr_url = page_cursor.get_previous_link()
</span></span><span class="line"><span class="cl">        print(next_url)
</span></span><span class="line"><span class="cl">        print(pr_url)
</span></span><span class="line"><span class="cl">        book_ser = BookModelSerializer(book_list, many=True)
</span></span><span class="line"><span class="cl">        return Response(data=book_ser.data)
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## models
</span></span><span class="line"><span class="cl">from django.db import models
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">外键补充
</span></span><span class="line"><span class="cl">models.CASCADE  级联删除
</span></span><span class="line"><span class="cl">DO_NOTHING  删除关联数据
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BaseModel(models.Model):
</span></span><span class="line"><span class="cl">    is_delete = models.BooleanField(default=False)
</span></span><span class="line"><span class="cl">    # auto_now_add=True 只要记录创建的时候，不需要手动插入时间，自动插入当前时间
</span></span><span class="line"><span class="cl">    create_time = models.DateTimeField(auto_now_add=True)
</span></span><span class="line"><span class="cl">    # auto_now=True 只要更新，就会把当前时间插入
</span></span><span class="line"><span class="cl">    last_update_time = models.DateTimeField(auto_now=True)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        # 单个字段，有索引，有唯一
</span></span><span class="line"><span class="cl">        # 多个字段，有联合索引，联合唯一
</span></span><span class="line"><span class="cl">        abstract = True  # 抽象表，不在数据库建立表
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Book(BaseModel):
</span></span><span class="line"><span class="cl">    id = models.AutoField(primary_key=True)
</span></span><span class="line"><span class="cl">    # verbose_name=&#39;书名&#39;admin中显示中文
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32, verbose_name=&#39;书名&#39;, help_text=&#39;这里填书名&#39;)
</span></span><span class="line"><span class="cl">    price = models.DecimalField(max_digits=5, decimal_places=2)
</span></span><span class="line"><span class="cl">    # 一对多的关系一旦确立，关联字段建在多的一方
</span></span><span class="line"><span class="cl">    # to_field默认不写，关联到publish主键
</span></span><span class="line"><span class="cl">    # db_constraint表示逻辑上是有外键关联，实际上是没外键的，增删不会受外键影响，orm该怎么用怎么用
</span></span><span class="line"><span class="cl">    publish = models.ForeignKey(to=&#39;Publish&#39;, on_delete=models.DO_NOTHING, db_constraint=False)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 和作者多对多，关联字段写在查询次数多的一方
</span></span><span class="line"><span class="cl">    # 什么时候用自动，什么时候用手动？ 第三章表只有关联字段，用自动。第三张表有扩展字段，需要手动
</span></span><span class="line"><span class="cl">    # 这个字段不能写on_delete，应为他有第三张表
</span></span><span class="line"><span class="cl">    authors = models.ManyToManyField(to=&#39;Author&#39;, db_constraint=False)
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        verbose_name_plural = &#39;书表&#39;  # admin中表名的显示
</span></span><span class="line"><span class="cl">    def __str__(self):
</span></span><span class="line"><span class="cl">        return self.name
</span></span><span class="line"><span class="cl">    @property
</span></span><span class="line"><span class="cl">    def publish_name(self):
</span></span><span class="line"><span class="cl">        return self.publish.name
</span></span><span class="line"><span class="cl">    def author_list(self):
</span></span><span class="line"><span class="cl">        author_list = self.authors.all()
</span></span><span class="line"><span class="cl">        # ll = []
</span></span><span class="line"><span class="cl">        # for author in author_list:
</span></span><span class="line"><span class="cl">        #     ll.append({&#39;name&#39;:author.name,&#39;sex&#39;:author.sex})
</span></span><span class="line"><span class="cl">        # return ll
</span></span><span class="line"><span class="cl">        return [{&#39;name&#39;:author.name,&#39;sex&#39;:author.sex} for author in author_list]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Publish(BaseModel):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    addr = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    def __str__(self):
</span></span><span class="line"><span class="cl">        return self.name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Author(BaseModel):
</span></span><span class="line"><span class="cl">    name = models.CharField(max_length=32)
</span></span><span class="line"><span class="cl">    sex = models.IntegerField(choices=((1, &#39;男&#39;), (2, &#39;女&#39;)))
</span></span><span class="line"><span class="cl">    # 一对一关系，写在查询频率高的一方
</span></span><span class="line"><span class="cl">    # OneToOneField本质就是ForeignKey+unique
</span></span><span class="line"><span class="cl">    authordetail = models.OneToOneField(to=&#39;AuthorDetail&#39;, db_constraint=False, on_delete=models.CASCADE)
</span></span><span class="line"><span class="cl">    def __str__(self):
</span></span><span class="line"><span class="cl">        return self.name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class AuthorDetail(BaseModel):
</span></span><span class="line"><span class="cl">    mobile = models.CharField(max_length=11)
</span></span><span class="line"><span class="cl">    def __str__(self):
</span></span><span class="line"><span class="cl">        return self.mobile
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">表断关联
</span></span><span class="line"><span class="cl">1、表之间没有外键关联，但是有外键逻辑关联(有充当外键的字段)
</span></span><span class="line"><span class="cl">2、断关联后不会影响数据库查询效率，但是会极大提高数据库增删改效率(不影响增删改查操作)
</span></span><span class="line"><span class="cl">3、断关联一定要通过逻辑保证表之间数据的安全，不要出现脏数据，代码来控制
</span></span><span class="line"><span class="cl">4、级联关系
</span></span><span class="line"><span class="cl">    作者没了，详情也没：on_delete = models.CASCADE
</span></span><span class="line"><span class="cl">    出版社没了，书还是那个出版社出版：on_delete = models.DO_NOTHING
</span></span><span class="line"><span class="cl">    部门没了，员工没有部门(空部门)：null=True，on_delete = models.SET_NULL
</span></span><span class="line"><span class="cl">    部门没了，员工进入默认部门(默认值)：default=0，on_delete = models.SET_DEFAULT
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## ser
</span></span><span class="line"><span class="cl">from rest_framework import serializers
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 写一个类继承ListSerializer,重写updata
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class BookListSerializer(serializers.ListSerializer):
</span></span><span class="line"><span class="cl">    # def create(self, validated_data):
</span></span><span class="line"><span class="cl">    #     pass
</span></span><span class="line"><span class="cl">    def update(self, instance, validated_data):
</span></span><span class="line"><span class="cl">        print(instance)
</span></span><span class="line"><span class="cl">        print(validated_data)
</span></span><span class="line"><span class="cl">        # 保存数据
</span></span><span class="line"><span class="cl">        # self.child:是BookModelSerializer对象,所以下面调的是对象的update方法
</span></span><span class="line"><span class="cl">        # ll = []
</span></span><span class="line"><span class="cl">        # for i,si_data in enumerate(validated_data):
</span></span><span class="line"><span class="cl">        #     ret = self.child.update(instance[i],si_data)
</span></span><span class="line"><span class="cl">        #     ll.append(ret)
</span></span><span class="line"><span class="cl">        # return ll
</span></span><span class="line"><span class="cl">        return [
</span></span><span class="line"><span class="cl">            # self.child.update(对象，字典)
</span></span><span class="line"><span class="cl">            self.child.update(instance[i],attrs) for i,attrs in enumerate(validated_data)
</span></span><span class="line"><span class="cl">        ]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 如果序列化的是数据库的表，尽量用ModelSerializer
</span></span><span class="line"><span class="cl">class BookModelSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    # 一种方案(只序列化可以，反序列化有问题)
</span></span><span class="line"><span class="cl">    # publish = serializers.CharField(source=&#39;publish.name&#39;)
</span></span><span class="line"><span class="cl">    # 第二种方案，models中写方法
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        list_serializer_class = BookListSerializer
</span></span><span class="line"><span class="cl">        model = models.Book
</span></span><span class="line"><span class="cl">        # fields = &#39;__all__&#39;
</span></span><span class="line"><span class="cl">        # 用的比较少
</span></span><span class="line"><span class="cl">        # depth = 0
</span></span><span class="line"><span class="cl">        fields = (&#39;name&#39;,&#39;price&#39;,&#39;authors&#39;,&#39;publish&#39;,&#39;publish_name&#39;,&#39;author_list&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        extra_kwargs = {
</span></span><span class="line"><span class="cl">            &#39;publish&#39;:{&#39;write_only&#39;:True},
</span></span><span class="line"><span class="cl">            &#39;publish_name&#39;:{&#39;read_only&#39;:True},
</span></span><span class="line"><span class="cl">            &#39;author_list&#39;:{&#39;read_only&#39;:True},
</span></span><span class="line"><span class="cl">            &#39;authors&#39;:{&#39;write_only&#39;:True},
</span></span><span class="line"><span class="cl">        }
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## admin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Register your models here.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">admin.site.register(models.Book)
</span></span><span class="line"><span class="cl">admin.site.register(models.Publish)
</span></span><span class="line"><span class="cl">admin.site.register(models.Author)
</span></span><span class="line"><span class="cl">admin.site.register(models.AuthorDetail)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="182-应用二">18.2 应用二</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、自定义user表，新增mobile唯一约束字段；新增icon图片字段
</span></span><span class="line"><span class="cl">2、在定义User表基础上，用genericViewSet + CreateModelMixin + serializer完成User表新增接口(就是注册接口)(ps:序列化类要重写create方法，不然的话密码就是明文)
</span></span><span class="line"><span class="cl">3、在定义User表基础上，用genericViewSet + RetrieveModelMixin + serializer完成User表单查(就是用户中心)
</span></span><span class="line"><span class="cl">4、在自定义User表基础上，用genericViewSet + UpdateModelMixin + serializer完成用户头像的修改
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## settings
</span></span><span class="line"><span class="cl">MEDIA_URL = &#39;/media/&#39;
</span></span><span class="line"><span class="cl">MEDIA_ROOT= os.path.join(BASE_DIR,&#39;media&#39;)    # 真正的文件夹路径
</span></span><span class="line"><span class="cl">AUTH_USER_MODEL = &#39;app01.user&#39;  # app名.表名
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## 主urls
</span></span><span class="line"><span class="cl">from django.contrib import admin
</span></span><span class="line"><span class="cl">from django.urls import path,include,re_path
</span></span><span class="line"><span class="cl">from django.views.static import serve # django内置给你的一个视图函数
</span></span><span class="line"><span class="cl">from django.conf import settings    # 以后取配置文件都用这个
</span></span><span class="line"><span class="cl"># from djangoProject1 import settings
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    path(&#39;admin/&#39;, admin.site.urls),
</span></span><span class="line"><span class="cl">    path(&#39;api/&#39;, include(&#39;app01.urls&#39;)),    # 路由分发
</span></span><span class="line"><span class="cl">    # 开放media文件
</span></span><span class="line"><span class="cl">    re_path(&#39;media/(?P&lt;path&gt;.*)&#39;,serve,{&#39;document_root&#39;:settings.MEDIA_ROOT})
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## 次urls
</span></span><span class="line"><span class="cl">from django.urls import path,include
</span></span><span class="line"><span class="cl">from app01 import views
</span></span><span class="line"><span class="cl">from rest_framework.routers import SimpleRouter
</span></span><span class="line"><span class="cl">router = SimpleRouter()
</span></span><span class="line"><span class="cl">router.register(&#39;register&#39;,views.RegisterView)
</span></span><span class="line"><span class="cl">print(router.urls)
</span></span><span class="line"><span class="cl">urlpatterns = [
</span></span><span class="line"><span class="cl">    # path(&#39;&#39;, include(router.urls)), # 第二种方式
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">urlpatterns += router.urls  # 第一种方式
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## models
</span></span><span class="line"><span class="cl">from django.db import models
</span></span><span class="line"><span class="cl">from django.contrib.auth.models import AbstractUser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class User(AbstractUser):
</span></span><span class="line"><span class="cl">    mobile = models.CharField(max_length=32,unique=True)
</span></span><span class="line"><span class="cl">    # 需要配media文件夹，上传的文件就会放在media文件夹
</span></span><span class="line"><span class="cl">    icon = models.ImageField(upload_to=&#39;icon&#39;, default=&#39;icon/default.png&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## ser
</span></span><span class="line"><span class="cl">from rest_framework import serializers
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl">from rest_framework.exceptions import ValidationError
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class UserModelSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    re_password = serializers.CharField(max_length=16,min_length=4,required=True,write_only=True)   # 因为re_password在表中没有，需要在这里定义
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        model = models.User
</span></span><span class="line"><span class="cl">        fields = [&#39;username&#39;,&#39;password&#39;,&#39;mobile&#39;,&#39;re_password&#39;,&#39;icon&#39;]
</span></span><span class="line"><span class="cl">        extra_kwargs = {
</span></span><span class="line"><span class="cl">            &#39;username&#39;:{&#39;max_length&#39;:16},
</span></span><span class="line"><span class="cl">            # 我只写password，反序列化的时候没有password字段
</span></span><span class="line"><span class="cl">            &#39;password&#39;:{&#39;write_only&#39;:True},
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 局部钩子
</span></span><span class="line"><span class="cl">    def validate_mobile(self,data):
</span></span><span class="line"><span class="cl">        if not len(data) == 11:
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;手机号不合法&#39;)
</span></span><span class="line"><span class="cl">        return data
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # 全局钩子
</span></span><span class="line"><span class="cl">    def validate(self, attrs):
</span></span><span class="line"><span class="cl">        if not attrs.get(&#39;password&#39;) == attrs.get(&#39;re_password&#39;):
</span></span><span class="line"><span class="cl">            raise ValidationError(&#39;两次密码不一致&#39;)
</span></span><span class="line"><span class="cl">        attrs.pop(&#39;re_password&#39;)    # 剔除改字段，因为数据库没有改字段
</span></span><span class="line"><span class="cl">        return attrs
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def create(self, validated_data):
</span></span><span class="line"><span class="cl">        # attrs.pop(&#39;re_password&#39;) 如果上面没有剔除，在这里也可以
</span></span><span class="line"><span class="cl">        # models.User.objects.create(**validated_data)    # 这个密码不会加密
</span></span><span class="line"><span class="cl">        user = models.User.objects.create_user(**validated_data)
</span></span><span class="line"><span class="cl">        return user
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class User2ModelSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        model = models.User
</span></span><span class="line"><span class="cl">        fields = [&#39;username&#39;,&#39;icon&#39;]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class UserImageSerializer(serializers.ModelSerializer):
</span></span><span class="line"><span class="cl">    class Meta:
</span></span><span class="line"><span class="cl">        model = models.User
</span></span><span class="line"><span class="cl">        fields = [&#39;icon&#39;]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## views
</span></span><span class="line"><span class="cl">from rest_framework.viewsets import GenericViewSet
</span></span><span class="line"><span class="cl"># CreateModelMixin:重写了as_view，路由配置变样了，
</span></span><span class="line"><span class="cl">from rest_framework.mixins import CreateModelMixin,RetrieveModelMixin,UpdateModelMixin
</span></span><span class="line"><span class="cl">from app01 import models
</span></span><span class="line"><span class="cl">from app01 import ser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class RegisterView(GenericViewSet,CreateModelMixin,RetrieveModelMixin,UpdateModelMixin):
</span></span><span class="line"><span class="cl">    queryset = models.User.objects.all()
</span></span><span class="line"><span class="cl">    serializer_class = ser.UserModelSerializer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 假设get请求和post请求用的序列化类不一样如何处理？
</span></span><span class="line"><span class="cl"># 重写get_serializer_class ，返回啥，用的序列化类就是啥
</span></span><span class="line"><span class="cl"># 注册用的序列化类是UserModelSerializer，查询一个用的是User2ModelSerializer
</span></span><span class="line"><span class="cl">    def get_serializer_class(self):
</span></span><span class="line"><span class="cl">        # action只有两种情况，create，retrieve，如果是create就走一个序列化类，如果是另外一种则走另一种序列化类
</span></span><span class="line"><span class="cl">        print(self.action)
</span></span><span class="line"><span class="cl">        if self.action == &#39;create&#39;:
</span></span><span class="line"><span class="cl">            return ser.UserModelSerializer
</span></span><span class="line"><span class="cl">        elif self.action == &#39;retrieve&#39;:
</span></span><span class="line"><span class="cl">            return ser.User2ModelSerializer
</span></span><span class="line"><span class="cl">        elif self.action == &#39;update&#39;:
</span></span><span class="line"><span class="cl">            return ser.UserImageSerializer
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="18drf总结">18、drf总结</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、restful规范--10条
</span></span><span class="line"><span class="cl"># 2、django上写符合restful规范的接口
</span></span><span class="line"><span class="cl"># 3、drf写接口
</span></span><span class="line"><span class="cl"># 4、APIView--》继承了原生View--》get，post方法
</span></span><span class="line"><span class="cl">	-(为什么get请求来了就会执行get方法:原生View)
</span></span><span class="line"><span class="cl">	-路由配置：视图类.as_view()--&gt;view(闭包函数)的内存地址
</span></span><span class="line"><span class="cl">	-请求来了，就会执行view(request,分组分出的字段，默认传的字段)--》self.dispatch()--&gt;处理的
</span></span><span class="line"><span class="cl">	-APIView重写了dispatch：包装了request对象，解析器，分页，三大认证，响应器，全局异常，去掉csrf
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"># 5、Request对象：request._request.request.data
</span></span><span class="line"><span class="cl">	-前端传过来的数据从哪取？
</span></span><span class="line"><span class="cl">		-地址栏里的数据:request.GET/query_params
</span></span><span class="line"><span class="cl">		-请求体中的数据:request.data/POST(json格式解释不了)--》request.body中取
</span></span><span class="line"><span class="cl">		-请求头中数据：request.META.get(&#34;HTTP_变成大写&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 6、Response对象 --》封装了原生的HttpResponse，Response(data，headars={},status=1/2/3/4/5开头的)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 7、自己封装了Response对象
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 8、序列化类：
</span></span><span class="line"><span class="cl">	-Serializer
</span></span><span class="line"><span class="cl">		-写字段，字段名要更表的字段对应，想不对应(在字段属性里面source可以修改)
</span></span><span class="line"><span class="cl">		-SerilizerMethodField必须配套一个get_字段名，返回什么，前台就看到什么
</span></span><span class="line"><span class="cl">	-ModelSerializer
</span></span><span class="line"><span class="cl">		-class Meta:
</span></span><span class="line"><span class="cl">			表对应
</span></span><span class="line"><span class="cl">			取出字段(__all__,列表)
</span></span><span class="line"><span class="cl">			排除字段(用的很少)
</span></span><span class="line"><span class="cl">			extra_kwargs会给字段的属性
</span></span><span class="line"><span class="cl">		-重写某个字段
</span></span><span class="line"><span class="cl">			# 伪代码
</span></span><span class="line"><span class="cl">			password = serializers
</span></span><span class="line"><span class="cl">            def get_password(self,instance):
</span></span><span class="line"><span class="cl">            	return &#34;***&#34;
</span></span><span class="line"><span class="cl">        -校验：字段自己的校验，局部钩子，全局钩子
</span></span><span class="line"><span class="cl">            -只要序列化类的对象执行了is_valiad(),这些钩子都会走，可以在钩子里写逻辑
</span></span><span class="line"><span class="cl">            -在表模型(model)中写方法，可以在上面取出的字段中直接写(fields里面直接写)，但是改字段不参与反序列化
</span></span><span class="line"><span class="cl">		-序列化多条(many=True):本质，ListSerializer内部套了一个个的serializer对象
</span></span><span class="line"><span class="cl">		-重写ListSerializer，让序列化对象和自己写的ListSerializer对应上(了解可看综合应用一)
</span></span><span class="line"><span class="cl">		-序列化类(instance,data,many,context={request:request})
</span></span><span class="line"><span class="cl">			(ps：context给什么东西，在序列化对象里就可以看到什么,把request对象传过去，就可以在序列化类里面写逻辑)
</span></span><span class="line"><span class="cl">		-视图函数中给序列化对象传递数据，使用context，传回来，放进去直接使用序列化对象.context.get获取
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl"># 9、视图
</span></span><span class="line"><span class="cl">	-两个视图基类APIView，GenericAPIView(继承APIView)：涉及到数据库和序列化类的操作。尽量用GenericAPIView，不涉及数据库和序列化类的操作，尽量用APIView
</span></span><span class="line"><span class="cl">	-5个视图扩展类
</span></span><span class="line"><span class="cl">		ListModelMixin
</span></span><span class="line"><span class="cl">		CreateModelMixin
</span></span><span class="line"><span class="cl">		RetrieveModelMixin
</span></span><span class="line"><span class="cl">		UpdateModelMixin
</span></span><span class="line"><span class="cl">		DestroyModelMixin
</span></span><span class="line"><span class="cl">	-9个视图子类他们就是(GenericAPIView+上面5个视图扩展类中的一个或多个)
</span></span><span class="line"><span class="cl">	    CreateAPIView,
</span></span><span class="line"><span class="cl">        ListAPIView,
</span></span><span class="line"><span class="cl">        UpdateAPIView,
</span></span><span class="line"><span class="cl">        RetrieveAPIView,
</span></span><span class="line"><span class="cl">        DestroyAPIView,
</span></span><span class="line"><span class="cl">        ListCreateAPIView,
</span></span><span class="line"><span class="cl">        RetrieveUpdateAPIView,
</span></span><span class="line"><span class="cl">        RetrieveUpdateDestroyAPIView,
</span></span><span class="line"><span class="cl">        RetrieveDestroyAPIView,
</span></span><span class="line"><span class="cl">    -视图集
</span></span><span class="line"><span class="cl">    	-ModelViewSet：继承了上面所有的，五大接口都有了
</span></span><span class="line"><span class="cl">    	-ReadOnlyModeViewSet：获取一条和多条的接口
</span></span><span class="line"><span class="cl">    	-GenericViewSet：ViewSetMixin+GenericAPIView
</span></span><span class="line"><span class="cl">    	ViewSet：ViewSetMixin+APIView
</span></span><span class="line"><span class="cl">    	ViewSetMixin：类重写了as_view,路由配置变样了
</span></span><span class="line"><span class="cl">    	
</span></span><span class="line"><span class="cl">    	
</span></span><span class="line"><span class="cl"># 10、路由
</span></span><span class="line"><span class="cl">	-基本配置：跟之前一样
</span></span><span class="line"><span class="cl">	-有action的：必须继承ViewSetMixin
</span></span><span class="line"><span class="cl">	-自动生成的：default和SimleRouter
</span></span><span class="line"><span class="cl">		-导入实例化得到对象，然后注册，然后对象.urls(自动生成的路由)
</span></span><span class="line"><span class="cl">		-路由相加urlpatterns+=router.urls/include:path(&#39;&#39;,include(router.urls))
</span></span><span class="line"><span class="cl">	-视图类中自己定义的方法，如何自动生成路由
</span></span><span class="line"><span class="cl">		-在自己定义的方法上加装饰器(action)
</span></span><span class="line"><span class="cl">		-两个参数methods=[GET,POST],表示这两种请求都能接收
</span></span><span class="line"><span class="cl">		-两个参数detail=True，表示生成带pk的连接
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 11、三大认证
</span></span><span class="line"><span class="cl">	-认证组件：校验用户是否登录
</span></span><span class="line"><span class="cl">		-写一个认证类，继承BaseAuthentication，重写authenticat，内部写认证逻辑，认证通过返回两个值，第一个是user，认证失败，抛异常
</span></span><span class="line"><span class="cl">		-全局使用，局部使用，局部警用
</span></span><span class="line"><span class="cl">	-权限：校验用户是否有权限进行后续操作
</span></span><span class="line"><span class="cl">		-写一个类，继承BasePermission，重写has_permission,True和False
</span></span><span class="line"><span class="cl">		-全局使用，局部使用，局部警用
</span></span><span class="line"><span class="cl">	-频率：限制用户访问频次
</span></span><span class="line"><span class="cl">		-写一个类，继承SimpleRateThrottle，重写get_cache_key,返回什么就以谁做限制，scop字段，需要跟setting中key对应
</span></span><span class="line"><span class="cl">		-全局使用，局部使用，局部警用
</span></span><span class="line"><span class="cl">		-需求：发送短信验证码的接口，一分钟只能发送一次，局部使用，配在视图类上
</span></span><span class="line"><span class="cl"># 12、解析器：前端传的编码格式，能不能解析(默认三种全配了，基本不需要改)，可能你写了个上传文件接口，局部配置一下，只能传form-data格式，局部使用：MultiParParser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 13、响应器：响应的数据，是json格式还是带浏览器的那种(不需要配)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 14、过滤器：借助于第三方django-filter
</span></span><span class="line"><span class="cl">	-注册应用
</span></span><span class="line"><span class="cl">	-setting中配置DjangoFilterBackend或者局部配置
</span></span><span class="line"><span class="cl">	-filter_fields = (&#39;age&#39;,&#39;sex&#39;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 15、排序
</span></span><span class="line"><span class="cl">	-全局或者局部配置rest_framework.filters.OrderingFilter
</span></span><span class="line"><span class="cl">	-视图类中配置：ordering_fields = (&#39;id&#39;,&#39;age&#39;)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"># 16、分页
</span></span><span class="line"><span class="cl">	-使用
</span></span><span class="line"><span class="cl">		继承了APIView的视图类中使用
</span></span><span class="line"><span class="cl">		继承了视图子类的视图中使用
</span></span><span class="line"><span class="cl">	-PageNumberPagination：最常用，需要在setting中配置page_size,四个参数
</span></span><span class="line"><span class="cl">	    PAGE_SIZE: 每页显示的条数
</span></span><span class="line"><span class="cl">        page_query_param: 每页数目的关键词
</span></span><span class="line"><span class="cl">        max_page_size: 限制一页最多多少数据
</span></span><span class="line"><span class="cl">        page_size_query_param: 表示每一页查看多少条数据，在浏览器上可以加参数查看
</span></span><span class="line"><span class="cl">        http://127.0.0.1:8000/api/books2/?aaa=1&amp;size=3
</span></span><span class="line"><span class="cl">	-LimitOffsetPagination：
</span></span><span class="line"><span class="cl">	    default_limit = 3       # 每页条数
</span></span><span class="line"><span class="cl">        limit_query_param = &#39;limit&#39;     # 往后拿几条
</span></span><span class="line"><span class="cl">        offset_query_param = &#39;offset&#39;   # 标杆
</span></span><span class="line"><span class="cl">        max_limit = 5   # 每页最大几条数据
</span></span><span class="line"><span class="cl">	-CursorPagination
</span></span><span class="line"><span class="cl">	    cursor_query_param = &#39;cursor&#39;   # 每一页查询的key
</span></span><span class="line"><span class="cl">        page_size = 2   # 每一页显示的条数
</span></span><span class="line"><span class="cl">        ordering = &#39;-price&#39;   # 排序字段
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        这种方式就是速度快，只有上一页和下一页
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"># 17、全局异常
</span></span><span class="line"><span class="cl">	-写一个方法
</span></span><span class="line"><span class="cl">	def my_exception_handler(exc, context):
</span></span><span class="line"><span class="cl">        response = exception_handler(exc, context)
</span></span><span class="line"><span class="cl">        # 两种情况，一个是None，drf没有处理
</span></span><span class="line"><span class="cl">        # response对象，django处理，但是处理的不符合咱们的要求
</span></span><span class="line"><span class="cl">        print(type(exc))
</span></span><span class="line"><span class="cl">        if not response:
</span></span><span class="line"><span class="cl">            return Response(data={&#39;status&#39;:999,&#39;msg&#39;:str(exc)},status=status.HTTP_400_BAD_REQUEST)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            if isinstance(exc, AuthenticationFailed):	
</span></span><span class="line"><span class="cl">                return Response(data={&#39;status&#39;: 777, &#39;msg&#39;: &#34;自定义未登录错误，&#34; + str(exc)}, status=status.HTTP_400_BAD_REQUEST)
</span></span><span class="line"><span class="cl">            # return response
</span></span><span class="line"><span class="cl">            return Response(data={&#39;status&#39;: 888, &#39;msg&#39;: response.data.get(&#39;detail&#39;)}, status=status.HTTP_400_BAD_REQUEST)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	-配置文件中配置(以后所有drf的异常都会走到这里)
</span></span><span class="line"><span class="cl">        REST_FRAMEWORK = {
</span></span><span class="line"><span class="cl">        &#39;EXCEPTION_HANDLER&#39;: &#39;app01.app_auth.my_exception_handler&#39;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 18、jwt
</span></span><span class="line"><span class="cl">	-是什么json web token 新的认证方式
</span></span><span class="line"><span class="cl">	-三段：头，载荷(用户信息)，签名
</span></span><span class="line"><span class="cl">	-使用：最简单方式(在路由中配置)
</span></span><span class="line"><span class="cl">		-path(&#39;login/&#39;,obtain_jwt_token)
</span></span><span class="line"><span class="cl">	-自定制：
</span></span><span class="line"><span class="cl">		多方式登录，手动签发token(两个方法)
</span></span><span class="line"><span class="cl">	-自定值基于jwt的认证类
</span></span><span class="line"><span class="cl">		-取出token
</span></span><span class="line"><span class="cl">		-调用jwt提供的解析出payload的方法(校验是否过期，是否合法，如果合法返回荷载信息)
</span></span><span class="line"><span class="cl">		-拿到荷载信息转成user对象
</span></span><span class="line"><span class="cl">		-返回
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl"># 19、RBAC：基于角色权限控制(django默认的auth就是给你做了这个事)，公司内部权限管理
</span></span><span class="line"><span class="cl">	对外的权限管理就是用三大认证
</span></span><span class="line"><span class="cl">	-用户表
</span></span><span class="line"><span class="cl">	-用户组表
</span></span><span class="line"><span class="cl">	-权限表
</span></span><span class="line"><span class="cl">	-用户对用户组中间表
</span></span><span class="line"><span class="cl">	-用户组对权限中间表
</span></span><span class="line"><span class="cl">	-用户对权限中间表
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">khw</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2022-01-07
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          <a href="/tags/django/">django</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/pythonday12%E8%B7%AF%E9%A3%9E%E9%A1%B9%E7%9B%AE/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">python,day12,路飞项目</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/pythonday10git/">
            <span class="next-text nav-default">python,day10,git</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://gitee.com/khwcloud" class="iconfont icon-github" title="github"></a>
  <a href="http://localhost:1313/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2022
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">khw</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.9e3db4166f5901c11faec00349b7b03ae36c12a6e820a208cf498f1aee812258.js"></script>








</body>
</html>
